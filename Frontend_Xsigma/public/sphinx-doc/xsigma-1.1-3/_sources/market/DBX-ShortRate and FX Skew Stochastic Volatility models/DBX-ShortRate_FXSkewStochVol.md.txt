# DBX-ShortRate_FXSkewStochVol Document

## 1 Executive Summary

The Global Model Risk Assessment is:

### Global Model Risk Assessment

| | Rating | Justification |
|---|---|---|
| Complexity | HIGH | Due to the validator SME judgement. |
| Uncertainty | HIGH | The model has a high number of trades in relation to the number of limitations applicable to the P-M specifications. |
| Reliance | HIGH | Pricing models have high reliance. |

Table 2: Model risk assessment

The uncertainty rating has been determined based on consideration of model inputs, relevant model limitations, the risk factor representation required for the products being modelled, the nature of the numerical implementation and calibration approaches employed. The complexity rating has been determined based on consideration of the number and nature of risk factors modelled including their interdependency, the calibration approach employed, the mathematical specification of the model and where relevant, the sophistication of the broader processing environment of which the model is part. The reliance of all pricing models is high as the model outputs define the relevant officially reported metrics rather than merely informing them. Reduction of reliance on pricing model outputs is similarly inappropriate.

### 1.1 Summary of main validation results

DBX-ShortRate_FXSkewStochVol is used in the valuation and risk-management of long-dated FX derivatives. In this model, the dynamics of the FX rate are represented by a lognormal process with local stochastic volatility and the dynamics of the domestic and foreign interest rates are represented by Hull-White processes with time-dependent coefficients. These features allow the model to capture stochastic interest rates, the FX volatility smile and the FX forward smile, making it appropriate for the pricing and risk management of long dated options referencing multi currency pairs. The model has a Monte Carlo implementation.

The testing performed in this report investigates the correct implementation and the behaviour of the model in EOD market scenarios and in stressed market scenarios (e.g. IRRBB, CCAR, HistSim VaR). The tests examine the robustness of the pricer and of the numerical methods in use in different market scenarios and examine the impact of different model inputs and market parameters on the price and main risk sensitivities of the products in scope. The model calibration is well documented and dedicated tests assess the robustness of the calibration. As a conclusion of the validation work, MoRM gives the models covered in this document full approval. The latest re-validation of the model was performed using DBAnalytics Version 1240. Subsequent material changes to the model must be submitted for validation.

The models contained in this document are pricing models used for the following purposes: Generate asset and liability fair value measurements reported in official books and records and/or generate risk sensitivities (i.e. for End of Day risk management purpose and/or feeding Risk and Capital calculation) and re-price positions under stress scenarios as a servicer model, in the context of regulatory stress tests i.e. CCAR, in the Interest Risk in the Banking Book ("IRRBB") Delta EVE calculation or in the context of full revaluation ("Full Reval") of (Stress) Value at Risk (HistSim, SVAR). The model is developed and maintained by DBAnalytics and is provided via dlls for use in Microsoft Excel, Python, Perl, and is made available in Kannon and Risk Engine.

The model DBX-ShortRate_FXSkewStochVol with configurations:

DBX-ShortRateNormal[LVMRAUTO]_FXSkewStochVol[DLVAUTO]

is recommended for use with the following products (for the products labelled with "*" the approved model is primary, for the others, alternative):

- CMSFXRangeAccrual
- FXAmerOpt
- FXOneBarrierOpt
- FXVolSwap
- IRFXDualDigitalOpt*
- IRFXSwapFXBasketOpt
- IRFXSwapFXOpt
- IRFXSwapFXRangeAccrual
- IRSwapQuanto
- IRSwapRangeAccrual
- IRXCcySwapAccretingCallableBerm
- IRXCcySwapCallableBerm
- LTFXConvexity*
- LTFXConvexityKnockOut*
- LTFXDigitalCallable*
- LTFXDigitalKnockOutCallable*
- LTFXParForward
- LTFXParForwardKnockOut*
- LTFXRatioForward*
- LTFXRatioForwardKnockOut*
- PRDCSwap*
- PRDCSwapCallableKO*
- PRDCSwapCallableRedemptionStrike*
- PRDCSwapKORedemptionStrike*
- PRDCSwapTarn*
- CMSFXRangeAccrualCallableBerm
- FXVarSwap
- IRFXCorrelationSwap*
- IRFXSwapDualRangeAccrual*
- IRFXSwapFXKnockOut*
- IRFXSwapFXOptCallableBerm
- IRFXSwapFXRangeAccrualCallableBerm*
- IRSwapQuantoRangeAccrualCallable*
- IRSwapNonXCcyBerm*
- IRXCcySwapCallable*
- LTFX*
- LTFXConvexityCallableKnockOut*
- LTFXDigital*
- LTFXDigitalKnockOut*
- LTFXOneBarDigitalOpt*
- LTFXParForwardCallable*
- LTFXPaymentOption*
- LTFXRatioForwardCallableKnockOut*
- LTFXResurrectingFaderOpt*
- PRDCSwapCallable*
- PRDCSwapCallableKORedemptionStrike*
- PRDCSwapKO*
- PRDCSwapRedemptionStrike*
- PRDCSwapTarnRedemptionStrike*

The above models are recommended for the following usage(s):

* End of day valuation and risk management.
* As a servicer model employed in valuation subject to CCAR stress testing scenarios and HistSim Var.
* For the calculation of Delta EVE under Interest Rate Risk in the Banking Book.

The table below summarizes the validation assessment per usage.

| Usage | Recommended for Use (RFU) |
|---|---|
| EOD | YES |
| HistSim | YES |
| CCAR | YES |
| IRRBB | YES |

Table 3: Validation Assessment

The review undertaken did not reveal any flaws in the theory or the relevant implementations. The model assumptions are detailed in the model description section.

Products labelled with "*" indicate that the approved model is primary.

The model assumptions are detailed in the model description section.

## 1.2 Limitations and Validation Findings Overview

### 1.2.1 Validation Findings

Model Limitations

For the model DBX-ShortRate_FXSkewStochVol, the following limitations have been identified, see Section 5.1.1 for further details:

* Missing Risk Factor[Correlation Skew][InstantaneousCorrelation]: The InstantaneousCorrelation framework does not have the flexibility to fit correlation skew when observed (e.g. equity basket options or cross-fx-options). [Lim ID 698]

* Missing Risk Factor[Interest Rate Smile][ShortRate]: The ShortRate framework can only produce a decreasing interest rate implied volatility profile. This assumption is reasonable for markets that do not exhibit significant implied volatility smile or when products are not sensitive to high-strikes. [Lim ID 699]

* Numerical[Monte-Carlo Error][DBX]: Monte-Carlo valuations have an error associated with them that is a function of the timegrid discretisation and number of simulations used. [Lim ID 700]

* Missing Risk Factor[Interest Rate Forward Volatility][ShortRate]: The ShortRate framework can only produce a forward volatility dynamic that does not preserve observed features in the volatility market (e.g. volatility hump). This assumption is reasonable for single expiry products or weakly path dependent products that are not strongly dependent on forward volatility. [Lim ID 2070]

* Missing Risk Factor[Correlation Uncertainty][InstantaneousCorrelation]: The Instantaneous Correlation are marked by the desk and need to be calibrated to liquid instruments having dependency to the correlation, such as Quanto-Swaps. [Lim ID 2557]

* Model Weakness[FX local-volatility parametrisation][FXSkew]: The functional parametrisation of the FXSkew framework can have limited flexibility in representing the instantaneous local volatility surface. [Lim ID 2622]

* Model Weakness[Interest Rate Market Calibration][ShortRate]: The ShortRate framework cannot simultaneously fit the entire option market (i.e. caps/swaptions of all expiries/tenors/strikes). This limitation can be ameliorated by calibrating different exotic volatilities to different parts of the volatility surface. [Lim ID 3085]

* Calibration[Calibration Uncertainty][FXSkew]: The automatic calibration of the FXSkew[DLVAUTO] model is sensitive to the choice of calibration targets (e.g. FWD, 25RR, 10CVX) and initial guesses of the vol surface parameters in the P/V VOL. The quality and appropriateness of the calibration needs to be monitored by GVG. [Lim ID 3588]

* Calibration[Model Calibration Uncertainty][FXSkewStochVol]: The calibration process may opt to exogenously set some of the model parameters instead of calibrating them to market observables (examples: MeanRevSV and LocalVolsSV of SV component, or MeanRev for Rates, where applicable). Therefore, the choice of these parameters should be monitored by GVG on a regular basis and uncertainty reserves should be computed, if deemed necessary. [Lim ID 3809]

* Model Approximation[Interest Rate Factors][FXSkew]: Cross currency type products are modelled with deterministic cross currency spreads. This should be monitored/reserved for lack of stochastic modelling. [Lim ID 4209]

## 1.3 Control Overview

The table below lists the conditions for use that have been raised to address model weaknesses identified in the course of validation. These are classified as Model Rule and should be monitored through the automated Model Parameter Monitoring process. All conditions for use are logged in MARS. Model parameters approved values and appropriate ranges are detailed in the section 6 and the parameter classification and accurate functioning of model rules is confirmed in section 5.

Table 4 lists the parameters used by the CURVE object.

| Parameter | Condition For Use ID | Approved Range | Default Value | Description |
|---|---|---|---|---|
| CURVE:: AddPar | 11032 | (NONE, LINEAR) | NONE | The property AddPar is the interpolation technique used to insert implied par swap rates between quoted market swap rates. |
| CURVE:: SmoothFutures | 11038 | (NO, YES, BACKWARD, BACKWARDDAILY) | NO | SmoothFutures = YES is designed to get smooth curve when nested (sequential) futures are inputted (e.g. input 3m futures monthly). SmoothFutures = YES globally bootstraps the future segment so that forward rates are linearly interpolated. SmoothFutures = BACKWARD: The term structure of back to back synthetic futures are created exactly like SmoothFutures = YES. But BACKWARD makes the continuously compounded forwards between the last inputted future settlement date and maturity flat. Then bootstrap backward by imposing (roughly) linear interpolation of (term) LIBOR forward rates. This method ensures LIBOR forwards after the last future settle is flat extrapolated if there were no Swaps instruments and enables us to smoothly connect with swap segment. SmoothFutures = BACKWARDDAILY: this is like BACKWARD but we create synthetic future instruments with Tenor = LiborBasis daily until the last Future settlement to avoid interpolation noise. We expect SmoothFutures = BACKWARDDAILY would give reasonable risk projection in the front end when inputting granular futures (e.g. monthly). |
| CURVE:: ExtrapMethod | 11041 | (CONSTANT_FORWARD, CONSTANT_PAR, CONSTANT_ZERO, NATIVE) | NATIVE | The property ExtrapMethod defines the method used to calculate rates beyond ExtrapTime (if specified) or the maturity of the longest quoted market instrument (otherwise). |
| CURVE:: CCYUseBaseCurve | 11044 | (NO, YES) |  | CCYUseBaseCurve controls usage of backbone curve for CCY discounting/forecasting. |
| CURVE:: OISDateCompression | 11048 | (NO, YES) | NO | When set to YES, to WAVG OIS rates calculation in CURVE bootstrap (when OISSpreadType = WAVG) and pricing is speed up with an approximation: 1b WAVG is approximated by continuous WAVG. |
| CURVE:: TurnMethod | 11054 | (CONSTANT_CASH, CONSTANT_FORWARD, PARALLEL_ZERO) | CONSTANT_CASH | The TurnMethod property dictates how rates should be calculated when one future completely encloses another, i.e. when an enclosing future both settles before and matures after another future - a situation that typically occurs when a turn future is enclosed by the December future. Even after both futures have been repriced, a further constraint is required to describe how the rates in the two segments of the enclosing future that neighbour the turn future are related. |
| CURVE:: NaturalTolerance | 11063 | like %d | 5d | Set the interval, around the LIBORMAT or SpotLiborSpread tenor, to project the closest libormat or SpotLibor spreads. Example: For 6m tenor, if NaturalTolerance is 5d, then libormat or SpotLibor spreads, without interpolation, will used for dates between 6m - 5d to 6m + 5d. Note: NaturalTolerance is not bumped. |
| CURVE:: NaturalTolerance | 11063 | <= 10 | 5d | Set the interval, around the LIBORMAT or SpotLiborSpread tenor, to project the closest libormat or SpotLibor spreads. Example: For 6m tenor, if NaturalTolerance is 5d, then libormat or SpotLibor spreads, without interpolation, will used for dates between 6m - 5d to 6m + 5d. Note: NaturalTolerance is not bumped. |
| CURVE:: RecalibMethod | 11068 | (APPROX, EXACT, EXACTFORCED) | APPROX | The flag RecalibMethod defines the interpolation of the discount factor curve. |
| CURVE:: HybridConstantForwardConnection | 11084 | (LINEAR, QUADRATIC) | QUADRATIC | The connection between the short end (built in CONSTANT_FORWARD) and the long end (HYBRID_FORWARD) of the curve is controlled by the flag HybridConstantForwardConnection. When set to QUADRATIC (default), the first instrument of the long end is built in ratio spline interpolation (curvature is calibrated). When set to LINEAR, the first instrument of the long end is built in linear interpolation (slope is calibrated) like the first instrument of HYBRID_FORWARD. LINEAR has less risk of oscillation or kinks at connection. |
| CURVE:: CashToFuture | 11085 | (EXACT, EXACTCASH, EXACTCASH-1, CASHPRIORITY, LINEAR, NONE) | LINEAR | The property CashToFuture specifies the interpolation technique used to infer the futures stub rate from cash rates. |
| CURVE:: SpotLiborUseBaseCurve | 11089 | (NO, YES) |  | SpotLiborUseBaseCurve controls usage of backbone curve for LIBOR discounting/forecasting. |
| CURVE:: BaseRateType | 13071 | (LIBOR, LIBOR-%, OIS, OIS-%) | LIBOR | BaseRateType property is recognized only when UseType is either DISCOUNTBASIS or LIBOR. This is to describe the base curve (the CURVE from CashFutures/Swaps is a LIBOR curve or OIS curve). Possible values are (1) BaseRateType = LIBOR (default) ... the curve from CashFutures/Swaps is LIBOR curve with Tenor = LiborBasis. (2) BaseRateType = LIBOR-Tenor ... the curve from CashFutures/Swaps is LIBOR curve with Tenor. LiborBasis is ignored and internally set to Tenor. (3)BaseRateType = OIS ... the curve from CashFutures/Swaps is OIS CURVE. LiborBasis is ignored. (4) BaseRateType = OIS-RateIndexType ... the curve from CashFutures/Swaps is OIS CURVE with given RateIndexSubType. This is equivalent to setting BaseRateType OIS and BaseRateIndexSubType RateIndexType. CompFreq is introduced when BaseRateType = OIS. This determines compounding frequency of OIS. |
| CURVE:: TreasuryUseBaseCurve | 13075 | (NO, YES) |  | TreasuryUseBaseCurve controls usage of backbone curve for TREASURY discounting/forecasting. |
| CURVE:: CurveType | 13076 | (LIBOR, CCYBASIS) |  | The property CurveType of an object of type CURVE defines how a given model uses the LIBOR curve and the SPREAD curve for forecasting (i.e. calculating forward rates) and discounting. In what follows, LIBOR refers to the curve created only from the tables Cash, Futures, Swaps, and SPREAD refers to the curve created from these tables plus the Spreads table. CMT refers to an object of type CMT. |
| CURVE:: Cash:: BaseCurve | 13471 | = NONE |  | When the SpotLiborSpreads subtable has the BaseCurve column, the Cash table needs to have the BaseCurve column too in order to define BaseCurve of the LIBOR cash in the Cash table. BaseCurve for RateType = OIS must be consistent what is implied by OISUseBaseCurve or UNSET. BaseCurve for RateType = LIBOR and Tenor = LiborBasis must be NONE, OIS or UNSET. |
| CURVE:: OISUseBaseCurve | 13875 | (NO, YES, HYBRID) |  | The properties UseBaseCurve are to build discounting/forecasting curves without backbone curves. For example, OISUseBaseCurve = NO means users have to input granular instruments (one spread instrument would mean a flat curve) with OISUseBaseCurve = NO. But users can expect smaller interpolation noise in DELTA when input instruments are outright rates (e.g. CASHRATE, ...). |
| CURVE:: UseType | 19781 | (CROSSCCYSWAP, DISCOUNTBASIS, LIBOR, INFLATION, TREASURY, CONVERTIBILITY, CROSSCCY) |  | The property UseType is used to define the way of building a CURVE. |
| CURVE:: BuildMethod | 19787 | (CONSTANT_FORWARD, HYBRID_CONSTANT_FORWARD, HYBRID_FORWARD, LINEAR_ZERO, QUADRATIC_FORWARD, QUADRATIC_CONSTANT_FORWARD) |  | The property BuildMethod defines the method used to calculate implied rates at maturities between quoted market instruments - it is a mandatory property for an object of type CURVE. |
| CURVE:: SPOTLIBORSPREADINTERPOLATIONS:: CASHTOFU-TURE | 19788 | (EXACT, EXACTCASH, EXACTCASH-1, CASHPRIORITY, LINEAR, NONE) | LINEAR | The property CashToFuture specifies the interpolation technique used to infer the futures stub rate from cash rates. |
| CURVE:: *:: SpreadBuildMethod | 19790 | (LINEAR_ZERO, CONSTANT_FORWARD, HYBRID_FORWARD, HYBRID_CONSTANT_FORWARD, QUADRATIC_FORWARD, QUADRATIC_CONSTANT_FORWARD) | UNSET | Users can provide SpreadBuildMethod per instrument to define from which instrument we change bootstrap. Possible values are All rows have UNSET (default): SpreadBuildMethod comes from the SpreadBuildMethod body property. All rows have the same value: build the curve with the SpreadBuildMethod. The short end is CONSTANT_FORWARD then the long end is HYBRID_FORWARD. We start CONSTANT_FORWARD for the short end then HYBRID_FORWARD in the long end. This is like HYBRID_CONSTANT_FORWARD but users define where HYBRID_FORWARD bootstrap starts. |
| CURVE:: *:: BaseCurve | 19791 | (NONE, LIBOR, LIBOR-*, OIS, OIS-*) |  | When the SpotLiborSpreads subtable has the BaseCurve column, the Cash table needs to have the BaseCurve column too in order to define BaseCurve of the LIBOR cash in the Cash table. BaseCurve for RateType = OIS must be consistent what is implied by OISUseBaseCurve or UNSET. BaseCurve for RateType = LIBOR and Tenor = LiborBasis must be NONE, OIS or UNSET. |
| CURVE:: SPOTLIBORSPREADINTERPOLATIONS:: SMOOTHFUTURES | 19792 | (NO, YES, BACKWARD, BACKWARDDAILY) | NO | SmoothFutures = YES is designed to get smooth curve when nested (sequential) futures are inputted (e.g. input 3m futures monthly). SmoothFutures = YES globally bootstraps the future segment so that forward rates are linearly interpolated. SmoothFutures = BACKWARD: The term structure of back to back synthetic futures are created exactly like SmoothFutures = YES. But BACKWARD makes the continuously compounded forwards between the last inputted future settlement date and maturity flat. Then bootstrap backward by imposing (roughly) linear interpolation of (term) LIBOR forward rates. This method ensures LIBOR forwards after the last future settle is flat extrapolated if there were no Swaps instruments and enables us to smoothly connect with swap segment. SmoothFutures = BACKWARDDAILY: this is like BACKWARD but we create synthetic future instruments with Tenor = LiborBasis daily until the last Future settlement to avoid interpolation noise. We expect SmoothFutures = BACKWARDDAILY would give reasonable risk projection in the front end when inputting granular futures (e.g. monthly). |

Table 4: CURVE object parameters used by the DBX-ShortRate_FXSkewStochVol.

Table 5 lists the parameters used by the VOL object.

| Parameter | Condition For Use ID | Approved Range | Default Value | Description |
|---|---|---|---|---|
| VOL:: CorrelationInterpolationSpace | 11088 | = TIME | TIME | CorrelationInterpolationSpace defines the direction in which correlations are interpolated: TIME interpolates between the input matrices in time. STRIKECORRELATION interpolates according to the level of the correlation basket, in correlation space. STRIKECHOLESKY interpolates, according to the level of the correlation basket, in Cholesky space. INTRINSIC: in this case, the correlation basket, defined in the CommonStateDependentCorrelation_Basket subtable, is used to drive the correlation skew. The user must enter a valid RateIndexType column, and the bare levels of those rates entered are used in the interpolation. The interpolation is done in correlation space directly. The levels of the components are not divided by the basket forward, so the weights must be chosen sensibly by the user if we have a correlation basket with RateIndexTypes from different asset classes. SIGMOID: a sigmoid function is used to interpolate correlation with parameters calculated to match the CorrUp, CorrDn and Slope input in the CorrelationSkewDrivers sub-table. GUYONLABORDERE: instead of a sigmoid function being an input function of an index level, the shift used is estimated on the fly to recover the full volatility surface of the basket, which is input with DiffusionType BASKET. TERMSKEW: this parametrizes a 2dimensional correlation skew as function of the strikes the two underlying. This can only be used with DBOPT using CopulaMethod = SIMCOPULA. |
| VOL:: Method | 13077 | = 1 | 1 | The properties Floor, Method and Weight are optional. When not provided they default to 0.01, 1 and 0.0 respectively. These properties are used only in conjunction with a SCENARIO object of UseType=SCENARIO when "MAKEVALID" is appended to the GenericScenarioType. When using a SCENARIO object in this way these parameters are used as arguments to the VolFunction("MAKEVALIDCORR") call. Details of how these parameters impact the MAKEVALIDCORR calculation can be found in the VolFunction("MAKEVALIDCORR") section. |
| VOL:: InterpType | 13080 | (LINEAR, PWCONST_R) |  | This refers to whether the functional mapping is piecewise linear or constant. An optional ExtraString ANDERSENSIDENIUS can be used to apply the scaling suggested in the paper by the authors of this name. |
| VOL:: Floor | 13081 | [0, 0.1] | 0.01 | The properties Floor, Method and Weight are optional. When not provided they default to 0.01, 1 and 0.0 respectively. These properties are used only in conjunction with a SCENARIO object of UseType=SCENARIO when "MAKEVALID" is appended to the GenericScenarioType. When using a SCENARIO object in this way these parameters are used as arguments to the VolFunction("MAKEVALIDCORR") call. Details of how these parameters impact the MAKEVALIDCORR calculation can be found in the VolFunction("MAKEVALIDCORR") section. |
| MODELVOL:: CalToEndDate | 13862 | (YES, NO) | NO | This property is only used for rates DBMVOLs when they are used as MODELVOL in dictionary. When vols are not input as MODELVOL this field has no impact. When set to NO, the MODELVOL framework exactly calibrates to the instruments given in the CalibTargets subtable. When set to YES, the MODELVOL framework ignores the tenor of the instruments given in the CalibTargets subtable and uses the EndDate of the trade instead. So this can be used for co-terminal calibration in case of callable trades. |
| VOL:: SmoothMaxBPVol | 13094 | = -9.99 |  | MaxBPVol is a property that can be given to DBMVOLs. In DBM, MAXBPVOL is currently applied only to interest rates. We can also enter a SmoothMaxBPVol which accomplishes the same effect but in a way such that the first derivative of the local vol is continuous; note that we cannot enter both MaxBPVol and SmoothMaxBPVol. |
| VOL:: MinVol | 13109 | (REFLECT-%, ABSORB-%, FLAT, ABSORB) | REFLECT | MinVol control the behaviour of the local vol surface when the vol becomes small. It can be used to prevent numerical instabilities when their volatility comes close to 0. It can be set to REFLECT-X (REFLECT), FLAT-X (FLAT) and ABSORB-X (ABSORB). (Blank X means -9.99) Where X should be a positive number or -9.99, when X = -9.99, this parameter is not activated. For REFLECT-X, vol(S, t) = Max( abs(vol(S, t)), X ). For FLAT-X, vol(S, t) = Max( vol(S, t), X ). ABSORB-X is similar to FLAT. Go left(right) from the ATM level. Once the vol hits X, the left(right) part from the point is X. |
| MODELVOL:: MeanRevInterpolation | 13864 | (LINEAR, PWCONST_R) | UNSET | When local vol and mean reversion curves are internally backed out, we can apply floor (with a term structure) on the mean reversion curve when a value is set. The format is time_1, time_2, time_3, ..., time_n,value_1, value_2, value_3, ..., value_n. For t < time_1, floor is not applied. After the time, a curve is constructed with [time_1, value_1], [time_2, value_2], ..., [time_n, value_n] and floor value at time t is calculated with linear interpolation and flat extrapolation. For example, 20y, 40y, 50y,0, 0, 0.01 means floor is not applied before 20y. From 20y until 40y, we apply 0 floor. From 40y and 50y, the floor is linearly interpolated between 0 and 0.01. After 50y, the floor is 0.01. |
| VOL:: StochVolCenteringMode | 13121 | [0, 1] | -1 | When DiffusionType = RATESTOCHVOL, EQUITYSTOCHVOL, or STOCHVOL ( stochastic rates ) then this field is present, this feature will be used to determine how to center Stochvol. Its default value is -1, means it will pick the StochvolcenteringMode from DBX model. If it's set to an non negative value, the stochvol centering method will use the feature set in the dbmvol instead from the model. |
| MODELVOL:: Interpolation | 13863 | (LINEAR, PWCONST_R, PWCONSTSMOOTH, CONSTANT_LV) | LINEAR | Interpolation in Time for CMSMAT, LIBORMAT, FXMAT, INFLATIONMAT matrices with possible ExtraStrings can be (1) (default) LINEAR ( Linear in XXXMAT ) with FLAT extrapolation; (2) QUADRATICPOLY (2nd order polynomial in XXXMAT ) with FLAT extrapolation; (3) CONSTANT_LV (linear in variance) with Linear in Variance extrapolation from the last two points; Interpolation in Time for other matrices is Linear. Extrapolation in Time for all other matrices is Flat. Interpolation in Tenor space is linear for all matrices, extrapolation is flat. |
| MODELVOL:: RescaleWeights | 13865 | (YES, NO) | NO | The parameter RescaleWeights allows to rescale the weights such that sum on each tenor is equal to to the time (and therefore the implied volatility on each tenor is unchanged by the weights). |
| VOL:: SABRUpperBound | 13164 | >= 1 | 20 | There is a possibility of preventing tail explosions, which is particularly relevant to avoid excessive CMS convexity under the situation when stoch vol is very high (possibly coupled with correlation close to 1). We do this via the field SabrUpperBound, which serves to bound how much the realized vol can reach in this stochastic vol model. This should be set to greater than 1. The effect of this field (if set to a large number, e.g. 5) on prices of options of reasonable strike (i.e. under 10%) is very limited but it nevertheless strongly curtails convexity explosion for CMS products. The default for SabrUpperBound is 20 and the range allowed is 2 to 200. SabrUpperBound can be entered as a matrix (with expiry/tenor dependent values) or as a single number as body property in which case the property name is SabrUpperBoundOne. |
| VOL:: TenorTolerance | 13169 | like %d |  | The tenor tolerance of the vol handle. This is optional but useful for avoiding superfluous interpolation of SABR parameters when obtaining vol if we get the dates off slightly. For example, if our vol subtable has a tenor column of 10y and tenor tolerance is 5d, then we will take the parameter from the 10y column if the tenor of our instrument is within 5d either side of 10y. |
| VOL:: TenorTolerance | 13169 | <= 5 |  | The tenor tolerance of the vol handle. This is optional but useful for avoiding superfluous interpolation of SABR parameters when obtaining vol if we get the dates off slightly. For example, if our vol subtable has a tenor column of 10y and tenor tolerance is 5d, then we will take the parameter from the 10y column if the tenor of our instrument is within 5d either side of 10y. |
| VOL:: BusinessTimeVols | 13172 | (YES, NO) | NO | When set to YES, the ATM volatility values as provided in DBOPTVOL are assumed to be not business time adjusted, and hence, the business time weighting is applied to these when computing the effective ATM volatility. In this case, BusinessDaysPerYear, WeekendDaysPerYear, and HolidaysPerYear must also be provided. If BusinessTimeVols=NO (default), the input ATM volatilities are not weighted and the the business time weights are only used for the ATM vol interpolation in between the time legs of the DBOPTVOL ATM VolMatrices. |
| VOL:: SABRUpperBoundOne | 13173 | >= 1 |  | There is a possibility of preventing tail explosions, which is particularly relevant to avoid excessive CMS convexity under the situation when stoch vol is very high (possibly coupled with correlation close to 1). We do this via the field SabrUpperBound, which serves to bound how much the realized vol can reach in this stochastic vol model. This should be set to greater than 1. The effect of this field (if set to a large number, e.g. 5) on prices of options of reasonable strike (i.e. under 10%) is very limited but it nevertheless strongly curtails convexity explosion for CMS products. The default for SabrUpperBound is 20 and the range allowed is 2 to 200. SabrUpperBound can be entered as a matrix (with expiry/tenor dependent values) or as a single number as body property in which case the property name is SabrUpperBoundOne. |
| VOL:: BusinessTimeVolsTraderTimeVols | 13177 | = YES |  |  |
| VOL:: UseUnadjustedStrikes | 13179 | (YES, NO) | YES | UseUnadjustedStrikes determines if when querying implied vols, we should subtract the Libor spread from the strike (i.e. YES) or add to the forward (i.e. NO). |
| VOL:: RateCorInterpolation | 13180 | (HYBRID, NONE, PWCONSTSMOOTH, QUADRATIC_LINEAR) |  | This tells how interpolation is done for the Tenors. |
| VOL:: WeightedVolInterpType | 13181 | (LINEAR, VARIANCE) | VARIANCE | Defines how we interpolate ATM volatilities in maturity dimension in presence of Dayweights. The value can either be VARIANCE (default) or LINEAR or HYBRID_FORWARD or TENSION_SPLINE. When set to VARIANCE, the CMSMAT entries are linearly interpolated in variance. When set to LINEAR, the CMSMAT entries are linearly interpolated. When set to HYBRID_FORWARD, the daily variance is interpolated by hybrid forward interpolation (Research Paper 7651). When set to TENSION_SPLINE, the CMSMAT entries are interpolated by tension spline interpolation (Research Paper 7436). Three optional parameters can be specified using extra string: (1) tension parameter e.g. TENSION_SPLINE-1; by default it is 1. Setting tension to zero will recover the ordinary C2 cubic spline, whereas setting tension to infinity will make the tension spline uniformly approach a linear spline; (2) cutoff expiry can be specified as a second parameter, e.g. TENSION_SPLINE-1-3m. Before cutoff expiry, constant variance interpolation is used; after expiry tension spline is used; (3) If cutoff is used, third parameter can be used to specify whether the interpolation is continuous at cutoff expiry, e.g. TENSION_SPLINE-1-3m-CONT or TENSION_SPLINE-1-3m-DISCONT; by default it is CONT. Note that for maturities shorter than flat maturity input of CMSMAT matrix, the interpolation is always done in variance space. In all cases, before interpolating the CMSMAT entries are converted to a common blend (the blend corresponding to interpolated maturity). |
| VOL:: ShortRateFastIntegral | 13183 | = YES | NO | The flag is relevant only when AnnuityMappingModel = SHORTRATE and controls the method to calibrate implied LIBOR short rate vol from normal ATM swaption vol : (1) NO (default): ATM swaption PVs are calculated off 1d (2d) numerical integration with (without) stochastic OIS spreads. ExtraString is also supported with the format NO, NumDerivX, PDESpaceStepsX to control integration grid for the LIBOR short rate. Default is NumDerivX = 5 and PDESpaceStepsX = 10. (2) YES: the integration w.r.t. LIBOR short rate is done analytically by using the Jamshidian decomposition technique. |
| VOL:: BlendInterpType | 13186 | = LINEAR |  | This determines the type of interpolation method to use when interpolating Blends on the MoneyDelta dimensions. |
| VOL:: MeanRevAutoCalib | 13187 | (YES, NO) | NO | The mean reversion parameter for AnnuityMappingModel = SHORTRATE can be auto calibrated when the flag MeanRevAutoCalib = YES. In that case, time dependent mean reversion is calibrated to ATM co initial swaptions. |
| VOL:: ZeroShiftWedge | 13188 | = -9.99 |  | One challenge to apply DLV for IR Cheytte is that original marginal distribution from AFSABR would imply stack of density at zero shift and naive application of Dupire's local vol construction would imply massive oscillation in local vol (2nd order derivatives of call prices are the density). This would introduce massive instability on risk and under stress testing. To overcome the issue we introduced ZeroShiftWedge, which replaces marginal distribution lower than some critical strike with a normal distribution. This gives an arbitrage-free and smooth implied vol extrapolation lower than the critical strike. |
| VOL:: OISSpreadVolType | 13190 | (LOCALVOL, LONGRATEEVOL) | LOCALVOL | One issue of inputting OIS spread local vol is difficulty in risk management: we would see huge OIS spread mean reversion risk (for OIS swaptions for example). One solution is to input OIS "term vols" to the OISSPREADVOL subtable and the property OISSpreadVolType was introduced for this purpose. OISSpreadVolType can be LOCALVOL (default), TERMVOL and LONGRATEEVOL. And this means inputted values in the OISSPREADVOL subtable are OIS short spread local vol, OIS short spread term vol at expiry and OIS long spread vol at expiry and tenor. Especially OISSpreadVolType = LONGRATEEVOL would massively reduce risk from OISSPREADMEANREV for OIS swaptions. |
| VOL:: MergeATMVolSurfaces | 13191 | = YES | YES | Optional Field (Default = YES). When set to NO, LIBORMAT and CMSMAT are not merged. They are separate vol surfaces and the libor vol surface is used when pricing an optionality on a single libor rate. When MergeATMVolSurfaces = NO, RateIndexType = LIBOR, LIBOR-CMT, NATURAL and NATURALCMT use the LIBORMAT surface. RateIndexType = CMS and CMT with a FloatFrequency equal to the Tenor are considered as LIBOR and use the LIBORMAT surface. In other cases, RateIndexType = CMS and CMT use the CMSMAT surface. When MergeATMVolSurfaces = YES, LIBORMAT and CMSMAT are internally merged in a single matrix and the vol lookup of any rateindextype is solely based on its tenor. This means that when MergeATMVolSurfaces is set to YES, the columns of CMSMAT and LIBORMAT have to be different. |
| VOL:: AFSabrBlendType | 13192 | (CONSTANT, SKEW) | CONSTANT | The AFSABR calculation is invoked when the SabrFormulaType is set to AFSABR. When AFSABRBlendType is CONSTANT, the default is to use 4 standard deviations, 30 space steps per standard deviation and 5 time steps per standard deviation for vanilla products (i.e., physical and cash swaptions), and 5 standard deviations, 40 space steps per standard deviation and 10 time steps per standard deviation for products requiring replication like CMS or spread options. When AFSABRBlendType is not CONSTANT, then the default is to use 4 standard deviations, 100 space steps per standard deviation and 5 time steps per standard deviation for vanilla products, and 5 standard deviations, 100 space steps per standard deviation and 10 time steps per standard deviation for products requiring replication. There is also a flavour of AFSABR which allows more granular control. This is controlled by setting the field AFSabrBlendType to SKEW. There is also the possibility to set AFSabrBlendType to PWCONSTSMOOTH where we slightly smooth transitions between different values of SabrBlend. |
| VOL:: OISMarginalModel | 13194 | (NONE, ATMVOL) | NONE | OIS spread vol should have impact on implied vols of OIS swaptions. There are several ways to take into account the impact and we introduced a flag OISMarginalModel for choosing a method. OISMarginalModel = NONE (default) means the OIS swap rate marginal is derived from the LIBOR Swap rate marginal assuming OIS spreads are deterministic. OISMarginalModel = ATMVOL captures the impact by backing out an ATMOIS swaption vol from the auto-calibrated short rate/spread model and get OIS swap rate marginal by solving AFSABR grid only by changing ATMVOL to the OIS ATMVOL. |
| VOL:: SABRFormulaType ([AFSABR-(*),  *, *]) | 13199 | >= 5 | LOGNORMAL | SabrFormulaType can take three possible values: (1) AFSABR - This is the current production value. It is an arb-free version of the SABR model which solves an effective forward equation using finite differences. Note that AFSABR accepts an extrastring with format n, m, p (so SabrFormulaType = AFSABR-n, m, p is a valid input with n, m and p being numbers). In that case n=AFSabrNumDeviations, m=AFSabrPDESpaceSteps, and p=AFSabrTimeSteps. (2) LOGNORMAL - uses the SABR formula for lognormal implied volatilities. (3) NORMAL - Use the SABR formula for normal implied volatilites. (4) NATURAL uses a different expansion. |
| VOL:: SABRFormulaType ([AFSABR-*,  *, *]) | 13199 | >= 5 | LOGNORMAL | SabrFormulaType can take three possible values: (1) AFSABR - This is the current production value. It is an arb-free version of the SABR model which solves an effective forward equation using finite differences. Note that AFSABR accepts an extrastring with format n, m, p (so SabrFormulaType = AFSABR-n, m, p is a valid input with n, m and p being numbers). In that case n=AFSabrNumDeviations, m=AFSabrPDESpaceSteps, and p=AFSabrTimeSteps. (2) LOGNORMAL - uses the SABR formula for lognormal implied volatilities. (3) NORMAL - Use the SABR formula for normal implied volatilites. (4) NATURAL uses a different expansion. |
| VOL:: SABRFormulaType ([AFSABR-*, *, *]) | 13199 | >= 100 | LOGNORMAL | SabrFormulaType can take three possible values: (1) AFSABR - This is the current production value. It is an arb-free version of the SABR model which solves an effective forward equation using finite differences. Note that AFSABR accepts an extrastring with format n, m, p (so SabrFormulaType = AFSABR-n, m, p is a valid input with n, m and p being numbers). In that case n=AFSabrNumDeviations, m=AFSabrPDESpaceSteps, and p=AFSabrTimeSteps. (2) LOGNORMAL - uses the SABR formula for lognormal implied volatilities. (3) NORMAL - Use the SABR formula for normal implied volatilites. (4) NATURAL uses a different expansion. |
| VOL:: ReplicateCashDV01 | 13202 | (1, 2) | 1 | When pricing IRR cash settled swaptions or CMS products with the vol surface of physical cash settle swaptions, price will depend on curve dynamics (i.e. how the physical DV01 and the cash DV01 are related). This is controlled by the flag AnnuityMappingModel (or formerly the flag ReplicateCashDV01). |
| VOL:: Interpolation | 13203 | (LINEAR, QUADRATICPOLY) | LINEAR | Interpolation in Time for CMSMAT, LIBORMAT, FXMAT, INFLATIONMAT matrices with possible ExtraStrings can be (1) (default) LINEAR ( Linear in XXXMAT ) with FLAT extrapolation; (2) QUADRATICPOLY (2nd order polynomial in XXXMAT ) with FLAT extrapolation; (3) CONSTANT_LV (linear in variance) with Linear in Variance extrapolation from the last two points; Interpolation in Time for other matrices is Linear. Extrapolation in Time for all other matrices is Flat. Interpolation in Tenor space is linear for all matrices, extrapolation is flat. |
| VOL:: CMSSpreadMarginalConstruction | 13206 | = CALIBRATE | CALIBRATE | This field is only relevant in the context of SIMCOPULA when pricing a trade that has a RateIndexType = CMSSPREAD and SimcopulaCMSSpread is set to NO. This field defines how we build the CMSSPREAD marginal. Only CALIBRATE should be used as it is by far superior to DIRECT. |
| VOL:: ZeroShiftType | 13208 | (FIXED, FLOATVOLSCALED) | FIXED | Can be set to FIXED (default), FLOATING, FLOATVOLSCALED, or CAPPED. FLOATING: the zeroshift used is [input zeroshift + forward]. CAPPED: then the zeroshift used is [input zeroshift + min( 0, forward ) ]. FLOATVOLSCALED: the input will be subject to conversion to the effective ZeroShift by ZeroShift = smoothmin( Forward, ZEROSHIFTFORWARDCAP, 25bps ) + smoothmax( ATMVOL, ZEROSHIFTVOLFLOOR, 0.1 * ZEROSHIFTVOLFLOOR ) * Sqrt( expiry ) * Input. ZEROSHIFTVOLFLOOR is given by the ZEROSHIFTVOLFLOOR subtable. When the table is not provided, ZEROSHIFTVOLFLOOR is 0. The intention is not to shrink the distance between zero shift and forward when vol goes to 0. ZEROSHIFTFORWARDCAP is given by the ZEROSHIFTFORWARDCAP subtable. When the table is not provided, no cap is applied (i.e. cap is + infinity). The intention is not to move zero shift up when forward goes up. |
| VOL:: ZeroShiftWedgeType | 13209 | = ABSPERCENTILE | ABSVOLSCALED | One challenge to apply DLV for IR Cheytte is that original marginal distribution from AFSABR would imply stack of density at zero shift and naive application of Dupire's local vol construction would imply massive oscillation in local vol (2nd order derivatives of call prices are the density). This would introduce massive instability on risk and under stress testing. To overcome the issue we introduced ZeroShiftWedge, which replaces marginal distribution lower than some critical strike with a normal distribution. This gives an arbitrage-free and smooth implied vol extrapolation lower than the critical strike. The way to define such critical strike is controlled by ZeroShiftWedgeType. |
| VOL:: SABRFormulaType | 13211 | = AFSABR | LOGNORMAL | SabrFormulaType can take three possible values: (1) AFSABR - This is the current production value. It is an arb-free version of the SABR model which solves an effective forward equation using finite differences. Note that AFSABR accepts an extrastring with format n, m, p (so SabrFormulaType = AFSABR-n, m, p is a valid input with n, m and p being numbers). In that case n=AFSabrNumDeviations, m=AFSabrPDESpaceSteps, and p=AFSabrTimeSteps. (2) LOGNORMAL - uses the SABR formula for lognormal implied volatilities. (3) NORMAL - Use the SABR formula for normal implied volatilites. (4) NATURAL uses a different expansion. |
| VOL:: ExtrapolationType | 13340 | (CONSTANT, CONSTANT-%) |  | Possible values are: (1) LOWER Strike-Mu; where strike an absolute strike or delta; mu a number (2) CONSTANT or CONSTANT-p (3) FORMULA-p-n, where p and n are two numbers. |
| VOL:: ExtrapolationBlend | 13343 | [0, 1] |  | Blend for which vols are kept constant in the extrapolation zone (ie beyond NumberStochVolDeviations deviations or for strikes greater than HighStrikeCutOff). If the property isn't provided, extrapolation is LOGNORMAL for SABR with SabrFormulaType=LOGNORMAL/EXACT (unless ZEROSHIFT is being used in which case it is NORMAL), NORMAL if a ZEROSHIFT is provided, and follows the ModelType field of the vols in all other cases. |
| VOL:: HighStrikeCutOff | 13348 | = -1 |  | For strikes greater than HighStrikeCutOff, the volatility is extrapolated constant (for a blend equal to ExtrapolationBlend).When HighStrikeCutOff is being used, NumStochVolDeviations is ignored on high strikes. |
| VOL:: PIVVolShiftType | 13423 | = ABSOLUTE | ABSOLUTE | PIVVolShiftType is only used for parametric Vol. It does not control the behavior of the body property "VolShift". It only controls the VolShift offset subtable. Default is Absolute, so volshift is used as absolute shift. When it is Relative/Quadratic, vol shift is used as relative shift (1+volShift).The VolShift between the offset dates are linearly interpolated w.r.t to business time, for both Absolute and Relative. For Quadratic, the (1+volShift)^2 is linearly interpolated w.r.t to business time. |
| VOL:: DLVCachingExactExtrapolation | 13482 | (NO, YES) | NO | If DLVCaching is set to YES (eventually being overridden by the correspondent model input, check DLVCaching), this controls whether, when beyond the range set by DLVCachingStrikeRange, the local vol is calculated using the exact analytical formula (YES) or extrapolated using the spline (NO). The default is NO. |
| VOL:: StochVolCap | 13595 | >= 5 |  | Cap applied to stochastic volatility multiplier. Default is 5.0 for DiffusionType=RATESTOCHVOL and 30.0 for STOCHVOL and EQUITYSTOCHVOL. If the ModelType=DOUBLEBLEND, then 9.99 is the default value. |
| VOL:: InputMode | 13903 | (STRIKEVOL, DELTAVOL, PARAMETRICVOL, MARGINALVOL) |  | With MARKETVOL, volatilities can be inputted as matrices for different strikes (INPUTMODE=STRIKEVOL) or deltas (INPUTMODE=DELTAVOL). It is also possible to enter a MARKETVOL using built-in parameterizations (INPUTMODE=PARAMETRICVOL). |
| VOL:: DIFFUSEFULDRIVER | 16730 | = NO | NO | When it is set to Yes all the underlying in the driver are diffused. If it is set to no just the underlying needed for the security pricing are diffused and the driver is reloaded accordingly. No changes are done on the driver weights as the driver performance is always normalized by the forward driver performance. |
| VOL:: MUNIRATIOSTOCHVOLMUNILIBORFLOOR | 19745 | [0, 0.1] |  | The muni ratio curve stabilization problem arises when Libor curve is near zero. One of the methodology to overcome this issue is the use of MuniLiborFloor and MuniLiborFloorWedge. MuniLiborFloor cannot be used at the same time with MuniZeroShift as they are mutually incompatible. When MuniLiborFloor is set to value other than -9.99, the meaning of input instrument is slightly modified. It is recomanded to set MuniLiborFloor around 1bps or 5bps. One of the benefits compared to MuniZeroShift is obvious. When Libor curve is above the floor level, the bootstrapped muni curve behaves exactly the same as if there was no floor while MuniZeroShift changes the whole muni curve regardless where the Libor curve is. When Libor curve approaches the floor or even cross the floor, this method will avoid the division of zero Libor therefore avoid this kind of instability. |
| VOL:: CurveType | 19747 | (LIBOR, CCYBASIS, SPREAD, BASIS, REASIS) |  | The property CurveType of an object of type CURVE defines how a given model uses the LIBOR curve and the SPREAD curve for forecasting (i.e. calculating forward rates) and discounting. In what follows, LIBOR refers to the curve created only from the tables Cash, Futures, Swaps, and SPREAD refers to the curve created from these tables plus the Spreads table. CMT refers to an object of type CMT. |
| VOL:: MUNIRATIOSTOCHVOLMUNILIBORFLOORWEDGE | 19748 | [0, 0.1] |  | The muni ratio curve stabilization problem arises when Libor curve is near zero. One of the methodology to overcome this issue is the use of MuniLiborFloor and MuniLiborFloorWedge. The drawback of this methodology is an artificial delta jump is introduced when Libor is around floor level. But it can again be smoothened by MuniLiborFloorWedge. Recommanded value is 25bps. |
| VOL:: SMOOTHFUTURESEXTRAPOLATION | 19749 | (FLAT, LINEAR, QUADRATIC) | FLAT | When SmoothFutures = BACKWARDDAILY, two flags SmoothFuturesExtrapolation and SmoothFuturesExtrapolationInterval are relevant to control extrapolation of LIBOR with Tenor = LiborBasis after the last future settlement date. |

Table 5: VOL object parameters used by the DBX-ShortRate_FXSkewStochVol.

| Parameter | Condition For Use ID | Approved Range | Default Value | Description |
|---|---|---|---|---|
| VOL:: SQUARESYSTEMMETHOD | 19104 | (LEASTSQUARES, POWELL) | | This is intended for DBMVOL auto-calibration, and can be set to LEASTSQUARES or POWELL. It specifies the optimization algorithm used for calibration. If provided, this overrides the corresponding auto-calibration setting in EXTRAINFO or PRICINGINFO. |
| VOL:: SkewType | 19351 | = SA4 | | Defines the functional form of the volatility as a function of strike. Currently implemented slice parameterizations are: (1) SA4 with slice parameters (VOL, SKEW, SMILE, POWER) (2) LABGD with slice parameters (VOL, SKEW, SMILE, POWER, AO, AP) (3)SABR4 with slice parameters (VOL, BLEND, SKEW, SMILE) (4) SABRFORMULAPD with slice parameters (VOL, SKEW, SMILE) (5) VW12 with twelve slice parameters (VOL, SKEW, SMILE, PUTWING, PUTDEPTH, PUTFLATTEN, CALLWING, CALLDEPTH, CALLFLATTEN, ASYMPTOTICTHRESHOLD, ASYMPTOTICSLOPE, MINVOL) |
| VOL:: RateCopula | 19746 | (NONE, GAUSSIAN) | NONE | This is to indicate the copula type for cross FX rate, it can be GAUSSIAN or GUMBEL for this moment. By default it's NONE, which means that this property will not be used. When this property is not NONE, all the correlation input will be interpreted as the the copula parameter input. |
| VOL:: RateCopula | 19750 | (GAUSSIANEXACT, GUMBELEXACT, GAUSSIANFOUR) | NONE | This is to indicate the copula type for cross FX rate, it can be GAUSSIAN or GUMBEL for this moment. By default it's NONE, which means that this property will not be used. When this property is not NONE, all the correlation input will be interpreted as the the copula parameter input. |
| VOL:: AnnuityMappingModel | 19751 | (SHORTRATE, FLAT) | LINEAR, FLAT | When pricing IRR cash settled swaptions or CMS products with the vol surface of physical settle swaptions, price will depend on curve dynamics (i.e. how the physical DV01 and the cash DV01 are related). This is controlled by the flag AnnuityMappingModel (or formerly the flag ReplicateCashDV01). |
| VOL:: AbsorbingBarrierType | 19752 | (NONE, ABSOLUTE, FORWARDDIFF, STDDEV) | | (1) When AbsorbingBarrierType = ABSOLUTE is used, the volatility becomes 0 when the underlying reaches AbsorbingBarrier. The vol starts decreasing for spot = AbsorbingBarrier + AbsorbingWedge. This can be used for example with AbsorbingBarrier = 0% when NORMAL rates are diffused and we don't want scenarios where rates become negative. (2) When AbsorbingBarrierType = FORWARDDIF is used, the vol becomes 0 (at time t), when the underlying reaches forward(t) + AbsorbingBarrier. The same way as for ABSOLUTE, the vol starts decreasing forward(t) + AbsorbingBarrier+AbsorbingWedge. (3) When AbsorbingBarrier = STDDEV is used, the absorbing barrier and wedges are then input as a number of standard deviations. (4) When AbsorbingBarrierType = NONE nothing is done. |
| VOL:: InterpolationType | 19754 | (DURATION, MATURITY) | TIMESTRIKE | Determines the Interpolation in Strike Space. |
| VOL:: APPLYVOL-SPREADSBEFOREINTERPOLATION | 19756 | (YES, NO) | | This fields defaults to NO and only affects the interpolation of spreads on CMSMAT/LIBORMAT (so SHORTDATEVOLRATIO, CMSMAT.BONDOPTSPREAD, CMSMAT.BONDFUTSPREAD, CMSMAT.BONDOPTSPREAD, CMSMAT.CCSPREADXXX, CMSMAT.FUNDINGSPREAD-XXX). (1) When set to NO the volatility spread is applied after having interpolated the base vol level from CMSMAT. This means in particular the spread interpolation is agnostic of dayweights. (2) When set to YES we first apply the vol spreads to CMSMAT marked expiries and then interpolate from CMSMAT including those spreads. This means in particular the spread interpolation takes into account dayweights and WeightedVolInterpType. In addition to that, when the field is set to YES, for the specific cases of the matrices SHORTDATEVOLRATIO, CMSMAT.BONDOPTSPREAD and CMSMAT.BONDFUTSPREAD, we first extrapolate CMSMAT (including Dayweight) to get base vol level for the spread marked expiries, then the spread is applied on those extrapolated points and finally we interpolate to get the vol we need. This means the interpolation in the short end is similar to the interpolation we would have if CMSMAT had shorter dated expiries. |
| VOL:: USESABRFORAVERAGINGOP-TIONS | 19760 | (YES, NO) | YES | It only affects the pricing of coupons involving EONIA averaging rates (for example compounded SOFR coupons) in DBOPT. |
| VOL:: WeekendWeight | 19762 | >= 0 | | The relative amount of variance experienced on a weekend as a fraction of a typical business day. This is used in interpolation of the volatilities between time points. |
| VOL:: CondVarPriceAdjMethod | 19763 | = ADD | ADD | For Conditional Var swaps and Gamma Var Swaps, NO means no price adjustment is applied. ADD and MULTIPLY means the varswapriceadjustment is applied to each daily log-squared term and this property says whether it is applied additively or multiplicatively. The ADDALL and MULTIPLYALL are for Conditional Var Swap only, meaning that the price adjustments are applied without checking the conditions. |
| VOL:: HolidayWeight | 19765 | >= 0 | | The relative amount of variance experienced on a holiday as a fraction of a typical business day. This is used in the interpolation of volatilities between time points. |
| VOL:: AFSABR-MaxBPVol | 19775 | unset | | |
| VOL:: MEANREVEXTRAPOLATIONFLOOR | 19777 | unset | UNSET | When local vol and mean reversion curves are internally backed out, we can apply floor (with a term structure) on the mean reversion curve when a value is set. The format is time_1, time_2, time_3, ..., time_n,value_1, value_2, value_3, ..., value_n. For t < time_1, floor is not applied. After the time, a curve is constructed with [time_1, value_1], [time_2, value_2], ..., [time_n, value_n] and floor value at time t is calculated with linear interpolation and flat extrapolation. For example, 20y, 40y, 50y,0, 0, 0.01 means floor is not applied before 20y. From 20y until 40y, we apply 0 floor. From 40y and 50y, the floor is linearly interpolated between 0 and 0.01. After 50y, the floor is 0.01. |
| VOL:: ShortRateNumSteps | 19778 | unset | | |
| VOL:: CMSLIBORMATREFSTRIKE | 19779 | unset | UNSET | When it is set, it expects a strike as input (e.g. 5%) and in that case the volatilities in CMSMAT/LIBORMAT subtables are implied volatilities at that strike. This was introduced for munibond autocalibration where it makes sense to directly input the volatilities at the strike of the callable bonds of the CURVE. In that case we know that the bootstrapped curve will only be a function of CMSMAT and will not depend on other SABR parameters. This field can only be set when ModelType is NORMAL. When this field is unset (default), CMSMAT and LIBORMAT input refer to at-the-money volatilities. |
| VOL:: InputMode | 19783 | (STRIKEVOL, DELTAVOL, PARAMETRICVOL) | | With MARKETVOL, volatilities can be inputted as matrices for different strikes (INPUTMODE=STRIKEVOL) or deltas (INPUTMODE=DELTAVOL). It is also possible to enter a MARKETVOL using built-in parameterizations (INPUTMODE=PARAMETRICVOL). |
| VOL:: BusinessTimeVols | 19786 | (YES, NO) | NO | When set to YES, the ATM volatility values as provided in DBOPTVOL are assumed to be not business time adjusted, and hence, the business time weighting is applied to these when computing the effective ATM volatility. In this case, BusinessDaysPerYear, WeekendDaysPerYear, and HolidaysPerYear must also be provided. If BusinessTimeVols=NO (default), the input ATM volatilities are not weighted and the the business time weights are only used for the ATM vol interpolation in between the time legs of the DBOPTVOL ATM VolMatrices. |

## FIXING Object Parameters

| Parameter | Condition For Use ID | Approved Range | Default Value | Description |
|---|---|---|---|---|
| FIXING:: NaturalTolerance ([*]*f) | 13354 | <= 10 | | Tolerance (maximum tenor mismatch) allowed when mapping natural to libor rates. |
| FIXING:: NaturalTolerance ([*]*wl) | 13355 | <= 1 | | Tolerance (maximum tenor mismatch) allowed when mapping natural to libor rates. |
| FIXING:: InterpolateNatural | 13381 | (YES, NO) | YES | The field InterpolateNatural determines whether natural rate interpolation/extrapolation in tenor space is allowed. When set to NO, if a natural mapping is needed but not found within the NaturalTolerance, an error is thrown. However, when set to YES (default), the natural rate will be interpolated (or extrapolated flat) from the mapped libor rates with higher/lower tenor. |

## PRICINGINFO Object Parameters

| Parameter | Condition For Use ID | Approved Range | Default Value | Description |
|---|---|---|---|---|
| PRICINGINFO:: PricingInfoType | 13970 | (AUTOCALIBRATION, AUTOBASIS, BARRIER, BARRIERINFO, REPORT, SETTLEDCASH, MODELVOL) | | PRICINGINFO objects can be inserted into a DICTIONARY to provide different types of functionality. The type of functionality is determined by the BodyProperty PricingInfoType. |

## EXPOSURE Object Parameters

| Parameter | Condition For Use ID | Approved Range | Default Value | Description |
|---|---|---|---|---|
| EXPOSURE:: AutoConvertTable | 13394 | not exists | | AUTOCONVERTABLE objects were introduced to provide an AutoConvertTable subtable as a separate object to a DICTIONARY of MODE = GETEXPOSURE. The motivation is to allow front office calculators (e.g. Kannon, RMS, ...) to provide instruction of auto-conversion per EOD DICTIONARY. The AUTOCONVERTABLE object will change CalcIntrinsic of the DBL MODEL handle to -1 when EXPOSURE handle has NewExposureMethod = HISTSIM or SCENARIO. |

## EXTRAINFO Object Parameters

| Parameter | Condition For Use ID | Approved Range | Default Value | Description |
|---|---|---|---|---|
| EXTRAINFO:: UseSyntheticForwards | 13451 | = NO | NO | If set to YES the filter adjusts the repo rates of the MKTDATA object to improve the fit. Please note that if the target options are American, this procedure involves approximations. If set to YES, the adjusted MKTDATA object is returned, with handlename equal to the input MARKETVOL's AssetName followed by "_SYNTHETIC", unless a different handlename is specified by the NewMktDataHandleName body property described below. |
| EXTRAINFO:: FitType | 13452 | = SLICE | SLICE | SLICE performs a maturity-by-maturity fit of the PIV slice parameters. GLOBAL operates as follows: (1) A set of global parameters is identified by the through the PostProcess subtable. (2) In each iteration, for a given set of global parameters, the PIV slice parameters not controlled by the global parameters are fitted slice-by-slice (when GlobalSliceFitType=NESTED) (3) After each iteration, the overall quality of the fit is assessed according to the value of the Weighting and GlobalWeighting fields. |
| EXTRAINFO:: Weighting | 13453 | (NOTIONAL, VEGAOPTIONAL) | | SPREAD weights each option by the inverse of the vol (if TargetType = VOL) or price (if TargetType = PRICE) bid offer spread. VEGA weights each option by the Black-Scholes analytical vega of a European option of the same strike and maturity. NORMALIZEDVEGA works in the same way but we normalize the weights by the vega of an ATM option at each maturity, which is relevant when FitType=GLOBAL, to avoid implicitly giving higher weights to longer expiries. NOTIONAL uses the Notional column of EQVANILLAS as weights. With NORMALIZEDVEGADENSITY we normalize as in NORMALIZEDVEGA and further multiply by the distance to the nearest targets in normalized strike space, so the weight density follows the vega profile and is independent of the number of option targets in each part of the curve. VEGANOTIONAL uses the product of the vega times the notional. NONE applies a weight of 1 to all options. CUSTOM allows to give any desired weight to each option. The weights should be given in a subtable named "CustomWeights" that should contain a filled column labeled "Maturity" while the other columns should be labeled "Strike_%n", where %n stands for a number giving the strike as a fraction of the spot. The strikes and dates in this weights matrix do not have to match the strikes and dates in the vol or in the input targets, since interpolation will be used to assign a weight to each option according to its maturity/strike. |
| EXTRAINFO:: TargetType | 13455 | = VOL | | Possible values are CouponSpread, CouponMultiplier, CouponStrike and BarrierLevel. |
| EXTRAINFO:: ResultType | 13893 | (blank), RISKMULTIPLIER, DEFAULTRISK, ACCRUAL, AutoCalibration, BermTax, RateTerm, PIVAUTOFIT, CALIBRATE, accounts, lapsedata, CorrelatedRandomNumbers, CpityPVs, MatrixStats) | | EXTRAINFO is a KEYWORD that can be entered in the DICTIONARY. The corresponding object, that needs to be given in the dictionary for this keyword, has to be an object of type RESULTS which includes the property ResultType. |

## FUNDINGVOL Object Parameters

| Parameter | Condition For Use ID | Approved Range | Default Value | Description |
|---|---|---|---|---|
| FUNDINGVOL:: FrontLatticeFreq | 17773 | unset | UNSET | FreqTimeVec, FrontLatticeFreq and DecayTime are used for the DS4 MonteCarlo to add background simulation time vector. Values can be "UNSET" or numbers. When numbers are set, the convention of the background time vector generation is consistent with that of the DBX model. FrontLatticeFreq = UNSET means FrontLatticeFreq = FreqTimeVec. DecayTime = UNSET or 0, the background time vector is generated only with FreqTimeVec. When FreqTimeVec is set to UNSET and FrontLatticeFreq and DecayTime are set, a background time vector of FrontLatticeFreq is added until DecayTime. This is only the convention of FUNDINGVOL. |
| FUNDINGVOL:: DecayTime | 17774 | unset | UNSET | FreqTimeVec, FrontLatticeFreq and DecayTime are used for the DS4 MonteCarlo to add background simulation time vector. Values can be "UNSET" or numbers. When numbers are set, the convention of the background time vector generation is consistent with that of the DBX model. FrontLatticeFreq = UNSET means FrontLatticeFreq = FreqTimeVec. DecayTime = UNSET or 0, the background time vector is generated only with FreqTimeVec. When FreqTimeVec is set to UNSET and FrontLatticeFreq and DecayTime are set, a background time vector of FrontLatticeFreq is added until DecayTime. This is only the convention of FUNDINGVOL. |
| FUNDINGVOL:: ReinvestSpreadCalcMethod | 17776 | = EXACT | EXACT | Describes how to handle ReinvestSpread and Spread of PLAINZERO SECURITY when capturing DS4 convexity with DBOPT model and CalcZeroCouponConvexity = YES. Possible values are (1) EXACT: throw an error when PLAINZERO SECURITY has non zero ReinvestSpread or Spread as we cannot calculate convexity analytically. (2) APPROX: when PLAINZERO SECURITY has non zero ReinvestSpread and/or Spread, calculate convexity by approximation as if all zero yield were coming from LIBOR compounding. As long as these spread are not huge (like 10%), the approximation is accurate enough to capture convexity. |
| FUNDINGVOL:: FreqTimeVec | 17777 | unset | UNSET | FreqTimeVec, FrontLatticeFreq and DecayTime are used for the DS4 MonteCarlo to add background simulation time vector. Values can be "UNSET" or numbers. When numbers are set, the convention of the background time vector generation is consistent with that of the DBX model. FrontLatticeFreq = UNSET means FrontLatticeFreq = FreqTimeVec. DecayTime = UNSET or 0, the background time vector is generated only with FreqTimeVec. When FreqTimeVec is set to UNSET and FrontLatticeFreq and DecayTime are set, a background time vector of FrontLatticeFreq is added until DecayTime. This is only the convention of FUNDINGVOL. |
| FUNDINGVOL:: StateMaxFraction | 17779 | = 0.25 | 0.25 | The flags PolyOrder and StateMaxFraction are used when pricing cash settled swaptions with collateral options by using DBOPTVOL with AnnuityMappingModel = SHORTRATE. When deriving the annuity mapping function, we need to get the conditional expectation of funding ADF w.r.t. the LIBOR short rate. Currently we use the DS4 Monte Carlo with the PolyOrder and StateMaxFraction to get the conditional expectation. Defaults are PolyOrder = 1200, StateMaxFraction = 0.25 |
| FUNDINGVOL:: PolyOrder | 17802 | (1200, 1200-0.25) | 1200 | The flags PolyOrder and StateMaxFraction are used when pricing cash settled swaptions with collateral options by using DBOPTVOL with AnnuityMappingModel = SHORTRATE. When deriving the annuity mapping function, we need to get the conditional expectation of funding ADF w.r.t. the LIBOR short rate. Currently we use the DS4 Monte Carlo with the PolyOrder and StateMaxFraction to get the conditional expectation. Defaults are PolyOrder = 1200, StateMaxFraction = 0.25 |
| FUNDINGVOL:: FloorSmoothing | 18467 | = NO | NO | FUNDINGVOL:: FLOORCALCMETHOD FUNDINGVOL:: FREQTIMEVEC FUNDINGVOL:: INTEGRATIONFREQ From v1130 onwards, whenever FloorCalcMethod=ANALYTIC, the field FloorSmoothing is ignored and will have no effect. When set to YES, during calculation of convexity or discount factors with collateral options in the DS4 MonteCarlo, an analytic conditional bond formula (based on moment matching) is used for discounting with collateral floor options (ResearchPaper 9136). This will stabilize Monte Carlo simulation in presence of collateral floor options. |

## FUNDING Object Parameters

| Parameter | Condition For Use ID | Approved Range | Default Value | Description |
|---|---|---|---|---|
| FUNDING:: Type | 17775 | = SPOTFX | | A FUNDING object of Type SPOTFX provides Spot FX rates for FUNDINGCURVE. |

## MODEL Object Parameters

| Parameter | Condition For Use ID | Approved Range | Default Value | Description |
|---|---|---|---|---|
| MODEL:: CompressionFreq | 12938 | >= 12 | 12 | Used in connection with ExerciseCompression. It determines the frequency of the actually used exercise dates. |
| MODEL:: DirectSLVStateMaxFraction | 12939 | = 0.8 | 0.8 | When we input in the dictionary a PARAMETRICVOL with DirectLocalVol=YES and a DBMVOL with DiffusionType=EQUITYSTOCHVOL (or STOCHVOL for FX) a direct derivation of the local vol surface in the stochastic vol model is done. Setting DirectSLVCalculationMethod = STATEMAX triggers a calculation where we do a regression with the log of the underlying process as the independent variable, using the StateMax algorithm. In the DBX model handle, two fields can be used to customize parameters of this regression algorithm: DirectSLVPolyOrder and DirectSLVStateMaxFraction. The latter parameter has a default value of 0.8, which means that a second, more refined call to the StateMax algorithm is done after a first call. |
| MODEL:: StateMaxPayoffState | 12940 | (NONE, DIGITAL, ALL) | NONE | This param improves the pricing of American-style options for range products. When the user chose ALL or DIGITAL, prices of digital options maturing at end date of the current Range period is added to the states used for the regression. |
| MODEL:: NumberSubSims | 12945 | = 1 | | Only used for simulating defaults when credit features are used. In this case the precision can be enhanced by re-using intensity paths for NumberSubSims event simulations. This has also been extended for use with hazard simulations for insurance valuation in DBX. |
| MODEL:: NumberSims | 13710 | >= 5000 | | NumberSims is the number of simulations to perform during pricing. At 2000 simulations, the seed variance is typically for non-compound options, 2.5% of time value. The seed variance is typically lower for european options than american style options. These seed variance numbers depend on the choice of Variance Reduction. |
| MODEL:: StateMaxRegularization | 12948 | (NONE, RIDGE, RIDGE-%, RIDGENORM, RIDGENORM-%) | NONE | Defines the way to regularize least squares fitter used in StateMax (for all PolyOrders using it, e.g. 0, 103, 200, 2002, but not 1200 for example). Specifying it as NONE means no regularization is performed. On the other hand, setting it to RIDGE will perform Tikhonov regularization (also known as ridge regression) with regularization parameter calculated as 1% of the average singular value of regressors matrix X. In other words, we calculate pseudoinverse of X using singular values s_i multiplied by [1 + (0.01 * avg(s_i) / s_i)^2]. The 0.01 multiplier can be rewritten by specifying extrastring for this property, e.g. RIDGE-0.1 will use multiplier 0.1 instead. Note that, to avoid introducing additional biases, we center the estimator at the mean of response variable (e.g. realized PVs) after applying ridge regression, which is done by shifting the coefficient for the unit vector accordingly. RIDGENORM is very similar to RIDGE and has to be used when UseNewSVD is set to ALGLIB (i.e. UseNewSVD = ALGLIB is not allowed with StateMaxRegularization = RIDGE). When UseNewSVD is set to ALGLIB, we cannot define the regularization parameter the usual way because the average of the singular value is not known for optimization reasons. UseNewSVD uses the average of the square of singular values instead of the square of the average of singular values. Generally, Tikhonov regularization suppresses the coefficients related to differences of highly correlated variables, thus reducing variance of the estimator and improving its generalization performance at a cost of some bias (the higher is the regularization parameter the bigger is the effect, e.g. RIDGE-1 will give considerable bias even at price level). Regularization is especially important when evaluating function on different paths than those used for regression (i.e. generalization problem), e.g. in PPE calculations or extra paths or with FreezeStateMaxRiskWeights = YES, allowing to improve risk stability and avoid blow-ups in such cases. |
| MODEL:: NumberSeedVarianceRuns | 12953 | >= 1 | 1 | NumberRuns / NumberSeedVarianceRuns is the number of independent simulations to perform for pricing. If this is set to three for example, three separate runs with say 2000 paths each will be used. The price returned will represent the average over three runs. |
| MODEL:: ArithmeticStochvol | 12954 | = YES | YES | ArithmeticStochVol allows to define if we want to use the double arithmetic technique when there is stochvol for one of the underlyings. The default is YES for backward compatibility. Using the double arithmetic technique can be useful if the stochastic volatility is one of the main drivers of the PV but if there are many components and stochvol is only a very minor part, this can lead to a decrease in precision overall. |
| MODEL:: UseBinomialSimulation | 12959 | = NO | | Identifies whether the Binomial Simulation is used. |
| MODEL:: MinNumberSteps | 12962 | >= 0 | | The minimum number of Monte Carlo timesteps before the first security point. |
| MODEL:: DLVCalibrationStrikes | 12963 | >= 5 | 5 | In DBX, setting DLVCalibration = YES, ALL, or MIXTURE will trigger an internal calibration of the local vol surface for an EQUITY/ASSET or FX underlying performed at each time step within the Monte Carlo simulation. DLVCalibrationStrikes is the number of points in the vol surface that will be used as targets in the calibration. It is also the number of free parameters in the calibration. |
| MODEL:: DLVCalibrationStdevs | 12963 | >= 2 | | In DBX, setting DLVCalibration = YES, ALL, or MIXTURE will trigger an internal calibration of the local vol surface for an EQUITY/ASSET or FX underlying performed at each time step within the Monte Carlo simulation. DLVCalibrationStdevs is a positive number that determines how far out spread in vol terms are the calibration strikes (at nodes of the Adj(S, t) function). |
| MODEL:: DLVCalibrationMaxIter | 12963 | >= 1 | 1 | In DBX, setting DLVCalibration = YES, ALL, or MIXTURE will trigger an internal calibration of the local vol surface for an EQUITY/ASSET or FX underlying performed at each time step within the Monte Carlo simulation. DLVCalibrationMaxIter is the number of iterations in the calibration. |
| MODEL:: DLVCalibrationFrequency | 12963 | <= 30 | 1 | In DBX, setting DLVCalibration = YES, ALL, or MIXTURE will trigger an internal calibration of the local vol surface for an EQUITY/ASSET or FX underlying performed at each time step within the Monte Carlo simulation. DLVCalibrationFrequency is one of the parameters that can be used to configure this calibration. It should be an integer that determines the calibration frequency with respect to the underlying simulation time vector. So when equal n, the calibration is performed in a fraction 1/n of the background simulation points, plus all points where we have a security update. When equal zero we only perform the calibration at time points corresponding to security updates. Default is 1 which means that we perform the calibration at all time points. |
| MODEL:: SimSeedBackbone | 12965 | = NO | NO | SimSeedBackbone allows to make the backbone timevector used in BrownianBridge to be derived from the SetDates of the (only) simulation security in a dictionary. This is useful for the simulation of underlyings for EXPOSURE calculations with external random numbers as it makes sure that the Brownian medians are consistent in the simulation and exposure phases. |
| MODEL:: DLVIRMethod | 12967 | (RANK, MARGINAL) | RANK | If the property DLVIRMethod is set to MARGINAL, we use the density from the MARKETVOL between simulated spot values, rather than the default of RANK which assumes the density between simulated spots is 1/NumberSims. If set to DBL, we compute the DLVIR correction using a DBL CALIBMODEL provided to the dictionary. |
| MODEL:: UseOrthogonalRuns | 12968 | (YES, NO) | | VarianceReduction=ORTHOGONAL requires a number of paths large enough - at least as large as 2 x NormalDeviatesDim - in order to apply Gramm Schmidt. When NormalDeviatesDim is very large, it may be challenging memory wise to run the model and NumberRuns can be used to split paths. In order to apply Gramm Schmidt globally over all NumberRuns, UseOrthogonalRuns must be set to YES. With NO, Orthogonalization is applied separately for each run. |
| MODEL:: StateMaxCutOff | 12969 | <= 0.01 | 0.01 | By using the property StateMaxCutOff in a Monte Carlo model (DEX, DBM), users can remove similar states for statemax calculations. Especially this stabilizes risk calculation with FreezeStateMaxRiskWeights ='YES. Like StateMaxFactors, a PCA is done on all factors involved. Then find minimal N such that Sum(largest N eigenvalues) / Sum(all eigenvalues) ≥ 1 - StateMaxCutOff, and the N-1 eigenVectors with the highest eigenValues will be used for the statemax calculation. Additionally, an N-th factor is used, which is obtained by doing a linearisation of the final payoff with all the factors. This technique is particularly efficient for basket pricing. After pricing the trade, the extra results (in this case the ExerciseTable) for MULTISWAP, RANGESWAP, CMSOPT and KOMULTIDUALCCY, will provide information about the following ratio: Sum(largest N eigenvalues) / Sum(all eigenvalues). |
| MODEL:: FVANoiseReduction | 12970 | (YES, NO, DBL) | | DBAnalytics allows the calculation of the price (or implied vol) of a forward starting option whose strike sets at time t (SetDate) and whose maturity is at time T (= SetDate + RateTerm) using RateIndexType IMPLIEDVOL where time is measured relative to the ValuationDate. In order to price this, we need to simulate the option prices, and then use the StateMax algorithm to regress. FVANoiseReduction YES attempts to help deliver better regression by subtracting a function known at t before we do the regression, and adding it on again after the regression is done. FVANoiseReduction YES is currently only supported for RateDeltaType ATMVOL (or for RateDeltaType SPOTSTRIKE/FORWARDSTRIKE when RateDelta = 1.0). An alternative method is FVANoiseReduction DBL. This is currently only support for RateDeltaType FIXEDSTRIKE, with RateUnderlyingType EQUITY. This calculates the IMPLIEDVOL using the DBL PDE model, and projects it onto the paths in DBX. The DBL MODEL is provided in the dictionary via the CALIBMODEL keyword.In |
| MODEL:: CompactSimulation | 12977 | (YES, NO) | NO | When set to YES it is optimizing the memory footprint of normal deviates in the DBX simulation by only generating deviates that are used. |
| MODEL:: IntegrationFrequency | 12978 | >= 1 | 1 | IntegrationFrequency is the number of steps between integration points. |
| MODEL:: IntegrationFreq | 12978 | >= 365 | | IntegrationFreq specifies how finely the input volatility functions will be integrated. If IntegrationFreq is set to 0 (default for DBX), it uses the frequency of the lattice. If it is set to some other number such as 120 (default for DBL), it uses this number (120) of steps per year. It is recommended to keep it set to zero for DBX. |
| MODEL:: NumberRuns | 12980 | >= 1 | 1 | NumberRuns / NumberSeedVarianceRuns is the number of independent simulations to perform for pricing. If this is set to three for example, three separate runs with say 2000 paths each will be used. The price returned will represent the average over three runs. |
| MODEL:: StateMaxCorrection | 12984 | (JACKKNIFE, NONE) | NONE | In the latter case, while determining exercise decision for each path, we drop this path from the regression. Thus, to determine expected PV for i-th path among N ones, we regress the other N-1 (except i-th) paths and then evaluate the resulting polynomial at the i-th path. Using some linear algebra, this can be done quickly for all paths, so that the additional cost compared to usual regression is of the order of one additional regression (and not N regressions as would be the case for brute force approach). |
| MODEL:: StateMaxWedge | 12988 | (-4, 0) | | StateMaxWedge is used for the decision function as described in the Polyorder description. A value of zero will optimize the choice of wedge size. |
| MODEL:: CompressionDirection | 12989 | (FORWARD, BACKWARD) | | To improve speed of pricing for products involving many dates ( for example long dated asian/bermudan/range options with daily fixings), the idea of compression is to price a simplified product, containing fewer dates than the initial one. In DBX, you can further select the CompressionDirection. Using CompressionDirection BACKWARD can be useful in certain cases for additional stability in theta and explain calculations, as it better preserves consistency of the security time vector as time decays. |
| MODEL:: DirectSLVPolyOrder | 12990 | = 3 | 3 | When we input in the dictionary a PARAMETRICVOL with DirectLocalVol=YES and a DBMVOL with DiffusionType=EQUITYSTOCHVOL (or STOCHVOL for FX) a direct derivation of the local vol surface in the stochastic vol model is done. Setting DirectSLVCalculationMethod = STATEMAX triggers a calculation where we do a regression with the log of the underlying process as the independent variable, using the StateMax algorithm. In the DBX model handle, two fields can be used to customize parameters of this regression algorithm: DirectSLVPolyOrder and DirectSLVStateMaxFraction. The former determines the order of the polynomial used in the regression. Default value is 3, which means we use a 3rd order polynomial. |
| MODEL:: Tolerance | 12991 | <= 0.00001 | 0 | The tolerance used to center rate stochastic vols and diffused credit default intensities. When set to zero, it is internally converted to 1E-6 for SV cases and to 1E-7 for credit diffusion cases. |
| MODEL:: CopulaSimulation | 12993 | (YES, NO) | NO | When set to YES we perform the simulation in a single time step, so this is only allowed when the security has a single SetDate=PayDate. We can simulate EQUITY, ASSET or FXRATE, but IR or credit vol is not allowed. For EQUITY and ASSET we need to use a PARAMETRICVOL MARKETVOL. The marginal distributions for each underlying are obtained from the PIV, and we use a gaussian copula to get the joint distribution. So in the simulation each random normal deviate represents a terminal value for the underlying. For FX we need to use a lognormal DBMVOL. |
| MODEL:: StateMaxControlVariable | 12995 | (NO, YES, INDICATOR) | | The purpose of StateMax is to calculate the conditional expectation of some raw PVs as of a given date where the raw PVs depend on some cashflows not known yet. |
| MODEL:: CumulativeNumDeviations | 12997 | >= 4 | | Represents in DLV cumulative calibration the number of (normal) standard deviations on each side that are used to defined the range for calibration strikes. |
| MODEL:: ValueMode | 12999 | = VALUEDATE | | If it is SettleDate(ValueDate) security cashflows are ignored in pricing if paid on or before the settlementdate(valuationdate) of the curve. Also the result of the pricing is compounded up to the respective date. |
| MODEL:: ExerciseCompression | 13000 | (NONE, EXPONENTIAL, EXPONENTIAL-%, SYNCHRONISED, SYNCHRONISED-%) | NONE | Used for Aswaption, Convertible, Ecppt, cpticap, cptiswap, bondposition and gyptbondopt securities. Allows to reduce computational time by generating a subset of the original set of dates. Default to NONE, meaning that no compression is done. |
| MODEL:: CMSForwardCentering | 13001 | (NONE, INARREARS) | INARREARS | This is only relevant when the security has CMS or CMSSpread RateIndexType and the dictionary contains a DBOPTVOL object. In that case this field controls how the CMS forwards generated by the model are centered to those of DBOPT. Possible values are (a) NONE: there are no centering to DBOPT forwards (b) INARREARS: CMS forwards are centered so that in arrears CMS forwards are exactly those of DBOPT (c) RAYDELAY: CMS forwards are centered so that CMS forwards with payment date corresponding to the payment date of the coupon are exactly those of DBOPT (restriction applies). We turn on DS2 recalibration when either a), b) or c) is true. |
| MODEL:: CumulativeNumSteps | 13003 | >= 50 | | Represents in DLV cumulative calibration the approximate number of calibration strikes used per (normal) standard deviation. |
| MODEL:: UseRegularTimeVec | 13004 | (YES, NO, PARTIAL, ADAPTIVE) | NO | When set to YES and and FreqTimeVec equals FrontLatticeFreq (or DecayTime is zero) the time vector used for the simulation is created regularly, in such a way that moving the valuation date forward does not change the location or length of the remaining time intervals. This setting together with DeviateOrder = BACKWARD is intended to minimize the noise in THETA calculations. It can also be set to PARTIAL. In this case, when FreqTimeVec is not equal to FrontLatticeFreq (and DecayTime is not zero) we generate the time vector regularly, as above, but augment the time vector in the front end using the FrontLatticeFreq decaying at a rate controlled by the DecayTime to an asymptotic frequency of 1. This is intended to be used with DeviateOrder = MULTIBRIDGE to minimize noise in THETA calculations whilst allowing different FrontLatticeFreq/FreqTimeVec. It can also be set to ADAPTIVE. In this case, we first feel what is the background frequency given by the underlying security time vector (working backwards in window lengths of length DecayTime). If the background frequency is not high enough to match FreqTimeVec, we bisect the largest remaining gap in the window, and repeat until it fits. Finally, we enrich the time vector with additional points in the front end using the FrontLatticeFreq exactly as with PARTIAL. It should be noted that this method can also be used with e.g. DeviateOrder MULTIBRIDGE to minimize noise in THETA calculations whilst allowing direct FrontLatticeFreq/FreqTimeVec. It has the additional advantage that it does not add wasteful time points if the security time vector is already dense. |
| MODEL:: DirectSLVFitWeight | 13005 | = 0.01 | | |
| MODEL:: ModelMode | 13169 | (PRICE, PRICEVALUETWOCDAY) | | ModelMode determines the pricing conventions. PRICE means price to value date of the curve. PRICESETTLE means price to settle date of the curve. Additional modes are: PRICEONEDAY, PRICETWOCDAY, PRICETHREEDAY, PRICEVALUEONEDAY, PRICEVALUETWOCDAY, PRICEVALUETHREEDAY - These modes subtract one, two and three days from the option expiries and the settle day of the curve to derive the number of volatility days. These three modes always return price to settle. The PRICEVALUE modes return price to value date. |
| MODEL:: AccreterFactors | 13167 | = 1 | | Number of factors used for european accreting notional amortizing notional swaption pricing in ASWAPTION. When AccreterFactors = 2, ATMRateCorrelation has to be entered and currently it's only supported with UseScaledStrikeForAccretingSwap = YES. |
| MODEL:: CompressionFreq | 13168 | >= 12 | 12 | Used in connection with ExerciseCompression. It determines the frequency of the actually used exercise dates. |
| MODEL:: UseScaledStrikeForAccretingSwap | 13196 | = YES | YES | This property is for pricing accreting/amortizing notional swaptions of european style booked in ASWAPTION. To price amortizing swaption, we use a replication method, i.e we use a series of vanilla swaptions( same expiry, different tenors) to replicate exact payoff of the amortizing swaption. When this property is set to YES, the replication is based on the assumption that size for different swaprates change are proportional to its vol level, while with NO the assumption is swapraters change size is the same along different tenors. "YES" is more in line with the Hull white model. We have additional possibilities. In particular, assuming a one-factor model (which this whole replication methodology rests on), we can solve for the critical probability where exercise of the swaption is meaningful. This translates to a (different) strike for each of the underlying swaptions in the hedge. The fully correct approach is to do this under a common measure (i.e. the T-forward measure). This we allow if the property above is set to FULL. However, note this assumes we have a good distribution (such as SABR exact whereas original SABR is not arb-free). Alternatively, if we solve for each swap rate under its annuity measure, the task is easier and we provide for this by setting the field to ALL. This is less justifiable but no worse than YES or NO above since the strikes are not strictly justifiable either and should give another possible valuation for comparison. With UseScaledStrikeForAccretingSwap = YES, when the far strike and atm volcs each replicating swaptions increase fast along the tenor, the iterator to find the right scale may fail. In case it fails, we will use an underdetermined solver to find a minimal parallel drift in addition to the scale to make the replication succeed. |
| MODEL:: PayoffSmoothing | 13207 | = NO | NO | When property PayoffSmoothing is set to YES in DBOPT, the CALL/PUT payoffs are smoothed around the strike during the numerical integration. The smoothing region is controlled by properties PayoffSmoothingScale, MaximumPayoffSmoothingWedge, MinimumPayoffSmoothingWedge, and PayoffSmoothingUseTimeScaling. Affected payoffs are those that are priced in terms of CALL/PUT payoffs, i.e. standard caps/floors and swaptions, digitals, fixed range accruals. |
| MODEL:: VarianceReduction | 13415 | (ANTITHETIC, ANTITHETICPURE, BROWNIANBRIDGE, ORTHOGONAL) | | This feature specifies the method to be used for reducing variance in the simulation. |
| MODEL:: StateUseFlag | 13418 | = -1 | | If StateUseFlag is > 0, then this is the width of the final decision ramp as a multiple of the StateMaxWedge ramp. If StateUseFlag is -2 or below then no ramp is used and the exercise is always included, even if in sample this results in a decrease in NPV to the option holder. |
| MODEL:: StochVolCenteringMode | 13560 | {-1, 0, 1} | | This property is only relevant when a stochastic volatility process is used in the dictionary. recommended value is -1, meaning that the property from the combined DBMVOL is used. |
| MODEL:: DirectSLVSimsPerBin | 13819 | >= 1000 | | For DirectSLVCalculationMethod = BIN/FFT, the effective number of paths in a bin or within a Gaussian kernel is controlled by DirectSLVSimsPerBin property. If it is > 1 (e.g., 500), then bin/kernel width is chosen to include this number of points, while if it is < 1, then it is chosen to include [NumberSims*DirectSLVSimsPerBin] points (e.g., 1000 if NumberSims = 10000 and DirectSLVSimsPerBin = 0.75). The number of points will then be floored and capped at 1 and NumberSims, respectively. If this parameter is not specified, number of paths in a bin or within a Gaussian kernel will default to min(NumberSims/10, 500) for DirectSLVCalculationMethod = BIN, and to NumberSims*0.75 for DirectSLVCalculationMethod = FFT. |
| MODEL:: DLVIRWedgeRatio | 13822 | = 1 | | If the property DLVIRWedgeRatio is set, we use a triangular moving average when evaluating the integral to compute the expectation term. The width of the wedge is 2 * sqrt( NumberSims ) * DLVIRWedgeRatio + 1. |
| MODEL:: DeviateOrder | 13825 | (FORWARD, BACKWARD, MULTIBRIDGE, BROWNIANBRIDGE, MODELFORWARDBRIDGE) | FORWARD | BACKWARD, BROWNIANBRIDGE and MULTIBRIDGE are all methods designed to reduce noise in theta and explain calculations. FORWARDBRIDGE is designed as a way to get consistent random numbers used for cva and fva calculations. When set to BROWNIANBRIDGE, the deviates obtained from the random number generator are used to generate underlying Brownian motions at security time points first, before stochastically interpolating them at other time points. This supercedes VarianceReduction BROWNIANBRIDGE (which is nevertheless maintained for backwards compatibility, and is equivalent to VarianceReduction ORTHOGONAL + DeviateOrder=BROWNIANBRIDGE). When set to BACKWARD, the deviates obtained from the random number generator are used backwards in time, so the first number is applied to the last time skip, etc. When set to MODELFORWARDBRIDGE, the deviates obtained from the random number generator are used by the DBL MODEL handle to -1 when EXPOSURE handle has NewExposureMethod = HISTSIM or SCENARIO. |
| MODEL:: AverageCompression | 13878 | (NONE, EXPONENTIAL, EXPONENTIAL-%) | NONE | Only used for average/variance type of trades ( ie in AsianCap security and if RateAverageType is not equal to NOAVG in any allowed securities). Default to NONE, meaning no compression is done. |
| MODEL:: ConvergenceAccuracy | 13879 | <= 0.00000001 | 0.0 | This parameter has no effect when pricing rates derivatives with DBOPTVOL with SabrFormulaType = AFSABR. We always integrate the payoff on the whole AFSABR grid in that case. ConvergenceAccuracy is used to determine when DBAnalytics should stop evaluating numerical integrals used for the pricing of payoffs which depend on two underlying rates. We do not recommend changing its value away from the default of 1.0E-8; this property is kept mainly for the reconciliation of some exposure calculations in which ConvergenceAccuracy is reduced during autoconversion. |
| MODEL:: AverageCompression | 13880 | (NONE, EXPONENTIAL, EXPONENTIAL-%) | NONE | Only used for average/variance type of trades ( ie in AsianCap security and if RateAverageType is not equal to NOAVG in any allowed securities). Default to NONE, meaning no compression is done. |
| MODEL:: DBMVolCalcMethod | 13881 | = APPROX | APPROX | The flag controls the method to calculate ATM swaption implied vols when pricing vol is 1F normal short rate DBMVOL (i.e. DBMVOL with ModelType = NORMAL, Factor = 1 and VolType = DBT or BDT). APPROX means implied vols are calculated based on swap rate vol approximation (by freezing dS/ dL). EXACT means implied vols are calculated by integration w.r.t. the state variable (short rate at option expiry). We internally use the Jamshidian decomposition technique to analytically integrate the state variable. |
| MODEL:: ConvexityIntegrationStep | 13882 | <= 25 | | This parameter has no effect when pricing rates derivatives with DBOPTVOL with SabrFormulaType = AFSABR. ConvexityIntegrationStep is only known to have an impact on DBOPT pricing of LPI (inflation legs having PeriodCalPayType=PRODUCTLIFT) with pay delay. ConvexityIntegrationStep is an optional field. All arrears and CMS convexity adjustment formulae now use an option summation formula. This formula involves the summation of options over all strikes and thus gives a smile/skew correction to the usual arrears and CMS convexity adjustment formula. The step size when performing the summation defaults to 25 bp. This can be changed by setting the field to, say, 50 which would then use a 50 bp step size. Currently this formula is used in the pricing of all SECURITY objects except for ASIANCAP, CCYSWAP, EDOPTION and PLAINZERO. Note that GENSWAP does not support any type of convexity adjustment. All its forward rates are intrinsic. |
| MODEL:: DirectSLVSimsPerBin | 13883 | >= 0.7 | | For DirectSLVCalculationMethod = BIN/FFT, the effective number of paths in a bin or within a Gaussian kernel is controlled by DirectSLVSimsPerBin property. If it is > 1 (e.g., 500), then bin/kernel width is chosen to include this number of points, while if it is < 1, then it is chosen to include [NumberSims*DirectSLVSimsPerBin] points (e.g., 1000 if NumberSims = 10000 and DirectSLVSimsPerBin = 0.75). The number of points will then be floored and capped at 1 and NumberSims, respectively. If this parameter is not specified, number of paths in a bin or within a Gaussian kernel will default to min(NumberSims/10, 500) for DirectSLVCalculationMethod = BIN, and to NumberSims*0.75 for DirectSLVCalculationMethod = FFT. |
| MODEL:: IndexCompression | 13885 | (NONE, EXPONENTIAL, EXPONENTIAL-%, SYNCHRONISED, SYNCHRONISED-%) | NONE | Used with MKTDATA INDEX. Allows to reduce computational time by generating a subset of the original roll dates. Defaults to NONE, meaning that no compression is done. |
| MODEL:: StateMaxFraction | 13894 | = 1 | 1 | When StateMaxFraction is less than 1.0, statemax is called twice? The result of the first call is used to determine paths that are the closest to exercise boundary. We then keep only the fraction specified as StateMaxFraction of paths and call a second statemax on these paths. As we remove paths that are very far away from the money, it can significantly improve results because statemax has less trouble regressing on remaining simulations. In particular when there is skew, and removing paths that are very far from the money is harmless because exercise decision should be the easiest to determine for these simulations. It is recommended to use a number that is reasonably high like 90% or 92%. |
| MODEL:: PolyOrder | 13895 | (0, 100, 103, 200, 2003) | | PolyOrder is the polynomial order to use in the parametrization of the american option frontier. When PolyOrder is set to 0 or 100, the models will use a cubic polynomial for mapping the exercise boundary. For all other values, this parameter determines the highest power in the polynomial over state variables for calculating the american option exercise boundary. |
| MODEL:: UseNewSVD | 13896 | (NO, ALGLIB) | NO | This parameter is only available for DBX and DBM model. (1) NO: use the DBA internal method. (2) YES: use the IMSL method which appears to give more consistent results across platforms when the matrix is large. (3) YES.REGRESSION: use the regression method. (4) ALGLIB: use the Alglib method by Cholesky decomposition which performs ridge-like regression. |

| Parameter | Condition For Use ID | Approved Range | Default Value | Description |
|---|---|---|---|---|
| MODEL:: SurfaceTimeFloorMaxTime | 13898 | = NO | UNSET | If this feature is set to SECURITY in DBSMC, DBK, DBL or DBX, SurfaceTimeFloor in PIV will be capped by trade maturity, i.e., the effective SurfaceTimeFloor will be min( Maturity, FloorDate ), of which the latter is the original inputted floor date, or derived from the inputted floor interval from reference value date. When not set or set to NONE, SurfaceTimeFloor will work as previously. |
| MODEL:: RecalibCurves | 13899 | (YES, NO) | NO | Possible values are YES and NO (default = NO). We turn on DS2 recalibration when either a), b) or c) is true. a) a MODEL has RecalibCurves = YES b) MODE is ...-RECALIBRATE (legacy feature which would be deprecated in future) c) DICTIONARY has RECALIBCURVES = YES keyword. This means when a MODEL has RecalibCurves = YES, we always turn on recalibration regardless of the dictionary configuration. |
| MODEL:: DecayDboptvolToValuationDate | 13901 | (YES, NO) | YES | When set to YES and there is a DBOPTVOL in the dictionary with ValuationDate not equal to the CURVE Valuation date, the vol object effectively used for pricing will be the spot decayed version to the curve valuation date of the one given as input. In DBOPT and DBFX setting this field to YES also means we do not strictly require DBOPTVOL ValuationDate = CURVE ValuationDate anymore. |
| MODEL:: FreezeStateMaxRiskWeights | 19758 | (YES, YES.*, NO) | | This field is relevant for risk calculation of trades using StateMax feature (e.g. enter/cancel options, PPE/credit reserve). When this is set to YES, the regression coefficients for StateMax are cached in pricing the base scenario and the same coefficients are used for regression in bumped scenarios. This is not exact and can cause some bias in risk profile but risk calculation will be faster and risks will be more stable. One can also set it to INDICATOR, in which case the final exercise indicator will be frozen, i.e. kept the same as estimated in base case when calculating risks. This further reduces seed variance of risks for callable trades, but can lead to significant biases. |
| MODEL:: COMPRESSIONDECAYTIME | 19761 | >= 0 | | To improve speed of pricing for products involving many dates ( for example long dated asian/bermudan/range options with daily fixings), the idea of compression is to price a simplified product, containing fewer dates than the initial one. For example, setting AverageCompression to "EXPONENTIAL-3m" means that during the first 3 month after the valuationDate, fixingDates are unchanged, and then, their frequency decreases exponentially towards its asymptotic value. The convergence speed is controlled by CompressionDecayTime (model property): after around 2 or 3 CompressionDecayTime, the frequency has reached its infinite level. |
| MODEL:: RangeCompression | 19782 | (NONE, EXPONENTIAL, EXPONENTIAL-*, SYNCHRONISED, SYNCHRONISED-*) | NONE | Only used for Range type of trade (FXKORANGE and RANGESWAP security). Default to NONE, meaning that no compression is done. |
| MODEL:: LognormalCutoff | 19785 | >= 20 | | A number >1.0 (apart from 9.99 or UNSET which both mean infinity, the recommended value is 50.0 or higher) which specifies how many forwards the spot should exceed for its diffusion to be changed from lognormal to normal one. Thus, if spot originally follows dSpot(t)/Spot(t)=mu(t)dt+sigma(Spot, t)dW(t), then specifying this parameter will modify the local vol sigma(Spot, t) so as to suppress extreme paths and therefore improve numerical stability of the model. More precisely, the LV will be changed to vol(Spot, t)*U(f)/Spot(t) if Spot(t)>U(f)=LognormalCutoff*Fwd(t), and to vol(Spot, t)*Spot(t)/U(f) if Spot(t)≤U(f). At present, this feature is applied to the diffusion of FX, ASSET and EQUITY index types in a LOGNORMAL model only. |
| MODEL:: FreqTimeVec | 19789 | >= 12 | | FreqTimeVec determines the background time grid for the simulation. Since the vol/correlation handles are arbitrary functions of time, dbx calculates the local covariances of all the variables. These local covariances are used across the simulations timepoints. |
| MODEL:: RangeCompression | 19793 | (NONE, EXPONENTIAL, EXPONENTIAL-*) | NONE | Only used for Range type of trade (FXKORANGE and RANGESWAP security). Default to NONE, meaning that no compression is done. |
| DirectLocalVol | 11086 | (NO, YES) | | When PARAMETRICVOL are used in diffusion-type models (i.e., DBX, DBK, DBL, and DBSMC/AmericanTree), this flag controls whether a LocalVol model should be used (ie internally use Dupire's formula to produce an LV surface from the PARAMETRICVOL) or if a Black-Scholes model should used instead. The former corresponds to DirectLocalVol = YES, the latter to DirectLocalVol = NO. This flag is ignored by pure analytical model (i.e., DBSMC except AmericanTree). |
| DirectSLVCalculationMethod | 2952 | (BIN, FFT, FFT-Z, DBL) | STATEMAX | Defines the method used to compute the conditional expectation of the stochastic volatility $E[SV^2|S]$ multiplier necessary for DSLV. DirectSLVCalculationMethod = STATEMAX uses the original StateMax-based approach. DirectSLVCalculationMethod = BIN uses the bin-based method described by paper 8550. DirectSLVCalculationMethod = FFT uses a Gaussian kernel regression on ranks, evaluated with the Fast Fourier Transform, while FFT-Z is its modification used to improve estimation for low and high levels of spot. DirectSLVCalculationMethod = NONE do not perform any regression, but instead re-used directly the values computed by DirectSLVControlMethod. |
| DLVCalibration | 12982 | (YES, ALL) | YES | When DLVCalibration = YES, a calibration is performed in the monte carlo engine at each time step. This calibration is performed only if there is stochastic vol for EQUITY/FX or stochastic dividends for EQUITY. When DLVCalibration = ALL, the calibration is performed if always (i.e. for any DLV-driven EQUITY/FX underlying). When DLVCalibration = MIXTURE, the behavior is the same as ALL for simulation times before the PIV's SurfaceTimeFloor and the same as YES for simulation times after that. There are multiple calibration procedures available, controlled by the DLVCalibrationType parameter. |
| CenteringMode | 12986 | (0, 2, 3) | | CenteringMode for DBK/DBL can be either 0, 1, 2, 4. (1) 0 means "Grid rescaling" only which means that the grid is thinner for shorter time, giving a better convergence for short dated options, when short and long dated options are priced on the same grid, for instance with security=CAPFLOOR. (2) 1 means "Skew reduction" only, that is the reduction to a diffusion process with unit variance (see Research Paper 4240). (3) 2 means skew reduction + grid rescaling. This is the default of DBL. For non-skewed vols, we recommend CenteringMode = 2. For skew-vols, we should compare CenteringMode = 0 and 2. Sometimes CenteringMode = 0 is more stable than 2. (4) 4 means no skew reduction + no grid rescaling. CenteringMode = 4 is available in DBL (only for the Cheyette model). The advantage of CenteringMode = 4 is the terminal of the front end won't change if user changes the local vol level at the back end. |
| DLVCaching | 13493 | (NO, YES) | YES | The value will be overridden by the correspondent property (*DLVCaching* + DiffusionType) in the model (DBSMC, DBX, DBK, DBL) object, if input (see DLVCachingAsset, DLVCachingEquity, DLVCachingFX). If set to YES, the LocalVol is initially sampled at discrete points in the spot direction and subsequent evaluations are done via a spline that goes through these discrete sampled values. This greatly speeds up calculation in DBX and DBK. If set to NO, the analytical LocalVol formula is computed exactly in every case. NO is not recommended. This only applies if DirectLocalVol is set to YES. |
| DLVCalibrationType | 13824 | (SIMPLE, SMOOTH, SIMPLESMOOTH) | PRICE | Controls the type of DLV calibration used in DBX. DLVCalibrationType = PRICE calibrates the local vol surface at each time step to match the vanilla option surface obtained from a PARAMETRICVOL for certain strikes (controlled by DLVCalibrationStrikes and DLVCalibrationStdevs parameters). DLVCalibrationType = CUMULATIVE moves all the paths to their 'true' values as obtained from the cumulative distribution function calculated from PIV. DLVCalibrationType = CUMULATIVE-PRICE applies an adjustments to simulated paths to match option prices coming directly from the MARKETVOL at given percentiles of the distribution at each timestep. DLVCalibrationType = SIMPLE is similar to CUMULATIVE-PRICE, but it does not move paths to match digitals, but approximately matches call/put option prices only. DLVCalibrationType = SIMPLE-SMOOTH is similar to SIMPLE, but it applies smoother adjustment and matches prices exactly. DLVCalibrationType = SIMPLESMOOTH is similar to SIMPLE-SMOOTH, but the adjustment is capped and continuous across strikes. The cap is calculated as 1% of the empirical standard deviation of the returns over the last time step. |
| DirectSLVInterpOrder | 13884 | = 0 | | It is a Configuration parameter for improvements to the DSLV conditional expectation correction factor computation. If DirectSLVInterpOrder > 0 then a Continuous Graduation algorithm is applied to ln(SV^2) vs. an evenly spaced grid using the weight parameter and using number of knots = directSLVInterpOrder+1. See paper 7838 for details on graduation. If DirectSLVInterpOrder = -1 then a Gaussian Kernel regression is used in which the bandwidth is the number of sims per bin and the scaling variable is the rank order. This is completely equivalent to DirectSLVCalculationMethod FFT. |
| DecayTime | 19764 | >= 0 | | Decay time is the time after which the time grid follows exactly the specified frequency. Between the valuation and the decay time the grid distances are linearly interpolated from the first time point to the distance given by the frequency. |
| FrontLatticeFreq | 19784 | >= 12 | UNSET | FreqTimeVec, FrontLatticeFreq and DecayTime are used for the DS4 MonteCarlo to add background simulation time vector. Values can be "UNSET" or numbers. When numbers are set, the convention of the background time vector generation is consistent with that of the DBX model. FrontLatticeFreq = UNSET means FrontLatticeFreq = FreqTimeVec. DecayTime = UNSET or 0, the background time vector is generated only with FreqTimeVec. When FreqTimeVec is set to UNSET and FrontLatticeFreq and DecayTime are set, a background time vector of FrontLatticeFreq is added until DecayTime. This is only the convention of FUNDINGVOL. |

## 2 Introduction to Model and Validation

### 2.1 Validation Scope

The scope of the validation is detailed in section 1.1.

Products with similar features from a valuation perspective are grouped together and tested as a single consistent group wherein testing results for a representative product are deemed applicable and able to confer equivalent inference to the whole product group. The product grouping logic is presented in section 2.2.

### 2.2 Product Description

In this section we describe the products in scope of the models listed in the present document. A summary of the main features of each product can be found in Section 2.2.2. The current status of the model inventory (as of July 2023) can be found in Section 2.2.3.

#### 2.2.1 Product Definitions

Below is the list of product definitions, as provided in PRDS, for the model DBX-ShortRate_FXSkewStochVol:

| Product Name (Long Product Name) | Product Description |
| --- | --- |
| CMSFXRangeAccrual (ConstantMaturitySwapFXRangeAccrual) | An interest rate swap with CMS-linked coupons that accrue only if the FX rate settles inside a pre-defined range. |
| CMSFXRangeAccrualCallableBerm (CMSFXRangeAccrualCallableBermudan) | An interest rate swap with CMS-linked coupons that accrue only if the FX rate settles inside a pre-defined range. One party has the option to terminate the swap according to a schedule of dates. |
| FXAmerOpt (FXAmericanOption) | Gives the owner the right but not the obligation to exchange money denominated in one currency into another currency at a pre-agreed exchange rate on any date up to expiration. |
| FXOneBarEuroOpt (FXOneBarrierEuropeanOption) | Put or call with a single barrier. |
| FxVarSwap (FxVarianceSwap) | A forward contract on realised variance of spot FX over a given set of fixings, usually daily, where variance is the square of volatility. At maturity, the buyer will receive money if the realised spot variance is greater than the strike, but pay if it is lower. |
| FXVolSwap (FXVolatilitySwap) | A Forward contract on realised volatility of spot over a given set of fixings, usually daily, but can be any frequency. At maturity, the buyer will receive money if the realised spot volatility is greater than the strike, but pay if it is lower. The FX vol leg or entire trade may be subjected to a cap and/or floor. |
| IRFXCorrelationSwap (InterestRateFXCorrelationSwap) | A product that pays the difference between the agreed strike and correlations realized between an interest rate and an FX rate over the life of the swap. |
| IRFXDualDigitalOpt (InterestRateFXDualDigitalOption) | A binary option that pays a fixed amount if conditions on both the underlying interest rate and the FX are satisfied, otherwise pays nothing. |
| IRFXSwapDualRangeAccrual (InterestRateFXSwapDualRangeAccrual) | An interest rate swap with a range accrual where the coupon is dependant on the floating rate index and the spot FX rate fixing between certain barriers in any one period. Interest is only accrued if the reference rates fall within their respective ranges. |
| IRFXSwapFXBasketOpt (InterestRateFXSwapFXBasketOpt) | An interest rate swap with coupons that are FX basket options. |
| IRFXSwapFXKnockOut (InterestRateFXSwapFXKnockOut) | An interest rate swap with coupons that are FX barrier options. |
| IRFXSwapFXOpt (InterestRateFXSwapFXOption) | An interest rate swap with coupons that are FX options. |

#### 2.2.2 Product Grouping Table

Here below we show the product grouping table for DBX-ShortRate_FXSkewStochVol. The products marked in bold are tested thoroughly in the MVR.

| Product | Underlying | Coupon Structure | Underlying specific | Option | Barrier | Path Dependent | Basket Function | Quanto Composite |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CMSFXRangeAccrual | FX-InterestRate | Linear | Convex | | Range | | | |
| CMSFXRangeAccrual-CallableBerm | FX-InterestRate | Linear | Convex | Bermudan | Range | | | |
| FxAmerOpt | FX | EuroCpn | | American | | | | |
| FXOneBarEuroOpt | FX | EuroCpn | | | KnockIn-KnockOut | | | |
| FxVarSwap | FX | Linear | | | | Variance | | |
| FxVolSwap | FX | Linear EuroCpn | | | | Variance | | |
| IRFXCorrelationSwap | FX-InterestRate | Linear | | | | Correlation | | |
| IRFXDualDigitalOpt | FX-InterestRate | DigiCpn | | | | | | |
| IRFXSwapDualRange-Accrual | FX-InterestRate | Linear | | | | | | |
| IRFXSwapFXBasketOpt | FXMulti-InterestRate | EuroCpn | | | | | | |
| IRFXSwapFXKnockOut | FX-InterestRate | EuroCpn | | | KnockIn-KnockOut | | | |
| IRFXSwapFXOpt | FX-InterestRate | EuroCpn | | | | | | |
| IRFXSwapFXOpt-CallableBerm | FX-InterestRate | EuroCpn | | Bermudan | | | | |
| IRFXSwapFX-RangeAccrual | FX-InterestRate | Linear | | | Range | Correlation | | |
| IRFXSwapFX-RangeAccrual-CallableBerm | FX-InterestRate | Linear | | Bermudan | Range | Correlation | | |
| IRSwapQuanto | InterestRate | Linear | | | | | | Quanto-Composite |
| IRSwapQuanto-RangeAccrualCallable | InterestRate | Linear | | European-Bermudan-American | Range | | | Quanto-Composite |
| IRSwap-RangeAccrual | InterestRate | Linear | | | Range | | | |
| IRSwaptIon-XCcyBerm | FX-InterestRate | Linear | | Bermudan | | | | |
| IRXCcySwapAccreting CallableBerm | FX-InterestRate | Linear | | Bermudan | | | | |
| IRXCcySwapCallable | FX-InterestRate | Linear | | European-Bermudan-American | | | | |
| IRXCcySwapCallableBerm | FX-InterestRate | Linear | | Bermudan | | | | |
| LTFX | FX | Linear | | | | | | |
| LTFXConvexity | FX | Linear | Convex | | | | | |
| LTFXConvexity CallableKnockOut | FX | Linear | | European-Bermudan-American | KnockIn-KnockOut | | | |
| LTFXConvexityKnockOut | FX | Linear | Convex | | KnockIn-KnockOut | | | |
| LTFXDigital | FX | DigiCpn | | | | | | |
| LTFXDigitalCallable | FX | DigiCpn | | European-Bermudan-American | | | | |
| LTFXDigitalKnockOut | FX | DigiCpn | | | KnockIn-KnockOut | | | |
| LTFXDigitalKnockOut-Callable | FX | DigiCpn | | European-Bermudan-American | KnockIn-KnockOut | | | |
| LTFXOneBarDigitalOpt | FX | DigiCpn | | | KnockIn-KnockOut | | | |
| LTFXParForward | FX | Linear | Forward | | | | | |
| LTFXParForwardCallable | FX | Linear | Forward | European-Bermudan-American | | | | |
| LTFXParForward-KnockOut | FX | Linear | Forward | | KnockIn-KnockOut | | | |
| LTFXPaymentOption | FX | Linear | Forward | European-Bermudan-American | | | | |
| LTFXRatioForward | FX | EuroCpn | | | | | | |
| LTFXRatioForward-CallableKnockOut | FX | EuroCpn | | European-Bermudan-American | KnockIn-KnockOut | | | |
| LTFXRatioForward-KnockOut | FX | EuroCpn | | | KnockIn-KnockOut | | | |
| LTFXResurrecting-FaderOpt | FX | EuroCpn | | | Range | | | |
| PRDCSwap | FX | EuroCpn | | | | | | |
| PRDCSwapCallable | FX | EuroCpn | | European-Bermudan-American | Flex | | | |
| PRDCSwapCallableKO | FX | EuroCpn | | European-Bermudan-American | KnockIn-KnockOut | | | |
| PRDCSwapCallableKO-RedemptionStrike | FX | EuroCpn | | European-Bermudan-American | KnockIn-KnockOut | | | |
| PRDCSwapCallable-RedemptionStrike | FX | EuroCpn | | European-Bermudan-American | | | | |
| PRDCSwapKO | FX | EuroCpn | | | KnockIn-KnockOut | | | |
| PRDCSwapKO-RedemptionStrike | FX | EuroCpn | | | KnockIn-KnockOut | | | |
| PRDCSwap-RedemptionStrike | FX | EuroCpn | | | | | | |
| PRDCSwapTarn | FX | EuroCpn | | | TARN | | | |
| PRDCSwapTarn-RedemptionStrike | FX | EuroCpn | | | TARN | | | |

Table 14: The product grouping table for DBX-ShortRate_FXSkewStochVol.

We carry out extensive testing of a number of products in order to ensure that various features are implemented correctly. The features exemplified by the tested products are as follows:

| Group | Instruments | Payoff Structure |
| --- | --- | --- |
| Forward-Style Contracts | FXVarSwap<br>FXVolSwap<br>IRFXCorrelationSwap<br>IRSwapQuanto<br>LTFX<br>LTFXParForward | $$C_n = (X(T_n) - K_n)$$ Coupon for time $$T_n$$<br><br>$$X(T_n)$$ is the underlying value at time $$T_n$$—depending on the type of contract the underlying could be:<br><br>• FX rate,<br>• Interest rate (such as Libor, swap rates, CMS/CMS spread rates),<br>• A multiplier of applicable IR/FX rates,<br>• realized variance/volatility/correlation over a given set of fixings.<br><br>$$K_n$$ is the strike applicable at time $$T_n$$<br><br>$$τ_n$$ is the applicable day count fraction for the time period $$[T_n, T_{n+1}]$$ |
| European-Style Options | FXOneBarEuroOpt<br>IRFXDualDigitalOpt<br>LTFXConvexity<br>LTFXDigital<br>LTFXDigitalKnockOut<br>LTFXOneBarDigitalOpt<br>LTFXParForwardKnockOut<br>LTFXRatioForward<br>LTFXRatioForwardKnockOut | $$C_n = χ_{(.)}Δ_n(φ_n(X(T_n) - K_n))_+$$ is the Coupon for time $$T_n$$<br><br>$$X(T_n)$$ is the underlying value at time $$T_n$$—depending on the type of contract the underlying could be:<br>• FX rate,<br>• Interest rate (such as Libor, swap rates, CMS/CMS spread rates),<br>• A multiplier of applicable IR/FX rates.<br><br>$$K_n$$ is the strike applicable at time $$T_n$$<br><br>$$τ_n$$ is the applicable day count fraction for the time period $$[T_n, T_{n+1}]$$<br><br>$$χ_{(.)}$$ is an indicator function (applicable for barrier features) that returns 1 if the applicable condition (.) is met and 0 otherwise. The applicable condition may be on the underlying (such as barrier levels) or on a different observable.<br><br>$$φ = +1$$ for call options and $$-1$$ for put options<br><br>In the case of digital options the pay off just reduces to $$χ_{(X(T_n)>K_n)}τ_n$$ for calls and $$χ_{(X(T_n)<K_n)}$$ for put options<br><br>LTFXRatio forward type contracts are just a strip of European call/put options. |
| PRDCs | PRDCSwap<br>PRDCSwapKO<br>PRDCSwapCallable<br>PRDCSwapCallableKO<br>PRDCSwapCallableKO-RedemptionStrike<br>PRDCSwapCallable-RedemptionStrike<br>PRDCSwapKORedemptionStrike<br>PRDCSwapRedemptionStrike<br>PRDCSwapTARN<br>PRDCSwapTARN-RedemptionStrike | $$C_n = χ_{(.)}M_nΔ_n(X(T_n) - K_n)_+$$ is the coupon for time $$T_n$$,<br><br>$$M_n$$ is a multiplier applicable to the coupons at time $$T_n$$<br><br>$$X(.)$$ is usually an FX-linked variable<br><br>$$K_n$$ is the strike applicable at time $$T_n$$<br><br>$$τ_n$$ is the applicable day count fraction for the time period $$[T_n, T_{n+1}]$$<br><br>$$χ_{(.)}$$ is an indicator function used in the presence of barrier features<br><br>Overall:<br>• one leg is a funding leg without any optionality and pays LIBOR + spread.<br>• the second leg pays some options of FX, with possibly a barrier.<br><br>Moreover, the callable PRDCs lie at the intersection between this group and the one of Bermudan/American style derivatives. |
| Bermudan/ American style derivatives | CMSFXRangeAccrual-CallableBerm<br>FXAmerOpt<br>IRFXSwapFXOptCallableBerm<br>IRFXSwapFXRangeAccrual-CallableBerm<br>IRSwaptionXCcyBerm<br>IRXCcySwapAccreting-CallableBerm<br>IRXCcySwapCallable<br>IRXCcySwapCallableBerm<br>LTFXConvexityCallableKnockOut<br>LTFXConvexityKnockOut<br>LTFXDigitalCallable<br>LTFXDigitalKnockOutCallable<br>LTFXParForwardCallable<br>LTFXPaymentOption<br>LTFXRatioForward-CallableKnockOut | These derivatives typically have cancellable/ other early exercise features during the life of the contract. TARNs are auto callable based on the target level of coupons accrued.<br><br>In the absence of early exercise features these derivatives have pay- off functions is similar to those discussed in the previous groups. |

Table 16 shows the trades booked under the DBX-ShortRate_FXSkewStochVol model on July 2023. Products we have tested are marked in bold.

| Product | No. Trades | PV (M EUR) | Absolute PV (M EUR) |
| --- | --- | --- | --- |
| **PRDCSwapCallableRedemptionStrike** | 1174 | 86.4567 | 299.1838 |
| **PRDCSwapRedemptionStrike** | 18 | 190.2722 | 193.0102 |
| **PRDCSwapCallable** | 521 | 122.0598 | 190.3646 |
| **IRSwapRangeAccrual** | 2 | 185.0928 | 185.0928 |
| **LTFXRatioForwardKnockOut** | 306 | 55.9211 | 179.8264 |
| **PRDCSwap** | 111 | -13.9562 | 107.0258 |
| **PRDCSwapTarn** | 100 | 12.4883 | 105.5403 |
| **LTFXParForward** | 231 | -24.7877 | 93.6123 |
| **LTFXRatioForward** | 61 | 16.7972 | 76.9247 |
| **PRDCSwapCallableKORedemptionStrike** | 248 | 62.7963 | 69.0224 |
| **LTFXDigital** | 14 | 2.3814 | 13.0621 |
| **LTFXParForwardKnockOut** | 27 | 0.3861 | 9.5141 |
| **IRFXSwapFXKnockOut** | 5 | 3.2753 | 9.4844 |
| **PRDCSwapKO** | 36 | 1.5435 | 8.001 |
| **FXVolSwap** | 1 | -4.2224 | 4.2224 |
| **PRDCSwapKORedemptionStrike** | 31 | 0.5731 | 3.0673 |
| **IRFXSwapFXRangeAccrualCallableBerm** | 2 | -2.5076 | 2.5076 |
| **PRDCSwapTarnRedemptionStrike** | 8 | 0.9467 | 1.0875 |
| **LTFXDigitalKnockOut** | 3 | 0.0383 | 0.4167 |
| **PRDCSwapCallableKO** | 3 | 0.0841 | 0.0841 |
| **LTFXPaymentOption** | 36 | 0.0218 | 0.0296 |
| **FXOneBarEuroOpt** | 1 | -0.0096 | 0.0096 |
| **IRSwaptionXCcyBerm** | 3 | 0.0 | 0.0067 |
| FXVarSwap | 0 | 0.0 | 0.0 |
| LTFXDigitalKnockOutCallable | 0 | 0.0 | 0.0 |
| IRXCcySwapAccretingCallableBerm | 0 | 0.0 | 0.0 |
| CMSFXRangeAccrualCallableBerm | 0 | 0.0 | 0.0 |
| IRFXSwapDualRangeAccrual | 0 | 0.0 | 0.0 |
| LTFXConvexityCallableKnockOut | 0 | 0.0 | 0.0 |
| LTFXConvexityKnockOut | 0 | 0.0 | 0.0 |
| IRFXSwapFXOptCallableBerm | 0 | 0.0 | 0.0 |
| LTFXParForwardCallable | 0 | 0.0 | 0.0 |
| IRFXSwapFXOpt | 0 | 0.0 | 0.0 |
| IRSwapQuantoRangeAccrualCallable | 0 | 0.0 | 0.0 |
| LTFXRatioForwardCallableKnockOut | 0 | 0.0 | 0.0 |
| IRFXSwapFXBasketOpt | 0 | 0.0 | 0.0 |
| IRFXCorrelationSwap | 0 | 0.0 | 0.0 |
| IRFXSwapFXRangeAccrual | 0 | 0.0 | 0.0 |
| IRXCcySwapCallable | 0 | 0.0 | 0.0 |
| FXAmerOpt | 0 | 0.0 | 0.0 |
| IRFXDualDigitalOpt | 0 | 0.0 | 0.0 |
| IRXCcySwapCallableBerm | 0 | 0.0 | 0.0 |
| LTFX | 0 | 0.0 | 0.0 |
| LTFXDigitalCallable | 0 | 0.0 | 0.0 |
| IRSwapQuanto | 0 | 0.0 | 0.0 |
| LTFXConvexity | 0 | 0.0 | 0.0 |
| CMSFXRangeAccrual | 0 | 0.0 | 0.0 |
| LTFXResurrectingFaderOpt | 0 | 0.0 | 0.0 |
| LTFXOneBarDigitalOpt | 0 | 0.0 | 0.0 |

Table 16: The Model Inventory for DBX-ShortRate_FXSkewStochVol as of 03/07/2023.

### 2.3 Model Description

Allowed Model Configurations

The allowed model configuration for DBX-ShortRate_FXSkewStochVol is:

DBX-ShortRateNormal[LVMRAUTO]_FXSkewStochVol[DLVAUTO]

#### 2.3.1 Model Assumptions

The DBX-ShortRate_FXSkewStochVol model is primarily used to model long-dated FX products. The following model assumptions have been highlighted by DBAnalytics:

1. Diffusive Dynamics: the randomness in the evolution of the short rate processes representing the domestic and foreign interest rates, of the FX rate and of its underlying stochastic volatility component is assumed to be driven by Brownian Motions;

2. Mean reverting short rate and stochastic volatility dynamics: The dynamics of the short rates representing the domestic and foreign interest rates, and the dynamics of the stochastic volatility component of the FX rate are assumed to be given by mean-reverting (Hull-White) processes.

3. Time dependent short rate local volatility: A time dependent volatility structure (without a skew/smile component) is assumed to reasonably capture the interest rate dynamics relevant for FX-IR hybrid a and long dated FX derivatives.

4. No Arbitrage: This is a fundamental assumption for all realistic models used for pricing/hedging derivatives.

#### 2.3.2 Model Inputs

##### 2.3.2.1 Market Inputs

The model DBX-ShortRate_FXSkewStochVol requires the following market inputs:

• Interest Rate Curves: The domestic and foreign yield curves are constructed from a set of market observable instruments such as cash rates, futures and swaps, OISSpreads, CCYSpreads, etc. The base curve is typically the USD LIBOR 3M curve and other curves (e.g. OIS discounting curve, USD LIBOR 6M, non-USD denominated curves, etc.) are constructed with the help of the relevant spreads (derived from market observable instruments such as cross-currency swaps, basis swaps, etc).

• Interest Rate Volatility: The model requires liquid interest rate option markets for the calibration of the volatilities of the domestic and foreign interest rates. The interest rate volatility information is stored as follows:
  - The calibration targets are stored under the form of a AFSABR volatility object (which is similar to a volatility cube) which stores volatility information corresponding to different expiry-tenor pairs and strikes.
  - A CALIBMODEL object and a DBMVOL object of VolMode=LVMR store information related the auto-calibration of the interest rate volatility e.g. the time points where the volatility is calibrated, value of mean-reversion, parameters controlling to numerical methods in use.

• FX Rate Volatility: The model requires liquid FX option markets for the calibration of the FX rate volatility and only products denominated in currencies where this information is available should be priced using this model. The FX rate volatility information is stored as follows:
  - The market observable information is stored in a DELTAVOL object (typically under the form of a DNVFR/CVX term structure) to which the FX rate volatility is calibrated on the fly during pricing.
  - A MODELVOL obect of type SA and an EXTRAINFO object control the calibration of the SA4 functional form to the DELTAVOL object. The information regarding the DLVIR adjustment is stored in the MODEL object.

• FX Rate Stochastic Volatility: The information regarding the stochastic volatility component of the FX rate is stored in a VOL object of DiffusionType = STOCHVOL. The SV parameters are set exogenously and not calibrated to market observables.

• FX Spot: The information related to the FX spot value is stored in a DBQVOL object.

• Correlation: The correlation values between the domestic and foreign interest rate, FX rate and SV component of the FX rate are stored in a correlation matrix that can be found in the CORRELATION object.

##### 2.3.2.2 Model Parameters

The model parameters relevant for DBX-ShortRate_FXSkewStochVol are listed in Section 1.3.

#### 2.3.3 Dynamics of the interest rate

The following section is based on the model developer document [1]. In this model, the evolution of the domestic and foreign interest rates are represented by one-factor mean-reverting processes time-dependent coefficients (Hull-White model). More precisely, the dynamics of the domestic and foreign short rate processes $r_t^d$ and $r_t^f$ are given by:

$dr_t^i = (\theta_i(t) - k_i(t)r_t^i) dt + \sigma_i(t)dW_t^i, i \in \{d,f\} \tag{1}$

The above dynamics is stored in a DBMVOL object of type VolType DBT and VolMode LVMR. The volatility parameters $\sigma_i(t)$ are calibrated on the fly during pricing (autocalibration) while the mean-reversion parameters are exogenously set by the trading desk. The mean-reverting process described by the above SDE has a closed-form solution given by:

$r_t^i = \alpha_i(t) + \phi_i(t) \int_0^t \frac{\sigma_i(s)}{\phi_i(s)} dW_s$

where $\phi_i(t) = exp \left( -\int_0^t k_i(s)ds \right)$. The term $\alpha_i(t)$ is determined from the centering condition:

$\mathbb{E} \left[ exp \left( -\int_0^T r_i(s)ds \right) \right] = P_i(0,T), i \in \{d,f\} \tag{2}$

see Section 1.1 of [2]. The purpose of the centering condition is to ensure that the model fits the initial domestic and foreign discounting curves $\{P_i(0,T); T \geq 0\}, i \in \{d,f\}$.

In the DBMVOL objects corresponding to the domestic and foreign interest rate volatilities, the LocalVols table stores the initial guesses used in the calibration for the LocalVols parameters $\{\sigma_i(t_m), t_m \geq 0\}$ and the MeanRev table contains the pre-set mean-reversion parameters $\{k_i(t_n), t_n \geq 0\}, i \in \{d,f\}$. The CalibTargets table contains the co-terminal ATM swaptions used as calibration targets.

The DBOPTVOL object with AFSABR configuration is used to price the calibration targets and generate the market implied volatilities that will be used as targets in the calibration algorithm.

| Parameter | Parameter Description | Calibration |
| --- | --- | --- |
| $\theta_i(t)$ | Long-term mean parameter. This parameter is derived from the centering condition (2) in order to ensure that the model fits the initial yield curve. | The parameter is computed on the fly during pricing. |
| $k_i(t)$ | Mean-reversion parameter | The parameter is exogenously specified (owned by STRATS) |
| $\sigma_i(t)$ | Volatility parameter | The parameter is calibrated on the fly during pricing. |

Table 17: Model parameters specific to the interest rate.

#### 2.3.4 Dynamics of the FX rate

This section is based on model developer documents [1], [3], [4], [5], [6], and [7]. The FX rate follows the dynamics of a lognormal process with local-stochastic volatility:

$dS_t = (r_t^d - r_t^f)S_t dt + \sigma_{LV}(t, S_t)e^{u_t}S_t dW_t^S \tag{3}$
$du_t = \left( -\frac{\tau^2(t)}{2} - h(t)u_t \right) dt + \tau(t) dW_t^u$

where $\sigma_{LV}(t, S_t)$ represents the LV component and $u_t$ represents the SV component. The LV component is calibrated on the fly during pricing using the industry-standard approach that relies on Gyongy's theorem, see Section 2.3.7 for a detailed description.

| Parameter | Parameter Description | Calibration |
| --- | --- | --- |
| $\sigma_{LV}(t, S_t)$ | Local volatility component | The parameter is computed on the fly during pricing. |
| $\tau(t)$ | Volatility of SV component computed based on (5) and (6) | The parameter is exogenously specified (owned by STRATS). |
| $h(t)$ | Mean-reversion of SV component computed based on (7) | The parameter is exogenously specified (owned by STRATS). |

Table 18: Model parameters specific to the interest rate.

The correlation parameters between the interest rates, FX rate and SV component of FX rate is stored in CORRELATION object under the form of a correlation matrix. The correlation parameters are exogenously specified by the trading desk.

#### 2.3.5 Dynamics of the stochastic volatility of the FX rate

The parameters of the SV component $u_t$ are stored in a DBMVOL object of DiffusionType STOCHVOL, ModelType LOGNORMAL and VolMode LVTV0. The parameters of the SV component are stored in two tables: LocalVols and TermVols.

| Time | Vol | Use | BumpAmount | BumpType |
| --- | --- | --- | --- | --- |
| 0 | 1.0 | 0 | 0.05 | REL |
| 0 | 0.5 | 0 | 0.05 | REL |
| 0 | 0.25 | 0 | 0.05 | REL |

Table 19: Example of LocalVols table containing 3 rows.

The values stored in the 3 rows of the LocalVols table should be read as follows (we use the above table as example): the value from the 1st row is the mean-reversion parameter $h_0 = 1.0$, the value from the 2nd row $v_{LT} = 0.5$ represents the "long term local vol" and the value from the 3rd row $d = 0.25$ represents the decay time parameter.

The mean-reversion parameter $h_0$ stored in LocalVolsSV should not be confused with the mean-reversion $h(t)$ of the process $u_t$. Parameter $h_0$ is only used in formula (7) to define $LV_0$ and afterwards it is discarded. The mean-reversion $h(t)$ of the process $u_t$ is derived using formula (7).

Let $T_0$ represent the first maturity date present in the TermVols table. For all $t < T_0$, the SV local volatility $\tau(t)$ (denoted typically by $LV(t)$ in DBAnalytics documentation) is defined as follows:

$\tau(t)^2 = LV(T_0)^2 = TV(T_0)^2 \cdot \frac{2h_0T_0}{1 - exp(-2h_0T_0)} \tag{5}$

where $T_0$ represents the value of the TermVols at tenor $T_0$. For all $T_i \geq T_0$, the local volatility $LV(T_i)$ is defined as follows:

$LV(T_i) = \tau_{LT} + (LV_0 - \tau_{LT}) exp \left( -\frac{T_i - T_0}{d} \right) \tag{6}$

Expression (6) ensures that for $T_i > T_0$, the local volatility converges to the "long term local volatility" $\tau_{LT}$. The motivation behind this approach, as described in Section 1.5 of [7] is the following: if $TV_0$ is modified, the LV will be impacted at all maturities. This implies that long term trades will potentially have sensitivity to $TV_0$ which is not desirable. The above construction shows that the value of the vol-of-vol $\tau(t)$ (or $LV(t)$ in DBA notation) is centered around the "long term local volatility" $\tau_{LT}$.

| Time | Vol | Use | BumpAmount | BumpType |
| --- | --- | --- | --- | --- |
| 0.25 | 1.1236 | 0 | 0.01 | ABS |
| 0.5 | 0.6645 | 0 | 0.01 | ABS |
| 1 | 0.4349 | 0 | 0.01 | ABS |
| 2 | 0.3819 | 0 | 0.01 | ABS |
| 3 | 0.2477 | 0 | 0.01 | ABS |
| 5 | 0.2321 | 0 | 0.01 | ABS |
| 7 | 0.2012 | 0 | 0.01 | ABS |
| 10 | 0.1804 | 0 | 0.01 | ABS |
| 15 | 0.20 | 0 | 0.01 | ABS |
| 20 | 0.20 | 0 | 0.01 | ABS |

Table 20: Example of TermVols table.

Thus we have constructed a term-structure of local volatilities {$LV(T_i); i = 1,...,n$}. Together with the term-structure term vols {$TV(T_i); i = 1,...,n$} obtained through calibration, the mean-reversion $h(t)$ of the process $u_t$ is derived using the following relation:

$$TV^2(T)/T = \Phi^2(T) \int_0^T \frac{LV^2(t)}{\Phi^2(t)} dt \tag{7}$$

where $\Phi(t) = exp \left( -\int_0^t h(s)ds \right)$. Equation (7) shows that specifying any two quantities among LocalVols, TermVols and mean-reversion parameter allows to define the third one. The mean-reversion parameter $h(t)$ is computed from equation (7), by deriving the equation with respect to T and solving the resulting ODE in $\Phi^2(T)$. For more details on (7) and the complete derivations we refer to [7].

#### 2.3.6 Calibration of interest rate volatility

The volatilities of the domestic and foreign interest rates are calibrated on the fly during pricing. DBAnalytics uses the following objects to store the relevant information for the calibration of the (domestic and foreign) interest rate volatility:

• A DBMVOL object of VolType LVMR stores the initial guesses for the LocalVols parameters and the exogenously set mean-reversion parameter. The calibration targets are stored in a table called CalibTargets. The calibration targets are CALSWAPTION security objects of OptionType = STRADDLE which represent ATMF-strike swaption straddle positions corresponding to coterminal swaptions w.r.t the exotic's maturity.

• A DBOPTVOL object with AFSABR configuration stores volatility information corresponding to different expiry-tenor pairs and strikes (object similar to a volatility cube). The DBOPTVOL object is used to price the calibration targets contained in the CalibTargets table i.e. generate the market implied volatilities (and market prices) that are used as targets in the calibration algorithm.

• A CALIBMODEL object storing parameters controlling the numerical implementation of the calibration (e.g. MaxIter, CalibType).

Calibration algorithm. The calibration steps are the following:

1. The securities stored in the CalibTargets table are priced using the DBOPTVOL object. The resulting implied volatilies of the securities are treated as market implied volatilities to be used as calibration targets.

2. The calibration engine uses the Levenberg-Marquardt algorithm (LEASTSQUARES in DBAnalytics terminology) to calibrate the volatility of the short rate process. The LEASTSQUARES is an iterative method, that starts from the initial guesses for the parameters (values stored in the LocalVols table) and these values are then modified in subsequent iterations until a pre-specified convergence criteria is satisfied. The objective function minimizes the sum of squared errors between the target implied volatilities and the model-generated implied volatilities i.e.

$$I(P, \Sigma_{mkt}) = \sum_i w_i (\sigma_{mkt}(i) - \sigma_{mdl}(i, P))^2$$

where $P$ represents the set of model parameters being calibrated (in our case, the LocalVols parameters), $\sigma_{mkt}(i)$ are the market implied volatilities, $\sigma_{mdl}(i, P)$ are the model-generated implied volatilities (depend on the model parameters P) and $w_i$ are the weights assigned to each target $i$. The error tolerance level and the maximum number of iterations used by the model are configurable.

#### 2.3.7 Calibration of FX rate volatility

The local volatility component of the FX rate is calibrated on the fly during pricing, while The SV component of the FX rate is set exogenously. DBAnalytics uses the following objects to store the relevant information for the calibration of the FX rate volatility:

1. A MARKETVOL object of InputMode DELTAVOL stores the market information representing the calibration targets via a VOL table that contains a volatility surface, typically of type (DN, RR, CVX), but other conventions are also possible. The MARKETVOL object can contain a DayWeights table. See Section 2.3.8.1 for more details.

2. A MODELVOL object stores the PIV (parametric volatility) that is auto-fitted to the input DELTAVOL volatility surface in a model framework that assumes deterministic interest rates. The exact functional form of PIV is specified in the SkewType property and can be SA4 or LAGDF, see Section 2.3.8.2 for more details.

3. The information related to the DLVIR adjustment and SLV decomposition is stored in the MODEL object, see Sections 2.3.9 and 2.3.10 for more details.

Calibration algorithm.

The calibration methodology uses the industry-standard approach that relies on Gyongy's theorem and has the following steps:

1. The market information is provided by the MARKETVOL object of InputMode DELTAVOL that stores in the VOLS table a volatility surface of type (DN, RR, CVX).

2. The parametric volatility (PIV) represented by the MODELVOL object of InputMode PARAMETRICVOL is auto-fitted to the input volatility surface in a model framework that assumes deterministic interest rates. The functional form of PIV is specified by SkewType property and can be SA4 or LAGDF. For more details on this step, see Section 2.3.8.

3. Using Dupire's formula under the assumption of deterministic rates, the local volatilities $\sigma_{DLV}(t, S_t)$ are computed from the implied volatilities of vanilla options.

4. Since the model uses stochastic interest rates, the FX volatilities computed at the previous point need to be adjusted to account for the volatility of the interest rates. To this purpose, the local volatilities $\sigma_{DLV}(t, S_t)$ are adjusted, as described in [4]:

$$\sigma_{adj}^2(t, K) = \sigma_{DLV}(t, K)^2 - 2 \cdot A\Phi(t, K)$$

where $A\Phi(t, K)$ represents the stochastic IR correction, see [4] and [6]. The adjustment term is a function that depends on the parameters of the stochastic interest rates. For more details on this step, see Section 2.3.9.

5. The local volatility component $\sigma_{LV}(t, S_t)$ that is used in (3) is computed from:

$$\sigma_{LV}(t, K) = \frac{\sigma_{adj}(t, K)}{\mathbb{E}[e^{u_t} | S_t = K]}$$

with the conditional expectation present in the denominator being calculated according to the SLVCalculationMethod, see Section 2.3.10 for more details. This decomposition allows the FX smile to be explained partly by a local volatility component and partly by a stochastic volatility component. This further allows to control the price of the exotics while always correctly capturing the vanilla smiles.

![Figure 1: Calibration of the FX rate volatility.](./Fig/1.png)

#### 2.3.8 Parametric Implied Volatility (PIV) and PIV AutoFit

In this section we describe in detail the steps 1 and 2 of the calibration algorithm of the FX rate volatility. The PIV calibration (PIV AutoFit) has been described and tested in detail in models such as DBSMC-RateDeterministic_FXMarket. Therefore, we will provide in this section an explanation of how to use the input market volatility of type DELTAVOL (or STRIKEVOL) by choosing the PIV parameters at each time slice to minimize the least squares error in matching certain targets. Typically, these targets are either the prices / implied volatilities of certain options (e.g. ATMF, 25C, 25P) or a number of conditions that the implied volatility surface must satisfy (DN, RR, CVX).

##### 2.3.8.1 Description of market inputs. MARKETVOL object

The targets used in the calibration of the FX rate volatility are stored in a MARKETVOL object of InputMode DELTAVOL. Depending on the PIV in use, DELTAVOL will contain 3 targets per tenor (for SA4) or 5 targets per tenor (for LAGDF). More precisely, the market information is stored at each relevant tenor point $T_i, i = 1,...m$ under the form of the tuple that can take the form:

1. (ATMF, nC, nP) e.g. (ATMF, 25C, 25P), (ATMF 25C, 10C, 10P, 25P). In this configuration, the column ATMF stores the volatilities $\sigma_{ATMF}(T_i), i = 1,...,m$ corresponding to the ATMF strike equal to the forward. The columns nC and nP store individual deltas e.g. 10C, 25C, 10P, 25P. More precisely, is the delta notation is provided under the form (ATMF, 25C, 10P), then column 25C will store implied volatilities $\sigma_{25C}(T_i), i = 1,...,m$ corresponding to the delta of call option is equal to 0.25, while column 25P will store implied volatilities $\sigma_{10P}(T_i), i = 1,...,m$ corresponding to the strike where the delta of the put option is equal to -0.10.
In some configurations, the DN notation is substituted with the C-P notation. However, these are equivalent since the column C - P stores the volatilities $\sigma_{C-P}(T_i), i = 1,...,m$ corresponding to the strike where the call delta is equal to the put delta i.e. $\Delta_{Call} + \Delta_{Put} = 0$.

2. (DN, RR, CVX) e.g. (DN, 25RR, 10CVX), (DN, 25RR, 25CVX, 10RR, 10CVX).

An example of target set of type (DN, RR, CVX) is the following:

| Dates | DN | 25RR | 10CVX |
| --- | --- | --- | --- |
| "3m" | 0.0512019168 | -0.0162937206 | 0.0172201665 |
| "6m" | 0.0525569490 | -0.0166946545 | 0.0175089409 |
| "1y" | 0.0537512664 | -0.0174132985 | 0.0173273140 |
| "2y" | 0.0549098397 | -0.0175728969 | 0.0170310404 |
| "3y" | 0.0578146929 | -0.0128358403 | 0.0147951623 |
| "5y" | 0.0654296057 | -0.0134359912 | 0.0169943723 |
| "7y" | 0.0734890406 | -0.0152926834 | 0.0180403771 |
| "10y" | 0.0775564824 | -0.0156916182 | 0.0196913599 |
| "15y" | 0.0830564824 | -0.0200816182 | 0.0237913598 |
| "20y" | 0.0890564824 | -0.0196816182 | 0.0240913599 |
| "30y" | 0.0905564824 | -0.0205816182 | 0.0240913598 |

Table 25: Example of target volatilities stored in the Vols table of the DELTAVOL. Each tenor contains a tuple (DN, RR, CVX).

In the above table, the volatility surface is represented at each time slice by three quantities: DN, 25RR and 10CVX. Their interpretation is the following:

• The column DN stores a series of volatilities $\sigma_{DN}(T)$ corresponding to the DN (delta-neutral) strike $K_{DN}$ which is the value of the strike for which the call delta is equal to the put delta i.e.

$$\Delta_{Call}(K_{DN}, T, \sigma_{DN}) + \Delta_{Put}(K_{DN}, T, \sigma_{DN}) = 0$$

The exact definition of delta $\Delta$ is set by the parameter DeltaType. For example, DeltaType=FORWARDRISK corresponds to:

$$\Delta_{Call} = \frac{1}{\partial C / \partial F} = N(d_1) \text{ and } \Delta_{Put} = \frac{1}{\partial P / \partial F} = -N(-d_1)$$

where $C$ represents the call option price, $P$ represents the put option price, $F$ represents the forward and $DF$ represents the discount factor. In the Black-Scholes model the relation between these is the following:

$$C = DF(F \cdot N(d_1) - K \cdot N(d_2)) \text{ and } P = DF(K \cdot N(-d_2) - F \cdot N(-d_1))$$

• The column 25RR (risk-reversal) stores at each tenor point the following quantity:

$$25RR = \sigma_{25C} - \sigma_{25P}$$

where $\sigma_{25C}$ represents the implied volatility corresponding to the strike where the delta of the call option is equal to 0.25, while $\sigma_{25P}$ represents the implied volatility corresponding to the strike where the delta of the put option is equal to -0.25.

• The column 10CVX (convexity) stores at each tenor the following quantity:

$$10CVX = \frac{\sigma_{10C} + \sigma_{10P}}{2} - \sigma_{DN}$$

Note that an alternative to the tuple (DN, RR, CVX) is (DN, RR, FLY) e.g. (DN, 25RR, 10FLY). In this configuration, FLY has replaced CVX (which is a rough measure of the convexity of the smile). nFLY is defined as the number $f$ which satisfies:

$$C_{BS}(K_{10C},\sigma_{DN} + f) + P_{BS}(K_{10P},\sigma_{DN} + f) = C_{BS}(K_{10C},\sigma_{10C}) + P_{BS}(K_{10P},\sigma_{10P})$$

When the market information is provided under the form (DN, RR, CVX) or (DN, RR, FLY), DBAnalytics converts internally these quantities into the equivalent individual delta volatilities i.e. $\sigma_{DN}$, $\sigma_{25C}$, $\sigma_{10C}$, etc.

Delta Conventions

The delta objects $\Delta_{Call}$ and $\Delta_{Put}$ can be defined in different ways in DBAnalytics. As mentioned previously, their definition is controlled by the property DeltaType, which can take the following values:

• FORWARDRISK
• SPOTRISK
• FORWARDRISK-τ (e.g. FORWARDRISK-2y)
• FORWARDBASED
• SPOTBASE
• FENICS-τ (e.g. FENICS-2y)
• FENICSBASED-τ (e.g. FENICSBASED-2y)

The definition of each DeltaType can be found in Section 4.2 of [7].

Interpolation and Extrapolation

We consider that the market information is represented by a MARKETVOL object of InputMode DELTAVOL. The information contained in the object is equivalent to a set of volatilities $\sigma_K(T_i); i = 1,...m, j = 1,...n$, where $T_i; i = 1,...m$ represents the tenor structure present in the Vols table. The volatility value $\sigma_K(T)$ corresponding to tenor $T \in [T_r, T_{r+1}], 1 \leq r \leq m - 1$ and strike $K \neq K_j, j = 1,...n$ is derived in the following way:

1. Along each strike point $K_j, j = 1,...n$ the time interpolation is performed:

$$\sigma_{K_j}(T)^2T = \sigma_{K_j}(T_r)^2T_r + \frac{T - T_r}{T_{r+1} - T_r}(\sigma_{K_j}(T_{r+1})^2T_{r+1} - \sigma_{K_j}(T_r)^2T_r)$$

The time interpolation is controlled by the property VolMode which is set to CONSTANT_LV (flat forward volatility interpolation). This mode ensures non-negative forward variance by construction. This method has been tested extensively, see [12].

2. Once the set of volatilities {$\sigma_{K_j}(T); j = 1,...n$} is constructed at tenor $T$, the interpolation in the strike dimension is performed. This step is controlled by the property InterpolationType, which is set equal to NATURALCUBIC (cubic spline dimension). The description of NATURALCUBIC can be found in Section 4.3 of [7] and has been extensively tested in [12]. Cubic interpolation is the only interpolation method allowed by CFU in the strike dimension because the second derivative $\frac{\partial^2 C}{\partial K^2}$ is ensured to be continuous. If the second derivative is not continuous the no-arbitrage conditions are more likely to break, see Section 13 of [12] for more details.

Presence of arbitrage in volatility surface

It is possible to construct an extreme data set of input volatilities such that the no-arbitrage condition is breached. DBA provides extensive functionality for checking that the no-arbitrage conditions are satisfied, for example the property ArbitrageChecker, see [13], as well as the DBAnalytics function MarketVolFunctionCheckArb, see [14].

The property ArbitrageChecker = BUTTERFLY is set in place to flag the presence of butterfly arbitrage. We call butterfly arbitrage the following condition not being satisfied:

$$\frac{\partial^2 C}{\partial K^2}(K,T) > 0 \text{ for all } T. \tag{9}$$

This condition is equivalent to having the probability density function (PDF) of the marginal distribution $\rho(S_T)$ non-negative i.e. $\rho(S_T) \geq 0$, a requirement that PDFs need to satisfy. The name butterfly comes from the butterfly spread, which is a European payoff consisting of $\frac{1}{\epsilon}$ calls of strike $K - \epsilon$, $\frac{1}{\epsilon}$ calls of strike $K + \epsilon$ and $-\frac{2}{\epsilon}$ calls of strike $K$. Option markets are considered to be arbitraged well enough that butterfly spreads do not have negative prices i.e.

$$\lim_{\epsilon\to0} \frac{C(K + \epsilon,T) - 2C(K,T) + C(K - \epsilon,T)}{\epsilon^2} \geq 0 \tag{10}$$

It is easy to see that (9) and (10) are equivalent. Condition (9) also translates in having the denominator in the Dupire formula non-negative.

#### 2.3.8.2 PIV AutoFit. MODELVOL object

During one of the calibration steps of the FX rate volatility, a parametric implied volatility (PIV) is calibrated on the fly during pricing to the DELTAVOL object in the presence of deterministic interest rates. The PIV functional forms available in DBAnalytics are SA4 (4 parameters functional) and LA6GD (6 parameters functional). The choice of the functional form is controlled by the property SkewType present in the MODELVOL object. See below an example of MODELVOL object with a couple of relevant properties:

| VolName | MARKETVOL |
| --- | --- |
| SkewType | SA4 |
| SkewConvexityType | STANDARD |

| VolTermStructures |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- |
| Name | Type | Shift | Bump | BumpType | Use |  |
| VOL | CONSTANT | 0.0 | 0.01 | ABS | 1 |  |
| SMILE | CONSTANT | 0.0 | 0.01 | ABS | 1 |  |
| SKEW | CONSTANT | 0.0 | 0.01 | ABS | 1 |  |
| POWER | CONSTANT | 0.0 | 0.001 | ABS | 1 |  |

| VolParameters |  |  |  |  |  |
| --- | --- | --- | --- | --- |  |
| Name | Value | Bump | BumpType | Use |  |
| VOL | 0.2 | 0.001 | ABS | 1 |  |
| SMILE | 0.1 | 0.001 | ABS | 1 |  |
| SKEW | 0.0 | 0.001 | ABS | 1 |  |
| POWER | 1.0 | 0.001 | ABS | 1 |  |

| Offsets |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- |  |
| ExpiryDate | VolShift | VOL | SKEW | SMILE | POWER | Use |  |
| 20570811 | 0.0 | 0.0 | 0.0 | 0.0 | 0.0 | 1 |  |

Table 26: Example of some of the properties present in the MODELVOL object. The PIV form is specified by SkewType = SA4. The object contains the subtables VolTermStructures, VolParameters and Offsets. The VolParameters table stores a set of initial guesses for the parameters VOL, SMILE, SKEW and POWER. Note that the POWER parameter is not calibrated but kept constant to 1. The tables VolTermStructures and Offsets are explained below.

The PIV functional form is calibrated to the DELTAVOL object and the results of the calibration are provided in the results file of the pricing. An example of calibrated PIV parameters is the following:

| VolTermStructures |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- |
| Name | Type | Shift | Bump | BumpType | Use |  |
| VOL | CONSTANT | 0.0 | 0.01 | ABS | 1 |  |
| SMILE | CONSTANT | 0.0 | 0.01 | ABS | 1 |  |
| SKEW | CONSTANT | 0.0 | 0.01 | ABS | 1 |  |
| POWER | CONSTANT | 0.0 | 0.001 | ABS | 1 |  |

| VolParameters |  |  |  |  |  |
| --- | --- | --- | --- | --- |  |
| Name | Value | Bump | BumpType | Use |  |
| VOL | 0.0 | 0.001 | ABS | 1 |  |
| SMILE | 0.0 | 0.001 | ABS | 1 |  |
| SKEW | 0.0 | 0.001 | ABS | 1 |  |
| POWER | 0.0 | 0.001 | ABS | 1 |  |

| Offsets |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- |  |
| ExpiryDate | VolShift | VOL | SKEW | SMILE | POWER | Use |  |
| 20200715 | 0.00 | 0.0510455792 | -0.4730035844 | 0.8852265490 | 1.00 | 1 |  |
| 20201015 | 0.00 | 0.0523227441 | -0.4720544811 | 0.8633626299 | 1.00 | 1 |  |
| 20210415 | 0.00 | 0.0533972570 | -0.4805910104 | 0.8350806068 | 1.00 | 1 |  |
| 20220419 | 0.00 | 0.0543802512 | -0.4619918852 | 0.8230207430 | 1.00 | 1 |  |
| 20230417 | 0.00 | 0.0573064513 | -0.3349687201 | 0.7012594265 | 1.00 | 1 |  |
| 20250415 | 0.00 | 0.0646218004 | -0.3127573005 | 0.7418930707 | 1.00 | 1 |  |
| 20270415 | 0.00 | 0.0722306407 | -0.3037632645 | 0.7222623418 | 1.00 | 1 |  |
| 20300415 | 0.00 | 0.0757693776 | -0.3349109540 | 0.7549239034 | 1.00 | 1 |  |
| 20350416 | 0.00 | 0.0830564824 | -0.3717906984 | 0.7995505090 | 1.00 | 1 |  |
| 20400416 | 0.00 | 0.0890564824 | -0.3470886420 | 0.7848365539 | 1.00 | 1 |  |
| 20500415 | 0.00 | 0.0905564824 | -0.3583547492 | 0.7656095987 | 1.00 | 1 |  |

Table 27: Calibrated PIV of SkewType SA4. Note that the values stored in the table VolTermStructures are not affected (compare with previous table) while the values stored in the tables VolParameters and Offsets are changed (compare with previous table).

The fitted (calibrated) slice parameters VOL, SKEW, SMILE and POWER are computed at each of the time points listed in the ExpiryDate column of the Offsets subtable as follows:

$$VOL(t) = VOL + OffSets(VOL; t) = 0 + OffSets(VOL; t) = OffSets(VOL; t)$$
$$SKEW(t) = SKEW + OffSets(SKEW; t) = 0 + OffSets(SKEW; t) = OffSets(SKEW; t)$$
$$SMILE(t) = SMILE + OffSets(SMILE; t) = 0 + OffSets(SMILE; t) = OffSets(SMILE; t)$$
$$POWER(t) = POWER + OffSets(POWER; t) = 0 + OffSets(POWER; t) = OffSets(POWER; t) = 1$$

The terms VOL, SKEW, SMILE and POWER from the above formulas are the ones provided in the VolParameters table (27) and are all equal to 0.
#### 2.3.8.3 PIV functional forms

PIVs are defined by series of slices at several maturities $T_1, T_2, ...$ Each slice is described by the parametric form. Each PIV functional is expressed as a function of the normalized strike $z$ defined as

$$z = \frac{ln (K/F(0,T))}{\sigma_{ATMF}\sqrt{T}}$$

where $K$ is the strike, $F(0, T)$ is the forward and $\sigma_{ATMF}$ represents the volatility corresponding to the ATMF strike. It is known that the scale of the strike axis is increasing with time. Therefore, working directly in the strike space will make difficult to express how far is the strike from the forward give that the distance will depend also on the time and volatility. The introduction of the normalized space has the role of expressing this distance as a number of standard deviations away from the forward (with the forward being at $z = 0$).

Three parameters are common to all functional forms: VOL, SKEW and SMILE. These parameters are computed at each time slice during the PIV AutoFit, see Section 2.3.8.2. If the property SkewConvexityType is set to STANDARD (default setting), the interpretation of these parameters is the following:

$$VOL = \sigma_{ATMF}$$

$$SKEW = \frac{\partial}{\partial z} \left( \frac{\sigma^2(z)}{\sigma^2_{ATMF}} \right) |_{z=0}$$

$$SMILE = \frac{\partial^2}{\partial z^2} \left( \frac{\sigma^2(z)}{\sigma^2_{ATMF}} \right) |_{z=0}$$

Therefore, for small values of the normalized strike $z$ i.e. near the forward, the PIV function can be expressed under the form:

$$\sigma^2(z) = \sigma^2_{ATMF} \left( 1 + SKEW \cdot z + \frac{1}{2}SMILE \cdot z^2 + ... \right)$$

The approved PIV parametrizations are SA4 (4 parameters form) and LA6GD (6 parameters form):

SkewType SA4 The SA4 parametric form is given by

$$\sigma(z) = VOL \left( \frac{1}{2}(1 + Bz) + \sqrt{\frac{1}{4}(1 + Bz)^2 + \frac{1}{2}Cz^2} \right)^{POWER}$$

where

$$B = \frac{SKEW}{POWER}, C = \frac{1}{POWER} \left( SMILE - \frac{POWER-1}{POWER}SKEW^2 \right)$$

and where the four slice parameters (VOL, SMILE, SKEW, POWER) are calibrated to the input volatility surface.

#### 2.3.8.4 VolTermStructures

The VolTermStructures subtable describes the term structure of each of the slice parameters VOL, SMILE, SKEW and POWER. Each slice parameter can be described as a function of time-to-expiry. If the BusinessTimeVols is set to YES, the time-to-expiry is computed as business time i.e. the number of business days to expiry divided by the number of business days in a year (value stored in the field BusinessDaysPerYear).

We give below two examples of possible term structures. In the first example we assume that VolTermStructures and VolParameters subtables are the following:

| VolTermStructures | | | | | | |
| --- | --- | --- | --- | --- | --- |
| Name | Type | Shift | Bump | BumpType | Use |
| VOL | CONSTANT | 0 | 0.01 | ABS | 1 |
| SMILE | CONSTANT | 0 | 0.01 | ABS | 1 |
| SKEW | CONSTANT | 0 | 0.01 | ABS | 1 |
| POWER | CONSTANT | 0 | 0.01 | ABS | 1 |

| VolParameters | | | | | |
| --- | --- | --- | --- | --- |
| Name | Value | Bump | BumpType | Use |
| VOL | 0.2 | 0.001 | ABS | 1 |
| SMILE | 0.1 | 0.001 | ABS | 1 |
| SKEW | 0 | 0.001 | ABS | 1 |
| POWER | 1 | 0.001 | ABS | 1 |

Table 28: Example of VolTermStructures and VolParameters subtables where the term structure of the slice parameters is CONSTANT.

Here the term structure of all slice parameters is CONSTANT, therefore the slice parameter values are given by

$$f(p, t) = p, \text{ for all } t \leq T \text{ and } p \in \{VOL, SMILE, SKEW, POWER\}$$

i.e., in this case we have VOL=0.2, SMILE=0.1, SKEW=0 and POWER=1 for all $t \leq T$ where $T$ represents the maturity.
In the second example, the term structure of the slice parameter VOL is VOLMEANREV3, the term structure of the slice parameter SKEW is VARMEANREV3 and the term structure of the slice parameters SMILE and POWER is constant. An example of VolTermStructures and VolParameters subtables in this case is the following:

| VolTermStructures | | | | | | |
| --- | --- | --- | --- | --- | --- |
| Name | Type | Shift | Bump | BumpType | Use |
| VOL | VOLMEANREV3 | 0 | 0.01 | ABS | 1 |
| SKEW | VARMEANREV3 | 0 | 0.01 | ABS | 1 |
| SMILE | CONSTANT | 0 | 0.01 | ABS | 1 |
| POWER | CONSTANT | 0 | 0.01 | ABS | 1 |

| VolParameters | | | | | |
| --- | --- | --- | --- | --- |
| Name | Value | Bump | BumpType | Use |
| VOL_SHORT | 0.2 | 0.001 | ABS | 1 |
| VOL_LONG | 0.15 | 0.001 | ABS | 1 |
| VOL_K | 0.4 | 0.001 | ABS | 1 |
| SKEW_SHORT | 0.5 | 0.001 | ABS | 1 |
| SKEW_LONG | 0.3 | 0.001 | ABS | 1 |
| SKEW_K | 2 | 0.001 | ABS | 1 |
| SMILE | 0.1 | 0.001 | ABS | 1 |
| POWER | 1 | 0.001 | ABS | 1 |

Table 29: Example (from a dictionary corresponding to a call option on the USD/EUR FX rate) of VolTermStructures and VolParameters subtables where the term structure of the slice parameters is VARMEANREV3.

The term structure of the VOL slice parameter is VOLMEANREV3 which means that it is given by:

$$VOL(t) = f(LONG, SHORT, K; t) = \sqrt{LONG^2 + (SHORT^2 - LONG^2)\frac{1-e^{-Kt}}{Kt}}$$

where LONG=VOL_LONG=0.15, SHORT=VOL_SHORT=0.2 and K=VOL_K=0.4. The term structure of the SKEW slice parameter is VARMEANREV3 which means that it is given by:

$$SKEW(t) = f(LONG, SHORT, K; t) = LONG + (SHORT - LONG)\frac{1-e^{-Kt}}{Kt}$$

where LONG=SKEW_LONG=0.3, SHORT=SKEW_SHORT=0.5 and K=SKEW_K=2.
The following table contains the complete list of term structures available in DBAnalytics. For more details we refer to [11] and [7].

| TermStructure | Parameters | Definition |
| --- | --- | --- |
| CONSTANT | c | $f(T; c) = c$ |
| LINEARTIMEREF | REF r, SLOPE s, TIMEREF t | $f(T; r, s, t) = r + s(T - t)$ |
| VARMEANREV3 | SHORT S, LONG L, K | $f(T; S, L, K) = L + (S - L)\frac{1-exp(-KT)}{KT}$ |
| VOLMEANREV3 | SHORT S, LONG L, K | $f(T; S, L, K) = \left(L^2 + (S^2 - L^2)\frac{1-exp(-KT)}{KT}\right)^{\frac{1}{2}}$ |
| LINEXP4 | SHORT (S), SLOPE (s) LONG (L), K | $f(T; S, s, L, K) = L + (sT + S - L)exp(-KT)$ |
| POWER4TIMEREF | REF R, LONG L, K, POWER p, TIMEREF t | $f(T; R, L, K, P, t) = L + (R - L)(\frac{t}{T})^p$ |
| VOLDOUBLEMEANREV5 | SHORT S, LONG L, LONGK LK, REF R, SHORTK SK | $f(T; S, L, LK, R, SK)^2 = L^2 + (R^2 - L^2)\frac{1-exp(-LK \cdot T)}{LK \cdot T} + (S^2 - R^2)\frac{1-exp(-SK \cdot T)}{SK \cdot T}$ |
| VOLDOUBLEMEANREVADJUSTEDS | SHORT S, LONG L, LONGK LK, REF R, SHORTK SK, ADJUSTMENT A | $f(T; S, L, LK, R, SK, A) = VOLDOUBLEMEANREV5(T)(1 + \frac{A}{T})^{\frac{1}{2}}$ |
| VARDOUBLEMEANREV5 | SHORT S, LONG L, LONGK LK, REF R, SHORTK SK | $f(T; S, L, LK, R, SK) = L + (R - L)\frac{1-exp(-LK \cdot T)}{LK \cdot T} + (S - R)\frac{1-exp(-SK \cdot T)}{SK \cdot T}$ |
| POWER8MEANTIMEREF | REF R, LONG L, K, TIMEREF t, POWERK PK SHORTPOWER SP, LONGPOWER LP | $f(T; R, L, t, PK, SP, LP) = L + (R - L)(\frac{t}{T})^{(SP+(LP-SP)(1-exp(-PK \cdot T))}$ |

Table 30: Complete list of term structures for the slice parameters VOL, SKEW, SMILE, POWER.

#### 2.3.9 DLVIR Correction

In this Section we describe in detail Step 3 and Step 4 of the calibration of the FX rate volatility. More precisely we derive the DLV correction for FX rate volatility in the presence of stochastic interest rates. This Section is based on model developer documents [3], [4] and [5]. In Step 2 of the FX rate volatility calibration, a PIV functional form was calibrated to the input DELTAVOL object in a framework where the interest rates are assumed to be deterministic. Using Dupire's formula under the assumption of deterministic rates, the local volatilities $\sigma_{DLV}(t, S_t)$ are computed from the implied volatilities of vanilla options.

Since the model uses stochastic interest rates, the FX volatility obtained by calibrating the PIV form to the input DELTAVOL in an setting that assumes deterministic interest rates needs to be adjusted to account for the volatility of the interest rates. To this purpose, the Dupire local volatilities $\sigma_{DLV}(t, S_t)$ are adjusted, as described in [4]:

$$\sigma_{adj}^2(t, K) = \sigma_{DLV}(t, K)^2 - 2 \cdot A\Phi(t, K) \tag{11}$$

where $A\Phi(t, K)$ represents the stochastic IR correction, which is a function that depends on the parameters of the stochastic interest rates. In this section we present the derivation of (11). We consider the framework described in [4]. Under the domestic measure $Q^d$ the FX rate satisfies the following SDE:

$$dX_t = (r_t^d - r_t^f)X_tdt + \sigma(t)dW_t \tag{12}$$

The domestic and foreign interest rates satisfy the following SDEs in the domestic risk-neutral measure $Q^d$:

$$dr_t^d = (\theta_t^d - k^dr_t^d)dt + \eta_t^d dW_t^d, \quad Q^d - a.s.$$

and foreign risk neutral measure $Q^f$

$$dr_t^f = (\theta_t^f - k^fr_t^f)dt + \eta_t^f dW_t^f, \quad Q^f - a.s.$$

The expression of the domestic zero-coupon bond is given by:

$$D^d(0, T) = \mathbb{E}^d \left[ exp \left( -\int_0^T r_s^d ds \right) \right]$$

where the expectation is taken in the domestic risk-neutral measure $Q^d$. If $f^d(t, T)$ represents the domestic instantaneous forward rate, then the relation between the domestic zero-coupon bond and $f^d(t, T)$ is given by:

$$D^d(0, T) = exp \left( -\int_0^T f^d(0, t)dt \right) dt \implies f^d(0, T) = -\frac{\partial}{\partial T}lnD^d(0, T)$$

The expression of the foreign zero-coupon bond is given by:

$$D^f(0, T) = \mathbb{E}^f \left[ exp \left( -\int_0^T r_t^f ds \right) \right]$$

where the expectation is taken in the foreign risk-neutral measure $Q^f$. If $f^f(t, T)$ represents the foreign instantaneous forward rate, then the relation between the foreign zero-coupon bond and $f^f(t, T)$ is given by:

$$D^f(0, T) = exp \left( -\int_0^T f^f(0, t)dt \right) dt \implies f^f(0, T) = -\frac{\partial}{\partial T}lnD^f(0, T)$$

We define the following quantities:

$$x_T = ln \left( \frac{X_T}{F_{0,T}} \right) \quad \text{and} \quad k = ln \left( \frac{K}{F_{0,T}} \right) \tag{13}$$

where $F_{0,T}$ represents the FX forward given by

$$F_{0,T} = X_0 \frac{D^f(0, T)}{D^d(0, T)}$$

We define the quantities:

$$y_t^d = r_t^d - f^d(0, t) \quad \text{and} \quad y_t^f = r_t^f - f^f(0, t)$$

Then $y^d$ and $y^f$ satisfy under the domestic and foreign risk neutral measures the following SDEs:

$$dy_t^d = (\alpha_t^d - k^dy_t^d)dt + \eta_t^dW_t^d, \quad Q^d - a.s.$$
$$dy_t^f = (\alpha_t^f - k^fy_t^f)dt + \eta_t^fW_t^f, \quad Q^f - a.s. \tag{14}$$

where

$$v_t^d = e^{-2k^dt} \int_0^t e^{2k^du}(\eta_u^d)^2du \quad \text{and} \quad v_t^f = e^{-2k^ft} \int_0^t e^{2k^fu}(\eta_u^f)^2du \tag{15}$$

Equation (142) follows from Proposition 10.1.7. of [16]. We determine the equation of $y^f$ under the domestic measure $Q^d$. Since

$$\frac{dQ^f}{dQ^d}|_{F_t} = Z_t$$

where $dZ_t = \sigma(t)Z_tdW_t$, then $dW_t = dW_t - \sigma(t)dt$ is a Brownian motion under the $Q^f$-measure. Then

$$\frac{dQ^d}{dQ^f}|_{F_t} = \frac{1}{Z_t}$$

The process $Z = \frac{1}{Z_t}$ satisfies the following SDE under the $Q^f$-measure:

$$dZ_t = d\frac{1}{Z_t} = -\frac{1}{Z_t^2}dZ_t + \frac{1(-2)}{Z_t^3}d[Z, Z]_t = -\frac{1}{Z_t}(-\sigma(t)dW_t + \sigma^2(t)dt) + \frac{1}{Z_t}\sigma^2(t)dt = -\sigma(t)Z_tdW_t$$

Therefore $dZ_t = -\sigma(t)Z_tdW_t$ under the foreign risk neural measure $Q^f$. Using the Girsanov transform, we obtain that

$$W_t^f = dW_t^f - \frac{Z_t}{d[Z_t, W_t^f]_t} = dW_t^f + \sigma(t)\rho_Fdt$$

is a Brownian motion under $Q^d$, where $\rho_F$ is the correlation between the Brownian motion driving the FX rate and the Brownian motion driving the foreign interest rate. Therefore $y^f$ is given by

$$y_t^f = e^{-k^ft} \int_0^t e^{k^fs}(y_0^f - \sigma(s)\eta_s^f\rho_F)ds + e^{-k^ft} \int_0^t e^{k^fs}\eta_s^fdW_s^f \quad Q^d - a.s.$$

The process $y^d$ is given by

$$y_t^d = e^{-k^dt} \int_0^t e^{k^ds}y_0^dds + e^{-k^dt} \int_0^t e^{k^ds}\eta_s^ddW_s^d \quad Q^d - a.s.$$

It follows from (88) and (101) that the process $x_t$ is given by:

$$x_T = ln \left( \frac{X_T}{F_{0,T}} \right) = ln \left( \frac{X_T}{X_0} \right) - ln \left( \frac{F_{0,T}}{X_0} \right)$$
$$= \int_0^T \sigma(t)dW_t - \frac{1}{2} \int_0^T \sigma^2(t)dt + \int_0^T (r_t^d - r_t^f)dt - lnD^f(0,T) + lnD^d(0,T)$$
$$= \int_0^T \sigma(t)dW_t - \frac{1}{2} \int_0^T \sigma^2(t)dt + \int_0^T (r_t^d - r_t^f)dt + \int_0^T f^f(0,t)dt - \int_0^T f^d(0,t)dt$$
$$= \int_0^T \sigma(t)dW_t - \frac{1}{2} \int_0^T \sigma^2(t)dt + \int_0^T y_t^ddt - \int_0^T y_t^fdt \tag{16}$$

Therefore $x_t$ satisfies:

$$dx_t = \left( y_t^d - y_t^f - \frac{1}{2}\sigma^2(t) \right) dt + \sigma(t)dW_t$$

Let $C(t, K)$ represent the price of a call option:

$$C(t, K) = \mathbb{E}^d \left[ exp \left( -\int_0^t r_s^dds \right) (X_t - K)^+ \right] = \mathbb{E}^d \left[ B_t^d (X_t - K)^+ \right]$$

where we denoted by $B_t^d = exp \left( -\int_0^t r_s^dds \right)$.

Let 

$$\hat{c}(t, k) := \frac{C(t, K)}{D^d(0, t)F_{0,t}} = \mathbb{E}^d \left[ B_t^d D^d(0, t)^{-1} (X_t - K)^+ \right] = \mathbb{E}^d \left[ M_t \right]$$

It follows from the integration by parts formula that

$$d (B_t^d D^d(0, t)^{-1}) = -y_t^d B_t^d D^d(0, t)^{-1}dt \tag{17}$$

It follows from the Ito-Tanaka formula that:

$$d (e^{x_t} - e^k)^+ = \mathbf{1}_{\{e^{x_t}>e^k\}}e^{x_t} \left( y_t^d - y_t^f \right) dt + \mathbf{1}_{\{e^{x_t}>e^k\}}e^{x_t}\sigma(t)dW_t + \frac{1}{2} \delta_{\{e^{x_t}=e^k\}}e^{2x_t}\sigma^2(t)dt \tag{18}$$

It follows from (17) and (18) and the integration by parts formula that:

$$dM_t = d \left( B_t^d D^d(0, t)^{-1} (e^{x_t} - e^k)^+ \right) = B_t^d D^d(0, t)^{-1} \left( \mathbf{1}_{\{e^{x_t}>e^k\}}e^{x_t}\sigma(t)dW_t + \frac{1}{2}\delta_{\{e^{x_t}=e^k\}}e^{2x_t}\sigma^2(t)dt \right. \tag{19}$$
$$\left. - \mathbf{1}_{\{e^{x_t}>e^k\}}e^{x_t}y_t^ddt + \mathbf{1}_{\{e^{x_t}>e^k\}}e^{x_t}y_t^fdt \right)$$

By taking the expectation in (19) and the partial derivative w.r.t $t$ we obtain:

$$\frac{\partial \hat{c}}{\partial t}(t, k) = \frac{\partial}{\partial t}\mathbb{E}^d \left[ M_t \right] = \frac{\partial}{\partial t}\mathbb{E}^d \left[ M_0 + \int_0^t dM_s \right] =$$
$$= D^d(0, t)^{-1}\mathbb{E}^d \left[ B_t^d\mathbf{1}_{\{e^{x_t}>e^k\}}e^{x_t}y_t^d \right] - D^d(0, t)^{-1}\mathbb{E}^d \left[ B_t^d\mathbf{1}_{\{e^{x_t}>e^k\}}e^{x_t}y_t^f \right] \tag{20}$$
$$+ \frac{1}{2}D^d(0, t)^{-1}\mathbb{E}^d \left[ B_t^d\delta_{\{e^{x_t}=e^k\}}e^{2x_t}\sigma^2(t) \right]$$
$$= D^d(0, t)^{-1}\mathbb{E}^d \left[ B_t^d\mathbf{1}_{\{e^{x_t}>e^k\}}e^{x_t}y_t^d \right] - D^d(0, t)^{-1}\mathbb{E}^d \left[ B_t^d\mathbf{1}_{\{e^{x_t}>e^k\}}e^{x_t}y_t^f \right]$$
$$+ \frac{1}{2}k^2\sigma^2(t, k)D^d(0, t)^{-1}\mathbb{E}^d \left[ B_t^d\delta_{\{e^{x_t}=e^k\}} \right]$$

Using the fact that

$$\frac{\partial \hat{c}}{\partial K}(t, k) = \frac{\partial}{\partial K}\mathbb{E}^d \left[ D^d(0, t)^{-1}B_t^d (e^{x_t} - e^k)^+ \right] = -e^kD^d(0, t)^{-1}\mathbb{E}^d \left[ B_t^d\mathbf{1}_{\{e^{x_t}>e^k\}} \right]$$

and

$$\frac{\partial^2 \hat{c}}{\partial K^2}(t, k) = -e^k D^d(0, t)^{-1}\mathbb{E}^d \left[ B_t^d\mathbf{1}_{\{e^{x_t}>e^k\}} \right] + e^{2k}D^d(0, t)^{-1}\mathbb{E}^d \left[ B_t^d\delta_{\{e^{x_t}=e^k\}} \right]$$
$$= \frac{\partial \hat{c}}{\partial K}(t, k) + e^{2k}D^d(0, t)^{-1}\mathbb{E}^d \left[ B_t^d\delta_{\{e^{x_t}=e^k\}} \right]$$

we can write (20) under the form:

$$\frac{\partial \hat{c}}{\partial t} = \frac{1}{2}\sigma^2(t, k) \left( \frac{\partial^2 \hat{c}}{\partial K^2} - \frac{\partial \hat{c}}{\partial K} \right) + D^d(0, t)^{-1}\mathbb{E}^d \left[ B_t^d\mathbf{1}_{\{e^{x_t}>e^k\}}e^{x_t}y_t^d \right] - D^d(0, t)^{-1}\mathbb{E}^d \left[ B_t^d\mathbf{1}_{\{e^{x_t}>e^k\}}e^{x_t}y_t^f \right]$$

which implies

$$\sigma^2(t, k) = \frac{2 \frac{\partial \hat{c}}{\partial t}}{\frac{\partial^2 \hat{c}}{\partial K^2} - \frac{\partial \hat{c}}{\partial K}} = \frac{2}{\frac{\partial^2 \hat{c}}{\partial K^2} - \frac{\partial \hat{c}}{\partial K}} \left( D^d(0, t)^{-1}\mathbb{E}^d \left[ B_t^d\mathbf{1}_{\{e^{x_t}>e^k\}}e^{x_t}y_t^d \right] - D^d(0, t)^{-1}\mathbb{E}^d \left[ B_t^d\mathbf{1}_{\{e^{x_t}>e^k\}}e^{x_t}y_t^f \right] \right) \tag{21}$$

The derivation concludes by expressing (21) in terms of $C(t, K)$ and its partial derivatives. Using the fact that

$$\hat{c}(t, k) = \frac{C(t, K)}{D^d(0, t)F_{0,t}}$$

and the following relations:

$$\frac{\partial}{\partial t} (D^d(t, t)F_{0,t}) = -f^d(0, t)D^d(0, t)F_{0,t}$$
$$\frac{\partial K}{\partial k} = \frac{\partial}{\partial k} (F_0 e^k) = K$$
$$\frac{\partial K}{\partial t} = \frac{\partial}{\partial t} (F_0 e^k) = (f^d(0, t) - f^f(0, t)) K$$

we obtain

$$\frac{\partial}{\partial t}\hat{c}(t, k) = \frac{\partial}{\partial t} \left( \frac{C(t, K)}{D^d(0, t)F_{0,t}} \right) = \frac{(\frac{\partial C}{\partial t} + \frac{\partial C}{\partial K} \frac{\partial K}{\partial t}) D^d(0, t)F_{0,t} + C(t, K)f^d(0, t)D^d(0, t)F_{0,t}}{D^d(0, t)^2F_{0,t}^2}$$
$$= \frac{\frac{\partial C}{\partial t} + (f^d(0, t) - f^f(0, t)) K \frac{\partial C}{\partial K} + f^d(0, t)C(t, K)}{D^d(0, t)F_{0,t}}$$

$$\frac{\partial}{\partial k}\hat{c}(t, k) = \frac{K \frac{\partial C}{\partial K}}{D^d(0, t)F_{0,t}}$$

$$\frac{\partial^2}{\partial k^2}\hat{c}(t, k) = \frac{K \frac{\partial C}{\partial K} + K^2 \frac{\partial^2 C}{\partial K^2}}{D^d(0, t)F_{0,t}}$$

Therefore (21) becomes

$\sigma^2(t, k) = 2 \frac{\frac{\partial C}{\partial t} + (f^d(0, t) - f^f(0, t)) K \frac{\partial C}{\partial K} + f^f(0, t)C(t, K)}{K^2 \frac{\partial^2 C}{\partial K^2}}$
$- \frac{2D^d(0, t)F_{0,t}}{K^2 \frac{\partial^2 C}{\partial K^2}} \left( D^d(0, t)^{-1}\mathbb{E}^d \left[ B_t^d\mathbf{1}_{\{e^{x_t}>e^k\}}e^{x_t}y_t^d \right] - D^d(0, t)^{-1}\mathbb{E}^d \left[ B_t^d\mathbf{1}_{\{e^{x_t}>e^k\}}e^{x_t}y_t^f \right] \right) \tag{22}$

$= \sigma_{DLV}^2(t, K) - 2A\Phi(t, K)$

where $\sigma_{DLV}(t, K)$ represent the Dupire local volatility derived in the presence of deterministic interest rates at Step 3 of calibration algorithm and $A\Phi(t, K)$ represents the stochastic IR correction. For the remaining part of this section we denote

$\sigma_{adj}(t, K)^2 := \sigma_{DLV}^2(t, K) - 2A\Phi(t, K) \tag{23}$

As explained in [4], expression (21) has the following implementation in DBAnalytics which relies on the fact that

$\frac{\partial^2 \hat{c}}{\partial k^2} - \frac{\partial \hat{c}}{\partial k} = \frac{K}{F_{0,T}}N(t, k)$

where

$N(t, k) = \frac{\phi(d_2)}{\sqrt{w}} \left[ \frac{k}{\partial k} + \frac{1}{4} \left( -\frac{1}{4} - \frac{1}{w} + \frac{k^2}{w^2} \right) \left( \frac{\partial w}{\partial k} \right)^2 + \frac{1}{2} \frac{\partial^2 w}{\partial k^2} \right]$

$w(t, k) = \sigma_{BS}^2(t, k)t$

It follows that (21) can be written under the form:

$\sigma^2(t, k) = \frac{2F_{0,T}}{ KN(t, k) } \frac{\partial \hat{c}}{\partial t} = \frac{2F_{0,T}}{ KN(t, k) } \left( D^d(0, t)^{-1}\mathbb{E}^d \left[ B_t^d\mathbf{1}_{\{e^{x_t}>e^k\}}e^{x_t}y_t^d \right] - D^d(0, t)^{-1}\mathbb{E}^d \left[ B_t^d\mathbf{1}_{\{e^{x_t}>e^k\}}e^{x_t}y_t^f \right] \right)$

$= \sigma_{DLV}^2(t, K) - 2A\Phi(t, K)$

where the above expectations are computed using Monte-Carlo as explained in the following sections.

#### 2.3.10 Direct Stochastic Local Vol in DBX

In this Section we described in detail Step 5 of the calibration of the FX rate volatility. As described in (97), the dynamics of the FX rate process is given by:

$dS_t = (r_t^d - r_t^f)S_tdt + \sigma_{LV}(t, S_t)e^{u_t}S_tdW_t \tag{24}$

where $\sigma_{LV}(t, S_t)$ represents the LV component and $u_t$ represents the SV component. It can be shown that the local variance (i.e. the square of the local volatility) $\sigma_{adj}(t, K)^2$ derived in Step 4 of the calibration algorithm has the natural interpretation as the domestic risk-neutral expectation of the instantaneous variance of the FX rate $S$ at time $t$ conditional on the FX rate $S_t$ being equal to $K$ i.e.

$\sigma^2(t, K) = \mathbb{E}^d \left[ \sigma_{LV}^2(t, S_t)e^{2u_t} | S_t = K \right]$

This is equivalent to

$\sigma_{LV}^2(t, K) = \frac{\sigma^2(t, K)}{\mathbb{E}^d [e^{2u_t} | S_t = K]}$

#### 2.3.11 Model Implementation

The model is implemented in DBAnalytics using a Monte Carlo engine (DBX). The complete description of the DBX engine can be found in the model developer document [18]. The properties that control the numerical implementation are stored in the MODEL object present in the dictionary. These properties can take only values allowed by the conditions for use (CFU). The detailed description of the allowed conditions for used and the numerical parameters can be found in Section 1.3.

##### 2.3.11.1 STATEMAX framework

In the case of products with callable features, the model uses the STATEMAX framework described in [19]. In short, STATEMAX represents a set of algorithms used to compute conditional expectations in the context of pricing based on Monte Carlo methods. In DBAnalytics, the most important application of STATEMAX is in the solving of the optimal exercise problem, encountered in the pricing of American/Bermudan or callable options.

A generic STATEMAX algorithm used to determine the price of a Bermudan option can be found in Section 1.2 of [19]. It relies on recursively computing at each time step (exercise date) starting from the end date, the exercise value and the continuation value of the option on each Monte Carlo path. These values are used to construct a table (called Exercise matrix) of optimal exercise times on each path in the life of the option, essentially a table of 1's and 0's that set the point on each simulated path where the option should be exercised. Every time we encounter a 0 in the Exercise matrix, the corresponding contribution from that element in the value matrix is set to zero. When we encounter a 1 in the Exercise matrix, we multiply the corresponding contribution of the value matrix by 1, and add it to our total option value. The value of the option will be defined as the average over all the paths.

The exercise function is defined as the conditional expectation of the difference between the options's exercise value and the option's hold value i.e.

$\mathbb{E} [U_n(T_n) - C_n(T_n)|X_n] = W(X_n)$

where $U_n(T_n)$ represents the exercise value, $C_n(T_n)$ represents the continuation (hold) value and $X_n$ represents a set of state variables at time $T_n$ and $W$ is a polynomial function defined by the PolyOrder property. The parameters of the function $W$ will be determined using the least squares method employed on the data points ${(x_k, y_k); x_k = X(T_n, \omega_k), y_k = U_n(T_n, \omega_k) - C_n(T_n, \omega_k), k = 1...N}$, with $N$ representing the number of Monte Carlo paths and $X(T_n, \omega_k)$ the realisation of variable $X$ at time $T_n$ on path $\omega_k$.

The property PolyOrder impacts the value of "Ramp" and "Polynomial" since PolyOrder is decomposed internally as follows:

$PolyOrder = 100 \cdot Ramp + Polynomial$

This implies that:

1. PolyOrder=0 implies Ramp=0 and Polynomial=0
2. PolyOrder=100, 102, 103 implies Ramp=1 and Polynomial=0, 2, 3
3. PolyOrder=200 implies Ramp=2 and Polynomial=0
4. PolyOrder=503 implies Ramp=5 and Polynomial=3
5. PolyOrder=1200-0.25 implies Ramp=12 and Polynomial=0
6. PolyOrder=2003 implies Ramp=20 and Polynomial=3.

Ramp impact the method used to define the exercise time, while Polynomial determines the order of the polynomial function $W$. Note that Polynomial=0 implies that we use a polynomial of order 3 in the regression (therefore PolyOrder=103 is equivalent with PolyOrder=103). As stated before the Exercise function is defined as a binary function taking the values 0 and 1.
The introduction of Ramp has the purpose of allowing the Exercise function to take any value between 0 and 1 and smoothening th discontinuities in the pricing, since small changes in the underlying values along any path will cause small changes in the value from that path instead of a binary swth from a value $V(\omega_k)$ to 0.

The Ramp function has assigned a width parameter $\sigma'$. Ramp is set equal to 0 when $W(\omega_k) < -\sigma'$ and set equal to 1 when $W(\omega_k) > (-\sigma',\sigma')$. This implies that for $W(\omega_k) < -\sigma'$ the Exercise Value will be 0 and the value assigned to the option on path $\omega_k$ and time $T_n$ is 0, for $W(\omega_k) > \sigma'$, the Exercise Value will be 1 and the value assigned to the option on path $\omega_k$ and time $T_n$ is $V(T_n,\omega_k) > 0$ and for $W(\omega_k) \in (-\sigma',\sigma')$ the Exercise Value will be a number between 0 and 1 and the option value on path $\omega_k$ and time $T_n$ will be $Ramp \cdot V(T_n,\omega_k)$ where $0 < Ramp \cdot V(T_n,\omega_k) < V(T_n,\omega_k)$.

According to the model rules, the ramp function can be of type 0, 1, 2, 5, 12 and 20. A Ramp = 0 will tend to be the narrowest by default. Ramp = 1 will set the ramp using the maximum of either the standard deviations of the V(i) or W(i). There is a default setting for Ramp = 2 which is to use the Gaussian wedge with the same width as Ramp = 1. The complete description of the Ramp function can be found in [19], see Section 2.4.1 for Ramp=0, Section 2.4.2 for Ramp=1, Section 2.4.3 for Ramp=2, Section 2.4.6 for Ramp=5, Section 3 for Ramp=12 and Section 4 for Ramp=20.

The parameter StateMaxWedge to set manually the width of the Ramp, by overriding the default settings of the selected Ramp type. The parameter StateMaxWedge can be used to set the width of the Ramp. Setting the parameter StateMaxWedge to the notional value -4 will cause the linear ramp to be replaced by a gaussian or normal ramp, described in [20]. Setting StateMaxWedge=0 will optimize the choice of wedge size.

The property StateMaxControlVariate introduces a control variate in the computation, which is a variance reduction technique whose final purpose is to make the StateMax algorithm more stable and accurate. The complete description of the property can be found in Section 5 of [19].

The property StateMaxFraction introduces a smoothing methods which is based on the elimination of "extremal" paths. The complete description of the property can be found in Section 6.2 of [19]. The value of this property can be set to between 0.7 and 1 (i.e. the smoothing method is not used) for all configurations except PolyOrder=1200, 1200-0.25.

The property StateMaxFactors is used to limit the number of state variables (risk factors) used in the regression. If StateMaxFactors=N then a PCA is performed on all factors involved and the first N-1 eigenvectors with the highest eigenvalues will be used in StateMax. Additionally, an N-th factor is used, which is obtained by doing a linearization of the final payoff with all the factors.

The property StateMaxCutOff is used to reduce the number of states by selecting only the smallers and most diversified set of eigenvectors. As in the case of StateMaxFactor a PCA is performed on all risk factors to determine the smallest N satisfying

$$\frac{\sum{(largest N eigenvlaues)}}{\sum{(all eigenvalues)}} \geq 1 - StateMaxCutOff$$

The first N-1 eigenvectors with the highest eigenvalues will be used in the statemax calculation. Additionally, an N-th factor is used, which is obtained by doing a linearization of the final payoff with all the factors. According to model rules StateMaxCutOff has to be set to a value less or equal to 0.01. The complete description of the property can be found in Section 6.4 of [19].

The property StateMaxCorrection is used to reduce the variance-related bias and it impact only the calculation of the exercise decision. The property can be set to NONE (no adjustments are made) or JACKKNIFE. The description of the property can be found in Section 6.5 of [19].

The property StateMaxRegularization is used to improve the general performance of least-squares regression. This is done by changing the way the regression coefficients are computed from the classic formula:

$$\hat{\beta} = argmin_{\beta}||Y - X\beta||^2 = (X^TX)^{-1}X^TY$$

to the ridge (Tikhonov regularization) regression:

$$\hat{\beta} = argmin_{\beta}[||Y - X\beta||^2+\lambda||\beta||^2] = (X^TX + \lambda I)^{-1}X^TY$$

where λ is a suitably chosen parameter (if λ = 0 the formula degenerates to the classic expression) and where $I$ represents the unit matrix. The description of the property can be found in Section 6.6 of [19].
The property StateMaxFlag allows one to control the state variables being used during the Monte Carlo valuation of american options. According model rules, StateMaxFlag=-1 which means use all the states.

#### 2.3.11.2 Implementation of DLVIR correction

The numerical implementation of the stochastic IR adjustment term from Step 4 of the FX calibration algorithm i.e. the calculation of the following expectations

$$\mathbb{E}^d[D^d(0, t)^{-1}B_t^d\mathbf{1}_{\{e^{x_t}>e^k\}}e^{x_t}y_t^d] - \mathbb{E}^d[D^d(0, t)^{-1}B_t^d\mathbf{1}_{\{e^{x_t}>e^k\}}e^{x_t}y_t^f]$$

is done using the Monte-Carlo engine and it is presented in detail in Section 1.7.6 of [18] and [6]. The method in use is controlled by the property DLVIRMethod which has default value MARGINAL. We describe the main idea of the approach using a generic example where we are interested in computing the quantity:

$$\mathbb{E}^d[D^d(0, t)^{-1}B_t^dY(t)\mathbf{1}_{X_t > K}]$$

By switching to the domestic T-forward measure, we can write the above expectation under the form:

$$\mathbb{E}^T[Y(t)\mathbf{1}_{X_t > K}] = \mathbb{E}^T[\mathbb{E}^T[Y(t)|\mathbf{1}_{X_t > K}|X_t = s]] = \int_K^{\infty}\mathbb{E}^T[Y(t)|X_t = s]\rho_{X_t}^T(s)ds$$

$$= \int_K^{\infty}\frac{\mathbb{E}^d[B_t^dY(t)|X_t = s]}{\mathbb{E}^d[B_t^d|X_t = s]}\rho_{X_t}^T(s)ds \tag{25}$$

where the last expression comes from an application of Bayes theorem, which is required because the previous expectation was w.r.t. domestic T-forward measure and the simulated values of X are computed under the domestic risk-neutral measure.

#### 2.3.11.3 Implementation of DSLV framework

The numerical implementation of Step 5 of the FX calibration algorithm i.e. the calculation of the expectation

$$\mathbb{E}^d[e^{2u_t}|S_t = K]$$

is done using the DBX Monte Carlo engine and it is presented in detail in Section 1.7.7 of [18] and [5]. The method in use is controlled by the property DirectSLVCalculationMethod which has several modes allowed: STATEMAX, FFT, FFT-2, BIN and DBL.

#### 2.3.12 Risk Sensitivities

The following table lists the risk sensitivities relevant for the present model, which are used thoroughly in the MVR:

| Underlying | DBA Mode | Description |
| --- | --- | --- |
| IR Curve | FLATDELTA | The IR curve is shifted up by 1 bp absolute, i.e. $$FLATDELTA = PV(C) - PV(C + 1bp),$$ where $C \in \mathbb{R}^n$ is a representation of the curve object. |
| IR Curve | FLATOISSPREADSDELTA | The Spreads within the OISSpreads table of the CURVE are shifted up by 1 bp absolute, i.e. $$FLATOISSPREADSDELTA = PV(M + 1bp) - PV(M),$$ where $M \in \mathbb{R}^m$ represents the Spreads in the OISSpreads table. Mode OISSPREADSDELTA returns bucketed delta values i.e. OISSPREADSDELTA values corresponding to each tenor present in the OISSpreads table. |
| IR Curve | FLATCCYSPREADSDELTA | The Spread within the CCYSpreads table of the CURVE are shifted up by 1 bp absolute, i.e. $$FLATCCYSPREADSDELTA = PV(M + 1bp) - PV(M),$$ where $M \in \mathbb{R}^m$ represents the Spreads in the CCYSpreads table. Mode CCYSPREADSDELTA returns bucketed delta values i.e. CCYSPREADSDELTA values corresponding to each tenor present in the CCYSpreads table. |
| IR Curve | FLATSPOTLIBORSPREADSDELTA | The Spread within the SpotLiborSpreads table of the CURVE are shifted up by 1 bp absolute, i.e. $$FLATSPOTLIBORSPREADSDELTA = PV(M + 1bp) - PV(M),$$ where $M \in \mathbb{R}^m$ represents the Spreads in the SpotLiborSpreads table. Mode SPOTLIBORSPREADSDELTA returns bucketed delta values i.e. SPOTLIBORSPREADSDELTA values corresponding to each tenor present in the SpotLiborSpreads table. |
| IR & FX volatilities | FLATVEGA | It bumps all parameters whose use flag is set to 1 in all subtables (like LocalVols, TermVols, etc.) by 5% relative. That is, $$FLATVEGA = PV(\sigma(1 + 0.05)) - PV(\sigma),$$ where $\sigma \in \mathbb{R}^s$ represents the volatility object. Mode VEGA returns the bucketed vega values i.e. the VEGA values corresponding to each tenor stored in the VOL object. |
| FX Spot | FXDELTA/FLATVEGA | It bumps the FX spot value by BumpAmount set in BumpTable of VOL object (VolType=FXCURVE) . That is, $$FXDELTA = PV(S_0 + bump) - PV(S_0),$$ where $S_0$ represents the FX spot value. |
| FX Spot | FXGAMMA | It bumps FX spot by 1% relative and computes, $$FXGAMMA = PV(1.01S_0) + PV(0.99S_0) - 2PV(S_0),$$ where $S_0$ represents the FX spot value. |

Table 31: Risk sensitivities and their corresponding DBA modes. However, note that the value of the shift size used in the definition of a risk sensitivity is not always fixed to 1bp and can be changed in the pricing dictionary.

#### 2.3.13 Model Outputs

We can extract from the model the PV and the risk sensitivities ("greeks") relative to changes in parameters such as IR curves, IR volatilities, FX spot and FX volatility moves. In particular, the main risk sensitivities of interest are deltas (w.r.t. interest rates and FX spot) and vegas (w.r.t. FX volatility and IR volatilities). Further risk sensitivities are the OIS spread delta, CCY spread delta, discount spread delta, spot Libor spread delta, etc.

### 2.4 Feeder and Servicer Models

The model DBX-ShortRate_FXSkewStochVol has no direct servicer or feeder models.

### 2.5 Model Change Description

DBAnalytics model developers log model changes in release notes, which are available through a dedicated website. In the release note, model developers identify the scope of the change made for the Product-Model combinations it is related to and how it can be identified through the library interface. Pricing model changes are categorised into major, minor, technical, non-model and other. The proposed change category is reviewed, and agreed by MoRM on the DBAnalytics website.

The changes not relating to pricing models or risk modes are currently not subject to validation, MoRM review the classification to ensure no pricing model related changes are misclassified. MoRM will only validate major and minor classified model changes.

There are currently no model changes relevant to DBX-ShortRate_FXSkewStochVol.

### 2.6 Validation Outline

#### 2.6.1 Model testing

Section 4.1 assesses the general behaviour of the DBX-ShortRate_FXSkewStochVol model. The testing comprises of:

* Impact of Stochastic Rates (4.1.2): Compares the original ShortRate model to a RateDeterministic version.
* Impact of FX Volatility and Stochastic FX Volatility (4.1.3): Compares the original FXSkewStochVol model to an FXSkew and FXDeterministic versions.
* Sensitivity to Exogenously-Set Parameters (4.1.4): Assesses the PV impact from changes in IR MeanRev, and FX MeanRevSV and LocalVolSV.

#### 2.6.2 EOD testing

The tests listed in this section investigate the correct behaviour of the model in EOD market scenarios by examining each product's price and risk sensitivity computed in DBAnalytics. A summary of the testing is the following:

1. Monte Carlo Convergence test: We examine the impact of NumberSims parameter that controls the number of simulations used by the Monte Carlo engine, on the PVs and risk-sensitivities of the products in scope.
2. Parallel Shifts of interest rate curve: We examine the behaviur of the product's price and main risk sensitivites under parallel shifts of the interest rate curve.
3. Relative Shifts of interest rate volatility: We examine the behaviur of the product's price and main risk sensitivites under relative shifts of the interest rate volatility.
4. Relative Shifts of FX Spot: We examine the behaviour of the product's price and main risk sensitivities under relative shifts of the FX spot.
5. Relative Shifts of FX Volatility: We examine the behaviour of the product's price and main risk sensitivities under relative shifts of the FX volatility.
6. Additional product specific testing: For more complex products, we investigate the behaviour of the product's price in different corner cases.

#### 2.6.3 Interest Rate Risk in the Banking Book (IRBB) Testing

In this section, we describe the Interest Rate Stress Tests on the models covered by this MVR models according to a runtime of ten different scenarios defined under the IRRBB framework. This framework is part of the Basel capital framework Pillar 2 (Supervisory Review Process). The goal is to approve the behaviour and accuracy of the DBAnalytics implementation for all the components of the model under those scenarios.
The BCBS document [47] describes eight Interest Rate shock scenarios that are required to be applied to IRRBB exposures in each currency for which a bank has material positions in the Banking Book. Eight Interest Rate currency dependent shock scenarios are prescribed that reflect currency-specific absolute interest rate shocks. Two of them (Steepener and Flattener) have been extended to take their opposite shift in order to define two additional scenarios: Steepener Negative and Flattener Negative. The IRRBB Interest Rate scenarios are summarized as follows:

1. Parallel shock up,
2. Parallel shock down,
3. Steepener shock (short rate down and long rates up),
4. Steepener Negative shock (opposite Steepener shift),
5. Flattener shock (short rates up and long rates down),
6. Flattener Negative shock (opposite Flattener shift),
7. Short rates shock up,
8. Short rates shock down,
9. Long rates shock up,
10. Long rates shock down.

Given a time bucket $k$, the Interest Rate shock for the time bucket midpoint $t_k$ for each of the ten scenarios $s \in \{1,...,10\}$ are parametrized by elementary shocks $\overline{R}_{s,c}$ for each shock type $e \in \{parallel, short, long\}$ per currency $c$. For the purposes of our tests the following most extreme elementary shocks (in bps) were chosen:

$$\overline{R}_{s,c} = \begin{cases}
200 & \text{if } e = \text{ parallel}, \forall c, \\
250 & \text{if } e = \text{ short}, \forall c, \\
100 & \text{if } e = \text{ long}, \forall c
\end{cases} \tag{26}$$

These shocks correspond to the elementary shocks for Euro currency. The interest rate shocks $\Delta R_{s,c}(t_k)$ for each scenario are as follows:

Parallel shock for currency $c$: a constant parallel shock up or down across all time buckets:

$$\Delta R_{\text{parallel},c}(t_k) = \pm R_{\text{parallel},c} \tag{27}$$

Short rate shock for currency $c$: shock up or down that is greatest at the shortest tenor midpoint. Long rate shock for currency $c$: shock up or down is greatest at the longest tenor midpoint. Rotation shock for currency $c$: these are steepening and flattening shocks. They involve rotations to the term structure of the interest rates whereby both the long and short rates are shocked and the shift in the interest rates at each tenor midpoint is obtained by applying the following formulae to the shocks:

$$\Delta R_{3,c}(t_k) = -0.65|\Delta R_{\text{short},c}(t_k)| + 0.9|\Delta R_{\text{long},c}(t_k)|,$$
$$\Delta R_{4,c}(t_k) = 0.8|\Delta R_{\text{short},c}(t_k)| - 0.6|\Delta R_{\text{long},c}(t_k)|, \tag{28}$$
$$\Delta R_{\text{stee},c}(t_k) = -\Delta R_{\text{steeNeg},c}(t_k),$$
$$\Delta R_{\text{flat},c}(t_k) = -\Delta R_{c}(t_k).$$

For each component, those ten scenarios and the base case scenario are tested. For each of those eleven scenarios, we perform a parallel shift of the rate curve on the zero-rates, from −15% to +15% with a 1% step. Results are plotted in the next sections. Further to the above, the 10 IRRBB scenarios applicable to the 489 Contractual Option Model and Non Usage adjustments are augmented with a relative shift on the volatility of 25% and are also tested for shifts with respect to this IR volatility. For each of the eleven scenarios, we perform a relative shift of the volatility with incremental values from −99% to +100% with a 10% step.

#### 2.6.4 CCAR test evidence

The CCAR methodology is included in the general stress testing framework as described in Standardized Shock Primer document [48]. This, in particular, includes a construction of CCAR stressed market data objects for adverse and severely adverse stress scenarios which have been reviewed and validated in [49, 50, 51, 52].
For the purpose of this validation, CCAR market data objects are treated as given inputs and the main objective is to test the behaviour of a product-model pair in the CCAR stressed pricing contexts including model (auto)calibration, convergence and stability of the returned PV and risk sensitivities.
The latest CCAR stress scenario testing was performed in Q2 2023 using the shock objects provided by Market Risk. For the purpose of this validation, CCAR market data objects are treated as given inputs and the main objective is to test the behaviour of a product-model pair in the CCAR stressed pricing contexts including convergence and stability of the returned PV and risk sensitivities. We consider three separate scenarios in testing:

1. Base Scenario: This is the market data used in end of day pricing on the valuation date and its presented in this section only for comparison purposes;
2. CCAR 1: This is the Asset Bubble Burst - Q2 2023 scenario. In terms of the market data relevant to the testing product, shocks are applied to all relevant objects in the EOD pricing dictionary as given by Market Risk.
3. CCAR 2: This is the severe adverse Q2 2023 FRB CCAR scenario. In terms of the market data relevant to the testing product, shocks are applied to all relevant objects in the EOD pricing dictionary as given by Market Risk.

#### 2.6.5 HistSim Var/Multivariate test evidence

The purpose of this test is to examine the robustness of the model by showing that the model is robust enough to price in extremely stressed scenarios similar to those seen during the 2008 crisis. This is done by applying the SVAR 10d shocks used in HistSim VaR calculation. Let $V_t$ represent the time $t$ value of a product and let $(X_t^i)_{t≥0}, i=1,...n$ represent the set of risk factors that are relevant for the product i.e.

$$V_t = V(t, X^1,...X^n)$$

These risk factors are typically market observables e.g.

* Swaps instruments used in the construction of the interest rate curve;
* OIS spreads and CCY spreads that are extracted from LIBOR-OIS swaps and cross-currency swaps and are relevant for the construction of the OIS discounting curves and for the construction of foreign curves from the base curve (e.g. for the construction of the CHF curve from a base USD curve);
* FX spot values relevant in multi-currency models;
* Volatility parameters (e.g. ATMVOL, SLOPE, CONVEXITY, used in parametric models such as SP04) that are obtained by calibrating the model to a volatility surface of vanilla option prices.

or parameters set exogenously by the model user e.g.

* Volatility and mean reversion parameters of SV component present in stochastic volatility or local-stochastic volatility models;
* Correlation parameters between various risk factors e.g. correlation between the SV components of two Cheyette LSV diffusions.

Risk Methodology team provides a series of SVAR (stressed VaR) 10D shocks for a wide range of risk factors. For each risk factor, there are two shocks (Min Shock and Max Shock) corresponding to the minimum of the 5th percentile and maximum of the 95th percentile. For each risk factor relevant to the product, we compute the corresponding risk sensitivity and according to the sign of the sensitivity we either apply the Min Shock or apply the Max Shock. The purpose of this step is to retrive the most extreme scenario that can be generated with the provided SVAR 10D shocks.
To exemplify, we consider a call option on the USD/EUR FX rate whose value depends on the following risk factors:

| ObjectType | Currency | RiskFactor | Shocks Availability |
| --- | --- | --- | --- |
| IRCURVE | USD | SWAP | Yes |
| IRCURVE | EUR | SWAP | Yes |
| FXSPOT | USD/EUR | SPOT | Yes |
| FXDBMVOL | USD/EUR | LOCALVOL | Yes |

Table 32: Example of risk factors identified by DBAnalytics.

* Let $S^j(T_n); n = 1,..N_j, j \in \{EUR, USD\}$ represent the term structures of swap instruments present in the input EUR and USD curves;
* Let $X_0$ represent USD/EUR FX rate;
* Let $\{v_m; m = 1,...M\}$ represent the term structure of LOCALVOLs contained in the FX rate volatility.

We perform the following steps:

* For each swap instrument present in the EUR curve and USD curve we compute the "bucketed deltas" i.e.

$$\frac{\partial}{\partial S^j(T_n)}V(t), n = 1,..N_j, j \in \{EUR, USD\}.$$

The sign of the derivative will dictate the type of shock applied: e.g. if

$$\frac{\partial}{\partial S^{EUR}(T_n)}V(t) > 0$$

then for determining the maximum PV we apply the corresponding SVAR 10D MinShock to the $n^{th}$ swap present in the EUR curve i.e. shift the swap's original coupon value $C_n^{EUR}$ by $C_n^{EUR}(1 + \lambda MinShock_{swap,n}^{EUR})$. The parameter λ is allowed to take values between 0 and 1: λ = 0 corresponds to EOD scenario, whereas λ = 1 corresponds to SVAR 10d scenario.

* For each volatility present in the LOCALVOLS term structure we compute the "bucketed vegas" i.e.

$$\frac{\partial}{\partial v_m}V(t), m = 1,...M.$$

The sign of the derivative will dictate the type of shock applied: e.g. if

$$\frac{\partial}{\partial v_m}V(t) > 0$$

then for determining the maximum PV we apply the corresponding SVAR 10D MaxShock to the $m^{th}$ volatility present in the LOCALVOLS term structure curve i.e. shift the original value $v_m$ to $v_m(1 + \lambda MaxShock_{loc})$.

* We compute the derivative with respect to the FX spot i.e. $\frac{\partial}{\partial X_0}V(t)$ and depending on the derivative sign, for example if the sign is positive, we apply a relative shift to the original spot $X_0(1 + \lambda MaxShock_{spot})$.

* Using the shifted risk factors $S^{j,up}(T_n); n = 1,..N_j, j \in \{EUR, USD\}, X_0^{up}, \{v_m^{up}; m = 1,...M\}$ we are able to compute the maximum PV:

$$V^{max}(\lambda) = V(S^{j,up}(T_n); n = 1,..N_j, j \in \{EUR, USD\}, X_0^{up}, \{v_m^{up}; m = 1,...M\})$$

while using the shifted risk factors $S^{j,down}(T_n); n = 1,..N_j, j \in \{EUR, USD\}, X_0^{down}, \{v_m^{down}; m = 1,...M\}$ we are able to compute the minimum PV:

$$V^{min}(\lambda) = V(S^{j,down}(T_n); n = 1,..N_j, j \in \{EUR, USD\}, X_0^{down}, \{v_m^{down}; m = 1,...M\})$$

* By shifting the parameter λ from 0% to 100% we obtain the PV ladders $V^{min}(\lambda)$ and $V^{max}(\lambda)$ that represent the PV evolution to the EOD scenario to the SVAR10D scenario.

#### 2.6.6 Model Parameter Rules testing

The model parameters rules for DBX-ShortRate_FXSkewStochVol were submitted in MARS request 2020Jul17-LOERAND-14868. The submitted rules were tested in Section 4.15.

#### 2.6.7 Calibration testing

The calibration of the model DBX-ShortRate_FXSkewStochVol was tested in relation to MARS requests 2020Jul3-DBEAGLEH-14939 (calibration of interest rate component) and 2020Dec01-DBEAGLEH-16199. The calibration of the model was tested for a wide range of products, see Section 4.13 for a complete description of the performed tests.

| Tested product | Section |
| --- | --- |
| CMSFXRangeAccrual | 4.13.4 |
| FXEuroOpt | 4.13.5 |
| FXVolSwap | 4.13.6 |
| LTFXParForwardKnockOut | 4.13.7 |
| LTFXDigitalKnockOut | 4.13.8 |
| IRFXSwapFXKnockOut | 4.13.9 |
| IRFXSwapFXRangeAccrual | 4.13.10 |
| IRXCcySwapAccretingCallableBerm | 4.13.11 |
| FXAmerOpt | 4.13.12 |
| PRDCSwapCallable | 4.13.13 |
| PRDCSwapCallableKORedemptionStrike | 4.13.14 |
| PRDCSwapTARNRedemptionStrike | 4.13.15 |

Table 33: Testing of calibration.

### 2.6.8 Testing Files

All files for the model testing are listed in Table 34 and product testing are in Table 35. The files are available from the SVN repository:

https://mars-svn.risk.intranet.db.com/doc/ModelApproval/branches/uat/mvdocs/ModelValidationReports/DBX-ShortRate_FXSkewStochVol/

| Test | Section | Testing File* |
| --- | --- | --- |
| Stochastic Rates | §4.1.2 | _tests/Q2_2023/ModelTests/RateDet_ShortRate/ |
| IRFXSwapFXKnockOut | §4.1.2 | Rateoet_IRFXSwapFXKnockOut.ipynb |
| IRSwaptionXCcyBerm | §4.1.2 | Rateoet_IRSwaptionXCcyBerm.ipynb |
| LTFXParForwardKnockOut | §4.1.2 | Rateoet_LTFXParForwardKnockOut.ipynb |
| PRDCSwapCallableKORedemptionStrike | §4.1.2 | Rateoet_PRDCSwapCallableKORedemptionStrike.ipynb |
| FX Volatility & Stochastic FX Volatility | §4.1.3 | _tests/Q2_2023/ModelTests/FXDet_FXSkew_FXStochVol/ |
| IRFXSwapFXKnockOut | §4.1.3 | FX-IRFXSwapFXKnockOut.ipynb |
| IRSwaptionXCcyBerm | §4.1.3 | FX-IRSwaptionXCcyBerm.ipynb | 
| LTFXParForwardKnockOut | §4.1.3 | FX-LTFXParForwardKnockOut.ipynb |
| PRDCSwapCallableKORedemptionStrike | §4.1.3 | FX-PRDCSwapCallableKORedemptionStrike.ipynb |
| Exogenously-Set Parameters | §4.1.4 | _tests/Q2_2023/ModelTests/ExogenouslySetParams/ |
| IRFXSwapFXKnockOut | §4.1.4.1 | ExoParams-IRFXSwapFXKnockOut.ipynb |
| IRSwaptionXCcyBerm | §4.1.4.2 | ExoParams-IRSwaptionXCcyBerm.ipynb |
| LTFXParForwardKnockOut | §4.1.4.3 | ExoParams-LTFXParForwardKnockOut.ipynb |
| PRDCSwapCallableKORedemptionStrike | §4.1.4.4 | ExoParams-PRDCSwapCallableKORedemptionStrike.ipynb |

Table 34: List of Model Testing Files.

| Test | Section | Testing File* |
| --- | --- | --- |
| IRFXSwapFXKnockOut | §4.2 | _tests/Q2_2023/IRFXSwapFXKnockOut/ |
| EOD Testing | §4.2.5 | IRFXSwapFXKnockOut-EOD.ipynb |
| IRRBB Testing | §4.2.6 | IRFXSwapFXKnockOut-IRRBB.ipynb |
| CCAR Testing | §4.2.7 | IRFXSwapFXKnockOut-CCAR.ipynb |
| Multivariate Testing | §4.2.8 | IRFXSwapFXKnockOut-Multivar.ipynb |
| IRSwaptionXCcyBerm | §4.3 | _tests/Q2_2023/IRSwaptionXCcyBerm/ |
| EOD Testing | §4.3.5 | IRSwaptionXCcyBerm-EOD.ipynb |
| IRRBB Testing | §4.3.6 | IRSwaptionXCcyBerm-IRRBB.ipynb |
| CCAR Testing | §4.3.7 | IRSwaptionXCcyBerm-CCAR.ipynb |
| Multivariate Testing | §4.3.8 | IRSwaptionXCcyBerm-Multivar.ipynb |
| IRFXSwapFXRangeAccrualCallableBerm | §4.4 | _tests/Q2_2023/IRFXSwapFXRangeAccrualCallableBerm/ |
| EOD Testing | §4.4.3 | IRFXSwapFXRangeAccrualCallableBerm_EOD.ipynb |
| IRRBB Testing | §4.4.4 | IRFXSwapFXRangeAccrualCallableBerm_IRRBB.ipynb |
| CCAR Testing | §4.4.5 | IRFXSwapFXRangeAccrualCallableBerm_CCAR.ipynb |
| Multivariate Testing | §4.4.6 | IRFXSwapFXRangeAccrualCallableBerm_Multivar.ipynb |
| LTFXDigitalKnockOut | §4.5 | _tests/Q2_2023/LTFXDigitalKnockOut/ |
| EOD Testing | §4.5.3 | LTFXDigitalKnockOut_EOD.ipynb |
| CCAR Testing | §4.5.5 | LTFXDigitalKnockOut_CCAR.ipynb |
| IRRBB Testing | §4.5.4 | LTFXDigitalKnockOut_IRRBB.ipynb |
| Multivariate Testing | §4.5.6 | LTFXDigitalKnockOut_Multivar.ipynb |
| LTFXParForwardKnockOut | §4.6 | _tests/Q2_2023/LTFXParForwardKnockOut/ |
| EOD Testing | §4.6.5 | LTFXParForwardKnockOut-EOD.ipynb |
| CCAR Testing | §4.6.7 | LTFXParForwardKnockOut-CCAR.ipynb |
| IRRBB Testing | §4.6.6 | LTFXParForwardKnockOut-IRRBB.ipynb |
| Multivariate Testing | §4.6.8 | LTFXParForwardKnockOut-Multivar.ipynb |
| PRDCSwapCallable | §4.7 | _tests/Q2_2023/PRDCSwapCallable/ |
| EOD Testing | §4.7.3 | PRDCSwapCallable_EOD.ipynb |
| CCAR Testing | §4.7.5 | PRDCSwapCallable_CCAR.ipynb |
| IRRBB Testing | §4.7.4 | PRDCSwapCallable_IRRBB.ipynb |
| Multivariate Testing | §4.7.6 | PRDCSwapCallable_Multivar.ipynb |
| PRDCSwapCallableKORedemptionStrike | §4.8 | _tests/Q2_2023/PRDCSwapCallableKORedemptionStrike/ |
| EOD Testing | §4.8.5 | PRDCSwapCallableKORedemptionStrike-EOD.ipynb |
| CCAR Testing | §4.8.7 | PRDCSwapCallableKORedemptionStrike-CCAR.ipynb |
| IRRBB Testing | §4.8.6 | PRDCSwapCallableKORedemptionStrike-IRRBB.ipynb |
| Multivariate Testing | §4.8.8 | PRDCSwapCallableKORedemptionStrike-Multivar.ipynb |
| PRDCSwapTarnRedemptionStrike | §4.9 | _tests/Q2_2023/PRDCSwapTarnRedemptionStrike/ |
| EOD Testing | §4.9.3 | PRDCSwapTarnRedemptionStrike_EOD.ipynb |
| CCAR Testing | §4.9.5 | PRDCSwapTarnRedemptionStrike_CCAR.ipynb |
| IRRBB Testing | §4.9.4 | PRDCSwapTarnRedemptionStrike_IRRBB.ipynb |
| Multivariate Testing | §4.9.6 | PRDCSwapTarnRedemptionStrike_Multivar.ipynb |
| IRSwapQuantoRangeAccrualCallable | §4.10 | _tests/Q1_2024/IRSwapQuantoRangeAccrualCallable/ |
| EOD Testing | §4.10.6 | IRSwapQuantoRangeAccrualCallable_EOD.ipynb |
| CCAR Testing | §4.10.8 | IRSwapQuantoRangeAccrualCallable_CCAR.ipynb |
| IRRBB Testing | §4.10.7 | IRSwapQuantoRangeAccrualCallable_IRRBB.ipynb |
| Multivariate Testing | §4.10.9 | IRSwapQuantoRangeAccrualCallable_Multivar.ipynb |
| LTFXResurrectingFaderOpt | §4.11 | _tests/Q1_2024/LTFXResurrectingFaderOpt/ |
| EOD Testing | §4.11.6 | LTFXResurrectingFaderOpt_EOD.ipynb |
| CCAR Testing | §4.11.8 | LTFXResurrectingFaderOpt_CCAR.ipynb |
| IRRBB Testing | §4.11.7 | LTFXResurrectingFaderOpt_IRRBB.ipynb |
| Multivariate Testing | §4.11.9 | LTFXResurrectingFaderOpt_Multivar.ipynb |
| LTFXOneBarDigitalOpt | §4.12 | _tests/Q1_2024/LTFXOneBarDigitalOpt/ |
| EOD Testing | §4.12.6 | LTFXOneBarDigitalOpt_EOD.ipynb |
| CCAR Testing | §4.12.8 | LTFXOneBarDigitalOpt_CCAR.ipynb |
| IRRBB Testing | §4.12.7 | LTFXOneBarDigitalOpt_IRRBB.ipynb |
| Multivariate Testing | §4.12.9 | LTFXOneBarDigitalOpt_Multivar.ipynb |

Table 35: List of Product Testing Files.

### 2.7 Engagement Process

The main model developer documentation [1] has been reviewed for sufficiency and completeness against the model approval request submission standards detailed in the Pricing Model Validation Key Operating Document [53]. The results of the initial review are detailed in Tables 3.5 and 3.6.

### 2.8 List of Validation Findings

#### 2.8.1 Open Validation Findings

There are currently no open validation findings to be addressed.

| Request ID | Start Date | Due Date | Request Status | Originator | Action Owner | Finding Severity |
| --- | --- | --- | --- | --- | --- | --- |

Table 36: DBX-ShortRate_FXSkewStochVol Open Findings

#### 2.8.2 Closed Validation Findings

| Request ID | Start Date | Due Date | Request Status | Originator | Action Owner | Finding Severity |
| --- | --- | --- | --- | --- | --- | --- |

Table 37: DBX-ShortRate_FXSkewStochVol Open Findings

### 2.9 List of Validation Observation

As part of the validation of pricing models, MoRM may identify problems with the model that require an immediate implementation fix and cause further validation activities to be put on hold. Ownership, compensating controls, remediation actions and timelines will be discussed and monitored as part of the MCWGs. To raise a validation finding MoRM create a validation finding request in MARS, where the finding is described, responsible action owner is assigned and a deadline for remediation of the finding specified. MoRM can revoke the model approval if validation findings are not closed within agreed timelines. MoRM will only raise validation findings and not observations for pricing models. Due to the nature of model usage for valuation and risk management, matters identified must be addressed through concrete remediation.

## 3 Assessment of Approach, Conceptual Soundness and Implementation

In this section, we review the methodology, conceptual soundness and implementation of the models contained in the present document.

### 3.1 Assessment of Development and Modelling Data

DBX-ShortRate_FXSkewStochVol is the preferred model to price and risk-manage long-dated FX derivatives where the main risk factors driving the value of the products are the FX spot and/or the FX rate volatility. Since long-dated FX derivatives are expected to be impacted by the volatility of the interest rates, the model assumes stochastic interest rates.

The FX rate dynamics are represented by a lognormal process with local-stochastic volatility (DLVAUTO configuration). The FX rate volatility is calibrated on the fly during pricing via a multiple step process. The calibration targets are typically represented by a term structure of DN/CVX/RR volatilities. It is expected that the calibration targets are selected at expiries that are relevant for the exotic which relies on the calibration. The dynamics of the domestic and foreign interest rates are presented by mean-reverting processes with time-dependent coefficients (Hull-White model). The interest rate volatilities are calibrated on the fly during pricing to a prescribed set of targets. These are expected to represent the term structure of ATM volatilities.

The initial domestic and foreign yield curves are constructed from a set of market observable instruments such as cash, futures, swaps, OISSpreads, CCYSpreads, etc. In the case of the multi-currency model, a domestic and a foreign interest rate curve are provided. The curve construction algorithm begins with the construction of a base curve (typically USD LIBOR 3M) and simultaneously bootstraps OIS discounting curve (constructed with the help of the OIS spreads stored in the OISSpreads subtable) and LIBOR forecasting curve. The model includes spreads such DiscountSpreads, CCYSpreads, SpotLiborSpreads, TreasurySpreads, BasisSpreads, etc. depending on the type of curve in use (e.g. CCYSpreads are used in the construction of non-USD curves, SpotLiborSpreads are used in the construction of forward rates with tenors different from the tenor of the base curve, etc.) or on the product being priced (e.g. DiscountSpreads might be necessary in the construction of the product's funding curve). The complete description of the curve construction algorithm can be found in [21].

### 3.2 Assessment of Methodology and Calibration

This section aims to provide an assessment of the ability of the model to capture inherent risk factors associated to the products in scope and of the numerical implementation of the model. Furthermore, the section provides an assessment of the calibration methodology.

#### 3.2.1 Conceptual soundness of model specification

The products in scope of the model DBX-ShortRate_FXSkewStochVol are a wide range of long-dated FX derivatives. The main risk factors of the products in scope are the FX spot and/or the FX rate volatility. The model is well suited for the pricing and risk management of the above products for the following reasons:

* The dynamics of the FX rate are modelled using a lognormal process with local-stochastic volatility (LSV) component. The local volatility component is non-parametric (DLVAUTO configuration) This is an industry-standard model in which the FX smile is explained partly by a local volatility component and partly by stochastic volatility. By mixing the stochastic and the local volatility, the model controls the price of the exotic contracts, while always correctly pricing the vanilla smile.

* The FX local volatility component allows the model to reprice the input volatility smile of vanilla options i.e. achieve consistency with the market available information. Therefore, the model is appropriate for the pricing and risk-management of products that depend on the volatility smile of the FX rate.

* In the case of exotics that depend on the evolution of the FX smile (the forward volatilities are unknown quantities at valuation date), the pricing model typically imposes a realistic and controllable dynamics on the volatility evolution (for example it can assume that the forward smile is similar to the valuation date smile). The presence of the SV component of the FX rate allows to control the dynamics of the forward smile.

* Due to the fact that the products are long-dated, the model assumes stochastic interest rates i.e. the dynamics of the domestic and foreign interest rates are represented by Hull-White processes. This assumption allows the model to capture the impact of the interest rates volatilities on the price and risk sensitivities of the products in scope. Note that, due to the nature of the products, the impact of the interest rates volatilities on the price and risk sensitivities of the products is fairly limited when compared with the impact of the FX volatility or FX spot rate.

The model has a Monte Carlo implementation which is an industry standard approach. The specific implementation choices made by DBAnalytics appear to be valid solutions and can be considered in line with the industry best practice as well as with the recent literature.

#### 3.2.2 Assessment of Calibration

The calibration of the FX rate volatility is done on the fly during pricing in the framework of the DLVAUTO configuration. The calibration is a three-step process: 1) a PIV functional form (e.g. SA4) is fitted to the implied volatility surface provided by in the DELTAVOL object under the assumption of deterministic interest rates; 2) the calibrated volatilities are adjusted via DLVIR correction to account for the stochasticity of interest rates; 3) the calibrated volatility is decomposed into a LV component and a SV component using Gyongy's theorem. The complete description of the calibration can be found in Section 2.3.7. The calibration of the domestic and foreign interest rates volatilities is done on the fly during pricing in the framework of the LVMRAUTO configuration. Due to the fact that the interest rates are represented as Hull-White processes with time-dependent coefficients (unable to capture the volatility smile) the model calibrates typically to a term structure of ATMF swaptions at different expiries and tenors that cover the time to maturity of the exotic. The complete description of the calibration can be found in Section 2.3.6. The tests performed by DBAnalytics and the tests performed by MoRM show that the calibration quality, expressed as the distance between the market-observed implied volatilities ("targets") and the model-generated implied volatilities, is very high at all expiry-strike pairs present in the input market volatility surface.

### 3.3 Assessment of Model Assumptions and Limitations

The key objective of this section is to ensure that the model assumptions and limitations are clearly identified, key risks highlighted by model developers are assessed, and where appropriate, additional model risks are identified. The model assumptions and limitations are listed in Sections 2.3.1 and 5.1.1, respectively. The list of model assumptions and limitations is deemed complete and there is no relevant missing item that should be added to the documentation.

Table 38 lists the model assumptions and gives a statement on their conceptual suitability.

| Assumption | Conceptual Suitability |
| --- | --- |
| No Arbitrage | This assumption implies the existence of a risk-neutral measure, or equivalently, that there are no arbitrage opportunities. It is a fundamental and industry-standard assumption for all realistic models that are used in the pricing and risk-management of derivatives. |
| Diffusive Dynamics | The randomness in the evolution of the short rate processes representing the domestic and foreign interest rates, of the FX rate and of its underlying stochastic volatility component is assumed to be driven by Brownian Motions. |
| Diffusive dynamics for FX rate | The model assumes that the dynamics of the FX rate and of its SV component are given by continuous processes where the randomness in the evolution is assumed to be driven by Brownian motions. Additionally, the SV component experiences a unique jump in the proximity of t=0. |
| Mean-reverting short rate and stochastic volatility dynamics | The dynamics of the short rates representing the domestic and foreign inteerest rates, and the dynamics of the stochastic volatility component of the FX rate are assumed to be given by mean-reverting (Hull-White) processes. |
| Time dependent short rate local volatility | A time dependent volatility structure (without a skew/smile component) is assumed to reasonably capture the interest rate dynamics relevant for FX-IR hybrids and long dated FX derivatives. |

Table 38: DBX-ShortRate_FXSkewStochVol: model assumptions and their conceptual suitability.

#### 3.3.1 Assessment of Model Limitations

Table 39 lists the model limitations, their impact and the mitigating controls in place. The description of each limitation is identical to the one that can be found in MARS and PRDS:

| Limitation | Impact | Mitigating Control |
| --- | --- | --- |
| Numerical: Monte-Carlo valuations have an error associated with them that is a function of the timegrid discretisation and number of simulations used. [Lim ID 700] | The accuracy of pricing and of the risk sensitivities computation may be sensitive to the choice of the Monte Carlo parameters. | The testing shows that the impact of the Monte-Carlo parameters on the value on the PV and risk sensitivity values are small as long as the Monte-Carlo related parameters satisfy the relevant CFUs. |
| Missing Risk Factor: The ShortRate framework can only produce a decreasing interest rate implied volatility profile. This assumption is reasonable for markets that do not exhibit significant implied volatility smile or when products are not sensitive to high-strikes. [Lim ID 699] | Due to the nature of the products (FX derivatives) the impact of the interest rate volatility is fairly small. | The impact of this limitation should be monitored on constant basis by GVG, as part of the ongoing monitoring plan for this model, based on feedback from the ongoing usage of the model. Furthermore, reserves should be taken, if deemed necessary. |
| Missing Risk Factor: The ShortRate framework can only produce a forward volatility dynamic that does not preserve observed features in the volatility market (e.g. volatility hump). This assumption is reasonable for single expiry products or weakly path dependent products that are not strongly dependent on forward volatility. [Lim ID 2670] | Due to the nature of the products (FX derivatives) the impact of the interest rate volatility is fairly small. | The impact of this limitation should be monitored on constant basis by GVG, as part of the ongoing monitoring plan for this model, based on feedback from the ongoing usage of the model. Furthermore, reserves should be taken, if deemed necessary. |
| Model Weakness: The ShortRate framework cannot simultaneously fit the entire option market (i.e. caps/swaptions of all expiries/tenors/strikes). This limitation can be ameliorated by calibrating different exotic volatilities to different parts of the volatility surface [Lim ID 3085] | The dynamics of the interest rates are represented by Hull-White processes with time-dependent coefficients which are calibrated typically to an ATM term-structure of swaptions of different expiry-tenor pairs. Although not all implied volatilities can be reproduced exactly, the model-generated implied vols are expected to be very close to the target implied vols. Note that the impact of the interest rates' volatilities on the products' prices and risk sensitivities is very small. | The impact of this limitation should be monitored on constant basis by GVG, as part of the ongoing monitoring plan for this model, based on feedback from the ongoing usage of the model. Furthermore, reserves should be taken, if deemed necessary. |
| Missing Risk Factor: The instantaneous correlations are marked by the desk and need to be calibrated to liquid instruments having dependency to the correlation.[Lim ID 2557] | This assumption is reasonable when there are only limited instruments available for correlation calibration. | The impact of this limitation should be assessed by benchmarking against alternative models or by stressing the correlation coefficients in different scenarios. We recommend that GVG monitors on constant basis the impact of this limitation, and reserves should be taken, if deemed necessary. |
| Model Weakness (Calibration Uncertainty): The calibration process may opt to exogenously set some of the model parameters instead of calibrating them to market observables (examples: MeanRevSV and LocalVolsSV of SV component, or MeanRev for Rates, where applicable). [Lim ID 3809] | This limitation is relevant for all products in scope since the calibration will impact the prices and risk sensitivities of exotics depending on it | We recommend GVG to monitor the uncertainty surrounding the calibration and compute uncertainty reserves, if deemed necessary. |
| Model Weakness: The InstantaneousCorrelation framework does not have the flexibility to fit correlation skew. [Lim ID 698] | This limitation is only applicable to basket options or cross-FX-options. | The impact of this limitation should be assessed by benchmarking against alternative models or by stressing the correlation coefficients in different scenarios. We recommend that GVG monitors on constant basis the impact of this limitation, and reserves should be taken, if deemed necessary. |
| Calibration: The automatic calibration of the ShortRate model is sensitive to the choice of calibration targets. Incorrectly chosen calibration targets may lead to an error in calibration. [Lim ID 3489] | This limitation is relevant for all products in scope since all show sensitivity to interest rate volatility | The quality and appropriateness of the calibration needs to be monitored by GVG, and reserves should be taken, if deemed necessary. |
| Model Weakness: The volatility parametrisation that represents instantaneous local volatility has restricted flexibility in the shape of the local volatility surface that can be produced. [Lim ID 2622] | This limitation is relevant for all products in scope since all show sensitivity to FX rate volatility | We recommend that GVG monitors on constant basis the impact of this limitation, and reserves should be taken, if deemed necessary. |
| Calibration: In the FX DLV framework a misspecification of the calibration set instruments (expiry-strikes) can lead to the mispricing of the Exotic. The calibration targets need to be monitored on a regular basis. [Lim ID 3588] | This limitation is relevant for all products in scope since all show sensitivity to FX rate volatility | The quality and appropriateness of the calibration needs to be monitored by GVG, and reserves should be taken, if deemed necessary. |
| Calibration: The automatic calibration of the parametric functional form is sensitive to the choice of calibration targets and parameters. [Lim ID 3508] | This limitation is relevant for all products in scope since all show sensitivity to FX rate volatility | The quality and appropriateness of the calibration needs to be monitored by GVG, and reserves should be taken, if deemed necessary. |

Table 39: Model limitations, their impact and the mitigating control.

### 3.4 Expert Judgements in the Model

In addition to the model specification detailed in section 2.3, the market inputs specified in Section 2.3.2.1 are subject to IPV process and the following model parameters are subject to the following expert judgement:

| Parameter | Description | Calibration Approach and Frequency |
| --- | --- | --- |
| MeanRev (IR) | Mean-reversion of interest rate process | Exogenously specified (owned by STRATS). The parameter is set daily. The book is remarked monthly with the calibrated values. |
| Power (FX) | Parameter present in the SA4 parametric form | Exogenously specified and always set to 1. |
| Correlation | Correlation matrix parameters | Exogenously specified (owned by trading desk). Marked by trading desk at their own discretion. |
| MeanRevSV LocalVolsSV | Parameters of the stochastic volatility component of the FX rate volatility. | Exogenously specified (owned by STRATS). The parameters are calibrated daily. The book is remarked weekly with the newly calibrated values. The calibration is done by STRATS, using a two-step calibration logic similar to the one employed for DBX-RateDeterministic_FXSkewStochVolJump. |

Table 40: Parameters set by expert judgement in the model DBX-ShortRate_FXSkewStochVol.

### 3.5 Assessment of Model Documentation

Model users are responsible for seeking model validation for all new model and product combinations prior to use, through the submission of Model Approval Requests in line with the documentation standards set out by MoRM. Documentation should be sufficient to permit independent review and to facilitate potential replication and/or upgrade of the model by others, independent of the original developer.

upgrade of the model by others, independent of the original developer.

The following steps are carried out in evaluating the Model Approval Request submissions:

* Upon being assigned to the Model Approval Request, the Primary Approver must review the submission to confirm completeness and adequacy against the minimum standards.

* If the Model Approval Request does not comply with submission standards or if additional information is required, the Primary Approver will reject the request and clearly document the reasons for this as well as follow up actions required by model owner/developer submitting the request, prior to resubmission.

MoRM will not commence validation until the Model Approval Request is accepted.

At any time during the validation process, MoRM have the right to request additional information they deem necessary for effective validation, even if outside the submission requirements listed in this document. MoRM may also ask for the model documents to be updated during the course of the validation. Additional supporting information obtained during the validation is also recorded in MARS.

The pricing model developer document requirements to check:

| Section | Content | MoRM check |
| --- | --- | --- |
| Executive summary | | Yes |
| | Model Developer | Yes |
| | Documentation Info | Yes |
| Market characteristic and market data | | |
| Market characteristic | | Yes |
| | Market considerations | Yes |
| | Market instruments | Yes |
| | Market instrument treatment | Yes |
| | Other market data | Yes |
| Model Description | | Yes |
| Model Dynamics | | |
| | Model assumptions | Yes |
| | Model parameters | Yes |
| | Model dynamics | Yes |
| | Model components | Not relevant |
| | Model implementation | Yes |
| Model calibration | | |
| | Model parameters calibration | Yes |
| Model risk sensitivities | | |
| | Modes which apply to the model | Yes |
| | Model risk sensitivities | Yes |
| Model weaknesses, limitations | | |
| | Weakness and limitation description | Yes |
| | Model Restrictions (Conditions for Use) | Yes |
| Conceptual Soundness | | |
| | Product scope | Yes |
| | Justification for model selection | Yes |
| Model controls | | |
| | Analytics Library and Version | Yes |
| | Compensating controls | Yes |
| | Model inputs controls | Yes |
| Implementation testing and justification of model behaviour | | Yes |
| Model configuration testing | | Yes |
| References | | Yes |

| Section | Content | MoRM check |
| --- | --- | --- |
| Executive summary | | |
| | Model Developer | Yes |
| | Documentation Info | Yes |
| | Model configuration | Yes |
| | Product Owner | Yes |
| | Business Area, Line or Asset Class | Yes |
| | Risk Management Systems | Yes |
| Products description | | |
| Product Scope | | |
| | PRDS name and definition | Yes |
| | NPA Reference | Yes |
| | Mathematical desciption of the payoff | Yes |
| | Product contractual parameters | Yes |
| | Product scripting | Yes |
| Product grouping | | Yes |
| | Product main characteristics and features | Yes |
| Product model appropriateness | | |
| Model appropriateness for products it will be used for | | |
| | Product-Model Combination appropriateness | Yes |
| Product Risk factor identification | | |
| | Key Risk factors | Yes |
| | Risk sensitivities | Yes |
| | Calibration instruments | Yes |
| | Products calibration instrument choice | Yes |
| Product model weakness identification | | |
| | Product-Model Combination Limitations | Yes |
| Model Configuration Testing and Results | | |
| Convergence and stability tests | | Yes |
| Limiting case and alternative model testing | | Yes |
| Calibration algorithm and risk sensitivities | | Yes |
| Risk factor tests | | Yes |
| | End of Day condition and VAR | Yes |
| | CCAR and EBA conditions | Yes |
| | RIB | Yes |

## 3.6 IT Implementation testing

For Pricing models, implementation refers to DBA releases and deployment refers to integrating them into risk calculators. The deployed model library executable code must be held in a secure and controlled environment or embedded in a system which is held in a secure and controlled environment.

DBAnalytics production system reconciliation: Independent model validation testing is undertaken using DBAnalytics. Since no additional processing of DBAnalytics is undertaken and no further external analytics are being run in strategic production systems, it can be assured that model output produced with a consistent version of DBAnalytics will yield equivalent results whether run locally by individual users or in official production systems.

The following tests have been carried out by DBAnalytics in the developer document [1] and in the calibration testing document [29] and they cover the following model components:

* Model Calibration: the performed tests show that the model is able to price the calibration targets with high accuracy. Further tests show that the calibration is robust under changes of initial guesses of parameters and under different market conditions. The complete description of performed tests can be found in Section 4.13 and in the DBA testing documents [29] and [1].

* PV and Risk Convergence Analysis: the performed tests verify the Monte-Carlo convergence (at price level and risk sensitivities level) with respect to the parameterrs NumberSims and FreqTimeVec for a set of selected products.The products considered are found to converge to their asymptotic values at the current production settings.

* Model Benchmark Tests: the tests compare the prices of exotic and vanilla options and the implied volatility smile generated by different models (LV, DLV, DSLV, SLV) and different implementations of the same model (DBX, DBSMC). The tests show consistency between configurations.

* Standard Scenarios and Stress Scenarios: the performed tests analyse the behaviour of the product's price and main risk sensitivities as a function of the main risk factors (FX spot, FX VOL, interest rate curves, interest rate volatilities etc.). The tests are performed on a representative set of products in EOD conditions and stress conditions (CCAR, IRRBB, HistSim VAR). The test results show that the PV and risk sensitivities profiles behave as expected and are smooth in all considered scenarios.

* Stress Testing and Boundary Conditions: the tests analyse the behavior of the price in extreme scenarios for FX VOL, interest rate volatility and interest rate level.

## 4. Independent Validation Testing

In this section, we perform the main independent validation testing of the models listed in this report, the products that are used by these models as well as the model parameters that are used to define the Conditions for Use of the models.

### 4.1 Model Tests

This section tests the general behaviour of the DBX-ShortRate_FXSkewStochVol model. The testing comprises of:

* Impact of Stochastic Rates (4.1.2): Compares the original ShortRate model to a RateDeterministic version.

* Impact of FX Volatility and Stochastic FX Volatility (4.1.3): Compares the original FXSkewStochVol model to FXSkew and FXDeterministic versions.

* Sensitivity to Exogenously-Set Parameters (4.1.4): Assesses the PV impact from changes in IR MeanRev, and FX MeanRevSV and LocaVolSV.

#### 4.1.1 Tested Dictionaries

The testing is done in Q2 2023 with model configuration

DBX-ShortRate[LVMIRA.ro]_FXSkewStochVol[DLVAUTO]

using DBAnalytics v.1240.

The testing is performed on the following dictionaries:

* IRFXSwapFXKnockOut: This trade receives the USD 3m LIBOR and pays a fixed rate of 2.5% semi-annually on a notional of 10 M USD, starting from 16/08/2017 and ending on 16/08/2027. There is a KO barrier both legs, which knocks out the recieve leg if the FX rate exceeds 0 JPY/USD (always KO), and the pay leg if it exceeds 110 JPY/USD. The barrier comes into effect on 16/08/2022, and the valuation date is 09/11/2021. The domestic rate is JPY, foreign rate is USD, and the spot FX rate is 113.435 JPY/USD. The cash flows of both legs are converted to JPY.

The receive leg payoff is summarised below:

$$RecLeg(JPY) = \mathbb{E}\left[N\sum_{i=0}^{M_r} L_{3m}^{USD}(t_i)\cdot \mathbb{I}(X_{t_i}^{JPY/USD} < 0)\cdot e^{-\int_{t_0}^{t_i}r_s ds}\cdot X_{t_i}^{JPY/USD}\right]$$

Similarly, the pay leg follows:

$$PayLeg(JPY) = \mathbb{E}\left[N\sum_{i=0}^{M_p} s\cdot \mathbb{I}(X_{t_i}^{JPY/USD} < 110)\cdot e^{-\int_{t_0}^{t_i}r_s ds}\cdot X_{t_i}^{JPY/USD}\right]$$

Here:

- $N$ is the notional of 10 M USD.
- $M_r, M_p$ is the number of cashflows on the receive and pay legs, respectively.
- $L_{3m}^{USD}(t_i)$ is the USD 3m LIBOR at $t_i$.
- $X_{t_i}^{JPY/USD}$ is the JPY/USD FX rate at $t_i$.
- $r_s$ is the domestic (JPY) rate.
- $s$ is the fixed rate of 2.5%.

* IRSwaptionXCcyBerm: This trade receives a fixed rate of 9.5% on a semi-annual basis, and pays a fixed rate of 8.42% semi-annually. The notional of both the receive and pay leg are time-dependent. Notional of the receive leg starts at 225 USD, then drops to 150 USD (down 1/3) on 08/04/2024 (2 cf) and finally down to 75 USD (down another 1/3) on 08/04/2025 (2 cf). Similarly, on the pay leg, the notional is initially 205.96851 EUR, then it drops to 137.31234 EUR (down 1/3) on 08/04/2024 (2 cf) and finally down to 68.65617 EUR (down another 1/3) on 08/04/2025 (2 cf).

There is a fixed flow on both the receive and pay leg, that is added to the coupon. The receive leg has a fixed flow of 75 USD (1/3 of initial notional) and pay leg has a fixed flow of 68.65617 EUR (also 1/3 of initial notional). These fixed flows start from 11/10/2022 and last until the end of the trade. The coupon and fixed cash flows of the pay leg are converted to USD.

The trade starts on 19/12/2015 and ends on 19/05/2025 (10yrs), and the valuation date is 09/12/2021. The domestic rate is USD, foreign rate is EUR.

There is a Bermudian SHORT ENTER option that can be exercised every 6M between 08/04/2016 to 08/10/2025 (10 years with 20 dates) with a strike of 102.984255 EUR, which is converted to USD. Therefore, $PV = -RightToEnter(PayLeg - RecLeg)$.

The receive leg payoff is summarised below:

$$RecLeg(USD) = \mathbb{E}\left[\sum_{i=0}^{M_r}(N_r^{USD}(t_i)s_r + F_r)\cdot e^{-\int_{t_0}^{t_i}r_s ds}\right]$$

Similarly, the pay leg follows:

$$PayLeg(USD) = \mathbb{E}\left[\sum_{i=0}^{M_p}(N_p^{EUR}(t_i)s_p + F_p)\cdot e^{-\int_{t_0}^{t_i}r_s ds}\cdot X_{t_i}^{USD/EUR}\right]$$

The option is only entered at exercise date, $t_{ex}$, when

$$Remaining PayLeg(t_{ex}) - Remaining RecLeg(t_{ex}) > K \cdot X_{t_{ex}}^{USD/EUR}$$

Here:

- $N_r^{USD}(t_i), N_p^{EUR}(t_i)$ is the time-dependent notional of the receive and pay legs.
- $M_r, M_p$ are the number of cashflows on the receive and pay legs, respectively.
- $s_r, s_p$ are the fixed rates of the legs.
- $F_r, F_p$ are the fixed cash flows of the legs.
- $r_s$ is the domestic (USD) rate.
- $X_{t_i}^{USD/EUR}$ is the USD/EUR FX rate at $t_i$.
- $K$ is the strike (in EUR).

* LTFXParForwardKnockOut: This trade receives a fixed rate of 1 JPY on a quarterly basis on a notional of 12.585 M JPY, and pays a fixed rate of 1 USD quarterly on a notional of 0.15 M USD. The pay leg is converted to JPY.

There is a CONTINUOUSKOLEG UPPER barrier on both legs with a strike of 120 JPY/USD, starting from 27/04/2021 and applied every month until 28/06/2024. The trade starts on 21/04/2021, ends on 30/06/2024 (3yrs), and the valuation date is 09/12/2021. The domestic rate is JPY and foreign is USD.

The receive leg payoff is summarised as:

$$RecLeg(JPY) = \mathbb{E}\left[N_r^{JPY}\sum_{i=0}^{M_r}\mathbb{I}(X_{t_i}^{JPY/USD} < 120)\cdot e^{-\int_{t_0}^{t_i}r_s ds}\right]$$

Similarly, the pay leg follows:

$$PayLeg(JPY) = \mathbb{E}\left[\sum_{i=0}^{M_p}N_p^{USD}\cdot\mathbb{I}(X_{t_i}^{JPY/USD} < 120)\cdot e^{-\int_{t_0}^{t_i}r_s ds}\cdot X_{t_i}^{JPY/USD}\right]$$

Here:

- $N_r^{JPY}, N_p^{USD}$ is the notional of the receive and pay legs.
- $M_r, M_p$ are the number of cashflows on the receive and pay legs, respectively.
- $X_{t_i}^{JPY/USD}$ is the JPY/USD FX rate at $t_i$.
- $r_s$ is the domestic (JPY) rate.

* PRDCSwapCallableKORedemptionStrike This trade receives the JPY 6m-LIBOR with a spread of -0.0001 on a notional of 100 M JPY, and annually pays the sum of a fixed rate of -0.25 on a notional of 110 M JPY and a fixed rate of 0.3 on a notional of 1.178992 M AUD, that is converted to JPY. There is also a time-dependent cap and floor on the pay coupons, with the first four cashflows capped and floored to 11, and the remaining cashflows capped at 9.35 and floored to 0.

There is a time-dependent upper KO barrier on the pay leg that is checked yearly, on the JPY/AUD FX rate from 102.9 down to 76.9, starting on 28/07/2011 and ending on 28/07/28. If the trade is not knocked out, it receives 100 M JPY and pays 1.287 AUD on the end date.

The trade itself starts on 11/08/2008 and ends on 12/08/2038 (30yrs), and the valuation date is 09/12/2021.

There is a Bermudan LONG CANCEL option that can be exercised on two dates 20090812 and 20100812 with two strikes of both of 0 JPY. ValuationDate is past the exercise dates, so this feature is irrelevant.

The receive leg payoff is summarised as:

$$RecLeg(JPY) = \mathbb{E}\left[N_r^{JPY}\sum_{i=0}^{M_r}(L_{6m}^{JPY}(t_i) + s_r)\cdot\mathbb{I}(X_{t_i}^{JPY/AUD} < B_i)\cdot e^{-\int_{t_0}^{t_i}r_s ds}\right]$$

Similarly, the pay leg follows:

$$PayLeg(JPY) = \mathbb{E}\left[\sum_{i=0}^{M_p}CF\left((N_{p1}^{JPY}s_{p1}) + (N_{p2}^{AUD}s_{p2}\cdot X_{t_i}^{JPY/AUD})\right)\cdot\mathbb{I}(X_{t_i}^{JPY/AUD} < B_i)\cdot e^{-\int_{t_0}^{t_i}r_s ds}\right]$$

Here:

- $N_r^{JPY}, N_{p1}^{JPY}, and N_{p2}^{AUD}$ is the notional of the receive leg, and the two notionals on the pay leg.
- $M_r, M_p$ are the number of cashflows on the receive and pay legs, respectively.
- $L_{6m}^{JPY}(t_i)$ is the JPY 6m-LIBOR.
- $s_r$ is the spread on the JPY LIBOR.
- $s_{p1}$ and $s_{p2}$ are the two fixed rates on the pay leg, on the JPY and AUD notionals.
- $X_{t_i}^{JPY/AUD}$ is the JPY/AUD FX rate at $t_i$.
- $B_i$ is the time-dependent KO barrier.
- $r_s$ is the domestic (JPY) rate.
- $CF(x)$ is the cap and floor on coupon, $x$. $CF(x) = max(min(x, F), C)$, where $C$ and $F$ are the values for the cap and floor.

#### 4.1.2 Stochastic Rates Impact: 
DBX-ShortRate_FXSkewStochVol vs. DBX-RateDeterministic_FXSkewStochVol

In this section, we test the effect of stochastic interest rates by comparing the DBX-ShortRate_FXSkewStochVol and DBX-RateDeterministic_FXSkewStochVol models for different products. RateDeterministic dictionaries are created by removing the IR MODELVOL and DBOPTVOL objects.

![Figure 2: PV of IRFXSwapFXKnockOut as a function of a) domestic IR shifts, b) foreign IR shifts, c) FX spot shifts and d) FX volatility shifts for stochastic and deterministic interest rates. The grey dashed line illustrates the difference in PV between the ShortRate and RateDeterministic models. There is a small difference in PV when the IR volatility is removed.](./Fig/2.png)

![Figure 3: PV of IRSwaptionXCcyBerm as a function of a) domestic IR shifts, b) foreign IR shifts, c) FX spot shifts and d) FX volatility shifts for stochastic and deterministic interest rates. The grey dashed line illustrates the difference in PV between the ShortRate and RateDeterministic models. There is a small difference in PV when the IR volatility is removed.](./Fig/3.png)

![Figure 4: PV of LTFXParForwardKnockOut as a function of a) domestic IR shifts, b) foreign IR shifts, c) FX spot shifts and d) FX volatility shifts for stochastic and deterministic interest rates. The grey dashed line illustrates the difference in PV between the ShortRate and RateDeterministic models. There is a small difference in PV when the IR volatility is removed.](./Fig/4.png)

#### 4.1.3 FX Volatility and Stochastic FX Volatility Impact:
DBX-RateDeterministic_FXDeterministic vs. DBX-ShortRate_FXSkew vs. DBX-ShortRate_FXSkewStochVol

In this section, we test the effect of FX volatility and stochastic FX volatility by comparing the original DBX-ShortRate_FXSkewStochVol model to DBX-ShortRate_FXSkew and DBX-ShortRate_FXDeterministic for different products. DBX-ShortRate_FXSkew dictionaries are created by removing the STOCHVOL DEMVOL object, and the DBX-RateDeterministic_FXDeterministic dictionaries are created from DBX-ShortRate_FXSkew by shifting the IR and FX volatilities to 0.0001% of its original value[^1] and setting its correlation between volatilities to 0.

[^1]: *DBAnalytics throws an error if the FX vol object is removed.

![Figure 5: PV of PRDCSwapCallableKORedemptionStrike as a function of a) domestic IR shifts, b) foreign IR shifts, c) FX spot shifts and d) FX volatility shifts for stochastic and deterministic interest rates. The grey dashed line illustrates the difference in PV between the ShortRate and RateDeterministic models. There is a small difference in PV when the IR volatility is removed.](./Fig/5.png)

![Figure 6: PV of IRFXSwapFXKnockOut as a function of a) domestic IR shifts, b) foreign IR shifts, c) FX spot shifts and d) FX volatility shifts for stochastic volatility, local volatility and deterministic FX. The grey dashed line illustrates the difference in PV between the FXSkewStochVol and FXSkew models. There is a small difference in PV when the FX stochastic volatility is removed, but a significant change when the FX volatility is removed.](./Fig/6.png)

![Figure 7: PV of IRSwaptionXCcyBerm as a function of a) domestic IR shifts, b) foreign IR shifts, c) FX spot shifts and d) FX volatility shifts for stochastic volatility, local volatility and deterministic FX. The grey dashed line illustrates the difference in PV between the FXSkewStochVol and FXSkew models. There is a small difference in PV when the FX stochastic volatility is removed, but a significant change when the FX volatility is removed. When the FX volatility is removed, the trade never enters the swap in the IRSwaptionXCcyBerm, and therefore $PV = -RightToEnter(PayLeg - RecLeg) = 0$.](./Fig/7.png)

![Figure 9: PV of PRDCSwapCallableKORedemptionStrike as a function of a) domestic IR shifts, b) foreign IR shifts, c) FX spot shifts and d) FX volatility shifts for stochastic volatility, local volatility and deterministic FX. The grey dashed line illustrates the difference in PV between the FXSkewStochVol and FXSkew models. There is a small difference in PV when the FX stochastic volatility is removed, but a significant change when the FX volatility is removed.](./Fig/9.png)

#### 4.1.4 Sensitivity to Exogenously-Set Parameters

There are a number of exogenously-set parameters in this model and this section tests the PV impact of changes in these parameters. Sensitivity to these parameters are covered by the following limitation:

Calibration/[Model Calibration Uncertainty][FXSkewStochVol]: The calibration process may opt to exogenously set some of the model parameters instead of calibrating them to market observables (examples: MeanRevSV and LocaVolsSV of SV component, or MeanRev for Rates, where applicable). Therefore, the choice of these parameters should be monitored by GVG on a regular basis and uncertainty reserves should be computed, if deemed necessary. Id = 3809.

The following parameters are set exogenously:

* Mean reversion level of the interest rates, $k_i(t)$ (set by the STRATS)

$$dr_i^t = [\theta_i(t) - k_i(t)r_i^t] dt + \sigma_i(t)dW_i^t, \quad i \in \{d, f\}$$

* Mean reversion ($h_0$), long term local vol ($τ_{LT}$), and the decay ($d$) parameters of the FX stochastic volatility. These parameters compute the stochastic volatility of the FX, $τ(t)$, which below $T_0$ (the first TermVol time peg) is defined as,

$$τ(t)^2 = LV(T_0)^2 = TV(T_0)^2 \cdot \frac{2h_0T_0}{1 - \exp(-2h_0T_0)},$$

and greater than $T_0$, it follows,

$$τ(T_i) = LV(T_i) = τ_{LT} + (LV_0 - τ_{LT})\exp\left(-\frac{T_i - T_0}{d}\right)$$

##### 4.1.4.1 IRFXSwapFXKnockOut

Figure 10 shows the impact on price from shifts in the mean reversion level for the a) domestic and b) foreign rates, c) mean reversion, $h_0$, d) long term local vol, $τ_{LT}$, and e) the decay, $d$, parameters of the FX stochastic volatility.

![Figure 10: PV of IRFXSwapFXKnockOut as a function of shifts in the mean reversion level for the a) domestic and b) foreign rates, and c) mean reversion, $h_0$, d) long term local vol, $τ_{LT}$, and e) the decay, $d$, parameters of the FX stochastic volatility. The grey dashed line shows the market PV of the trade. There is a small difference in PV when each of these parameters is bumped.](./Fig/10.png)

##### 4.1.4.2 IRSwaptionXCcyBerm

Figure 11 shows the impact on price from shifts in the mean reversion level for the a) domestic and b) foreign rates, c) mean reversion, $h_0$, d) long term local vol, $τ_{LT}$, and e) the decay, $d$, parameters of the FX stochastic volatility.

![Figure 11: PV of IRSwaptionXCcyBerm as a function of shifts in the mean reversion level for the a) domestic and b) foreign rates, and c) mean reversion, $h_0$, d) long term local vol, $τ_{LT}$, and e) the decay, $d$, parameters of the FX stochastic volatility. The grey dashed line shows the market PV of the trade. There is a small difference in PV when each of these parameters is bumped.](./Fig/11.png)

##### 4.1.4.3 LTFXParForwardKnockOut

Figure 12 shows the impact on price from shifts in the mean reversion level for the a) domestic and b) foreign rates, c) mean reversion, $h_0$, d) long term local vol, $τ_{LT}$, and e) the decay, $d$, parameters of the FX stochastic volatility.

![Figure 12: PV of LTFXParForwardKnockOut as a function of shifts in the mean reversion level for the a) domestic and b) foreign rates, and c) mean reversion, $h_0$, d) long term local vol, $τ_{LT}$, and e) the decay, $d$, parameters of the FX stochastic volatility. The grey dashed line shows the market PV of the trade. There is a small difference in PV when each of these parameters is bumped.](./Fig/12.png)

##### 4.1.4.4 PRDCSwapCallableKORedemptionStrike

Figure 13 shows the impact on price from shifts in the mean reversion level for the a) domestic and b) foreign rates, c) mean reversion, $h_0$, d) long term local vol, $τ_{LT}$, and e) the decay, $d$, parameters of the FX stochastic volatility.

![Figure 13: PV of PRDCSwapCallableKORedemptionStrike as a function of shifts in the mean reversion level for the a) domestic and b) foreign rates, and c) mean reversion, $h_0$, d) long term local vol, $τ_{LT}$, and e) the decay, $d$, parameters of the FX stochastic volatility. The grey dashed line shows the market PV of the trade. There is a small difference in PV when each of these parameters is bumped.](./Fig/13.png)

## 4.2 Product Testing: IRFXSwapFXKnockOut

The testing in this section is done in Q2 2023 in model configuration

$$ DBX-ShortRate[LVMIRA.ro]_FXSkewStochVol[DLVAUTO] $$

using DBAnalytics version 1230.

### 4.2.1 Product Description

The product consists of two legs with the same EffectiveDate (start date) 16/08/2017 and EndDate 16/08/2027.

* The receiver leg pays with quarterly frequency floating coupons depending on USD LIBOR 3M. There is an upper barrier at each pay date between 16/08/2022 and 16/08/2027 on JPY/USD FX rate, and payments are only made if the FX rate is below the barrier on the pay date.

$$L_{USD}^{3m}(T_n) * \tau_n\mathbb{1}(S_{T_n}<K_r)$$

where $L_{USD}^{3m}$ is the USD LIBOR 3M, $\tau_n = T_n - T_{n-1}$, $K_r$ represents the upper barrier on the receive leg ($K_r = 0$) and $S_{T_n}$ represents the JPY/USD FX rate at $T_n$.

* The pay leg pays with semi-annual frequency a constant spread equal to 0.025. Between 16/08/2022 and 16/08/2027 an upper barrier is set in place at each pay date and the payments are made only if the JPY/USD spot rate stays below the barrier at each pay date i.e. the net cash flow on the pay leg at each pay date $T_n$ is given by:

$$0.025 * \tau_n\mathbb{1}(S_{T_n}<K_p)$$

where $K_p$ represents the upper barrier on the pay leg ($K_p = 110$).

Each leg's notional is equal to USD 10M. Note that although both legs are USD denominated, the PV and risk sensitivities are reported in JPY (which is defined as the domestic market) i.e. a conversion in JPY is performed.

![Figure 14: Left: PV of IRFXSwapFXKnockOut as function of barrier (denoted as FX Strike) applied to the FX spot rate. The FX spot rate is less likely to reach the barrier value as the barrier value increases. This implies that the pay leg's coupons are more likely to be paid, thus decreasing the total PV of the product which is given by RecLegPV - PaylegPV.](./Fig/14.png)

| PV | JPY DELTA | USD DELTA | JPY VEGA | USD VEGA | FXDELTA | FXVEGA | FXGAMMA | Corr Sens. |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| -45,336,275.97 | -56,337.09 | -6,624.95 | -6,276.92 | 43,984.31 | 11,226,839.91 | -416,760.472 | -1,152,905.20 | 34,961.09 |

Table 41: IRFXSwapFXKnockOut: PV and main risk sensitivities calculated in EOD scenario. We can see that the main risk factors are the FX spot rate and the volatility of the FX rate. The PV and risk sensitivities are reported in JPY (domestic market).

The dictionary has been tested against the model rules submitted for approval,

| Property | Value |
| --- | --- |
| MVModelName | DBX-ShortRate_FXSkewStochVol |
| DB_RiskProduct | IRFXSwapFXKnockOut |
| ModelRule Filter Name | PARAMCONTROL |
| ModelRule Filter Version | 20230602 |
| ModelRuleStatus | PASS |

### 4.2.2 Monte Carlo convergence: Price and Risk Sensitivities

We first carry out testing to ensure that he product's PV and main risk sensitivities are robust as the parameters relevant for the Monte Carlo simulation are varied. We fix all the DBX model parameters and vary only the number of simulations for different Seed parameters. The product displays a good convergence, with PV and risk sensitivities reaching their asymptotic values after 5-10k paths. Similar Monte-Carlo convergence tests can be found in DBAnalytics testing document [1].

The market trade has the following parameters for the DBX model,

| Parameter | Value |
| --- | --- |
| NumberSims | 15000 |
| NumberRuns | 1 |
| FrontLatticeFreq | 96 |
| FreqTimeVec | 12 |
| IntegrationFreq | 365 |

The convergence results are shown in Figures 15 and 16 for price and all risk sensitivities. We see that all estimates converge to stable values.

![Figure 15: a) Price, b) Flat Delta - JPY, c) FX Delta, d) Flat Delta - USD, e) FX Gamma, and f) FX Vega estimates for the IRFXSwapFXKnockOut trade as a function number of simulations in the Monte Carlo (DBX) model. The price and risk sensitivities all converge to stable values.](./Fig/15.png)

![Figure 16: a) Flat Vega - JPY, and b) Flat Vega - USD for the IRFXSwapFXKnockOut trade as a function number of simulations in the Monte Carlo (DBX) model. The Flat Vega values converge to a stable value.](./Fig/16.png)

### 4.2.3 Correlation Sensitivity

Figure 17 shows the PV impact of correlation between the FX volatility and domestic/foreign IR volatility for the IRFXSwapFXKnockOut product, with and without the KnockOut feature (IRFXSwap). When the KnockOut feature is removed from the product, the impact of correlation is not significant.

![Figure 17: Price as a function of the correlation between the JPY/USD FX volatility and the domestic/foreign IR volatility for the IRFXSwapFXKnockOut, with and without the KnockOut feature (IRFXSwap). Correlation has a greater impact on price when the trade has the KnockOut feature than without.](./Fig/17.png)

This trade has a path-dependent KnockOut feature on the FX rate, and therefore it is highly sensitive to the FX volatility (see Figure 40). Increases in this risk factor leads to an increase in the survivability of the pay leg. It also has a non-zero positive correlation between the FX volatility and the rates volatility. Therefore shifts in the domestic or foreign IR volatility will have an impact on the forward FX and thus on the overall PV. When the KnockOut feature is removed, the impact of IR volatility is reduced, see Figure 18.

| STRADDLE | 100 | 2y | 20270816 | 0.015721 | 0.000271 | 0.000271 | -1.5801996-11 | 1.065004 | 1.065004 | -7.814941e-08 |

Table 45: Summary of autocalibration results for the foreign (USD) IR volatility.

| Maturity | Delta | TargetVol | EffectVol | FitError |
| --- | --- | --- | --- | --- |
| 20220310 | DN | 0.071549 | 0.071549 | 4.703928e-11 |
| 20220310 | 25RR | -0.010227 | -0.010227 | -4.08022e-11 |
| 20220310 | 10CVX-DN | 0.004082 | 0.004082 | -4.84366e-10 |
| 20220609 | DN | 0.071604 | 0.071604 | 8.24459e-11 |
| 20220609 | 25RR | -0.010260 | -0.010260 | -5.30889e-11 |
| 20220609 | 10CVX-DN | 0.010244 | 0.010244 | -5.91682e-10 |
| 20221209 | DN | 0.071497 | 0.071497 | 2.04211e-10 |
| 20221209 | 25RR | -0.009942 | -0.009942 | -7.13091e-11 |
| 20221209 | 10CVX-DN | 0.012409 | 0.012409 | -1.10572e-09 |
| 20511211 | DN | 0.114448 | 0.114448 | 8.82116e-11 |
| 20511211 | 25RR | -0.049451 | -0.049451 | -6.93128e-11 |
| 20511211 | 10CVX-DN | 0.025009 | 0.025009 | -7.89991e-10 |

Table 46: Summary of autocalibration results for the JPY/USD FX volatility.

#### 4.2.4.2 Sensitivity to Initial Guesses used for Parameters

The LocalVols are set to a flat value of 28.855 bps for the full term structure. In this section, we test the sensitivity of the calibration results for initial flat values in {1, 5, 10, 50, 100, 500} bps. The calibration should be robust to our choice in initial LVs, and this is evident by the difference in implied volatility and prices between the market and model, given in Tables 47 and 48 for the JPY IR vol, and 49 and 50 for the USD IR vol.

| OptionMat | Tenor | Strike | VolDiff (1 bps) | VolDiff (5 bps) | VolDiff (10 bps) | VolDiff (50 bps) | VolDiff (100 bps) | VolDiff (500 bps) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1y | 20270816 | 0.000280 | -7.19712e-14 | -7.19712e-14 | -7.19712e-14 | -1.30004e-11 | -3.29100e-13 | -1.29066e-11 |
| 18m | 20270816 | 0.000258 | -2.58500e-13 | -2.58500e-13 | -2.58500e-13 | -6.82197e-11 | -1.84597e-12 | -6.82157e-11 |
| 2y | 20270816 | 0.000300 | 2.89667e-13 | 2.89667e-13 | 2.89667e-13 | -4.16877e-11 | -2.40337e-12 | -4.16602e-11 |
| 3y | 20270816 | 0.000347 | -1.67349e-13 | -1.67349e-13 | -1.67349e-13 | -7.67679e-11 | -2.79155e-12 | -7.67611e-11 |
| 4y | 20270816 | 0.000424 | -9.11482e-12 | -9.11482e-12 | -9.11482e-12 | -6.94531e-11 | -1.59487e-12 | -8.84577e-11 |
| 5y | 20270816 | 0.000432 | -8.24410e-12 | -8.24410e-12 | -8.24410e-12 | -6.12461e-11 | -4.70852e-11 | -6.12451e-11 |

Table 47: Difference in implied volatility between the market and model for different starting LocalVols in the domestic (JPY) IR vol object.

| OptionMat | Tenor | Strike | PriceDiff (1 bps) | PriceDiff (5 bps) | PriceDiff (10 bps) | PriceDiff (50 bps) | PriceDiff (100 bps) | PriceDiff (500 bps) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1y | 20270816 | 0.000280 | -2.6943e-11 | -2.6943e-11 | -2.6943e-11 | 4.86839e-11 | -1.23904e-10 | -4.9056e-10 |
| 18m | 20270816 | 0.000258 | -1.05877e-10 | -1.05877e-10 | -1.05877e-10 | -2.78419e-08 | -7.56078e-10 | -2.7943e-09 |
| 2y | 20270816 | 0.000300 | 1.20614e-10 | 1.20614e-10 | 1.20614e-10 | 3.42893e-08 | -1.16764e-09 | -3.45873e-09 |
| 3y | 20270816 | 0.000347 | -6.22001e-11 | -6.22001e-11 | -6.22001e-11 | -2.85441e-08 | -1.03354e-09 | -2.85443e-09 |
| 4y | 20270816 | 0.000424 | -2.45483e-09 | -2.45483e-09 | -2.45483e-09 | -1.87037e-08 | -4.29431e-10 | -1.87020e-09 |
| 5y | 20270816 | 0.000432 | -1.00904e-09 | -1.00904e-09 | -1.00904e-09 | -7.49578e-09 | -3.76303e-09 | -7.49514e-09 |

Table 48: Difference in price between the market and model for different starting LocalVols in the domestic (JPY) IR vol object.

| OptionMat | Tenor | Strike | VolDiff (1 bps) | VolDiff (5 bps) | VolDiff (10 bps) | VolDiff (50 bps) | VolDiff (100 bps) | VolDiff (500 bps) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1y | 20270816 | 0.015615 | -1.58558e-13 | -1.58558e-13 | -1.58558e-13 | 9.30510e-13 | 3.23689e-13 | -1.26541e-12 |
| 18m | 20270816 | 0.015613 | -1.06919e-12 | -1.06919e-12 | -1.06919e-12 | 4.97574e-12 | 1.11673e-12 | -8.83071e-11 |
| 2y | 20270816 | 0.016712 | -1.51691e-12 | -1.51691e-12 | -1.51691e-12 | -9.74891e-12 | 6.51106e-12 | -1.62328e-11 |
| 3y | 20270816 | 0.016588 | -6.70426e-12 | -6.70426e-12 | -6.70426e-12 | -5.63979e-12 | -2.72615e-12 | -1.56925e-11 |
| 4y | 20270816 | 0.016560 | -7.49081e-11 | -7.49081e-11 | -7.49081e-11 | -1.85917e-11 | 2.74707e-12 | -1.13922e-11 |
| 5y | 20270816 | 0.016721 | -1.80713e-10 | -1.80713e-10 | -1.80713e-10 | 9.55663e-12 | 2.99405e-11 | -1.93371e-10 |

Table 49: Difference in implied volatility between the market and model for different starting LocalVols in the foreign (USD) IR vol object.

| OptionMat | Tenor | Strike | PriceDiff (1 bps) | PriceDiff (5 bps) | PriceDiff (10 bps) | PriceDiff (50 bps) | PriceDiff (100 bps) | PriceDiff (500 bps) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1y | 20270816 | 0.015615 | -5.71818e-11 | -5.71818e-11 | -5.71818e-11 | 3.35378e-10 | 1.16842e-10 | -4.5171e-10 |
| 18m | 20270816 | 0.015613 | -4.20454e-10 | -4.20454e-10 | -4.20454e-10 | 1.64576e-09 | 4.36573e-10 | -3.50982e-09 |
| 2y | 20270816 | 0.016712 | -6.04194e-10 | -6.04194e-10 | -6.04194e-10 | -3.87296e-09 | 2.60134e-09 | -6.50570e-09 |
| 3y | 20270816 | 0.016588 | -2.36812e-09 | -2.36812e-09 | -2.36812e-09 | -1.99109e-09 | -9.62497e-10 | -5.51961e-09 |
| 4y | 20270816 | 0.016560 | -1.90188e-08 | -1.90188e-08 | -1.90188e-08 | -4.71347e-09 | 6.96421e-10 | -2.88207e-09 |
| 5y | 20270816 | 0.016721 | -1.84637e-08 | -1.84637e-08 | -1.84637e-08 | 1.00551e-09 | 3.44037e-09 | -2.22180e-08 |

Table 50: Difference in price between the market and model for different starting LocalVols in the foreign (USD) IR vol object.

#### 4.2.4.3 DLV Calibration

We use the following DLV parameters in the MODEL object to improve the quality of calibration fit:

| Parameter | Value |
| --- | --- |
| NumberSims | 10000 |
| MaxIter | 0 |
| FrontLatticeFreq | 96 |
| IntegrationFreq | 365 |
| DLVCalibration | ALL |
| DLVCalibrationType | SIMPLE-SMOOTH |

FXSkewStochVol[DLVAuto] Figure 19 shows the comparison between the market implied volatility, fitted using a SA4 parametric function, and the DLV for options at different maturities. The SA4 parametric function is fitted using the DBSMC-RateDeterministic_FXMarket model. There is a good quality of fit between DLV and the parametric implied volatility.

![Figure 19: Comparison between the market implied volatility for the JPY/USD FX rate computed using the DBSMC-RateDeterministic_FXMarket model and the Dupire local volatility (DLV) at option maturities of a) 3m, b) 6m, c) 1y, d) 5y, e) 10y and f) 30y.](./Fig/19.png)

### 4.2.5 EOD Testing: Price and Risk Sensitivities

#### 4.2.5.1 Domestic IR Curve Shifts

We examine the behaviour of the product's PV under parallel shifts of the domestic (JPY) interest rate curve in Figures 20 and 21.

![Figure 20: a) Total PV, b) RecPV, and c) PayPV as a function of parallel shifts of the domestic (JPY) curve. The behavior of the overall PV is dominated by the pay leg. An upward shift of the domestic rate (JPY) leads to an increase in the JPY/USD FX rate and thus the pay cash flows are less likely to survive the knockout barrier (K_p = 110). This leads to a decrease in the PayPV, and therefore an increase in the overall price (Price = -RightToEnter(RecPV - PayPV)). For the receive leg, the KO barrier is far below JPY/USD FX rate, and therefore shifts of the JPY curve have minimal impact on the RecPV and overall price. See Figure 21 for an in-depth analysis.](./Fig/20.png)

![Figure 21: a) JPY/USD FX forward rate at each pay leg date for JPY curve shifts in {-0.05, 0, 0.05}. The dashed line indicates the FX upper barrier on the pay leg. When the JPY curve is shifted up, the forward FX rate is much higher the pay/leg KO barrier. Survival probability of the cash flows on the b) receive, and c) pay legs. The KO barrier comes into effect on 16/08/2022, thus the first three cashflows on the receive leg, and the first two cash flows on the pay leg are largely unaffected by JPY shifts. After the first barrier date, all cash flows on the receive leg are knocked out since the barrier is 0 JPY/USD, and the survival probability on the pay leg drops as the JPY curve is shifted up. The final two figures show the resulting cash flows on the d) receive, and e) pay legs.](./Fig/21.png)

Figures 22 and 23 show the PV and main risk sensitivities as a function of the domestic (JPY) interest rate curve.

The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 22: a) Price, b) JPY/USD FX Delta, c) Flat Delta - JPY, d) Flat Delta - USD, e) JPY/USD FX Vega, and f) JPY/USD FX Gamma as a function of parallel shifts of the domestic (JPY) IR curve. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/22.png)

![Figure 23: a) Flat Vega - JPY, and b) Flat Vega - USD as a function of parallel shifts of the domestic (JPY) IR curve.](./Fig/23.png)

#### 4.2.5.2 Foreign IR Curve Shifts

We examine the behaviour of the product's PV under parallel shifts of the foreign (USD) interest rate curve in Figures 24 and 25.

![Figure 24: a) Total PV, b) RecPV, and c) PayPV as a function of parallel shifts of the foreign (USD) curve. Inverse to domestic curve shifts, an upward shift of the foreign rate (USD) leads to a decrease in the JPY/USD FX rate and thus the pay cash flows are more likely to survive the knockout barrier (K_p = 110). This leads to an increase in the PayPV. For the receive leg, the RecPV also increases since USD LIBOR-3m rate increases. Initially, the rate of increase of the PayPV is less than the RecPV, so the overall PV rises, but eventually PayPV rises faster than RecPV and this leads to a drop in price. The non-linearity of the PayPV is due to the KO survival probability. See Figure 25 for an in-depth analysis.](./Fig/24.png)

![Figure 25: a) USD LIBOR-3m rate at each receive leg date for USD curve shifts in {-0.05, 0, 0.05}. When the USD curve is shifted up, the USD LIBOR-3m also shifts up. b) JPY/USD FX forward rate at each pay leg date. The dashed line indicates the FX upper barrier on the pay leg. When the USD curve is shifted up, the forward FX rate drops below the pay/leg KO barrier. Survival probability of the cash flows on the b) receive, and c) pay legs. As before, all cash flows after the first barrier date on the receive leg are knocked out, and the survival probability on the pay leg rises as the USD curve is shifted up. The absolute difference in survival probability is greater for upward USD curve shifts, than downward shifts. The final two figures show the resulting cash flows on the d) receive, and f) pay legs.](./Fig/25.png)

Figures 26 and 27 show the PV and main risk sensitivities as a function of the foreign (USD) interest rate curve.

![Figure 26: a) Price, b) JPY/USD FX Delta, c) Flat Delta - JPY, d) Flat Delta - USD, e) JPY/USD FX Vega, and f) JPY/USD FX Gamma as a function of parallel shifts of the foreign (USD) IR curve. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/26.png)

![Figure 27: a) Flat Vega - JPY, and b) Flat Vega - USD as a function of parallel shifts of the foreign (USD) IR curve.](./Fig/27.png)

#### 4.2.5.3 Domestic IR Volatility Shifts

We examine the behaviour of the product's PV under relative shifts of the domestic (JPY) IR volatility in Figures 28 and 29.

![Figure 28: a) Total PV, b) RecPV, and c) PayPV as a function of relative shifts of the domestic (JPY) IR volatility. The behavior of the overall PV is dominated by the pay leg. An upward shift of the domestic (JPY) IR volatility leads to a small decrease in the JPY/USD FX rate at later dates and thus the pay cash flows are more likely to survive the knockout barrier (K_p = 110). This leads to an increase in the PayPV, and therefore a decrease in the overall price (Price = -RightToEnter(RecPV - PayPV)). For the receive leg, shifts of the JPY IR volatility have minimal impact on the RecPV and overall price. See Figure 29 for in-depth analysis.](./Fig/28.png)

![Figure 29: a) JPY/USD FX forward rate at each pay leg date for JPY IR vol shifts in {-0.95, 0.53, 2.0}. The dashed line indicates the FX upper barrier on the pay leg. When the JPY IR volatility is shifted up, the forward FX rate at later dates decreases slightly - this can be seen more clearly in Table 52. The next two figures show the survival probability on the pay leg for b) all cashflows, and c) zoomed in on the later cashflows. There is a small increase in the later survival probabilities at higher volatility, corresponding to the drop in FwdFX. The final two figures show the resulting cash flows on d) all cashflows, and e) later cashflows. JPY IR volatility is only a minor risk factor for this trade.](./Fig/29.png)

| Pay Date (yrs) | FwdFX (-95%) | FwdFX (200%) | FwdFX - Diff |
| --- | --- | --- | --- |
| 0.189041 | 113.359714 | 113.359692 | -0.000023 |
| 0.684932 | 113.049989 | 113.049897 | -0.000092 |
| 1.189041 | 112.465848 | 112.465702 | -0.000146 |
| 1.684932 | 111.626232 | 111.625966 | -0.000266 |
| 2.189041 | 110.572590 | 110.572209 | -0.000381 |
| 2.687671 | 109.454537 | 109.454034 | -0.000504 |
| 3.197260 | 108.329790 | 108.328903 | -0.000887 |
| 3.693151 | 107.232162 | 107.231181 | -0.000981 |
| 4.194521 | 106.143497 | 106.142184 | -0.001313 |
| 4.690411 | 105.062623 | 105.061180 | -0.001444 |
| 5.191781 | 103.982512 | 103.980646 | -0.001866 |
| 5.687671 | 102.898990 | 102.897021 | -0.001969 |

Table 52: The JPY/USD FwdFX rate at each pay date, after a -95% JPY vol shift, a 200% JPY vol shift, and the difference between the 200% and 95% shift. The difference is negative because the forward FX rate decreases with increasing JPY vol.

Figures 30 and 31 show the PV and main risk sensitivities as a function of the domestic (JPY) interest rate volatility. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 30: a) Price, b) JPY/USD FX Delta, c) Flat Delta - JPY, d) Flat Delta - USD, e) JPY/USD FX Vega, and f) JPY/USD FX Gamma as a function of relative shifts of the domestic (JPY) IR volatility. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/30.png)

#### 4.2.5.4 Foreign IR Volatility Shifts

![Figure 32: a) Total PV, b) RecPV, and c) PayPV as a function of relative shifts of the foreign (USD) IR volatility. An upward shift of the foreign (USD) IR volatility leads to a small increase in the later JPY/USD FX forward rates and thus the pay cash flows are less likely to survive the knockout barrier (K_p = 110). This leads to a decrease in the PayPV. The receive leg only consists of the first three cash flows which are dependent on the USD LIBOR-3m. When the USD IR volatility increases, there is a small increase in the USD LIBOR and therefore RecPV rises. The rate of increase of RecPV is smaller than the decrease in PayPV, therefore the overall PV increases at a declining rate. See Figure 33 for in-depth analysis.](./Fig/32.png)

![Figure 33: a) JPY/USD FX forward rate at each pay leg date for USD IR vol shifts in {-0.95,0.53,2.0}. The dashed line indicates the FX upper barrier on the pay leg. When the USD IR volatility is shifted up, the forward FX increases slightly at later dates. The next two figures show the survival probability on the pay leg for b) all cashflows, and c) zoomed in on the later cashflows. There is a small decrease in the later survival probabilities at higher volatility, corresponding to the rise in FwdFX. The final two figures show the resulting cash flows on d) all cashflows, and e) later cashflows. USD IR volatility is also only a minor risk factor for this trade.](./Fig/33.png)

| Pay Date (yrs) | Rate (-95%) | Rate (53%) | Rate (200%) | PVLet (-95%) | PVLet (53%) | PVLet (200%) | PVLet - Diff |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 0.189041 | 0.001550 | 0.001550 | 0.001550 | 0.449022 | 0.449022 | 0.449022 | 0.000000 |
| 0.432877 | 0.002518 | 0.002519 | 0.002521 | 0.705008 | 0.705281 | 0.705645 | 0.000637 |
| 0.684932 | 0.004461 | 0.004462 | 0.004464 | 1.288938 | 1.289277 | 1.289748 | 0.000809 |

Table 53: This table shows the USD LIBOR-3m and the resulting receive leg cashflows (PVLet) for USD IR vol shifts in {-0.95, 0.53, 2.0}. The final column shows the difference in PVLet between the 200% and -95% shifts. Only the first three cashflows are shown, since the rest are knocked out. We see only small increase in the USD LIBOR as a function of USD IR volatility shifts.

Figures 34 and 35 show the PV and main risk sensitivities as a function of the foreign (USD) interest rate volatility. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 34: a) Price, b) JPY/USD FX Delta, c) Flat Delta - JPY, d) Flat Delta - USD, e) JPY/USD FX Vega, and f) JPY/USD FX Gamma as a function of relative shifts of the foreign (USD) IR volatility. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/34.png)

![Figure 35: a) Flat Vega - JPY, and b) Flat Vega - USD as a function of relative shifts of the foreign (USD) IR volatility.](./Fig/35.png)

#### 4.2.5.5 FX Spot Shifts

We examine the behaviour of the product's PV under relative shifts of the JPY/USD FX spot rate in Figures 36 and 37.

![Figure 36: a) Total PV, b) RecPV, and c) PayPV as a function of relative shifts of the JPY/USD FX spot rate. An upward shift of the JPY/USD FX spot rate causes JPY/USD FX forward rates to also increase. Since the pay leg of the trade is currently ATM, even a small increase in the FX spot, causes the forward FX rates to be far above the barrier, and therefore all the pay cash flows knock out. This causes a drop in the PayPV around the 0 shift. The PayPV subsequently rises because the first two cash flows (which are not KO) are multiplied by an increasing FX forward rate. When the FX spot is shifted down, all of the pay cashflows survive the barrier and the PayPV peaks, then any further downshifts of the FX spot causes the pay cashflows to decrease since they are multiplied by a smaller FX forward in the USD-to-JPY currency conversion. For the receive leg, the first three cashflows (not KO) are multiplied by an increasing FX rate, hence there is a rise in RecPV. See Figure 37 for in-depth analysis.](./Fig/36.png)

![Figure 37: a) JPY/USD FX forward rate at each pay leg date for FX spot shifts in {-0.95, -0.06, 2.0}. The dashed line indicates the FX upper barrier on the pay leg. When the JPY/USD FX spot is shifted up, the forward FX increases significantly. The next two figures show the survival probability for the b) receive leg, and c) pay leg. For positive spot shifts, the survival probability drops to 0 on all barrier dates, and inversely, a downward shift results in a survival probability of 1. The final two figures show the resulting cash flows on the d) receive leg, and e) pay leg. When cashflows are not knocked out, an increasing FX spot results in an increasing PVLet for both legs.](./Fig/37.png)

Figures 38 and 39 show the PV and main risk sensitivities as a function of the JPY/USD FX spot rate. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 38: a) Price, b) JPY/USD FX Delta, c) Flat Delta - JPY, d) Flat Delta - USD, e) JPY/USD FX Vega, and f) JPY/USD FX Gamma as a function of relative shifts of the JPY/USD FX spot rate. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/38.png)

![Figure 39: a) Flat Vega - JPY, and b) Flat Vega - USD as a function of relative shifts of the JPY/USD FX spot rate.](./Fig/39.png)

#### 4.2.5.6 FX Volatility Shifts

We examine the behaviour of the product's PV under relative shifts of the volatility of the JPY/USD FX rate in Figures 40 and 41.

![Figure 40: a) Total PV, b) RecPV, and c) PayPV as a function of relative shifts of the JPY/USD FX volatility. The overall PV behaviour is dominated by the pay leg. As the FX volatility is increased, the forward FX rate decreases slightly, and cashflows more likely to survive the KO barrier. Hence, the PayPV increases, however, the rate of increase of the survival probability decreases with FX vol, and the pay cash flows are multiplied by a smaller FX rate in the USD-to-JPY currency conversion. Therefore, eventually, the decrease in pay cash flow from the currency conversion is greater than the increase in the value from the survival probability, and the PayPV begins to decrease. The effect of FX volatility on the RecPV is minimal. See Figure 41 for in-depth analysis.](./Fig/40.png)

![Figure 41: a) JPY/USD FX forward rate at each pay leg date for JPY/USD FX volatility shifts in {-0.9, -0.19, 1.4}. The dashed line indicates the FX upper barrier on the pay leg. When the JPY/USD FX volatility is shifted up, the forward FX decreases slightly - see Table 54. The next two figures show the b) survival probability, and the c) cashflows on the pay leg. For positive FX vol shifts, the survival probability increases at a decreasing rate on all barrier dates. The PVLet initially increases due to the rising survival probability, before decreasing due to the multiplication with a falling FwdFX rate in the currency conversion.](./Fig/41.png)

| Pay Date (yrs) | FwdFX (-90%) | FwdFX (200%) | FwdFX - Diff |
| --- | --- | --- | --- |
| 0.189041 | 113.359723 | 113.359699 | -0.000024 |
| 0.684932 | 113.050022 | 113.049927 | -0.000095 |
| 1.189041 | 112.465901 | 112.465751 | -0.000149 |
| 1.684932 | 111.626322 | 111.626057 | -0.000264 |
| 2.189041 | 110.572705 | 110.572346 | -0.000359 |
| 2.687671 | 109.454678 | 109.454218 | -0.000460 |
| 3.197260 | 108.330019 | 108.329239 | -0.000781 |
| 3.693151 | 107.232398 | 107.231572 | -0.000826 |
| 4.194521 | 106.143789 | 106.142731 | -0.001058 |
| 4.690411 | 105.062914 | 105.061803 | -0.001111 |
| 5.191781 | 103.982852 | 103.981491 | -0.001361 |
| 5.687671 | 102.899318 | 102.897993 | -0.001325 |

Table 54: The JPY/USD FwdFX rate at each pay date, after a -90% FX vol shift, a 200% FX vol shift, and the difference between the 200% and 90% shift. The difference is negative because the forward FX rate decreases with increasing FX vol.

Figures 42 and 43 show the PV and main risk sensitivities as a function of the volatility of the JPY/USD FX rate. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 42: a) Price, b) JPY/USD FX Delta, c) Flat Delta - JPY, d) Flat Delta - USD, e) JPY/USD FX Vega, and f) JPY/USD FX Gamma as a function of relative shifts of the JPY/USD FX volatility. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/42.png)

![Figure 43: a) Flat Vega - JPY, and b) Flat Vega - USD as a function of relative shifts of the JPY/USD FX volatility.](./Fig/43.png)

#### 4.2.5.7 Taylor Test

In this section, we test how well the Delta-Gamma-Vega expansion of the present value approximates the present value in a neighborhood of the point

$$(FX\ Spot\ Shift, FX\ Vol\ Shift) = (0,0)$$ (41)

More precisely, we check that for spot and volatility shifts $(C,\sigma)$ in a neighborhood of $(0,0)$ (which we chose to be $(-10\%,10\%) \times (-60\%,60\%)$) we have

$$PV(C,\sigma) \approx PV(0,0) + \frac{1}{\delta_C}\Delta(0,0)C + \frac{1}{\delta_v}\nu(0,0)\sigma + \frac{1}{2}\frac{1}{\delta_C^2}\Gamma(0,0)C^2,$$ (42)

where $\Delta$, $\nu$ and $\Gamma$ denote here the FXDELTA, FLATVEGA and FXGAMMA AVE, and $\delta_C$, $\delta_v$ and $\delta_\Gamma$ represent the shift sizes used in the computation of FXDELTA, FLATVEGA and FXGAMMAAVE, respectively.

![Figure 44: a) Price against JPY/USD FX spot shift calculated with DBAnalytics (red), and the first (green) and second (blue) order Taylor approximations. b) Price against JPY/USD FX vol shift calculated with DBAnalytics (red), and the first order (green) Taylor approximation.](./Fig/44.png)

![Figure 45: a) The price computed by DBAnalytics is shown as a coloured surface plot as a function of JPY/USD FX spot and vol shifts. The black wireframe shows the Taylor-approximated price, computed using the market PV, FX Delta, FX Gamma, Flat Vega. b) The absolute difference between the price calculated by DBAnalytics and the price approximated from the Taylor expansion.](./Fig/45.png)

### 4.2.6 IRRBB Scenarios testing

In this subsection we perform the IRRBB test of the IRFXSwapFXKnockOut product. We study 10 IRRBB scenarios and the 'base' scenario, which corresponds to the current state of the market: 'base', 'parallel_up', 'parallel_down', 'steepener', 'flattener', 'short_up', 'short_down', 'long_up', 'long_down', 'steepener_neg' and 'flattener_neg'.

The effect of the IRRBB scenarios on the base case is illustrated in Figure 46 for the domestic yield curve (JPY) and in Figure 47 for the foreign yield curve (USD).

![Figure 46: The IRRBB scenarios applied to the base case of the domestic (JPY) yield curves.](./Fig/46.png)

![Figure 47: The IRRBB scenarios applied to the base case of the foreign (USD) yield curves.](./Fig/47.png)

Interest Rate curve shifts. We examine the behaviour of the product's PV under parallel shifts of the JPY interest rate curve and USD interest rate curve in the EOD scenario (added for comparison) and 10 IRRBB scenarios. The test results show that the profiles of the PVs are smooth.

![Figure 48: a) Price and b) Flat Delta - JPY under parallel shifts of domestic (JPY) interest rate curve for the base and IRRBB scenarios.](./Fig/48.png)

![Figure 49: a) Price and b) Flat Delta - USD under parallel shifts of foreign (USD) interest rate curve for the base and IRRBB scenarios.](./Fig/49.png)

Interest Rate volatility shifts. We examine the behaviour of the product's PV under relative shifts of the JPY interest rate volatility and USD interest rate volatility. The test results show that the profiles of the PVs are smooth.

![Figure 50: a) Price and b) Flat Vega - JPY under relative shifts of domestic (JPY) interest rate volatility for the base and IRRBB scenarios.](./Fig/50.png)

![Figure 51: a) Price and b) Flat Vega - USD under relative shifts of foreign (USD) interest rate volatility for the base and IRRBB scenarios.](./Fig/51.png)

FX spot shifts. We examine the behaviour of the product's PV under relative shifts of the FX spot rate. The test results show that the profiles of the PVs are smooth.

### 4.2.7 CCAR Scenarios testing

The 2023 CCAR shocks have been applied to the EOD dictionary (Base scenario) for testing.

Interest Rate curve shifts. We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the JPY interest rate curve and USD interest rate curve. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 54: a) Price and b) Flat Delta - JPY under parallel shifts of domestic (JPY) interest rate curve for the base and CCAR scenarios.](./Fig/1.png)

CCAR2 has a downward shift in FX spot by -9.34%, and therefore the pay leg is more likely to survive the barrier and PV is lower than the base case. When the JPY rate increases, the FwdFX increases, and cashflows are more likely to be KO, resulting in an increase in PV.

![Figure 55: a) Price and b) Flat Delta - USD under parallel shifts of foreign (USD) interest rate curve for the base and CCAR scenarios.](./Fig/2.png)

For USD curve shifts, the CCAR2 scenario causes the price to initially decrease because the pay cashflows are more likely to survive the barrier (JPY/USD FwdFX decreases), but then increases because the pay cashflows are multiplied by a falling FX rate.

Interest Rate volatility shifts. We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the JPY interest rate volatility and USD interest rate volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 56: a) Price and b) Flat Vega - JPY under relative shifts of domestic (JPY) interest rate volatility for the base and CCAR scenarios.](./Fig/2.png)

![Figure 57: a) Price and b) Flat Vega - USD under relative shifts of foreign (USD) interest rate volatility for the base and CCAR scenarios.](./Fig/3.png)

FX spot rate shifts. We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the JPY/USD FX spot rate. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 58: a) Price and b) FX Delta - JPY/USD under relative shifts of JPY/USD FX spot rate for the base and CCAR scenarios.](./Fig/3.png)

FX rate volatility shifts. We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the volatility of the JPY/USD FX rate. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 59: a) Price and b) FX Vega - JPY/USD under relative shifts of JPY/USD FX volatility for the base and CCAR scenarios.](./Fig/4.png)

At the lower FX spot in CCAR2, the FX volatility is a more significant risk factor. For downward shifts of the FX volatility, the FwdFX is below the barrier and all pay cashflows survive. As the FX volatility increases, the survival probability decreases for the pay cashflows, and therefore the PV increases.

### 4.2.8 MultiVar Scenarios testing

For the given dictionary, DBAnalytics identifies the following risk factors:

| ObjectType | Currency | RiskFactor | Shocks Availability |
| --- | --- | --- | --- |
| IRCURVE | JPY | JPY | CCYSPREAD | Yes |
| IRCURVE | JPY | JPY | DISCOUNTSPREAD | Yes |
| IRCURVE | JPY | JPY | OISSPREAD | Yes |
| IRCURVE | JPY | JPY | SWAP | Yes |
| IRCURVE | USD | USD | OISSPREAD | Yes |
| IRCURVE | USD | USD | SPOTLIBORSPREAD | Yes |
| IRCURVE | USD | USD | SWAP | Yes |
| FXSPOT | JPY/USD | JPY/USD | SPOT | Yes |
| IRDBOPTVOL | JPY | JPY | CMSMAT | Yes |
| IRDBOPTVOL | USD | USD | CMSMAT | Yes |
| FXMARKETVOL | JPY/USD | JPY/USD | ATMVOL | Yes |
| FXMARKETVOL | JPY/USD | JPY/USD | CONVEXITY | Yes |
| FXMARKETVOL | JPY/USD | JPY/USD | DELTAVOL | Yes |
| FXMARKETVOL | JPY/USD | JPY/USD | SLOPE | Yes |
| FXSTOCHDBMVOL | JPY/USD | JPY/USD | LOCALVOL | No |
| FXSTOCHDBMVOL | JPY/USD | JPY/USD | MEANREV | No |

Table 55: Risk Factors identified by DBAnalytics in the dictionary of IRFXSwapFXKnockOut and shock availability in list provided by Market Risk.

The identified risk factors are correct: IRFXSwapFXKnockOut is an FX derivative whose payoff depends on the JPY/USD FX rate. There is two interest rates present in the dictionary: the JPY rate and the USD rate. As described in [21], every curve is constructed starting from a base curve (LIBOR 3M USD in this case) with the help of additional spreads. The curve construction model simultaneously constructs a LIBOR forecasting curve and an OIS discounting curve. This explains the presence of the OISSPREAD among the risk factors. The FundingName is assigned "zwizn-jpy-x-x" in this security which corresponds to DiscountSpread "pyois", therefore DISCOUNTSPREADs are necessary and the product will show sensitivity to them.

The JPY and USD interest rates are modelled as Hull-White processes with time-dependent volatility that calibrate to the input DBOPT volatility objects. Therefore each volatility object will show sensitivity to the inputs CMSMAT. The JPY/USD FX rate is modelled as a lognormal local volatility (Dupire-type) process which is calibrated to an input volatility object of type DELTAVOL consisting of a volatility surface of type DN/CV/RR. Therefore the product will show sensitivity to those inputs. However, the provided shocks do not cover the given configuration, being given in a ATMVOL/SLOPE/CONVEXITY or ATMVOL/DELTAVOL format. Therefore, in order to stress the FX volatility, we opt for a simplification and apply the ATMVOL shocks to the DN inputs stored in the DELTAVOL object.

The product shows sensitivity to those instruments relevant for the time period between valuation date and expiry date.

We apply the SVAR 10D shocks gradually to the EOD dictionary by stressing all the risk factors listed in Table 55 using the logic described above. We obtain the following profiles:

![Figure 60: PV of IRFXSwapFXKnockOut.](./Fig/6.png)

The PV ladder shows that the pricing model is sufficiently robust to price in extremely stressed scenarios. As we evolve from the EOD scenario to the stressed VaR 10D scenario the profile of the PV remains stable and well-behaved. The test is passed.

![Figure 61: PV when only the term structure of a) FXSPOT, b) FXMARKETVOL, c) IRCURVE, and d) IRDBOPTVOL is stressed.](./Fig/6.png)

The PV ladder shows that the pricing model is sufficiently robust to price in extremely stressed scenarios. As we evolve from the EOD scenario to the stressed VaR 10D scenario the profile of the PV remains stable and well-behaved. The test is passed.

### 4.2.9 Impact of parameters set by expert-judgement

The parameters of the SV component of the FX rate are set by expert judgement and are stored in a VOL object of DiffusionType=STOCHVOL. In the following figure, we examine the impact of the parameters stored in the TermVols table, see Section 2.3 for a complete description of the parameters. The original TermVols table is the following:

| Maturity | 1Y | 2Y | 3Y | 5Y | 7Y | 10Y | 15Y | 20Y | 30Y |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Vol | 0.415 | 0.33 | 0.283 | 0.241 | 0.232 | 0.219 | 0.2 | 0.2 | 0.2 |

Table 56: TermVol table stored in the VOL object of DiffusionType = STOCHVOL. These values are exogenously set.

Note that the SV component of the FX rate volatility is used in the last step of the calibration, and provides the final decomposition of the FX rate volatility into an LV component and SV component, see Section 2.3.10. The method used in the calculation of the decomposition is calculated is controlled by the property DirectSLVCalculationMethod which has several modes allowed: FFT, FFT-2, BIN and DBL. The following figure figure shows the impact of the TermVols parameters on the product's price as we apply shifts ranging from -50% to +50% to the original term structure stored in the TermVols table in 3 scenarios for DirectSLVCalculationMethod: FFT, FFT-2 and BIN[^7].

[^7]: The scenario DirectSLVCalculationMethod=DLV cannot be applied, the dictionary throwing the following error: "Invalid DSLV Computation Type entered, must be STATEMAX or BIN".

![Figure 62: PV of IRFXSwapFXKnockOut for different scenarios of vol-of-vol created by applying relative shifts ranging from -50% to +50% to the original TermVols table stored in the VOL object of DiffusionType=STOCHVOL.](./Fig/7.png)

The test shows that the SV parameters, set by expert judgement, have an impact on the IRFXSwapFXKnockOut's price.

The following figures examine the impact of the mean-reversion parameters of the interest rate process on the price of IRFXSwapFXKnockOut. The mean-reversion parameters are exogenously set.

![Figure 63: PV of IRFXSwapFXKnockOut for different values of JPY IR VOL MeanRev parameters (left) and USD IR VOL MeanRev parameters (right).](./Fig/8.png)

The grey dashed line shows the market PV of the trade. The test shows that these parameters, set by expert judgement, have an impact on the IRFXSwapFXKnockOut's price.

## 4.3 Product Testing: IRSwaptionXCcyBerm

The testing in this section is done in Q2 2023 in model configuration

DBX-ShortRate[LVMRAUTO]_FXSkewStochVol[DLVAUTO]

using DBAnalytics version 1230.

### 4.3.1 Product Description

The cross currency interest rate swaption gives the payer the right but not the obligation to enter into a cross currency rate swap according to a schedule of future exercise dates. The underlying swap has on both legs EffectiveDate=19/12/2015, RollDate=19/05/2016 and ExpiryDate=19/05/2025. The swap's ReceiveLeg pays with 6M frequency a USD-denominated fixed coupon equal to 0.095. A fixed flow is added to be paid on the receive leg after the calculation of the coupon. The values of the fixed flow are stored in the RecFlows table, column FixedFlow0. The swap's PayLeg pays with 6M frequency a EUR-denominated fixed coupon equal to 0.0842. A fixed flow is added to be paid on the pay leg after the calculation of the coupon. The values of the fixed flow are stored in the PayFlows table, column FixedFlow0. If the swap is entered, the net cashflow exchanged at a pay date $T_n$ can be represented (in a simplified way) under the form:

$$X_n = (T_n - T_{n-1}) (C_{USD}^{rec}(T_n) - C_{EUR}^{pay}(T_n))$$

Note that for this product the domestic market is the USD market and the simulations are performed under the USD risk-neutral measure. The swaption can be exercised between ExerciseStart=19/12/2015 and ExerciseEnd=19/05/2025 with 6M distance between exercise dates. The swaption has negative PV because its representation given by the properties OptionPosition = SHORT, OptionType = ENTER is −RightToEnter(PayLeg − RecLeg) (i.e. the net cashflows exchanged at each pay date will be −X_n where X_n is defined above.)

Note that for valuation purposes, since the domestic risk-neutral measure is the USD measure, the value of the product's cashflows need to be converted to USD, and therefore are expressed as follows:

$$X_n^{USD} = (T_n - T_{n-1})(C_{USD}^{rec}(T_n) - C_{EUR}^{pay}(T_n) S_{Fx})$$

where $S_{Fx}$ represents the USD/EUR FX rate.

| PV | USD DELTA | EUR DELTA | USD VEGA | EUR VEGA | FXDELTA | FXVEGA | FXGAMMA | Corr. Sens. |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| -362,733.15 | 1392.05 | -1567.65 | 1454.99 | -406.63 | -519,576.71 | -81,069.23 | -3455.44 | 2783.44 |

Table 57: IRSwaptionXCcyBerm: PV and main risk sensitivities calculated in EOD scenario. We can see that the main risk factors are the FX spot rate and the volatility of the FX rate. The values are reported in USD (the domestic currency in this case).

![Figure 64: Left: PV of IRSwaptionXCcyBerm for different values of the fixed spread paid on the Receive Leg.](./Fig/9.png)

Since the product's value is expressed as −RightToEnter(PayLeg − RecLeg), increasing the value of the spread leads to an increase in the value of the RecLeg. Therefore the option is less likely to be exercised and the value of the product converges to 0. 

![Figure 64: Right: PV of IRSwaptionXCcyBerm for different values of the fixed spread paid on the Pay Leg.](./Fig/9.png)

Decreasing the value of the spread leads to decrease of the value of the PayLeg. Therefore the option is less likely to be exercised and the value of the product converges to 0. The observed behaviour is in-line with expectations.

![Figure 65: Left: PV of IRSwaptionXCcyBerm for different values of the fixed flow paid on the Receive Leg (created by applying relative shifts ranging from -90% to 90% to the original fixed flow).](./Fig/10.png)

The x-axis represents in the above figures the size of the relative shifts). Since the product's value is expressed as −RightToEnter(PayLeg − RecLeg), increasing the value of the fixed flow leads to an increase in the value of the RecLeg. Therefore the option is less likely to be exercised and the value of the product converges to 0. 

![Figure 65: Right: PV of IRSwaptionXCcyBerm for different values of the fixed flow paid on the Pay Leg.](./Fig/10.png)

Decreasing the value of the fixed flow leads to decrease of the value of the PayLeg. Therefore the option is less likely to be exercised and the value of the product converges to 0. The observed behaviour is in line with expectations.

The dictionary has been tested against the model rules submitted for approval,

| Property | Value |
| --- | --- |
| MVModelName | DBX-ShortRate_FXSkewStochVol |
| DB_RiskProduct | IRSwaptionXCcyBerm |
| ModelRule Filter Name | PARAMCONTROL |
| ModelRule Filter Version | 20230602 |
| ModelRuleStatus | PASS |

### 4.3.2 Monte Carlo convergence: Price and Risk Sensitivities

We first carry out testing to ensure that the product's PV and main risk sensitivities are robust as the parameters relevant for the Monte Carlo simulation are varied. We fix all the DBX model parameters and vary only the number of simulations for different Seed parameters. The product displays a good convergence, with PV and risk sensitivities reaching their asymptotic values after 5-10k paths. Similar Monte-Carlo convergence tests can be found in DBAnalytics testing document [1].

The market trade has the following parameters for the DBX model,

| Parameter | Value |
| --- | --- |
| NumberSims | 15000 |
| NumberRuns | 1 |
| FrontLatticeFreq | 96 |
| FreqTimeVec | 12 |
| IntegrationFreq | 365 |

The convergence results are shown in Figures 66 and 67 for price and all risk sensitivities. We see that all estimates converge to stable values.

![Figure 66: a) Price, b) Flat Delta - EUR, c) FX Delta, d) Flat Delta - USD, e) FX Gamma, and f) FX Vega estimates for the IRSwaptionXCcyBerm trade as a function number of simulations in the Monte Carlo (DBX) model.](./Fig/12.png)

The price and risk sensitivities all converge to stable values.

![Figure 67: a) Flat Vega - EUR, and b) Flat Vega - USD for the IRSwaptionXCcyBerm trade as a function number of simulations in the Monte Carlo (DBX) model.](./Fig/13.png)

The Flat Vega values converge to a stable value.

### 4.3.3 Correlation Sensitivity

Figure 68 shows the PV impact of correlation between the FX volatility and domestic/foreign IR volatility for the IRSwaptionXCcyBerm product, with and without the Berm feature (IRSwaptionXCcy). When the Berm feature is removed from the product, the trade simply swaps two fixed rates and therefore the correlation has no impact on the PV.

![Figure 68: Price as a function of the correlation between the USD/EUR FX volatility and the domestic/foreign IR volatility for the IRSwaptionXCcyBerm, with and without the Berm feature (IRSwaptionXCcy).](./Fig/13.png)

Correlation has no impact when the Berm feature is removed from the trade.

This trade has a path-dependent Berm feature and the pay leg has a EUR-to-USD currency conversion. Therefore, the trade is highly sensitive to the FX volatility (see Figure 217). Increases in this risk factor leads to an increased likelihood of entering the option (and a subsequent decrease in PV because PV = −RightToEnter(PayLeg − RecLeg)). It also has a non-zero correlation between the FX volatility and the rates volatility. Therefore shifts in the domestic or foreign IR volatility will have an impact on the forward FX and thus on the option exercise probability. When the Berm feature is removed, the impact of IR volatility is non-existent, see Figure 69.

![Figure 69: Price as a function of a) domestic (USD) and b) foreign (EUR) IR volatility for the IRSwaptionXCcyBerm, with and without the Berm feature (IRSwaptionXCcy).](./Fig/14.png)

IR volatility has no impact on the trade when the Berm feature is removed.

### 4.3.4 Calibration Testing

#### 4.3.4.1 Repricing Calibration Targets

The results of the autocalibration step of the market trade are given in Tables 60, 61, and 62 for the domestic IR, foreign IR and FX volatility. The trade ends on 19/05/2025, and for IR volatility, this generates four coterminal swaptions at pegs {1y, 18m, 2y, 3y}. After the fitting procedure, the difference between the target market implied volatility, and the implied volatility, from the LVMR, is negligible. For FX volatility, PIVAutofit calibrates the market DN, 25RR, 10CVX to an SA4 parametric function. Again, the difference in implied volatility between the market and model is insignificant.

| OptionType | Notional | OptionMat | Tenor | Strike | MarketVols | ModelVols | VolDiffs | MarketPrices | ModelPrices | PriceDiffs |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| STRADDLE | 100 | 1Y | 20251008 | 0.015492 | 0.015041 | 0.015041 | 1.710499e-12 | 3.319817 | 3.319817 | 3.774341e-10 |
| STRADDLE | 100 | 18m | 20251008 | 0.016462 | 0.013946 | 0.013946 | 4.905926e-12 | 3.091189 | 3.091189 | 1.984427e-09 |
| STRADDLE | 100 | 2Y | 20251008 | 0.016847 | 0.012551 | 0.012551 | 5.906954e-11 | 2.511194 | 2.511194 | -1.181717e-09 |
| STRADDLE | 100 | 3Y | 20251008 | 0.016836 | 0.011012 | 0.011012 | -3.073951e-11 | 1.218638 | 1.218638 | -3.401729e-09 |

Table 60: Summary of autocalibration results for the domestic (USD) IR volatility.

| OptionType | Notional | OptionMat | Tenor | Strike | MarketVols | ModelVols | VolDiffs | MarketPrices | ModelPrices | PriceDiffs |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| STRADDLE | 100 | 1Y | 20251008 | -0.000995 | 0.000554 | 0.000554 | -4.282020e-11 | 1.258422 | 1.258422 | -1.066735e-09 |
| STRADDLE | 100 | 18m | 20251008 | -0.000460 | 0.000789 | 0.000789 | -2.697319e-10 | 1.333317 | 1.333317 | -0.427576e-09 |
| STRADDLE | 100 | 2Y | 20251008 | -0.000165 | 0.000552 | 0.000552 | -4.554303e-10 | 1.255484 | 1.255484 | 0.475203e-09 |
| STRADDLE | 100 | 3Y | 20251008 | -0.000073 | 0.000593 | 0.000593 | 1.905473e-10 | 0.767164 | 0.767164 | -2.234050e-09 |

Table 61: Summary of autocalibration results for the foreign (EUR) IR volatility.

| Maturity | Delta | TargetVol | FittedVol | FitError |
| --- | --- | --- | --- | --- |
| 20220310 | DN | 0.062925 | 0.062925 | 3.997850e-11 |
| 20220310 | 25RR | -0.002112 | -0.002112 | -6.279338e-12 |
| 20220310 | 10CVX-DN | 0.006086 | 0.006086 | -3.766017e-10 |
| 20220609 | DN | 0.063700 | 0.063700 | 8.227197e-11 |
| 20220609 | 25RR | -0.005200 | -0.005200 | -3.647929e-11 |
| 20220609 | 10CVX-DN | 0.007866 | 0.007866 | -6.443704e-10 |
| 20221209 | DN | 0.062651 | 0.062651 | 8.076873e-15 |
| 20221209 | 25RR | -0.005248 | -0.005248 | 5.774027e-15 |
| 20221209 | 10CVX-DN | 0.009732 | 0.009732 | 1.585537e-15 |
| 20231211 | DN | 0.065630 | 0.065630 | 1.186551e-14 |
| 20231211 | 25RR | -0.003884 | -0.003884 | 2.171180e-14 |
| 20231211 | 10CVX-DN | 0.011497 | 0.011497 | 8.817599e-15 |
| 20241211 | DN | 0.068425 | 0.068425 | 1.424589e-10 |
| 20241211 | 25RR | -0.002310 | -0.002310 | 2.789601e-11 |
| 20241211 | 10CVX-DN | 0.010186 | 0.010186 | -8.829723e-10 |
| 20261210 | DN | 0.073925 | 0.073925 | 7.913127e-11 |
| 20261210 | 25RR | -0.000985 | -0.000985 | 4.261861e-11 |
| 20261210 | 10CVX-DN | 0.010156 | 0.010156 | -5.061880e-10 |
| 20281211 | DN | 0.075724 | 0.075724 | 6.692714e-11 |
| 20281211 | 25RR | -0.000444 | -0.000444 | 5.058323e-11 |
| 20281211 | 10CVX-DN | 0.010157 | 0.010157 | -4.297855e-10 |
| 20311211 | DN | 0.078425 | 0.078425 | 5.121750e-11 |
| 20311211 | 25RR | -0.000425 | -0.000425 | 5.221652e-11 |
| 20311211 | 10CVX-DN | 0.010064 | 0.010064 | -3.337870e-10 |
| 20361211 | DN | 0.081425 | 0.081425 | 1.256849e-12 |
| 20361211 | 25RR | 0.000025 | 0.000025 | 1.065980e-11 |
| 20361211 | 10CVX-DN | 0.004064 | 0.004064 | -1.918324e-11 |
| 20411211 | DN | 0.091425 | 0.091425 | -3.409772e-13 |
| 20411211 | 25RR | 0.000025 | 0.000025 | -7.749326e-12 |
| 20411211 | 10CVX-DN | 0.002364 | 0.002364 | 9.213244e-12 |
| 20511211 | DN | 0.101225 | 0.101225 | -3.306522e-13 |
| 20511211 | 25RR | 0.000025 | 0.000025 | -1.51700e-11 |
| 20511211 | 10CVX-DN | 0.002064 | 0.002064 | 1.109831e-11 |

Table 62: Summary of autocalibration results for the USD/EUR FX volatility.

#### 4.3.4.2 Sensitivity to Initial Guesses used for Parameters

The LocalVols are set to a flat value of 26.855 bps for the full term structure. In this section, we test the sensitivity of the calibration results for initial flat values in {1, 5, 10, 50, 100, 500} bps. The calibration should be robust to our choice in initial LVs, and this is evident from the difference in implied volatility and prices between the market and model, given in Tables 63 and 64 for the USD IR vol, and 65 and 66 for the EUR IR vol.

| OptionMat | Tenor | Strike | VolDiff (1 bps) | VolDiff (5 bps) | VolDiff (10 bps) | VolDiff (50 bps) | VolDiff (100 bps) | VolDiff (500 bps) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1Y | 20251008 | 0.015492 | 6.736130e-13 | 6.736130e-13 | 6.736130e-13 | 3.109253e-12 | 2.692860e-13 | -1.732606e-12 |
| 18m | 20251008 | 0.016462 | -9.210150e-13 | -9.210150e-13 | -9.210150e-13 | 1.072099e-11 | 6.614080e-13 | -2.189416e-11 |
| 2Y | 20251008 | 0.016847 | -5.264125e-11 | -5.264125e-11 | -5.264125e-11 | -6.863423e-11 | -1.116848e-11 | -1.144465e-10 |
| 3Y | 20251008 | 0.016836 | -3.055655e-11 | -3.055655e-11 | -3.055655e-11 | -4.802073e-11 | -9.615016e-11 | -1.211261e-10 |

Table 63: Difference in implied volatility between the market and model for different starting LocalVols in the domestic (USD) IR vol object.

| OptionMat | Tenor | Strike | PriceDiff (1 bps) | PriceDiff (5 bps) | PriceDiff (10 bps) | PriceDiff (50 bps) | PriceDiff (100 bps) | PriceDiff (500 bps) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1Y | 20251008 | 0.015492 | 1.486393e-10 | 1.486393e-10 | 1.486393e-10 | 6.866801e-10 | 6.368294e-11 | -3.823912e-10 |
| 18m | 20251008 | 0.016462 | -2.041483e-10 | -2.041483e-10 | -2.041483e-10 | 2.376369e-09 | 1.466249e-10 | -4.853640e-09 |
| 2Y | 20251008 | 0.016847 | -1.053223e-08 | -1.053223e-08 | -1.053223e-08 | -1.774517e-08 | -2.333585e-09 | -2.396734e-08 |
| 3Y | 20251008 | 0.016836 | -3.381483e-09 | -3.381483e-09 | -3.381483e-09 | -5.314122e-09 | -3.533856e-10 | -1.340414e-08 |

Table 64: Difference in price between the market and model for different starting LocalVols in the domestic (USD) IR vol object.

| OptionMat | Tenor | Strike | VolDiff (1 bps) | VolDiff (5 bps) | VolDiff (10 bps) | VolDiff (50 bps) | VolDiff (100 bps) | VolDiff (500 bps) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1Y | 20251008 | -0.000995 | -1.848920e-12 | -1.848920e-12 | -1.848920e-12 | -2.013340e-12 | -4.556548e-11 | -2.088351e-11 |
| 18m | 20251008 | -0.000460 | -1.101442e-11 | -1.101442e-11 | -1.101442e-11 | -1.129101e-11 | -2.485167e-10 | -1.174131e-10 |
| 2Y | 20251008 | -0.000165 | -1.867141e-11 | -1.867141e-11 | -1.867141e-11 | -1.867147e-11 | -3.012323e-10 | -1.724787e-10 |
| 3Y | 20251008 | -0.000073 | -2.087297e-11 | -2.087297e-11 | -2.087297e-11 | -2.087297e-11 | 9.197325e-12 | -3.270435e-10 | -2.030750e-10 |

Table 65: Difference in implied volatility between the market and model for different starting LocalVols in the foreign (EUR) IR vol object.

| OptionMat | Tenor | Strike | PriceDiff (1 bps) | PriceDiff (5 bps) | PriceDiff (10 bps) | PriceDiff (50 bps) | PriceDiff (100 bps) | PriceDiff (500 bps) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1Y | 20251008 | -0.000995 | -4.218181e-10 | -4.218181e-10 | -4.218181e-10 | -4.592930e-10 | -7.047264e-08 | -7.789563e-09 |
| 18m | 20251008 | -0.000460 | -2.536939e-09 | -2.536939e-09 | -2.536939e-09 | -2.600541e-09 | -5.724056e-08 | -2.704354e-08 |
| 2Y | 20251008 | -0.000165 | -4.043951e-09 | -4.043951e-09 | -4.043951e-09 | -4.043051e-09 | -6.288401e-08 | -3.690643e-08 |
| 3Y | 20251008 | -0.000073 | -2.428693e-09 | -2.428693e-09 | -2.428693e-09 | 1.063187e-09 | -3.865387e-08 | -2.386205e-09 |

Table 66: Difference in price between the market and model for different starting LocalVols in the foreign (EUR) IR vol object.

#### 4.3.4.3 DLV Calibration

We use the following DLV parameters in the MODEL object to improve the quality of calibration fit:

| Parameter | Value |
| --- | --- |
| NumberSims | 10000 |
| MaxIter | 0 |
| FrontLatticeFreq | 96 |
| IntegrationFreq | 365 |
| DLVCalibration | ALL |
| DLVCalibrationType | SIMPLE-SMOOTH |

FXSkewStochVol[DLVAuto]. Figure 70 shows the comparison between the market implied volatility, fitted using a SA4 parametric function, and the DLV for options at different maturities. The SA4 parametric function is fitted using the DBSMC-RateDeterministic_FXMarket model. There is a good quality of fit between DLV and the parametric implied volatility.

![Figure 70: Comparison between the market implied volatility for the IRSwaptionXCcyBerm DLV FX FX rate computed using the DBSMC-RateDeterministic_FXMarket model and the Dupire local volatility (DLV) at option maturities of a) 3m, b) 6m, c) 1y, d) 5y, e) 10y and f) 30y.](./Fig/18.png)

### 4.3.5 EOD testing: Price and Risk Sensitivities

#### 4.3.5.1 Domestic IR Curve Shifts

We examine the behaviour of the product's PV under parallel shifts of the domestic (USD) interest rate curve in Figures 71 and 72.

![Figure 71: a) Total PV, b) RecPV, and c) PayPV as a function of parallel shifts of the domestic (USD) IR curve.](./Fig/19.png)

An upward shift of the USD IR causes the discount factor to decrease and therefore leads to a drop in the receive leg's cash flow. The pay leg has a currency conversion from EUR to USD. A higher USD rate causes the USD/EUR forward FX rate to increase, but there is an equal and opposite shift in the discount factor. Hence, there is no change to the PayPV. The trade value is given by −RightToEnter(PayLeg − RecLeg), hence upward shifts of the USD curve increases the likelihood of the option being entered, and therefore the PV decreases. See Figure 72 for in-depth analysis.

Figures 73 and 74 show the PV and main risk sensitivities as a function of the domestic (USD) interest rate curve. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 72: a) Discount factor, and b) USD/EUR FX forward rate at each pay leg date for USD curve shifts in {−0.05, 0.0, 0.05}.](./Fig/19.png)

When the USD curve is shifted up, the discount factor decreases, while the forward FX increases. The next two figures show the individual coupons on the b) receive leg, and c) pay leg. The coupon is equal to $Rate0 \times Notional \times FwdFX$. This has been verified through a manual computation and is overlaid on the DBA results as grey dashed lines. For both legs, we see the effect of the time-dependent notional on the coupon, which drops a third of its initial value on 08/04/2024 and another third on 08/04/2025. The final two figures show the final cash flows at each pay date. The PVLet is calculated as $(FixedFlow \times FwdFX + Coupon \times Daycount) \times DiscFact$. Again, this has been computed manually and shown in dashed lines. The PVLet for the first cash flow date on both legs is significantly smaller than the later dates, because the FixedFlow = 0. Additionally, the Pay PVLet shows that the increase in FwdFX is perfectly cancelled by the decrease in DiscFact.

![Figure 73: a) Price, b) USD/EUR FX Delta, c) Flat Delta - USD, d) Flat Delta - EUR, e) USD/EUR FX Vega, and f) USD/EUR FX Gamma as a function of parallel shifts of the domestic (USD) IR curve.](./Fig/1.png)

The profiles of the PV and risk sensitivities are smooth and as expected.

![Figure 74: a) Flat Vega - USD, and b) Flat Vega - EUR as a function of parallel shifts of the domestic (USD) IR curve.](./Fig/2.png)

### 4.3.5.2 Foreign IR Curve Shifts

We examine the behaviour of the product's PV under parallel shifts of the foreign (EUR) interest rate curve in Figures 75 and 76.

![Figure 75: a) Total PV, b) RecPV, and c) PayPV as a function of parallel shifts of the foreign (EUR) IR curve.](./Fig/2.png)

Inverse to domestic curve shifts, when the foreign curve is shifted up, the forward USD/EUR FX decreases, and therefore the PayPV also decreases in the currency conversion from EUR-denominated coupons to USD. Currency conversion happens only on the pay leg, so the receive leg is unaffected by EUR curve shifts. If the PayPV decreases, then the likelihood that the option is exercised also decreases ($-RightToEnter(PayLeg - RecLeg)$), and the trade PV tends to 0. See Figure 76 for in-depth analysis.

![Figure 76: a) USD/EUR FX forward rate, and b) the resulting pay cash flows at each pay leg date for EUR curve shifts in {−0.05, 0.0, 0.05}.](./Fig/3.png)

When the EUR curve is shifted up, the FwdFX decreases and therefore the Pay PVLet also decreases due to the currency conversion. The next two figures show the c) exercise probability and d) the American option value at each exercise date. As expected, exercise probability increases significantly for downward shifts of the EUR curve, because the value of the pay leg has increased, $-RightToEnter(PayLeg - RecLeg)$. The American option price decreases due to the minus in the SHORT option.

Figures 77 and 78 show the PV and main risk sensitivities as a function of the foreign (EUR) interest rate curve. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 77: a) Price, b) USD/EUR FX Delta, c) Flat Delta - USD, d) Flat Delta - EUR, e) USD/EUR FX Vega, and f) USD/EUR FX Gamma as a function of parallel shifts of the foreign (EUR) IR curve.](./Fig/4.png)

The profiles of the PV and risk sensitivities are smooth and as expected.

![Figure 78: a) Flat Vega - USD, and b) Flat Vega - EUR as a function of parallel shifts of the foreign (EUR) IR curve.](./Fig/5.png)

### 4.3.5.3 Domestic IR Volatility Shifts

We examine the behaviour of the product's PV under relative shifts of the domestic (USD) IR volatility in Figures 79 and 80.

![Figure 79: a) Total PV, the b) American Option, and the c) Underlying Swap as a function of relative shifts of the domestic (USD) IR volatility.](./Fig/6.png)

The total PV is equal to the American Option ($PV = -RightToEnter(PayLeg-RecLeg)$). Increases in the domestic IR volatility leads to an increased likelihood of the option being entered and therefore we see a decrease in the overall PV (due to the minus from the SHORT). See Figure 80 for in-depth analysis.

![Figure 80: The a) option exercise probability, and b) value of the option for USD IR vol shifts in {−0.95, 0.53, 2.0}.](./Fig/7.png)

When the USD IR volatility is shifted up, the exercise probability increases significantly at the intermediate dates and the American option value is at its lowest. As the trade progresses, the value of the option tends to zero since the number and total value of the remaining cashflows decreases.

Figures 81 and 82 show the PV and main risk sensitivities as a function of the USD IR volatility. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 81: a) Price, b) USD/EUR FX Delta, c) Flat Delta - USD, d) Flat Delta - EUR, e) USD/EUR FX Vega, and f) USD/EUR FX Gamma as a function of relative shifts of the domestic (USD) IR volatility.](./Fig/8.png)

The profiles of the PV and risk sensitivities are smooth and as expected.

![Figure 82: a) Flat Vega - USD, and b) Flat Vega - EUR as a function of relative shifts of the domestic (USD) IR volatility.](./Fig/9.png)

### 4.3.5.4 Foreign IR Volatility Shifts

We examine the behaviour of the product's PV under relative shifts of the foreign (EUR) IR volatility in Figures 83 and 84.

![Figure 83: a) Total PV, the b) American Option, and the c) Underlying Swap as a function of relative shifts of the foreign (EUR) IR volatility.](./Fig/10.png)

The total PV is equal to the American Option ($PV = -RightToEnter(PayLeg - RecLeg)$). Increases in the foreign IR volatility also leads to an increased likelihood of the option being entered to a smaller degree than domestic IR vol shifts. There is, therefore, a decrease in the overall PV (due to the minus from the SHORT). See Figure 84 for in-depth analysis.

![Figure 84: The a) option exercise probability, and b) value of the option for EUR IR vol shifts in {−0.95, 0.53, 2.0}.](./Fig/11.png)

When the EUR IR volatility is shifted up, the exercise probability increases slightly at the intermediate dates and the American option value reaches it's lowest. As the trade progresses, the value of the option tends to zero since the number and total value of the remaining cashflows decreases.

Figures 85 and 86 show the PV and main risk sensitivities as a function of the EUR IR volatility. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 85: a) Price, b) USD/EUR FX Delta, c) Flat Delta - USD, d) Flat Delta - EUR, e) USD/EUR FX Vega, and f) USD/EUR FX Gamma as a function of relative shifts of the foreign (EUR) IR volatility.](./Fig/12.png)

The profiles of the PV and risk sensitivities are smooth and as expected.

### 4.3.5.5 FX Spot Shifts

Figures 89 and 90 show the PV and main risk sensitivities as a function of the USD/EUR FX spot rate. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 88: a) JPY/USD FX forward rate and b) the pay cashflows at each pay leg date for FX spot shifts in {−0.95, −0.06, 2.0}.](./Fig/13.png)

At higher FX spot rate, the FwdFX is greater, and therefore the value of pay cashflows also increases, since it is linear in the FX rate.

### 4.3.5.6 FX Volatility Shifts

We examine the behaviour of the product's PV under relative shifts of the USD/EUR FX volatility in Figures 91 and 92.

![Figure 91: a) Total PV, the b) American Option, and the c) Underlying Swap as a function of relative shifts of the USD/EUR FX volatility.](./Fig/15.png)

The total PV is equal to the American Option ($PV = -RightToEnter(PayLeg - RecLeg)$). Increases in the USD/EUR FX volatility leads to a significant increase in the likelihood of the option being entered. This causes a decrease in the overall PV (due to the minus from the SHORT). See Figure 92 for in-depth analysis.

![Figure 92: The a) option exercise probability, and b) value of the option for USD/EUR FX vol shifts in {−0.95, 0.53, 1.9}.](./Fig/16.png)

When the USD/EUR FX volatility is shifted up, the exercise probability increases significantly at the intermediate dates and the American option value reaches it's lowest value. As the trade progresses, the value of the option tends to zero since the number and total value of the remaining cashflows decreases.

Figures 93 and 94 show the PV and main risk sensitivities as a function of the the USD/EUR FX volatility. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 93: a) Price, b) USD/EUR FX Delta, c) Flat Delta - USD, d) Flat Delta - EUR, e) USD/EUR FX Vega, and f) USD/EUR FX Gamma as a function of relative shifts of the USD/EUR FX volatility.](./Fig/17.png)

The profiles of the PV and risk sensitivities are smooth and as expected.

![Figure 94: a) Flat Vega - USD, and b) Flat Vega - EUR as a function of relative shifts of the USD/EUR FX volatility.](./Fig/18.png)

### 4.3.5.7 Taylor Test

In this section, we test how well the Delta-Gamma-Vega expansion of the present value approximates the present value in a neighborhood of the point

$(FX~Spot~Shift, FX~Vol~Shift) = (0,0) \tag{43}$

More precisely, we check that for spot and volatility shifts $(C,\sigma)$ in a neighborhood of $(0,0)$ (which we chose to be $(−10\%, 10\%) \times (−60\%, 60\%)$ we have

$PV(C,\sigma) \approx PV(0,0) + \frac{1}{\delta_1} \Delta(0,0)C + \frac{1}{\delta_\sigma} \nu(0,0)\sigma + \frac{1}{2\delta_1^2} \Gamma(0,0)C^2 \tag{44}$

where Δ, ν and Γ denote here the FXDELTA, FLATVEGA and FXGAMMAAVE and δ₁, δσ and δγ represent the shift sizes used in the computation of FXDELTA, FLATVEGA and FXGAMMAAVE, respectively.

Figure 95 shows the application of Taylor approximation to price sensitivities:

![Figure 95: a) Price against USD/EUR FX spot shift calculated with DBAnalytics (red), and the first (green) and second (blue) order Taylor approximations. b) Price against USD/EUR FX vol shift calculated with DBAnalytics (red), and the first order (green) Taylor approximation.](./Fig/1.png)

Figure 96 provides a more detailed view of the Taylor approximation quality:

![Figure 96: a) The price computed by DBAnalytics is shown as a coloured surface plot as a function of USD/EUR FX spot and vol shifts. The black wireframe shows the Taylor-approximated price, computed using the market PV, FX Delta, FX Gamma, Flat Vega. b) The absolute difference between the price calculated by DBAnalytics and the price approximated from the Taylor expansion.](./Fig/1.png)

## 4.3.6 IRRBB Scenarios testing

In this subsection we perform the IRRBB test of the IRSwaptionXCcyBerm product. We study 10 IRRBB scenarios and the "base" scenario, which corresponds to the current state of the market: 'base', 'parallel_up', 'parallel_down', 'steepener', 'flattener', 'short_up', 'short_down', 'long_up', 'long_down', 'steepener_neg' and 'flattener_neg'.

The effect of the IRRBB scenarios on the base case is illustrated in Figure 97 for the domestic yield curve (USD) and in Figure 98 for the foreign yield curve (EUR).

![Figure 97: The IRRBB scenarios applied to the base case of the domestic (USD) yield curves.](./Fig/2.png)

![Figure 98: The IRRBB scenarios applied to the base case of the foreign (EUR) yield curves.](./Fig/3.png)

Interest Rate curve shifts. We examine the behaviour of the product's PV under parallel shifts of the EUR interest rate curve and USD interest rate curve in the EOD scenario (added for comparison) and 10 IRRBB scenarios. The test results show that the profiles of the PVs are smooth.

![Figure 99: a) Price and b) Flat Delta - USD under parallel shifts of domestic (USD) interest rate curve for the base and IRRBB scenarios.](./Fig/4.png)

![Figure 100: a) Price and b) Flat Delta - EUR under parallel shifts of foreign (EUR) interest rate curve for the base and IRRBB scenarios.](./Fig/4.png)

Interest Rate volatility shifts. We examine the behaviour of the product's PV under relative shifts of the EUR interest rate volatility and USD interest rate volatility. The test results show that the profiles of the PVs are smooth.

![Figure 101: a) Price and b) Flat Vega - USD under relative shifts of domestic (USD) interest rate volatility for the base and IRRBB scenarios.](./Fig/5.png)

![Figure 102: a) Price and b) Flat Vega - EUR under relative shifts of foreign (EUR) interest rate volatility for the base and IRRBB scenarios.](./Fig/5.png)

FX spot shifts. We examine the behaviour of the product's PV under relative shifts of the FX spot rate. The test results show that the profiles of the PVs are smooth.

![Figure 103: a) Price and b) FX Delta - USD/EUR under relative shifts of USD/EUR FX spot rate for the base and IRRBB scenarios.](./Fig/6.png)

FX VOL shifts. We examine the behaviour of the product's PV under relative shifts of the FX rate volatility. The test results show that the profiles of the PVs are smooth.

![Figure 104: a) Price and b) FX Vega - USD/EUR under relative shifts of USD/EUR FX volatility for the base and IRRBB scenarios.](./Fig/6.png)

## 4.3.7 CCAR Scenarios testing

The 2023 CCAR shocks have been applied to the EOD dictionary (Base scenario) for testing.

Interest Rate curve shifts. We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the USD interest rate curve and EUR interest rate curve. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 105: a) Price and b) Flat Delta - USD under parallel shifts of domestic (USD) interest rate curve for the base and CCAR scenarios.](./Fig/7.png)

![Figure 106: a) Price and b) Flat Delta - EUR under parallel shifts of foreign (EUR) interest rate curve for the base and CCAR scenarios.](./Fig/7.png)

Interest Rate volatility shifts. We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the USD interest rate volatility and EUR interest rate volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 107: a) Price and b) Flat Vega - USD under relative shifts of domestic (USD) interest rate volatility for the base and CCAR scenarios.](./Fig/8.png)

![Figure 108: a) Price and b) Flat Vega - EUR under relative shifts of foreign (EUR) interest rate volatility for the base and CCAR scenarios.](./Fig/8.png)

FX spot rate shifts. We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the USD/EUR FX spot rate. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 109: a) Price and b) FX Delta - USD/EUR under relative shifts of USD/EUR FX spot rate for the base and CCAR scenarios.](./Fig/9.png)

FX rate volatility shifts. We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the volatility of FX rate. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 110: a) Price and b) FX Vega - USD/EUR under relative shifts of USD/EUR FX volatility for the base and CCAR scenarios.](./Fig/9.png)

## 4.3.8 MultiVar Scenarios testing

For the given dictionary, DBAnalytics identifies the following risk factors:

| ObjectType | Currency | RiskFactor | Shocks Availability |
|------------|----------|------------|---------------------|
| IRCURVE | USD | USD | DISCOUNTSPREAD | Yes |
| IRCURVE | USD | USD | OISSPREAD | Yes |
| IRCURVE | USD | USD | SWAP | Yes |
| IRCURVE | EUR | EUR | CCYSPREAD | Yes |
| IRCURVE | EUR | EUR | SWAP | Yes |
| FXSPOT | USD/EUR | USD/EUR | SPOT | Yes |
| IRDBOPTVOL | USD | USD | CMSMAT | Yes |
| IRDBOPTVOL | EUR | EUR | CMSMAT | Yes |
| FXMARKETVOL | USD/EUR | USD/EUR | ATMVOL | Yes |
| FXMARKETVOL | USD/EUR | USD/EUR | CONVEXITY | Yes |
| FXMARKETVOL | USD/EUR | USD/EUR | DELTAVOL | Yes |
| FXMARKETVOL | USD/EUR | USD/EUR | SLOPE | Yes |
| FXSTOCHDEMVOL | USD/EUR | USD/EUR | LOCALVOL | No |
| FXSTOCHDEMVOL | USD/EUR | USD/EUR | MEANREV | No |

Table 68: Risk Factors identified by DBAnalytics in the dictionary of IRSwaptionXCcyBerm and shock availability in list provided by Market Risk

The identified risk factors are correct: IRSwaptionXCcyBerm is an FX derivative whose payoff depends on the USD/EUR FX rate. There is two interest rates present in the dictionary: the EUR rate and the USD rate. As described in [21], every curve is constructed starting from a base curve (LIBOR 3M USD in this case) with the help of additional spreads. The curve construction model simultaneously constructs a LIBOR forecasting curve and an OIS discounting curve. This explains the presence of the OISSPREAD among the risk factors. The FundingName is assigned "global-markets-usd" in this security which corresponds to DiscountSpread "usd:tr", therefore DISCOUNTSPREADs are necessary and the product will show sensitivity to them.

The EUR and USD interest rates are modelled as Hull-White processes with time-dependent volatility that calibrate to the input DBOPT volatility objects. Therefore each volatility object will show sensitivity to the inputs CMSMAT. The USD/EUR FX rate is modelled as a lognormal local volatility (Dupire-type) process which is calibrated to an input volatility object of type DELTAVOL consisting of a volatility surface of type DN/CVX/RR. Therefore the product will show sensitivity to these inputs. However, the provided shocks do not cover the given configuration, being given in a ATMVOL/SLOPE/CONVEXITY or ATMVOL/DELTAVOL format. Therefore, in order to stress the FX volatility, we opt for a simplification and apply the ATMVOL shocks to the DN inputs shown in the DELTAVOL object.

The product shows sensitivity to those instruments relevant for the time period between valuation date and expiry date.

We apply the SVAR 10D shocks gradually to the EOD dictionary by stressing all the risk factors listed in Table 125 using the logic described above. We obtain the following profiles:

We apply the SVAR 10D shocks gradually to the EOD dictionary by stressing all the risk factors listed in Table 125 using the logic described above. We obtain the following profiles:

![Figure 111: PV of IRSwaptionXCcyBerm. The PV ladder shows that the pricing model is sufficiently robust to price in extremely stressed scenarios. As we evolve from the EOD scenario to the stressed VaR 10D scenario the profile of the PV remains stable and well-behaved. The test is passed.](./Fig/2.png)

![Figure 112: PV when only the term structure of a) FXSPOT, b) FXMARKETVOL, c) IRCURVE, and d) IRDBOPTVOL is stressed. The PV ladder shows that the pricing model is sufficiently robust to price in extremely stressed scenarios. As we evolve from the EOD scenario to the stressed VaR 10D scenario the profile of the PV remains stable and well-behaved. The test is passed.](./Fig/2.png)

## 4.3.9 Impact of parameters set by expert-judgement

The parameters of the SV component of the FX rate are set by expert judgement and are stored in a VOL object of DiffusionType=STOCHVOL. In the following figure, we examine the impact of the parameters stored in the TermVols table, see Section 2.3 for a complete description of the parameters. The original TermVols table is the following:

| Maturity | 1Y | 2Y | 3Y | 5Y | 7Y | 10Y | 15Y | 20Y | 30Y |
|----------|----|----|----|----|----|----|-----|-----|-----|
| Vol      |0.415|0.33|0.263|0.241|0.232|0.219|0.2|0.2|0.2|

Table 69: TermVol table stored in the VOL object of DiffusionType = STOCHVOL. These values are exogenously set.

Note that the SV component of the FX rate volatility is used in the last step of the calibration, and provides the final decomposition of the FX rate volatility into an LV component and SV component. See Section 2.3.10. The method used in the calculation of the decomposition is calculated is controlled by the property DirectSLVCalculationMethod which has several modes allowed: FFT, FFT-2, BIN and DBL. The following figure shows the impact of the TermVols parameters on the product's price as we apply shifts ranging from -50% to +50% to the original term structure stored in the TermVols table in 3 scenarios for DirectSLVCalculationMethod: FFT, FFT-2 and BIN[^1].

![Figure 113: PV of IRSwaptionXCcyBerm for different scenarios of vol-of-vol created by applying relative shifts ranging from -25% to +25% to the original TermVols table stored in the VOL object of DiffusionType=STOCHVOL. The test shows that the SV parameters, set by expert judgement, have an impact on the IRSwaptionXCcyBerm's price.](./Fig/4.png)

Note that the observed divergence between the product's PV computed in modes DirectSLVCalculationMethod = BIN/FFT-1 and FFT-2 occurs at a small PV value. The following tests show that the error value is decreasing significantly for higher PV values:

[^1]: The scenario DirectSLVCalculationMethod=DLV cannot be applied, the dictionary throwing the following error: "Invalid DSLV Computation Type entered, must be STATEMAX or BIN".

![Figure 116: PV of IRSwaptionXCcyBerm for different values of USD IR VOL MeanRev parameters (left) and EUR IR VOL MeanRev parameters (right). The grey dashed line shows the market PV of the trade. The test shows that these parameters, set by expert judgement, have an impact on the IRSwaptionXCcyBerm's price.](./Fig/5.png)

## 4.4 Product Testing: IRFXSwapFXRangeAccrualCallableBerm

The testing done in this section is for Q2 2023 with model configuration 

DBX.ShortRate[LMR]_FXSkewStochVol[DLVAUTO]

using DBAnalytics version 1240.

| Property | Value |
|----------|-------|
| MVModelName | DBX.ShortRate_FXSkewStochVol |
| DB_RiskProduct | IRFXSwapFXRangeAccrualCallableBerm |
| ModelRule Filter Name | PARAMCONTROL |
| ModelRule Filter Version | 20230602 |
| ModelRuleStatus | PASS |

The following parameters in the MODEL object have been used for FXSkewStochVol[DLVAUTO] calibration.

| Parameter | Value |
|-----------|-------|
| NumberSims | 20000 |
| MaxIter | 0 |
| FrontLatticeFrqg | 96 |
| IntegrationFreq | 365 |
| DLVCalibration | ALL |
| DLVCalibrationType | SIMPLE-SMOOTH |

Figure 117 shows the comparison between the market (parametric implied volatility using DBSMC model) and model (Dupire local volatility using DBX model) implied volatility on the EOD dictionary. The fit quality is good.

### TarnLifeTimeFloor Feature

applying the TarnLifeTimeFloor feature. For example, starting from -50% FX spot shift, AmericanOption is positive as ForwardSwap is negative and SumPayCoupon is above TarnLifeTimeFloor (so TarnLifeTimeFloor does not take effect). As FX spot is shifted up to 10% and 20%, the option will not be exercised (AmericanOption = 0) as ForwardSwap is positive and SumPayCoupon is still above TarnLifeTimeFloor. Keep increasing FX spot beyond 30%, AmericanOption is 0 though ForwardSwap is negative. This is because now TarnLifeTimeFloor is flooring to make sure that the long/cancel option holder does not pay too little. If the option is exercised after applying TarnLifeTimeFloor, the last pay coupon will be cancelled and the price for this option will be increased, which contradicts the purpose of TarnLifeTimeFloor.

![Figure 118: (a) Sum of PVLets on both legs before 2033-12-23 (b) Sum of PVLets on both legs after 2033-12-23 (c) UnderlyingSwap and AmericanOption for all cash flows (d) Final PV for the trade (e) Average barrier survival rate and sum of coupons for all cash flows on the pay leg under relative shift of USD/EUR FX spot. Option exercise date is on 2033-12-23. CalcIntrinsic = 1.](./Fig/6.png)

Figure 119 shows that the PV curves become smoother as FX volatility is increased, which is as expected.

![Figure 120: (a) Sum of PVLets on both legs before 2033-12-23 (b) Sum of PVLets on both legs after 2033-12-23 (c) UnderlyingSwap and AmericanOption for all cash flows (d) Final PV for the trade (e) Average barrier survival rate and sum of coupons for all cash flows on the pay leg under parallel shift of USD IR curve. Option exercise date is on 2033-12-23. CalcIntrinsic = 1.](./Fig/7.png)

Figure 121 shows that the PV curves become smoother as USD IR volatility is increased, which is as expected.

![Figure 121: PV and FLATVEGA as a function of parallel shift of USD IR curve under various levels of market USD IR volatilities.](./Fig/8.png)

### EUR IR Curve Shift

Shifting up the EUR curve, to some extent, is similar to decrease the FX rate. But there is also a big difference. As the RateCurrency and PayCurrency are all in EUR, the discount factor can decrease as the EUR curve is shifted up. As shown in Figure 122 (a), the shape of $PV_{rec}$ before 2033-12-23 purely depends on the discount factor as Mult = 0 for the Cashflows before 2033-12-23 - the rec coupons is independent of any rate changes. $PV_{pay}$ is in similar trend as the average barrier survival rate (Figure 122 (e)) in general, but it needs to be multiplied by the discount factor.

$PV_{rec}$ is positively correlated to the EUR curve change after 2033-12-23 as now Mult = 1. The increase in EUR rate is stronger than the effect of discount factor, so $PV_{rec}$ increases as EUR curve is shifted up. $PV_{pay}$ after 2033-12-23 also behaves reasonably. As EUR curve is shifted down from 5% to 0.5%, the pay coupons should not change as the average barrier survival rate stays constant. It is the discount factor that pulls up $PV_{pay}$. As the EUR curve is further shifted down to -3.5%, the range rate (USD/EUR) starts out of the barrier range and then all the pay coupons become 0. When the EUR curve is shifted down beyond -3.5%, sum of all pay coupons reaches TarnLifeTimeFloor as shown in Figure 122 (e). And the last PayCoupon is no longer 0. It is equal to $TarnLifeTimeFloor - \sum_{i=1}^{n-1} PayCoupon_i^{EUR}$. This why an increase in $PV_{pay}$ is observed.

The long/cancel option will be exercised (in Figure 122 (c)) if $PV_{pay}$ is greater than $PV_{rec}$ in Figure 122 (b), before applying the TarnLifeTimeFloor feature. Between the shift range of -5% and 3%, $PV_{pay}$ is always greater than $PV_{rec}$ as shown in Figure 122 (b), so option price is positive. The option behaviour is as expected.

![Figure 122: (a) Sum of PVLets on both legs before 2033-12-23 (b) Sum of PVLets on both legs after 2033-12-23 (c) UnderlyingSwap and AmericanOption for all cash flows (d) Final PV for the trade (e) Average barrier survival rate and sum of coupons for all cash flows on the pay leg under parallel shift of EUR IR curve. Option exercise date is on 2033-12-23. CalcIntrinsic = 1.](./Fig/9.png)

Figure 123 shows that the PV curves become smoother as EUR IR volatility is increased, which is as expected.

![Figure 123: PV and FLATVEGA as a function of parallel shift of EUR IR curve under various levels of market EUR IR volatilities.](./Fig/10.png)

### Impact of Correlation

Figure 124 shows the correlation between interest rates, FX rate and SV component of FX rate has an evident impact on path dependent product IRFXSwapFXRangeAccrualCallableBerm. Although IRFXSwapFXRangeAccrual obtained directly from removing the Tarn and Callable Bermudan features from IRFXSwapFXRangeAccrualCallableBerm is path dependent as well, the RangeType of WHIPSAW weakens the impact as the coupon does accrue further when the RangeIndex comes back into the range under WHIPSAW. Thus, the impact of correlation for IRFXSwapFXRangeAccrual is not significant.

![Figure 124: PV as a function of relative shift of correlation between interest rates, FX rate and SV component of FX rate. IRFXSwapFXRangeAccrual is obtained by removing the Tarn and Callable Bermudan features from IRFXSwapFXRangeAccrualCallableBerm. RangeType = WHIPSAW for both products.](./Fig/10.png)

A correlation sensitivity means a change in one component of the model (e.g. Interest rates volatility) can lead to a change in PV for path dependent products (e.g. RangeAccruals) as RangeIndex in another component of the model (e.g. FXRATE) can come in and out the range due to the correlated volatility variation. As is expected in Figure 125, IRFXSwapFXRangeAccrualCallableBerm shows more significant variation in PV under IR vol shift than IRFXSwapFXRangeAccrual as IRFXSwapFXRangeAccrualCallableBerm has a larger correlation sensitivity.

### 4.4.1 Monte Carlo convergence

We first carry out testing to ensure that the product's PV and main risk sensitivities are robust as the parameters relevant for the Monte Carlo simulation are varied. We fix all the DBA model parameters and vary only the number of simulations for different Seed parameters. The product displays a good convergence, with PV and risk sensitivities reaching their asymptotic values after 5-20k paths. Similar Monte-Carlo convergence tests can be found in DBAnalytics testing document [1].

### 4.4.3 EOD testing

#### 4.4.3.1 USD/EUR FX Spot Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the FX spot rate. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 129: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of relative shift of USD/EUR FX spot rate. All values are well behaved and as expected.](./Fig/129.png)

### 4.4.3.2 USD/EUR FX Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the volatility of FX rate. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 130: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of relative shift of USD/EUR FX volatility. All values are well behaved and as expected.](./Fig/130.png)

### 4.4.3.3 USD IR Curve Shift

We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the USD interest rate curve. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 131: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of parallel shift of USD IR curve. All values are well behaved and as expected.](./Fig/131.png)

### 4.4.3.4 USD IR Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the USD interest rate volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 132: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of relative shift of USD IR volatility. All values are well behaved and as expected.](./Fig/132.png)

### 4.4.3.5 EUR IR Curve Shift

We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the EUR interest rate curve. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 133: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of parallel shift of EUR IR curve. All values are well behaved and as expected.](./Fig/133.png)

### 4.4.3.6 EUR IR Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the EUR interest rate volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 134: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of relative shift of EUR IR volatility. All values are well behaved and as expected.](./Fig/134.png)

### 4.4.3.7 Taylor Test

In this section, we test how well the Delta-Gamma-Vega expansion of the present value approximates the present value in a neighborhood of the point

$$(FX Spot Shift, FX Vol Shift) = (0,0)$$

More precisely, we check that for spot and volatility shifts $(C,\sigma)$ in a neighborhood of $(0,0)$ (which we chose to be $(-20\%,20\%) \times (-50\%,50\%)$) we have

$$PV(C,\sigma) \approx PV(0,0) + \frac{1}{\delta_\Delta}\Delta(0,0)C + \frac{1}{\delta_\nu}\nu(0,0)\sigma + \frac{1}{2\delta_\Gamma^2}\Gamma(0,0)C^2,$$

where $\Delta$, $\nu$ and $\Gamma$ denote here the FXDELTA, FLATVEGA and FXGAMMAAVE and $\delta_\Delta$, $\delta_\nu$ and $\delta_\Gamma$ represent the shift sizes used in the computation of FXDELTA, FLATVEGA and FXGAMMAAVE, respectively.

![Figure 135: The results of the Taylor expansion test for IRFXSwapFXRangeAccrualCallableBerm. On the top left and top right pictures we see the plot of the present value computed with DBAnalytics and with the Taylor expansion, together with the relative error as the FX Spot and FX Volatility are subject to relative shifts. In the bottom left picture the plot of the present value as the FX spot and volatility are subject to relative shifts. In the bottom right picture the contour plot of the relative error between the DBA and Taylor values is shown.](./Fig/135.png)

### 4.4.4 IRRBB Scenarios testing

In this subsection we perform the IRRBB test of the IRFXSwapFXRangeAccrualCallableBerm product. We study 10 IRRBB scenarios and the 'base' scenario, which corresponds to the current state of the market: 'base', 'parallel_up', 'parallel_down', 'steepener', 'flattener', 'short_up', 'short_down', 'long_up', 'long_down', 'steepener_neg' and 'flattener_neg'.

#### 4.4.4.1 Scenario Curves

The scenario curves for the rates affecting this product are shown in Figure 136. The effects of each scenario are as expected by their names, for example the parallel up is a parallel shift of the base curve.

![Figure 136: USD and EUR zero rates under Base and IRRBB scenarios.](./Fig/136.png)

#### 4.4.4.2 USD/EUR FX Spot Shift

The stability of PV and FXDELTA under the IRRBB scenarios in comparison to the Base scenario is tested against FX spot shift as shown in Figure 137. All values are well behaved and as expected.

![Figure 137: PV and FXDELTA as a function of relative shift of USD/EUR FX spot for the Base and all IRRBB scenarios. The PV and FXDELTA are well behaved and as expected.](./Fig/137.png)

#### 4.4.4.3 USD/EUR FX Volatility Shift

The stability of PV and FXVEGA under the IRRBB scenarios in comparison to the Base scenario is tested against FX volatility shift as shown in Figure 138. All values are well behaved and as expected.

![Figure 138: PV and FXVEGA as a function of relative shift of USD/EUR FX volatility for the Base and all IRRBB scenarios. The PV and FXVEGA are well behaved and as expected.](./Fig/138.png)

#### 4.4.4.4 USD IR Curve Shift

The stability of PV and FLATDELTA under the IRRBB scenarios in comparison to the Base scenario is tested against USD curve shift as shown in Figure 139. All values are well behaved and as expected.

![Figure 139: PV and FLATDELTA as a function of parallel shift of USD curve for the Base and all IRRBB scenarios. The PV and FLATDELTA are well behaved and as expected.](./Fig/139.png)

#### 4.4.4.5 USD IR Volatility Shift

The stability of PV and FLATVEGA under the IRRBB scenarios in comparison to the Base scenario is tested against USD volatility shift as shown in Figure 140. All values are well behaved and as expected.

![Figure 140: PV and FLATVEGA as a function of relative shift of USD volatility for the Base and all IRRBB scenarios. The PV and FLATVEGA are well behaved and as expected.](./Fig/140.png)

#### 4.4.4.6 EUR IR Curve Shift

The stability of PV and FLATDELTA under the IRRBB scenarios in comparison to the Base scenario is tested against EUR curve shift as shown in Figure 141. All values are well behaved and as expected.

![Figure 141: PV and FLATDELTA as a function of parallel shift of EUR curve for the Base and all IRRBB scenarios. The PV and FLATDELTA are well behaved and as expected.](./Fig/141.png)

#### 4.4.4.7 EUR IR Volatility Shift

The stability of PV and FLATVEGA under the IRRBB scenarios in comparison to the Base scenario is tested against EUR volatility shift as shown in Figure 142. All values are well behaved and as expected.

![Figure 142: PV and FLATVEGA as a function of relative shift of EUR volatility for the Base and all IRRBB scenarios. The PV and FLATVEGA are well behaved and as expected.](./Fig/142.png)

### 4.4.5 CCAR Scenarios testing

The 2023 CCAR shocks have bee applied to the EOD dictionary (Base scenario) for testing.

#### 4.4.5.1 Monte Carlo convergence

We first carry out testing to ensure that the product's PV and main risk sensitivities are robust in the two CCAR scenarios as the Monte Carlo convergence testing that has been done for EOD testing. The trade under both CCAR scenarios displays good convergence.

![Figure 143: PV and main risk sensitivities as the number of simulations are varied, for different seeds under CCAR1 scenario. The results show stable convergence.](./Fig/143.png)

![Figure 144: PV and main risk sensitivities as the number of simulations are varied, for different seeds under CCAR2 scenario. The results show stable convergence.](./Fig/144.png)

#### 4.4.5.2 USD/EUR FX Spot Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the USD/EUR FX Spot. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 145: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of relative shift of USD/EUR FX spot for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/145.png)

#### 4.4.5.3 USD/EUR FX Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the USD/EUR FX volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 146: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of relative shift of USD/EUR FX volatility for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/146.png)

#### 4.4.5.4 USD IR Curve Shift

We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the USD interest rate curve. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 147: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of parallel shift of USD IR curve for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/147.png)

#### 4.4.5.5 USD IR Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the USD volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 148: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of relative shift of USD IR volatility for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/148.png)

#### 4.4.5.6 EUR IR Curve Shift

We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the EUR interest rate curve. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 149: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of parallel shift of EUR IR curve for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/149.png)

#### 4.4.5.7 EUR IR Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the EUR volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 150: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of relative shift of EUR IR volatility for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/150.png)

### 4.4.6 MultiVar Scenarios testing

For the given dictionary, DBAnalytics identifies the following risk factors:

| Type | Currency | AssetName | RiskFactor | Shocks |
| --- | --- | --- | --- | --- |
| IRCURVE | USD | USD | OISSPREAD | Yes |
| IRCURVE | USD | USD | SWAP | Yes |
| IRCURVE | EUR | EUR | CCYSPREAD | Yes |
| IRCURVE | EUR | EUR | DISCOUNTSPREAD | Yes |
| IRCURVE | EUR | EUR | OISSPREAD | Yes |
| IRCURVE | EUR | EUR | SPOTLIBORSPREAD | Yes |
| IRCURVE | EUR | EUR | SWAP | Yes |
| FXSPOT | USD/EUR | USD/EUR | SPOT | Yes |
| IRDBOPTVOL | USD | USD | CMSMAT | Yes |
| IRDBOPTVOL | EUR | EUR | CMSMAT | Yes |
| FXMARKETVOL | USD/EUR | USD/EUR | ATMVOL | Yes |
| FXMARKETVOL | USD/EUR | USD/EUR | CONVEXITY | No |
| FXMARKETVOL | USD/EUR | USD/EUR | DELTAVOL | No |
| FXMARKETVOL | USD/EUR | USD/EUR | SLOPE | No |
| FXSTOCHDBMVOL | USD/EUR | USD/EUR | LOCALVOL | No |
| FXSTOCHDBMVOL | USD/EUR | USD/EUR | MEANREV | No |

Table 72: Risk Factors identified by DBAnalytics in the dictionary of IRFXSwapFXRangeAccrualCallableBerm and shock availability in list provided by Market Risk.

The identified risk factors are correct: IRFXSwapFXRangeAccrualCallableBerm is an FX derivative whose payoff depends on the USD/EUR FX rate. There is two interest rates present in the dictionary: the EUR rate and the USD rate. As described in [21], every curve is constructed starting from a base curve (LIBOR 3M USD in this case) with the help of additional spreads. The curve construction model simultaneously constructs a LIBOR forecasting curve and an OIS discounting curve. This explains the presence of the OISSPREAD among the risk factors. The FundingName is assigned "zwzn-eu1-x-x-x" in this security which corresponds to DiscountSpread "eurstr", therefore DISCOUNTSPREADs are necessary and the product will show sensitivity to them.

The EUR and USD interest rates are modelled as Hull-White processes with time-dependent volatility that calibrate to the input DBOPT volatility objects. Therefore each volatility object will show sensitivity to the inputs CMSMAT. The USD/EUR FX rate is modelled as a lognormal local volatility (Dupire-type) process which is calibrated to an input volatility object of type DELTAVOL consisting of a volatility surface of type DN/CYX/RR. Therefore the product will show sensitivity to these inputs. However, the provided shocks do not cover the given configuration, being given in a ATMVOL/SLOPE/CONVEXITY or ATMVOL/DELTAVOL format. Therefore, in order to stress the FX volatility, we opt for a simplification and apply the ATMVOL shocks to the DN inputs stored in the DELTAVOL object.

The product shows sensitivity to those instruments relevant for the time period between valuation date and expiry date.

We apply the SVAR 10D shocks gradually to the EOD dictionary by stressing all the risk factors listed in Table 72 using the logic described above. We obtain the following profiles:

![Figure 151: PV of IRFXSwapFXRangeAccrualCallableBerm. The PV ladder shows that the pricing model is sufficiently robust to price in extremely stressed scenarios. As we evolve from the EOD scenario to the stressed VaR 10D scenario the profile of the PV remains stable and well-behaved. The test is passed.](./Fig/151.png)

You can see below examples of shocks applied only to the main risk factors (FX spot and FX vol):

![Figure 152: Upper Left: PV when only the term structure of FXSPOT is stressed. Upper Right: PV when only the term structure of FXMARKETVOL is stressed. Lower Left: PV when only the term structure of IRCURVE is stressed. Lower Right: PV when only the term structure of IRDBOPTVOL is stressed. The PV ladder shows that the pricing model is sufficiently robust to price in extremely stressed scenarios. As we evolve from the EOD scenario to the stressed VaR 10D scenario the profile of the PV remains stable and well-behaved. The test is passed.](./Fig/152.png)

### 4.4.7 Impact of parameters set by expert-judgement

The parameters of the SV component of the FX rate are set by expert judgement and are stored in a VOL object of DiffusionType=STOCHVOL. In the following figure, we examine the impact of the parameters stored in the TermVols table, see Section 2.3 for a complete description of the parameters. The original TermVols table is the following:

| Maturity | 1Y | 2Y | 3Y | 5Y | 7Y | 10Y | 15Y | 20Y | 30Y |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Vol | 0.479 | 0.367 | 0.281 | 0.169 | 0.17 | 0.181 | 0.2 | 0.2 | 0.2 |

Table 73: TermVol table stored in the VOL object of DiffusionType = STOCHVOL. These values are exogenously set.

Note that the SV component of the FX rate volatility is used in the last step of the calibration, and provides the final decomposition of the FX rate volatility into an O component and SV component, see Section 2.3.10. The method used in the calculation of the decomposition is calculated is controlled by the property DirectSLVCalculationMethod which has several modes allowed: FFT, FFT-2, BIN and DBL. The following figure figure shows the impact of the TermVols parameters on the product's price as we apply shifts ranging from -50% to +50% to the original term structure stored in the TermVols table in 3 scenarios for DirectSLVCalculationMethod: FFT, FFT-2 and BIN[^5].

[^5]: The scenario DirectSLVCalculationMethod=DLV cannot be applied, the dictionary throwing the following error: "Invalid DSLV Computation Type entered, must be STATEMAX or BIN!".

![Figure 153: PV of IRFXSwapFXRangeAccrualCallableBerm for different scenarios of vol-of-vol created by applying relative shifts ranging from -50% to +50% to the original TermVols table stored in the VOL object of DiffusionType=STOCHVOL. The test shows that the SV parameters, set by expert judgement, have an impact on the IRFXSwapFXRangeAccrualCallableBerm's price.](./Fig/153.png)

The following figures examine the impact of the mean-reversion parameters of the interest rate process on the price of IRFXSwapFXRangeAccrualCallableBerm. The mean-reversion parameters are exogenously set.

![Figure 154: PV of IRFXSwapFXRangeAccrualCallableBerm for different values of USD IR VOL MeanRev parameters (left) and EUR IR VOL MeanRev parameters (right). The test shows that these parameters, set by expert judgement, have an impact on the IRFXSwapFXRangeAccrualCallableBerm's price.](./Fig/154.png)

## 4.5 Product Testing: LTFXDigitalKnockOut

The testing done in this section is for Q2 2023 with model configuration

DBX.ShortRate[LVMR]_FXSkewStochVol[DLVAUTO]

using DBAnalytics version 1240.

| Property | Value |
| --- | --- |
| MVModelName | DBX-ShortRate_FXSkewStochVol |
| DB_RiskProduct | LTFXDigitalKnockOut |
| ModelRule Filter Name | PARAMCONTROL |
| ModelRule Filter Version | 20230602 |
| ModelRuleStatus | PASS |

The following parameters in the MODEL object have been used for FXSkewStochVol[DLVAUTO] calibration.

| Parameter | Value |
| --- | --- |
| NumberSims | 10000 |
| MaxIter | 0 |
| FrontLatticeFreq | 96 |
| IntegrationFreq | 365 |
| DLVCalibration | ALL |
| DLVCalibrationType | SIMPLE-SMOOTH |

Figure [155] shows the comparison between the market (parametric implied volatility using DBSMC model) and model (Dupire local volatility using DBX model) implied volatility on the EOD dictionary. The fit quality is good.

![Figure 155: Comparison between market implied volatility determined by DBSMC model and model implied volatility by Dupire local volatility (DLV) at different option maturities.](./Fig/155.png)

### 4.5.1 Product Description

LTFXDigital (Long Term Forward FX Digital) is a product where the settlement amount for a period is a pre-specified amount if the spot FX on the fixing date is above a set amount otherwise it is a different pre-specified amount. An LTFXDigitalKnockOut is an LTFXDigital product with an additional, conditional termination provision so that if the spot FX rate is above an agreed amount on a specified date, the contract terminates and all future cashflows cease. The tested product consists of a PayLeg and a ReceiveLeg with same EffectiveDate 04/11/2021, RollDate 30/11/2021 and EndDate 30/06/2027. Both legs make payments with monthly frequency between the start date and the end date. The payments are generalizations of digital coupons, each paid if the JPY/USD rate $S(T_i)$ is below a barrier level $K(T_i)$. The barrier values $K(T_i)$ can be found in the tables RecBarriers (in the case of the barrier used by the ReceiveLeg) and PayBarriers (in the case of the barrier used by the PayLeg). The $i^{th}$ coupon of leg $\alpha$ (where $\alpha$ stands for the receiver leg $R$ and payer leg $P$) is given by

$$C_i^{(\alpha)} = N \cdot \Delta_i \cdot \left(\sum_{j=0}^{n_i-1} \mathbb{1}_{[x_j^{(\alpha)},x_{j+1}^{(\alpha)})}(X(T_i)) \left(\theta_j^{(\alpha)}(X(T_i))y_j^{(\alpha)}+(1-\theta_j^{(\alpha)}(X(T_i)))y_{j+1}^{(\alpha)}\right)\right) \times \mathbb{1}_{X(T_i) \leq K^{(\alpha)}(T_i)} $$

where

* $N$ is the notional,

* $\tau_i$ is the applicable day count fraction for the time period $[T_i,T_{i+1})$ (and $\tau_i \approx \frac{1}{12}$),

* $X(t)$ is the JPY/USD FX rate at time $t$,

* $\theta_j^{(\alpha)}(x) = \frac{x_{j+1}^{(\alpha)}-x}{x_{j+1}^{(\alpha)}-x_j^{(\alpha)}}$,

* $(x_j^{(\alpha)}, y_j^{(\alpha)})$ are points given where we perform a linear interpolation.

Table 75 shows the data points defining the coupon payments if the FX rate is within the barrier range. Figure 156 shows the coupon payoff functions translated from Table 75.

![Table 75: Payoff description of RecLeg and PayLeg (values found in the ReceivePayoff and PayPayoff tables in the dictionary). If a setdate falls in between different ratedates, then the payoff is determined from the levels applicable to the previous available ratedate (i.e. interpolation in time is constant). If a setdate falls on a ratedate, that ratedate levels are used.](./Fig/75.png)

![Figure 156: PayOffValue as a function of RateLevel defined by the original dictionary on both legs for different dates. The RecPay coupon can be determined based on the FX rate by linear interpolation.](./Fig/156.png)
Table 76 shows the main risk sensitivities for this trade.

| PV | JPY DELTA | USD DELTA | JPY VEGA | USD VEGA | FXDELTA | FXGAMMA | FXVEGA |
| --- | --- | --- | --- | --- | --- | --- | --- |
| -538,564,215.09 | -514,054.20 | 489,905.96 | -61,127.11 | 473,702.86 | 242,959,753.86 | 2,495,251.59 | 27,399,684.71 |

Table 76: LTFXDigitalKnockOut: PV and main risk sensitivities calculated in EOD scenario. We can see that the main risk factors are the FX spot rate and the volatility of the FX rate. Trade valuation date is 2021-12-09.

### JPY/USD FX Spot Shift

To test the key features of the trade, CalcIntrinsic is set to 1 to ignore all the volatilities. Figure 157 shows $PV_{rec}$ is greater than $PV_{pay}$ when the FX spot rate is shifted down below -20% and $PV_{rec}$ becomes smaller than $PV_{pay}$ when the FX spot rate is shifted up from -20% until 10% when the FX spot breaches the barriers. This is in line with the coupon payoff functions in Figure 156. Everything under FX spot shift is well behaved and as expected.

![Figure 157: PV and average survival rate for both legs under relative FX spot rate shift. CalcIntrinsic = 1.](./Fig/157.png)

Figure 158 shows that the PV curves become smoother as FX volatility is increased, which is as expected.

![Figure 158: PV and FXVEGA as a function of JPY/USD FX spot shift under various levels of market FX volatilities.](./Fig/158.png)

### JPY IR Curve Shift

Shifting up the JPY curve, to some extent, is similar to increasing the FX rate. But there is also a difference. Figure 159 shows that cash flows are gradually knocked out with the JPY curve being shifted up as the average survival rates are decreasing. But the impact of this parallel shift of JPY curve is not as significant as directly shifting the FX spot rate. This leads to a small variation in the forward FX rate in the vicinity of 0 shift and therefore $PV_{rec}$ is always below $PV_{pay}$, which is similar to the PV profiles in the vicinity of 0 shift in Figure 157. Everything under JPY IR curve shift is well behaved and as expected.

![Figure 159: PV and FXVEGA as a function of JPY/USD FX spot shift under various levels of market FX volatilities.](./Fig/159.png)

Figure 160 shows that the PV curves become smoother as JPY IR volatility is increased, which is as expected.

![Figure 160: PV and FLATVEGA as a function of parallel shift of JPY IR curve under various levels of market JPY IR volatilities.](./Fig/160.png)

### USD IR Curve Shift

Shifting up the USD curve is similar to shifting down the JPY curve. Figure 161 shows opposite behaviours compared to Figure 159. All behaviours are as expected.

![Figure 161: PV and FXVEGA as a function of JPY/USD FX spot shift under various levels of market FX volatilities.](./Fig/161.png)

Figure 162 shows that the PV curves become smoother as USD IR volatility is increased, which is as expected. As can be seen in Table 76 that the volatility of the IR curves are not the main risk factors - they are quite small compared to FX sensitivities, therefore FlatVega profiles for IR curve are a bit wobbling.

![Figure 162: PV and FLATVEGA as a function of parallel shift of USD IR curve under various levels of market USD IR volatilities.](./Fig/162.png)

### Impact of Correlation

Figure 163 shows the correlation between interest rates, FX rate and SV component of FX rate has an evident impact on path dependent product LTFXDigitalKnockOut. LTFXDigital obtained directly from removing the knock out features from LTFXDigitalKnockOut is not path dependent as it does not have cap/floor or range barriers. Thus, LTFXDigital is not correlation sensitive.

![Figure 163: PV as a function of relative shift of correlation between interest rates, FX rate and SV component of FX rate. LTFXDigital is obtained by removing the knock out feature from LTFXDigitalKnockOut.](./Fig/163.png)

A correlation sensitivity means a change in one component of the model (e.g. interest rates volatility) can lead to a change in PV for path dependent products (e.g. KnockOut) as RangeIndex in another component of the model (e.g. FXRATE) can come in and out the barriers due to the correlated volatility variation. As is expected in Figure 164, LTFXDigitalKnockOut shows more significant variation in PV under IR vol shift than LTFXDigital as LTFXDigitalKnockOut has a larger correlation sensitivity.

![Figure 164: PV as a function of relative shift of domestic and foreign interest rate volatility for LTFXDigitalKnockOut and LTFXDigital. LTFXDigital is obtained by removing the knock out feature from LTFXDigitalKnockOut.](./Fig/164.png)

## 4.5.2 Monte Carlo convergence

We first carry out testing to ensure that the product's PV and main risk sensitivities are robust as the parameters relevant for the Monte Carlo simulation are varied.

![Figure 165: PV and main risk sensitivities as the number of simulations are varied, for different seeds. The results show stable convergence.](./Fig/165.png)

## 4.5.3 EOD testing

### 4.5.3.1 JPY/USD FX Spot Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the FX spot rate. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 166: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of relative shift of JPY/USD FX spot rate. All values are well behaved and as expected.](./Fig/166.png)

### 4.5.3.2 JPY/USD FX Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the volatility of FX rate. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 167: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of relative shift of JPY/USD FX volatility. All values are well behaved and as expected.](./Fig/167.png)

### 4.5.3.3 JPY IR Curve Shift

We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the JPY interest rate curve. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 168: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of parallel shift of JPY IR curve. All values are well behaved and as expected.](./Fig/168.png)

### 4.5.3.4 JPY IR Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the JPY interest rate volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 169: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of relative shift of JPY IR volatility. All values are well behaved and as expected.](./Fig/169.png)

### 4.5.3.5 USD IR Curve Shift

We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the USD interest rate curve. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 170: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of parallel shift of USD IR curve. All values are well behaved and as expected.](./Fig/170.png)

![Figure 148: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of relative shift of USD IR volatility for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/148.png)

### 4.5.3.6 USD IR Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the USD interest rate volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 171: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of relative shift of USD IR volatility. All values are well behaved and as expected.](./Fig/171.png)

## 4.5.4 IRRBB Scenarios testing

In this subsection we perform the IRRBB test of the LTFXDigitalKnockOut product. We study 10 IRRBB scenarios and the 'base' scenario, which corresponds to the current state of the market: 'base', 'parallel_up', 'parallel_down', 'steepener', 'flattener', 'short_up', 'short_down', 'long_up', 'long_down', 'steepener_neg' and 'flattener_neg'.

### 4.5.4.1 Scenario Curves

The scenario curves for the rates affecting this product are shown in Figure 173. The effects of each scenario are as expected by their names, for example the parallel up is a parallel shift of the base curve.

![Figure 173: JPY and USD zero rates under Base and IRRBB scenarios.](./Fig/173.png)

### 4.5.4.2 JPY/USD FX Spot Shift

The stability of PV and FXDELTA under the IRRBB scenarios in comparison to the Base scenario is tested against FX spot shift as shown in Figure 174. All values are well behaved and as expected.

![Figure 174: PV and FXDELTA as a function of relative shift of JPY/USD FX spot for the Base and all IRRBB scenarios. The PV and FXDELTA are well behaved and as expected.](./Fig/174.png)

### 4.5.4.3 JPY/USD FX Volatility Shift

The stability of PV and FXVEGA under the IRRBB scenarios in comparison to the Base scenario is tested against FX volatility shift as shown in Figure 175. All values are well behaved and as expected.

![Figure 175: PV and FXVEGA as a function of relative shift of JPY/USD FX volatility for the Base and all IRRBB scenarios. The PV and FXVEGA are well behaved and as expected.](./Fig/175.png)

### 4.5.4.4 JPY IR Curve Shift

The stability of PV and FLATDELTA under the IRRBB scenarios in comparison to the Base scenario is tested against JPY curve shift as shown in Figure 176. All values are well behaved and as expected.

![Figure 176: PV and FLATDELTA as a function of parallel shift of JPY IR curve for the Base and all IRRBB scenarios. The PV and FLATDELTA are well behaved and as expected.](./Fig/176.png)

### 4.5.4.7 USD IR Volatility Shift

The stability of PV and FLATVEGA under the IRRBB scenarios in comparison to the Base scenario is tested against USD volatility shift as shown in Figure 179. All values are well behaved and as expected.

![Figure 179: PV and FLATVEGA as a function of relative shift of USD volatility for the Base and all IRRBB scenarios. The PV and FLATVEGA are well behaved and as expected.](./Fig/179.png)

## 4.5.5 CCAR Scenarios testing

The 2023 CCAR shocks have been applied to the EOD dictionary (Base scenario) for testing.

### 4.5.5.1 Monte Carlo convergence

We first carry out testing to ensure that the product's PV and main risk sensitivities are robust in the two CCAR scenarios as the Monte Carlo convergence testing that has been done for EOD testing. The trade under both CCAR scenarios displays good convergence.

![Figure 180: PV and main risk sensitivities as the number of simulations are varied, for different seeds under CCAR1 scenario. The results show stable convergence.](./Fig/180.png)

![Figure 182: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of relative shift of JPY/USD FX spot for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/182.png)

### 4.5.5.3 JPY/USD FX Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the JPY/USD FX volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

Note that the behaviour for CCAR1 looks different from that for CCAR2 and Base, this is due to the applied CCAR shocks. For CCAR1, FX spot is shocked up 9.89% relatively and FX volatility is shocked up hugely to more than 600% REL for short maturities down to around 40% REL for long maturities. These shocks change the behaviour (cf. Figure 158) that the 10% REL FX spot bump would make the trade out of the money but the magnificent FX Vol bump makes the trade slightly above 0 (cf. Figure 158). Therefore, for CCAR1, reducing the FX volatility will bring the trade PV to 0 whereas increasing the FX volatility will slightly increase the trade PV. This is exactly evidenced by Figure 183.

![Figure 183: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of relative shift of JPY/USD FX volatility for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/183.png)

### 4.5.5.4 JPY IR Curve Shift

We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the JPY interest rate curve. The test results show that the profiles of the PVs and risk sensitivities are smooth.

Note again that the behaviour for CCAR1 looks different from that for CCAR2 and Base, this is again due to the applied CCAR shocks. This has been explained in Section 4.5.5.3 that the 10% REL FX spot bump would make the trade out of the money but the magnificent FX Vol bump makes the trade slightly above 0 (cf. Figure 158). The [-5%, 5%] parallel shift for the JPY curve leads to a small variation in FX rate. Thus, the trade PV under parallel JPY curve shift for CCAR1 is close to 0.
## 4.5.5.5 JPY IR Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the JPY volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 185: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of relative shift of JPY IR volatility for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/185.png)

## 4.5.5.6 USD IR Curve Shift

We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the USD interest rate curve. The test results show that the profiles of the PVs and risk sensitivities are smooth.

Note again that the behaviour for CCAR1 looks different from that for CCAR2 and Base, please refer to Section 4.5.5.4 for explanation.

![Figure 186: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of parallel shift of USD IR curve for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/186.png)

## 4.5.5.7 USD IR Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the USD volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 187: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of relative shift of USD IR volatility for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/187.png)

## 4.5.6 MultiVar Scenarios testing

For the given dictionary, DBAnalytics identifies the following risk factors:

| ObjectType | Currency | RiskFactor | Shocks Availability |
| --- | --- | --- | --- |
| IRCURVE | JPY | CCYSPREAD | Yes |
| IRCURVE | JPY | DISCOUNTSPREAD | Yes |
| IRCURVE | JPY | OISSPREAD | Yes |
| IRCURVE | JPY | SWAP | Yes |
| IRCURVE | USD | OISSPREAD | Yes |
| IRCURVE | USD | SWAP | Yes |
| FXSPOT | JPY/USD | SPOT | Yes |
| IRDBOPTVOL | JPY | CMSMAT | Yes |
| IRDBOPTVOL | USD | CMSMAT | Yes |
| FXMARKETVOL | JPY/USD | ATMVOL | Yes |
| FXMARKETVOL | JPY/USD | CONVEXITY | No |
| FXMARKETVOL | JPY/USD | DELTAVOL | No |
| FXMARKETVOL | JPY/USD | SLOPE | No |
| FXSTOCHDBMVOL | JPY/USD | LOCALVOL | No |
| FXSTOCHDBMVOL | JPY/USD | MEANREV | No |

Table 77: Risk Factors identified by DBAnalytics in the dictionary of LTFXDigitalKnockOut and shock availability in list provided by Market Risk.

The identified risk factors are correct: LTFXDigitalKnockOut is an FX derivative whose payoff depends on the JPY/USD FX rate. There is two interest rates present in the dictionary: the USD rate and the JPY rate. As described in [21], every curve is constructed starting from a base curve (LIBOR 3M USD in this case) with the help of additional spreads. The curve construction model simultaneously constructs a LIBOR forecasting curve and an OIS discounting curve. This explains the presence of the OISSPREAD among the risk factors. The FundingName assigned in this security is "global-markets-USD" that corresponds to Funding name "USDstr", which implies that DISCOUNTSPREADs are necessary and the product will show sensitivity to them.

The USD and JPY interest rates are modelled as Hull-White processes with time-dependent volatility that calibrate to the input DBOPT volatility objects. Therefore each volatility object will show sensitivity to the inputs CMSMAT. The JPY/USD FX rate is modelled as a lognormal local volatility (Dupire-type) process which is calibrated to an input volatility object of type DELTAVOL consisting of a volatility surface of type DN/CYX/RR. Therefore the product will show sensitivity to these inputs. However, the provided shocks do not cover the given configuration, being given in a ATMVOL/SLOPE/CONVEXITY or ATMVOL/DELTAVOL format. Therefore, in order to stress the FX volatility, we opt for a simplification and apply the ATMVOL shocks to the DN inputs stored in the DELTAVOL object.

The product shows sensitivity to those instruments relevant for the time period between valuation date and expiry date.

We apply the SVAR 10D shocks gradually to the EOD dictionary by stressing all the risk factors listed in Table 77 using the logic described above. We obtain the following profiles:

![Figure 188: PV of LTFXDigitalKnockOut. The PV ladder shows that the pricing model is sufficiently robust to price in extremely stressed scenarios. As we evolve from the EOD scenario to the stressed VaR 10D scenario the profile of the PV remains stable and well-behaved. The test is passed.](./Fig/188.png)

You can see below examples of shocks applied only to the main risk factors (FX spot and FX vol):

![Figure 189: Upper Left: PV when only the term structure of FXSPOT is stressed. Upper Right: PV when only the term structure of FXMARKETVOL is stressed. Lower Left: PV when only the term structure of IRCURVE is stressed. Lower Right: PV when only the term structure of IRDBOPTVOL is stressed. The PV ladder shows that the pricing model is sufficiently robust to price in extremely stressed scenarios. As we evolve from the EOD scenario to the stressed VaR 10D scenario the profile of the PV remains stable and well-behaved. The test is passed.](./Fig/189.png)

## 4.5.7 Impact of parameters set by expert-judgement

The parameters of the SV component of the FX rate are set by expert judgement and are stored in a VOL object of DiffusionType=STOCHVOL. In the following figure, we examine the impact of the parameters stored in the TermVols table, see Section 2.3 for a complete description of the parameters. The original TermVols table is the following:

| Maturity | 1Y | 2Y | 3Y | 5Y | 7Y | 10Y | 15Y | 20Y | 30Y |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Vol | 0.415 | 0.33 | 0.263 | 0.241 | 0.232 | 0.219 | 0.2 | 0.2 | 0.2 |

Table 78: TermVol table stored in the VOL object of DiffusionType = STOCHVOL. These values are exogenously set.

Note that the SV component of the FX rate volatility is used in the last step of the calibration, and provides the final decomposition of the FX rate volatility into an O component and SV component, see Section 2.3.10. The method used in the calculation of the decomposition is calculated is controlled by the property DirectSLVCalculationMethod which has several modes allowed: FFT, FFT-2, BIN and DBL. The following figure figure shows the impact of the TermVols parameters on the product's price as we apply shifts ranging from -50% to +50% to the original term structure stored in the TermVols table in 3 scenarios for DirectSLVCalculationMethod: FFT, FFT-2 and BIN[^5].

[^5]: The scenario DirectSLVCalculationMethod=DLV cannot be applied, the dictionary throwing the following error: "Invalid DSLV Computation Type entered, must be STATEMAX or BIN!".

![Figure 190: PV of LTFXDigitalKnockOut for different scenarios of vol-of-vol created by applying relative shifts ranging from -50% to +50% to the original TermVols table stored in the VOL object of DiffusionType=STOCHVOL. The test shows that the SV parameters, set by expert judgement, have an impact on the LTFXDigitalKnockOut's price.](./Fig/190.png)

The following figures examine the impact of the mean-reversion parameters of the interest rate process on the price of LTFXDigitalKnockOut. The mean-reversion parameters are exogenously set.

![Figure 191: PV of LTFXDigitalKnockOut for different values of USD IR VOL MeanRev parameters (left) and JPY IR VOL MeanRev parameters (right). The test shows that these parameters, set by expert judgement, have an impact on the LTFXDigitalKnockOut's price.](./Fig/191.png)

## 4.6 Product Testing: LTFXParForwardKnockOut

The testing done in this section is done in Q2 2023 in model configuration

DBX-ShortRateNormal[LVMR Auto]_FXSkewStochVol[DLVAUTO]

using DBAnalytics version 1230.

### 4.6.1 Product Description

LTFXParForward is a series outright purchases or sales of FX Forwards. LTFXParForwardKnockOut is an LTFXParForward that is automatically terminated if the underlying FX touches a pre-defined barrier. The tested product consists of a PayLeg and a ReceiveLeg both having the same EffectiveDate 21/04/2021, RollDate 30/06/2021 and EndDate 30/06/2024. The valuation date is 09/12/2021.

Each leg makes quarterly payments: ReceiveLeg is JPY-denominated and pays a fixed coupon equal to 1 on a notional of 12.585 M JPY, while PayLeg is USD-denominated and pays a fixed coupon equal to 1 on a notional of 0.15 M USD, which is then converted to JPY. The payments are made as long as the JPY/USD FX rate is below a barrier $K$ at each look date $T_i$ with $T_0 = 27/04/2021$, $T_N = 26/06/2024$ and $T_{i+1} - T_i = 1M$. If the barrier is breached, both legs are knocked out.

The receive leg follows,

$$\text{RecLeg(JPY)} = \mathbb{E}\left[N_r \sum_{i=1}^{N} \mathbb{I}(X_i^{JPY/USD} < K)e^{-\int_{t_0}^{t_i} r_s ds}\right]$$

where $N_r$ is the JPY-denominated notional on the receive leg, $X_i^{JPY/USD}$ is the forward JPY/USD FX rate at time $t_i$, $K$ is the upper barrier, and $r_s$ is the domestic (JPY) interest rate.

Similarly, the pay leg is given as,

$$\text{PayLeg(JPY)} = \mathbb{E}\left[N_p \sum_{i=1}^{N} X_i^{JPY/USD} \mathbb{I}(X_i^{JPY/USD} < K)e^{-\int_{t_0}^{t_i} r_s ds}\right]$$

where $N_p$ is the USD-denominated notional on the pay leg, which is converted to JPY via the multiplication with the forward FX rate, $X_i^{JPY/USD}$.

| PV | USD DELTA | JPY DELTA | USD VEGA | JPY VEGA | FXDELTA | FXVEGA | FXGAMMA | Corr. Sens. |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| -30,105,122.56 | 8,472.81 | -12,078.67 | 18,825.71 | -623.09 | 1,782,6739.07 | 1,170,665.26 | 671,606.78 | 35,607.30 |

Table 79: LTFXParForwardKnockOut: PV and main risk sensitivities calculated in EOD scenario. The values are expressed in JPY (which is the domestic market). We can see that the main risk factors are the FX spot rate and the volatility of the FX rate. Trade valuation date is 09/12/2021.

![Figure 192: Left: PV of LTFXParForwardKnockOut as function of upper barrier applied to the FX spot rate on the ReceiveLeg. The FX spot rate is less likely to reach the barrier value as the upper barrier value increases. This implies that the receive leg's coupons are increasing in value, thus increasing the total PV of the product. Right: PV of LTFXParForwardKnockOut as function of upper barrier applied to the FX spot rate on the PayLeg. The FX spot rate is less likely to reach the barrier value as the upper barrier value increases. This implies that the pay leg's coupons are increasing in value, thus decreasing the total PV of the product.](./Fig/192.png)

The dictionary has been tested against the model rules submitted for approval,

| Property | Value |
| --- | --- |
| MVModelName | DBX-ShortRate_FXSkewStochVol |
| DB_RiskProduct | LTFXParForwardKnockOut |
| ModelRule Filter Name | PARAMCONTROL |
| ModelRule Filter Version | 20230602 |
| ModelRuleStatus | PASS |

### 4.6.2 Monte Carlo convergence: Price and Risk Sensitivities

We first carry out testing to ensure that the product's PV and main risk sensitivities are robust as the parameters relevant for the Monte Carlo simulation are varied.

The market trade has the following parameters for the DBX model;

| Parameter | Value |
| --- | --- |
| NumberSims | 15000 |
| NumberRuns | 1 |
| FrontLatticeFreq | 96 |
| FreqTimeVec | 12 |
| IntegrationFreq | 365 |

The convergence results are shown in Figures 193 and 194 for price and all risk sensitivities. We see that all estimates converge to stable values.

Figure 193 shows the price and risk sensitivities for the LTFXParForwardKnockOut trade as a function of the number of simulations in the Monte Carlo (DBX) model. The price and risk sensitivities all converge to stable values.

![Figure 193: a) Price, b) Flat Delta - JPY, c) FX Delta, d) Flat Delta - USD, e) FX Gamma, and f) FX Vega estimates for the LTFXParForwardKnockOut trade as a function number of simulations in the Monte Carlo (DBX) model. The price and risk sensitivities all converge to stable values.](./Fig/1.png)

Figure 194 shows the Flat Vega values for the LTFXParForwardKnockOut trade as a function of the number of simulations in the Monte Carlo (DBX) model. The Flat Vega values converge to a stable value.

![Figure 194: a) Flat Vega - JPY, and b) Flat Vega - USD for the LTFXParForwardKnockOut trade as a function number of simulations in the Monte Carlo (DBX) model. The Flat Vega values converge to a stable value.](./Fig/2.png)

### 4.6.3 Correlation Sensitivity

Figure 195 shows the PV impact of correlation between the FX volatility and domestic/foreign IR volatility for the LTFXParForwardKnockOut product, with and without the KnockOut feature (LTFXParForward). When the KnockOut feature is removed from the product, the correlation has no impact on the PV.

![Figure 195: Price as a function of the correlation between the JPY/USD FX volatility and the domestic/foreign IR volatility for the LTFXParForwardKnockOut, with and without the KnockOut feature (LTFXParForward). Correlation has a greater impact on price when the trade has the KnockOut than without.](./Fig/2.png)

This trade has a path-dependent KnockOut feature on the FX rate, and therefore it is highly sensitive to the FX volatility (see Figure 217). Increases in this risk factor leads to a decrease in the survivability of both the pay and receive legs. It also has a non-zero positive correlation between the FX volatility and the rates volatility. Therefore shifts in the domestic or foreign IR volatility will have an impact on the forward FX and thus on the overall PV. When the KnockOut feature is removed, the impact of IR volatility is non-existent, see Figure 196.

### 4.6.4 Calibration Testing

#### 4.6.4.1 Repricing Calibration Targets

The results of the autocalibration step of the market trade are given in Tables 82, 83, and 84 for the domestic IR, foreign IR and FX volatility. The trade ends on 28/06/2024, and for IR volatility, this generates three coterminal swaptions at pegs {1y, 18m, 2y}. After the fitting procedure, the difference between the target market implied volatility, and the implied volatility, from the LVMR, is negligible. For FX volatility, PIVAutofit calibrates the market DN, 25RR, 10CVX to an SA4 parametric function. Again, the difference in implied volatility between the market and model is insignificant.

Table 82: Summary of autocalibration results for the domestic (JPY) IR volatility.

| OptionType | Notional | OptionMat | Tenor | Strike | MarketVols | ModelVols | VolDiffs | MarketPrices | ModelPrices | PriceDiffs |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| STRADDLE | 100 | 1y | 20240628 | 0.000171 | 0.001056 | 0.001055 | -7.34661e-06 | 0.131179 | 0.132060 | -0.000811 |
| STRADDLE | 100 | 18m | 20240628 | 0.000154 | 0.001161 | 0.001160 | 1.08137e-06 | 0.119687 | 0.119575 | 0.000111 |
| STRADDLE | 100 | 2y | 20240628 | 0.000109 | 0.001369 | 0.001369 | -1.26935e-07 | 0.084635 | 0.084843 | -0.000008 |

Table 83: Summary of autocalibration results for the foreign (USD) IR volatility.

| OptionType | Notional | OptionMat | Tenor | Strike | MarketVols | ModelVols | VolDiffs | MarketPrices | ModelPrices | PriceDiffs |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| STRADDLE | 100 | 1y | 20240628 | 0.014373 | 0.016693 | 0.016693 | 4.75374e-12 | 2.036731 | 2.036731 | 5.60573e-10 |
| STRADDLE | 100 | 18m | 20240628 | 0.015962 | 0.014860 | 0.014860 | 2.16209e-11 | 1.501479 | 1.501479 | 2.14886e-09 |
| STRADDLE | 100 | 2y | 20240628 | 0.016778 | 0.013071 | 0.013071 | -1.31915e-10 | 0.791360 | 0.791360 | -7.96851e-09 |

[Table with maturity, delta, targetVol, fittedVol, and fitError]

| Maturity | Delta | TargetVol | FittedVol | FitError |
| --- | --- | --- | --- | --- |
| 20220310 | DN | 0.071548 | 0.071548 | 4.70986e-11 |
| 20220310 | 25RR | -0.010227 | -0.010227 | -4.05022e-11 |
| 20220310 | 10CVX-DN | 0.009088 | 0.009088 | -3.84360e-10 |
| 20220609 | DN | 0.071604 | 0.071604 | 8.24450e-11 |
| 20220609 | 25RR | -0.010260 | -0.010260 | -5.30888e-11 |
| 20220609 | 10CVX-DN | 0.010244 | 0.010244 | -5.91662e-10 |
| 20221209 | DN | 0.071497 | 0.071497 | 2.04211e-10 |
| 20221209 | 25RR | -0.009942 | -0.009942 | -7.18091e-11 |
| 20221209 | 10CVX-DN | 0.012409 | 0.012409 | -1.19672e-09 |
| 20231211 | DN | 0.071470 | 0.071470 | 3.29736e-14 |
| 20231211 | 25RR | -0.009527 | -0.009527 | 7.92768e-16 |
| 20231211 | 10CVX-DN | 0.014696 | 0.014696 | -2.22513e-14 |
| 20241211 | DN | 0.071272 | 0.071272 | 8.90815e-14 |
| 20241211 | 25RR | -0.009265 | -0.009265 | 1.31630e-14 |
| 20241211 | 10CVX-DN | 0.017391 | 0.017391 | -7.91970e-14 |
| 20261210 | DN | 0.071039 | 0.071039 | 3.94170e-13 |
| 20261210 | 25RR | -0.008815 | -0.008815 | 1.02300e-13 |
| 20261210 | 10CVX-DN | 0.022082 | 0.022082 | -4.17745e-13 |
| 20281211 | DN | 0.072899 | 0.072899 | 1.11448e-12 |
| 20281211 | 25RR | -0.015301 | -0.015301 | 2.49108e-13 |
| 20281211 | 10CVX-DN | 0.025578 | 0.025578 | -1.38678e-12 |
| 20311211 | DN | 0.084263 | 0.084263 | 1.89091e-12 |
| 20311211 | 25RR | -0.034382 | -0.034382 | 3.64930e-13 |
| 20311211 | 10CVX-DN | 0.029727 | 0.029727 | -2.76343e-12 |
| 20361211 | DN | 0.102651 | 0.102651 | 1.45026e-10 |
| 20361211 | 25RR | -0.047518 | -0.047518 | -2.10446e-10 |
| 20361211 | 10CVX-DN | 0.027013 | 0.027013 | -1.13267e-09 |
| 20411211 | DN | 0.106374 | 0.106374 | 8.44937e-11 |
| 20411211 | 25RR | -0.048224 | -0.048224 | -1.22992e-10 |
| 20411211 | 10CVX-DN | 0.025030 | 0.025030 | -7.75338e-10 |
| 20511211 | DN | 0.114448 | 0.114448 | 8.82116e-11 |
| 20511211 | 25RR | -0.049451 | -0.049451 | -6.93126e-11 |
| 20511211 | 10CVX-DN | 0.025009 | 0.025009 | -7.89981e-10 |

Table 84: Summary of autocalibration results for the JPY/USD FX volatility.

#### 4.6.4.2 Sensitivity to Initial Guesses used for Parameters

The LocalVols are set to a flat value of 28.855 bps for the full term structure. In this section, we test the sensitivity of the calibration results for initial flat values in {1, 5, 10, 50, 100, 500} bps. The calibration should be robust to our choice in initial LVs, and this is evident by the difference in implied volatility and prices between the market and model, given in Tables 85 and 86 for the JPY IR vol, and 87 and 88 for the USD IR vol.

Table 85: Difference in implied volatility between the market and model for different starting LocalVols in the domestic (JPY) IR vol object.

| OptionMat | Tenor | Strike | VolDiff (1 bps) | VolDiff (5 bps) | VolDiff (10 bps) | VolDiff (50 bps) | VolDiff (100 bps) | VolDiff (500 bps) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1y | 20240628 | 0.000171 | -7.34661e-06 | -7.34661e-06 | -7.34661e-06 | -7.34665e-06 | -7.34671e-06 | -7.34624e-06 |
| 18m | 20240628 | 0.000154 | 1.08132e-06 | 1.08132e-06 | 1.08132e-06 | 1.08105e-06 | 1.08090e-06 | 1.08125e-06 |
| 2y | 20240628 | 0.000109 | -1.29071e-07 | -1.29071e-07 | -1.29071e-07 | -1.29408e-07 | -1.29544e-07 | -1.29066e-07 |

Table 86: Difference in price between the market and model for different starting LocalVols in the domestic (JPY) IR vol object.

| OptionMat | Tenor | Strike | PriceDiff (1 bps) | PriceDiff (5 bps) | PriceDiff (10 bps) | PriceDiff (50 bps) | PriceDiff (100 bps) | PriceDiff (500 bps) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1y | 20240628 | 0.000171 | -0.000811 | -0.000811 | -0.000811 | -0.000811 | -0.000811 | -0.000811 |
| 18m | 20240628 | 0.000154 | 0.000111 | 0.000111 | 0.000111 | 0.000111 | 0.000111 | 0.000111 |
| 2y | 20240628 | 0.000109 | -0.000008 | -0.000008 | -0.000008 | -0.000008 | -0.000008 | -0.000008 |

Table 87: Difference in implied volatility between the market and model for different starting LocalVols in the foreign (USD) IR vol object.

| OptionMat | Tenor | Strike | VolDiff (1 bps) | VolDiff (5 bps) | VolDiff (10 bps) | VolDiff (50 bps) | VolDiff (100 bps) | VolDiff (500 bps) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1y | 20240628 | 0.014373 | 5.93017e-13 | 5.93017e-13 | 5.93017e-13 | 1.06097e-13 | 9.26965e-13 | -7.54043e-14 |
| 18m | 20240628 | 0.015962 | 2.22923e-12 | 2.22923e-12 | 2.22923e-12 | 4.42573e-13 | -1.46840e-12 | 6.43796e-12 |
| 2y | 20240628 | 0.016778 | -1.46242e-11 | -1.46242e-11 | -1.46242e-11 | -1.03921e-11 | -8.47734e-11 | -6.27374e-11 |

Table 88: Difference in price between the market and model for different starting LocalVols in the foreign (USD) IR vol object.

| OptionMat | Tenor | Strike | PriceDiff (1 bps) | PriceDiff (5 bps) | PriceDiff (10 bps) | PriceDiff (50 bps) | PriceDiff (100 bps) | PriceDiff (500 bps) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1y | 20240628 | 0.014373 | 6.14337e-11 | 6.14337e-11 | 6.14337e-11 | 2.59417e-11 | 1.13174e-11 | -9.20967e-12 |
| 18m | 20240628 | 0.015962 | 2.25245e-10 | 2.25245e-10 | 2.25245e-10 | 4.47160e-11 | -1.48372e-10 | -6.56616e-10 |
| 2y | 20240628 | 0.016778 | -8.85389e-10 | -8.85389e-10 | -8.85389e-10 | -6.25109e-10 | -5.33821e-09 | -3.97856e-09 |

#### 4.6.4.3 DLV Calibration

We use the following DLV parameters in the MODEL object to test the quality of calibration fit:

| Parameter | Value |
| --- | --- |
| NumberSims | 10000 |
| Maxiter | 0 |
| FrontLatticeFreq | 96 |
| IntegrationFreq | 365 |
| DLVCalibration | ALL |
| DLVCalibrationType | SIMPLE-SMOOTH |

FXSkewStochVol[DLVAuto]. Figure 197 shows the comparison between the market implied volatility, fitted using a SA4 parametric function, and the DLV for options at different maturities. The SA4 parametric function is fitted using the DBSMC-RateDeterministic_FXMarket model. There is a good quality of fit between DLV and the parametric implied volatility.

![Figure 197: Comparison between the market implied volatility for the JPY/USD FX rate computed using the DBSMC-RateDeterministic_FXMarket model and the Dupire local volatility (DLV) at option maturities of a) 3m, b) 6m, c) 1y, d) 5y, e) 10y and f) 30y.](./Fig/7.png)

### 4.6.5 EOD testing: Price and Risk Sensitivities

#### 4.6.5.1 Domestic IR Curve Shifts

We examine the behaviour of the product's PV under parallel shifts of the domestic (JPY) interest rate curve in Figures 198 and 199.

![Figure 198: a) Total PV, b) RecPV, and c) PayPV as a function of parallel shifts of the domestic (JPY) IR curve. An upward shift of the JPY rate causes JPY/USD FX forward rates to also increase, and therefore the both the pay and receive leg are more likely to knock out due to the barrier. The PayPV decreases faster than the RecPV because it's cashflows, once converted to JPY, are higher. This leads to an increase in PV. See Figure 199 for in-depth analysis.](./Fig/8.png)

![Figure 199: a) Discount factor, and b) JPY/USD FX forward rate for JPY curve shifts in {-0.05, -0.00, 0.05}. At a higher JPY rate, the discount factor decreases, while the JPY/USD FwdFX rate increases. The increase in the FwdFX is equal and opposite to the decrease in the DiscFact, and therefore the pay coupons (DiscFact × FwdFX) are constant to JPY rate shifts. c) The cash flows on the receive (solid) and pay (dashed) legs. The pay cashflows decrease faster than the receive ones, because their coupons are larger, and also because for negative shifts of the JPY rate, the DiscFact > 1, and therefore the receive PvLet is higher (DiscFact is cancelled perfectly by FwdFX on the pay leg). d) Difference in PvLet on the receive and pay legs at each pay date.](./Fig/9.png)

Figures 200 and 201 show the PV and main risk sensitivities as a function of the domestic (JPY) interest rate curve. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 200: a) Price, b) JPY/USD FX Delta, c) Flat Delta - JPY, d) Flat Delta - USD, e) JPY/USD FX Vega, and f) JPY/USD FX Gamma as a function of parallel shifts of the domestic (JPY) IR curve. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/10.png)

![Figure 201: a) Flat Vega - JPY, and b) Flat Vega - USD as a function of parallel shifts of the domestic (JPY) IR curve.](./Fig/11.png)

#### 4.6.5.2 Foreign IR Curve Shifts

We examine the behaviour of the product's PV under parallel shifts of the foreign (USD) interest rate curve in Figures 202.

![Figure 202: a) Total PV, b) RecPV, and c) PayPV as a function of parallel shifts of the foreign (USD) IR curve. This behaviour is opposite to domestic rate shifts. Upward shifts of the USD rate causes JPY/USD FX forward rates to decrease, and pay/rec legs are less likely to knock out. Like before, the pay leg increases faster than the rec leg, because the cashflows are larger, and therefore the PV decreases.](./Fig/12.png)

Figures 203 and 204 show the PV and main risk sensitivities as a function of the foreign (USD) interest rate curve. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 203: a) Price, b) JPY/USD FX Delta, c) Flat Delta - JPY, d) Flat Delta - USD, e) JPY/USD FX Vega, and f) JPY/USD FX Gamma as a function of parallel shifts of the foreign (USD) IR curve. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/13.png)

![Figure 204: a) Flat Vega - JPY, and b) Flat Vega - USD as a function of parallel shifts of the foreign (USD) IR curve.](./Fig/14.png)

#### 4.6.5.3 Domestic IR Volatility Shifts

We examine the behaviour of the product's PV under relative shifts of the domestic (JPY) interest rate volatility in Figures 205 and 206.

![Figure 205: a) Total PV, b) RecPV, and c) PayPV as a function of relative shifts of the domestic (JPY) IR volatility. An upward shift of the JPY IR volatility slightly increases the probability of the cashflows on the receive and pay legs to survive the KO barrier. Therefore, both the RecPV and PayPV increase. See Figure 206 for in-depth analysis.](./Fig/15.png)

![Figure 206: Barrier survival for a) all cashflows, and zoomed in on the b) later cashflows. As the JPY IR volatility is increased, it is slightly more likely for the receive and pay cashflows to survive the KO barrier. This has only a minor impact on PV.](./Fig/16.png)

Figures 207 and 208 show the PV and main risk sensitivities as a function of the domestic (JPY) IR volatility. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 207: a) Price, b) JPY/USD FX Delta, c) Flat Delta - JPY, d) Flat Delta - USD, e) JPY/USD FX Vega, and f) JPY/USD FX Gamma as a function of relative shifts of the domestic (JPY) IR volatility. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/17.png)

![Figure 208: a) Flat Vega - JPY, and b) Flat Vega - USD as a function of relative shifts of the domestic (JPY) IR volatility.](./Fig/18.png)

#### 4.6.5.4 Foreign IR Volatility Shifts

We examine the behaviour of the product's PV under relative shifts of the foreign (USD) interest rate volatility in Figures 209 and 210.

![Figure 209: a) Total PV, b) RecPV, and c) PayPV as a function of relative shifts of the foreign (USD) IR volatility. Shifts in the USD IR volatility does not lead to parallel shifts of the survival probability of the cashflows. The dependence of later cashflows' survivability on preceding cashflows leads to the increasing and decreasing behaviour of the PV. See Figure 210 for in-depth analysis.](./Fig/19.png)

![Figure 210: a) JPY/USD forward FX rates and b) barrier survival probability for USD IR volatility shifts in {-0.95, 0.53, 2.0}. As the USD IR volatility is increased, intermediate cashflows are slightly less likely to survive the KO barrier, but for the paths that do survive, the later cashflows are less likely to knockout. This risk factor has only a minor impact on PV.](./Fig/20.png)

Figures 211 and 212 show the PV and main risk sensitivities as a function of the foreign (USD) IR volatility. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 211: a) Price, b) JPY/USD FX Delta, c) Flat Delta - JPY, d) Flat Delta - USD, e) JPY/USD FX Vega, and f) JPY/USD FX Gamma as a function of relative shifts of the foreign (USD) IR volatility. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/21.png)

![Figure 212: a) Flat Vega - JPY, and b) Flat Vega - USD as a function of relative shifts of the foreign (USD) IR volatility.](./Fig/22.png)

### 4.6.5.5 FX Spot Shifts

We examine the behaviour of the product's PV under relative shifts of the JPY/USD FX spot rate in Figures 213 and 214.

![Figure 213: a) Total PV, b) RecPV, and c) PayPV as a function of relative shifts of the JPY/USD FX spot rate. The trade is currently at the money, so positive shifts of the FX spot causes the forward FX rates to increase and the cashflows for the receive and pay legs are knocked out. PV tends to zero. For negative spot shifts, the legs are in the money but due to the currency conversion on the pay leg, the pay cashflows are multiplied by a falling FX forward rate. Thus the PayPV decreases as the FX spot rate is shifted down, and this translates to an increase in the overall PV. See Figure 214 for in-depth analysis.](./Fig/23.png)

![Figure 214: a) JPY/USD forward FX rates and b) barrier survival probability for JPY/USD FX spot shifts in {-0.95, 0.03, 2.0}. The grey dashed line in (a) indicates the KO barrier of 120. When the JPY/USD FX rate is increased, the barrier survival drops to 0, and therefore the cashflows on the c) receive and d) pay leg also drop to 0. Equally, when the FX spot rate drops, the survival probability rises to 1, and all cashflows survive. On the pay leg, all pay cashflows are multiplied by a smaller FwdFX, leading to the linear decrease in PayPV.](./Fig/24.png)

Figures 215 and 216 show the PV and main risk sensitivities as a function of the JPY/USD FX spot rate. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 215: a) Price, b) JPY/USD FX Delta, c) Flat Delta - JPY, d) Flat Delta - USD, e) JPY/USD FX Vega, and f) JPY/USD FX Gamma as a function of relative shifts of the JPY/USD FX spot rate. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/25.png)

![Figure 216: a) Flat Vega - JPY, and b) Flat Vega - USD as a function of relative shifts of the JPY/USD FX spot rate.](./Fig/26.png)

### 4.6.5.6 FX Volatility Shifts

We examine the behaviour of the product's PV under relative shifts of the JPY/USD FX volatility in Figures 217 and 218.

![Figure 217: a) Total PV, b) RecPV, and c) PayPV as a function of relative shifts of the JPY/USD FX volatility. When the FX volatility increases, both legs are less likely to survive the KO barrier and therefore RecPV and PayPV decreases. At a particular negative shift of the FX volatility, the survival probability is 100% for all cashflows and further down shifts have no effect on the PV. See Figure 218 for in-depth analysis.](./Fig/27.png)

![Figure 218: a) JPY/USD forward FX rates and b) barrier survival probability for JPY/USD FX volatility shifts in {-0.95, -0.14, 1.4}. All FwdFX are currently below the KO barrier (K = 120), and therefore decreasing the FX volatility should lead to a 100% survival rate for all cashflows. When FX volatility rises, it becomes more likely for the FwdFX to be greater than the KO barrier, and thus survivability decreases.](./Fig/28.png)

Figures 219 and 220 show the PV and main risk sensitivities as a function of the JPY/USD FX volatility. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 219: a) Price, b) JPY/USD FX Delta, c) Flat Delta - JPY, d) Flat Delta - USD, e) JPY/USD FX Vega, and f) JPY/USD FX Gamma as a function of relative shifts of the JPY/USD FX volatility. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/29.png)

![Figure 220: a) Flat Vega - JPY, and b) Flat Vega - USD as a function of relative shifts of the JPY/USD FX volatility.](./Fig/30.png)

### 4.6.5.7 Taylor Test

In this section, we test how well the Delta-Gamma-Vega expansion of the present value approximates the present value in a neighborhood of the point

(FX Spot Shift, FX Vol Shift) = (0, 0)                                     (51)

More precisely, we check that for spot and volatility shifts $(C, \sigma)$ in a neighborhood of $(0, 0)$ (which we chose to be $(-10\%, 10\%) \times (-60\%, 60\%)$ we have

$PV(C, \sigma) \approx PV(0, 0) + \frac{1}{\delta_\Delta}\Delta(0, 0)C + \frac{1}{\delta_\nu}\nu(0, 0)\sigma + \frac{1}{2}\frac{1}{\delta_\Gamma}\Gamma(0, 0)C^2$,                                     (52)

where $\Delta$, $\nu$ and $\Gamma$ denote here the FXDELTA, FLATVEGA and FXGAMMAAVE and $\delta_\Delta$, $\delta_\nu$, and $\delta_\Gamma$ represent the shift sizes used in the computation of FXDELTA, FLATVEGA and FXGAMMAAVE, respectively.

![Figure 221: a) Price against JPY/USD FX spot shift calculated with DBAnalytics (red), and the first (green) and second (blue) order Taylor approximations. b) Price against JPY/USD FX vol shift calculated with DBAnalytics (red), and the first order (green) Taylor approximation.](./Fig/31.png)

![Figure 222: a) The price computed by DBAnalytics is shown as a coloured surface plot as a function of JPY/USD FX spot and vol shifts. The black wireframe shows the Taylor-approximated price, computed using the market PV, FX Delta, FX Gamma, Flat Vega. b) The absolute difference between the price calculated by DBAnalytics and the price approximated from the Taylor expansion.](./Fig/31.png)

### 4.6.6 IRRBB Scenarios testing

In this subsection we perform the IRRBB test of the LTFXParForwardKnockOut product. We study 10 IRRBB scenarios and the 'base' scenario, which corresponds to the current state of the market: 'base', 'parallel_up', 'parallel_down', 'steepener', 'flattener', 'short_up', 'short_down', 'long_up', 'long_down', 'steepener neg' and 'flattener neg'.

The effect of the IRRBB scenarios on the base case is illustrated in Figure 223 for the domestic yield curve (JPY) and in Figure 224 for the foreign yield curve (USD).

![Figure 223: The IRRBB scenarios applied to the base case of the domestic (JPY) yield curves.](./Fig/32.png)

![Figure 224: The IRRBB scenarios applied to the base case of the foreign (USD) yield curves.](./Fig/33.png)

Interest Rate curve shifts. We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the JPY interest rate curve and USD interest rate curve in the EOD scenario (added for comparison) and 10 IRRBB scenarios. The test results show that the profiles are smooth.

![Figure 225: a) Price and b) Flat Delta - JPY under parallel shifts of domestic (JPY) interest rate curve for the base and IRRBB scenarios.](./Fig/34.png)

![Figure 226: a) Price and b) Flat Delta - USD under parallel shifts of foreign (USD) interest rate curve for the base and IRRBB scenarios.](./Fig/34.png)

Interest Rate volatility shifts. We examine the behaviour of the product's PV and the main risk sensitivities under relative shifts of the JPY interest rate volatility and USD interest rate volatility. The test results show that the profiles are smooth.

![Figure 227: a) Price and b) Flat Vega - JPY under parallel shifts of domestic (JPY) interest rate volatility for the base and IRRBB scenarios.](./Fig/35.png)

![Figure 228: a) Price and b) Flat Vega - USD under parallel shifts of foreign (USD) interest rate volatility for the base and IRRBB scenarios.](./Fig/35.png)

FX spot shifts. We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the JPY/USD FX spot rate. The test results show that the profiles are smooth.

![Figure 229: a) Price and b) FX Delta - JPY/USD under relative shifts of JPY/USD FX spot rate for the base and IRRBB scenarios.](./Fig/36.png)

FX VOL shifts. We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the FX rate volatility. The test results show that the profiles are smooth.

![Figure 230: a) Price and b) FX Vega - JPY/USD under relative shifts of JPY/USD FX volatility for the base and IRRBB scenarios.](./Fig/36.png)

### 4.6.7 CCAR Scenarios testing

The 2023 CCAR shocks have been applied to the EOD dictionary (Base scenario) for testing.

Interest Rate curve shifts. We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the JPY interest rate curve and USD interest rate curve. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 231: a) Price and b) Flat Delta - JPY under parallel shifts of domestic (JPY) interest rate curve for the base and CCAR scenarios.](./Fig/37.png)

![Figure 232: a) Price and b) Flat Delta - USD under parallel shifts of foreign (USD) interest rate curve for the base and CCAR scenarios.](./Fig/37.png)

Interest Rate volatility shifts. We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the JPY interest rate volatility and USD interest rate volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 233: a) Price and b) Flat Vega - JPY under relative shifts of domestic (JPY) interest rate volatility for the base and CCAR scenarios.](./Fig/38.png)

![Figure 234: a) Price and b) Flat Vega - USD under relative shifts of foreign (USD) interest rate volatility for the base and CCAR scenarios.](./Fig/38.png)

FX spot rate shifts. We examine the behaviour of the product's PV and risk sensitivities under relative shifts of the FX spot rate. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 235: a) Price and b) FX Delta - JPY/USD under relative shifts of JPY/USD FX spot rate for the base and CCAR scenarios.](./Fig/39.png)

FX rate volatility shifts. We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the volatility of FX rate. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 236: a) Price and b) FX Vega - JPY/USD under relative shifts of JPY/USD FX volatility for the base and CCAR scenarios.](./Fig/39.png)

### 4.6.8 MultiVar Scenarios testing

For the given dictionary, DBAnalytics identifies the following risk factors:

Table 90: Risk Factors identified by DBAnalytics in the dictionary of PRDCSwapCallable and shock availability in list provided by Market Risk.

| ObjectType | Currency | RiskFactor | Shocks Availability |
| --- | --- | --- | --- |
| IRCURVE | JPY | JPY | CCYSPREAD | Yes |
| IRCURVE | JPY | JPY | DISCOUNTSPREAD | Yes |
| IRCURVE | JPY | JPY | OISSPREAD | Yes |
| IRCURVE | JPY | JPY | SWAP | Yes |
| IRCURVE | USD | USD | OISSPREAD | Yes |
| IRCURVE | USD | USD | SWAP | Yes |
| FXSPOT | JPY/USD | JPY/USD | SPOT | Yes |
| IRDBOPTVOL | JPY | JPY | CMSMAT | Yes |
| IRDBOPTVOL | USD | USD | CMSMAT | Yes |
| FXMARKETVOL | JPY/USD | JPY/USD | ATMVOL | Yes |
| FXMARKETVOL | JPY/USD | JPY/USD | CONVEXITY | Yes |
| FXMARKETVOL | JPY/USD | JPY/USD | DELTAVOL | Yes |
| FXMARKETVOL | JPY/USD | JPY/USD | SLOPE | Yes |
| FXSTOCHBMVOL | JPY/USD | JPY/USD | LOCALVOL | No |
| FXSTOCHBMVOL | JPY/USD | JPY/USD | MEANREV | No |

The identified risk factors are correct: LTFXParForwardKnockOut is an FX derivative whose payoff depends on the JPY/USD FX rate. There is two interest rates present in the dictionary: the USD rate and the JPY rate. As described in [21], every curve is constructed starting from a base curve (LIBOR 3M USD in this case) with the help of additional spreads. The curve construction model simultaneously constructs a LIBOR forecasting curve and an OIS discounting curve. This explains the presence of the OISSPREAD among the risk factors. The FundingName assigned in this security is "global-markets-usd" that corresponds to Funding name "usdsf-", which implies that DISCOUNTSPREADs are necessary and the product will show sensitivity to them.

The USD and JPY interest rates are modelled as Hull-White processes with time-dependent volatility that calibrate to the input DBOPT volatility objects. Therefore each volatility object will show sensitivity to the inputs CMSMAT. The JPY/USD FX rate is modelled as a lognormal local volatility (Dupire-type) process which is calibrated to an input volatility object of type DELTAVOL consisting of a volatility surface of type DN/CVX/RR. Therefore the product will show sensitivity to these inputs. However, the provided shocks do not cover the given configuration, being given in a ATMVOL/SLOPE/CONVEXITY format. Therefore, in order to stress the FX volatility, we opt for a simplification and apply the ATMVOL shocks to the DN inputs stored in the DELTAVOL object.

The product shows sensitivity to those instruments relevant for the time period between valuation date and expiry date.

We apply the SVAR 10D shocks gradually to the EOD dictionary by stressing all the risk factors listed in Table 90 using the logic described above. We obtain the following profiles:

![Figure 237: PV of LTFXParForwardKnockOut. The PV ladder shows that the pricing model is sufficiently robust to price in extremely stressed scenarios. As we evolve from the EOD scenario to the stressed VaR 10D scenario the profile of the PV remains stable and well-behaved. The test is passed.](./Fig/37.png)

![Figure 238: PV when only the term structure of a) FXSPOT, b) FXMARKETVOL, c) IRCURVE, and d) IRDBOPTVOL is stressed. The PV ladder shows that the pricing model is sufficiently robust to price in extremely stressed scenarios. As we evolve from the EOD scenario to the stressed VaR 10D scenario the profile of the PV remains stable and well-behaved. The test is passed.](./Fig/38.png)

### 4.6.9 Impact of parameters set by expert-judgement

The parameters of the SV component of the FX rate are set by expert judgement and are stored in a VOL object of DiffusionType=STOCHVOL. In the following figure, we examine the impact of the parameters stored in the TermVols table, see Section 2.3 for a complete description of the parameters. The original TermVols table is the following:

| Maturity | 1Y | 2Y | 3Y | 5Y | 7Y | 10Y | 15Y | 20Y | 30Y |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Vol | 0.415 | 0.33 | 0.263 | 0.241 | 0.232 | 0.219 | 0.2 | 0.2 | 0.2 |

Table 91: TermVol table stored in the VOL object of DiffusionType = STOCHVOL. These values are exogenously set.

Note that the SV component of the FX rate volatility is used in the last step of the calibration, and provides the final decomposition of the FX rate volatility into an LV component and SV component, see Section 2.3.10. The method used in the calculation of the decomposition is calculated is controlled by the property DirectSLVCalculationMethod which has several modes allowed: FFT, FFT-2, BIN and DBL. The following figure figure shows the impact of the TermVols parameters on the product's price as we apply shifts ranging from -50% to +50% to the original term structure stored in the TermVols table in 3 scenarios for DirectSLVCalculationMethod: FFT, FFT-2 and BIN[^21].

![Figure 239: PV of LTFXParForwardKnockOut for different scenarios of vol-of-vol created by applying relative shifts ranging from -50% to +50% to the original TermVols table stored in the VOL object of DiffusionType=STOCHVOL. The test shows that the SV parameters, set by expert judgement, have an impact on the LTFXParForwardKnockOut's price.](./Fig/39.png)

The following figures examine the impact of the mean-reversion parameters of the interest rate process on the price of LTFXParForwardKnockOut. The mean-reversion parameters are exogenously set.

![Figure 240: PV of LTFXParForwardKnockOut for different values of USD IR VOL MeanRev parameters (left) and JPY IR VOL MeanRev parameters (right). The test shows that these parameters, set by expert judgement, have an impact on the LTFXParForwardKnockOut's price.](./Fig/40.png)

## 4.7 Product Testing: PRDCSwapCallable

The testing done in this section is for Q2 2023 with model configuration

DBX-ShortRate[LVMR]_FXSkewStochVol[DLVAUTO]

using DBAnalytics version 1240.

| Property | Value |
| --- | --- |
| MVModelName | DBX-ShortRate_FXSkewStochVol |
| DB_RiskProduct | PRDCSwapCallable |
| ModelRule Filter Name | PARAMCONTROL |
| ModelRule Filter Version | 20230602 |
| ModelRuleStatus | PASS |

The following parameters in the MODEL object have been used for FXSkewStochVol[DLVAUTO] calibration.

| Parameter | Value |
| --- | --- |
| NumberSims | 10000 |
| MaxIter | 0 |
| FrontLatticeFreq | 96 |
| IntegrationFreq | 365 |
| DLVCalibration | ALL |
| DLVCalibrationType | SIMPLE-SMOOTH |

Figure 241 shows the comparison between the market (parametric implied volatility using DBSMC model) and model (Dupire local volatility using DBX model) implied volatility on the EOD dictionary. The fit quality is good.

![Figure 241: Comparison between market implied volatility determined by DBSMC model and model implied volatility by Dupire local volatility (DLV) at different option maturities.](./Fig/41.png)

### 4.7.1 Product Description

A PRDCSwapCallable is a power reverse dual-currency swap that can be terminated early at the discretion of the payer of the FX-linked coupons on any of the pre-defined dates. In the case of early termination the principals are re-exchanged back on the early termination date.

The tested product consists of a PayLeg and a ReceiveLeg both having the same EffectiveDate 2020-06-15, RollDate 2020-06-15 and EndDate 2050-06-15. The receive leg is JPY-denominated and makes quarterly payments depending on the JPY LIBOR 3M. More precisely, at every pay date $t_i$, the ReceiveLeg makes net payments equal to

$$PV_{rec}^{JPY} = N^{JPY} \cdot \mathbb{E}\left[\sum_{i=1}^{120} (L_i^{JPY} + S_{rec}^{JPY}) \cdot \Delta_i \cdot \exp\left(-\int_{t_v}^{t_i} r_s ds\right)\right]$$

where $\Delta_i$ is the daycount fraction, $t_v$ is the ValuationDate = 2021-12-08, $S_{rec}^{JPY} = 0.0105$. Note that the 3m JPY Libor rates for the first 6 RecFlows are fixed at different values. Each leg has a trade notional $N^{JPY}$ of 100M.

The PayLeg of the product is JPY-denominated and makes semi-annual payments equal to

$$PV_{pay}^{JPY} = \mathbb{E}\left[\sum_{i=1}^{60} PayCoupon_i^{JPY} \cdot \Delta_i \cdot \exp\left(-\int_{t_v}^{t_i} r_s ds\right)\right]$$

$$PayCoupon_i^{JPY} = N^{JPY} \cdot \min\left(U_i, \max\left(Mult_i \cdot X^{JPY/USD}(t_i) + S^{JPY}(t_i), L_i\right)\right)$$

where $X$ represents the JPY/USD FX rate. Note that the first 3 PayCoupons are fixed. After the first two PayFlows, Multiplier $Mult_i = 0.0012058251$, Spread $S^{JPY}(t_i) = -0.1$, AbsCap $U_i = 0.03$ and AbsFloor $L_i = 0$.

The trade can be terminated between ExerciseStart 2021-06-15 and ExerciseEnd 2049-12-15 with 6M interval between exercise dates. The product has the representation OptionPosition = LONG and OptionType = CANCEL which implies:

$$PV = PV_{rec} - PV_{pay} + Option$$

Table 92 summarizes the key features for this trade.

| SecurityName | KOMULTIDUALCCY |  |
| --- | --- | --- |
| Currency | JPY/USD |  |
| ReportUnit | M |  |
| EffectiveDate | 20200615 | 20200615 |
| EndDate | 20500615 | 20500615 |
| Frequency | QUARTERLY | SEMI |
| AmearInterval | 3m | 0y |
| Notional | 100 | 100 |
| RateIndexType | LIBOR | FXRATE |
| RateTerm | 3M | 0Y |
| RateCurrency | JPY | JPY/USD |
| Spread | 0.0105 | 0 |
| TermBarrier | 9.99 | 9.99 |
| NumOptions | 1 |  |
| ExerciseStart | 20210615 |  |
| ExerciseEnd | 20491215 |  |
| ExerciseInterval | 6M |  |
| OptionPosition | LONG |  |
| OptionType | CANCEL |  |
| Strike | 0 | 0 |

Table 92: Key product features for PRDCSwapCallable.

Table 93 shows the main risk sensitivities for this trade.

| PV | USD DELTA | JPY DELTA | USD VEGA | JPY VEGA | FXDELTA | FXVEGA | FXGAMMA | Corr.Sens. |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 7,675,596.91 | -100,395.69 | -78,744.88 | 175,459.79 | 106,455.76 | -3,933,887.25 | -164,605.99 | 14,744.20 | -69,727.92 |

Table 93: PRDCSwapCallable: PV and main risk sensitivities calculated in EOD scenario. We can see that the main risk factors are the FX spot rate and the volatility of the FX rate. Trade valuation date is 08/12/2021.

#### JPY/USD FX Spot Shift

To test the key features of the trade, CalcIntrinsic is set to 1 to ignore all the volatilities. Figure 242 shows the rec leg is not affected by FX spot shift because it has no dependency on FX. However, $PV_{pay}$ is a positive function of FX spot shift and it is also capped and floored. When FX spot rate is increased, more and more PayFlows are capped and finally all PayCoupons are capped and vice versa. Note that $PV_{pay}$ is not equal to 0 when FX spot is significantly decreased. This is because the first 3 PayCoupons are fixed as mentioned above.

$UnderlyingSwap = PV_{rec} - PV_{pay}$. When the remaining $PV_{pay}$ (sum of PayCoupons after exercise date) is greater than the remaining $PV_{rec}$ (sum of RecCoupons after exercise date), the option will be exercised. Note that negative part of the UnderlyingSwap is not fully cancelled. This is because the option ExerciseStart date is 1y later than the trade start date - the option cannot cancel the first one year's swap if it is negative. This is well behaved and as expected.

![Figure 242: Left: $PV_{rec}$ and $PV_{pay}$; Right: AmericanOption, UnderlyingSwap and PV under relative shift of JPY/USD FX spot. The trade starts from 2020-06-15, option exercise starts from 2021-06-15. CalcIntrinsic = 1.](./Fig/42.png)

Figure 243 shows that the PV curves become smoother as FX volatility is increased, which is as expected.

![Figure 243: PV and FXVEGA as a function of JPY/USD FX spot shift under various levels of market FX volatilities.](./Fig/43.png)

#### JPY IR Curve Shift

Shifting up the JPY curve, to some extent, is similar to increasing the FX rate. But there is also a difference. As PayCurrency is in JPY, the discount factor can decrease as the JPY curve is shifted up. This is why there is a big drop in $PV_{pay}$ beyond 2% parallel shift of JPY curve, as shown in Figure 244. As the rec leg is dependent on JPY Libor and the increase effect of shifting up the JPY curve outweighs the decreasing effect of discount factor, $PV_{rec}$ increases as the JPY curve is shifted up. The LONG/CANCEL option behaves the same as discussed above.

![Figure 244: Left: $PV_{rec}$ and $PV_{pay}$; Right: AmericanOption, UnderlyingSwap and PV under parallel shift of JPY curve. The trade starts from 2020-06-15, option exercise starts from 2021-06-15. CalcIntrinsic = 1.](./Fig/44.png)

Figure 245 shows that the PV curves become smoother as JPY IR volatility is increased, which is as expected.

![Figure 245: PV and FLATVEGA as a function of parallel shift of JPY IR curve under various levels of market JPY IR volatilities.](./Fig/45.png)

#### USD IR Curve Shift

Shifting up the JPY curve, to some extent, is similar to decreasing the FX rate. As can be observed in Figure 246 that the rec leg is not impacted by USD curve shift, $PV_{pay}$ is a negative function of the shift of the USD curve. All behaviours are as expected.

![Figure 246: Left: $PV_{rec}$ and $PV_{pay}$; Right: AmericanOption, UnderlyingSwap and PV under relative shift of JPY/USD FX spot shift. The trade starts from 2020-06-15, option exercise starts from 2021-06-15. CalcIntrinsic = 1.](./Fig/46.png)

Figure 247 shows that the PV curves become smoother as JPY IR volatility is increased, which is as expected.

![Figure 247: PV and FLATVEGA as a function of parallel shift of JPY IR curve under various levels of market JPY IR volatilities.](./Fig/47.png)

![Figure 248: Left: PV of PRDCSwapCallable as function of multiplier parameter. We remind that the multiplier parameter $K$ appears in the expression of the coupons paid on the PayLeg. Increasing the multiplier value implies $max(min(S(T_1)) - K, L) > min(U, min(S(T_1)) - K)$ and $min(U, min(S(T_1)) - K) > U$ i.e. the value of the PayLeg will increase, and therefore the PV of PRDCSwapCallable is decreasing. Right: PV of PRDCSwapCallable as function of spread parameter $K$ present in the expression of the coupons paid on the PayLeg. Increasing the spread $K$ implies $max(min(S(T_1)) - K, L) < L$ and $min(U, L) = L = 0.0$. This implies that the value of the PayLeg is decreasing et the total PV is increasing. The observed behaviour is in line with expectations.](./Fig/48.png)

![Figure 252: PV and main risk sensitivities as the number of simulations are varied, for different seeds. The results show stable convergence.](./Fig/50.png)

### 4.7.3.2 JPY/USD FX Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the volatility of FX rate. The test results show that the profiles of the PVs and risk sensitivities are smooth.

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the FX spot rate. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 253: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of relative shift of JPY/USD FX spot rate. All values are well behaved and as expected.](./Fig/51.png)

### 4.7.3.3 JPY IR Curve Shift

We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the JPY interest rate curve. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 255: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of parallel shift of JPY IR curve. All values are well behaved and as expected.](./Fig/52.png)

### 4.7.3.4 JPY IR Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the JPY interest rate volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 256: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of relative shift of JPY IR volatility. All values are well behaved and as expected.](./Fig/53.png)

### 4.7.3.5 USD IR Curve Shift

We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the USD interest rate curve. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 257: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of parallel shift of USD IR curve. All values are well behaved and as expected.](./Fig/54.png)

### 4.7.3.6 USD IR Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the USD interest rate volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 258: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of relative shift of USD IR volatility. All values are well behaved and as expected.](./Fig/55.png)

### 4.7.3.7 Taylor Test

In this section, we test how well the Delta-Gamma-Vega expansion of the present value approximates the present value in a neighborhood of the point

(FX Spot Shift, FX Vol Shift) = (0, 0)                                     (53)

More precisely, we check that for spot and volatility shifts $(C,σ)$ in a neighborhood of $(0, 0)$ (which we chose to be $(-10\%, 10\%) \times (-50\%, 50\%)$ we have

$$PV(C,σ) \approx PV(0,0) + \frac{1}{\delta_{\Delta}}\Delta(0,0)C + \frac{1}{\delta_{\nu}}\nu(0,0)σ + \frac{1}{2}\frac{1}{\delta_{\Gamma}}\Gamma(0,0)C^2,$$                                     (54)

where $\Delta$, $\nu$ and $\Gamma$ denote here the FXDELTA, FLATVEGA and FXGAMMAAVE and $\delta_{\Delta}$, $\delta_{\nu}$, and $\delta_{\Gamma}$ represent the shift sizes used in the computation of FXDELTA, FLATVEGA and FXGAMMAAVE, respectively.

![Figure 259: The results of the Taylor expansion test for PRDCSwapCallable. On the top left and top right pictures we see the plot of the present value computed with DBAnalytics and with the Taylor expansion, together with the relative error as the FX Spot and FX Volatility are subject to relative shifts. In the bottom left picture the plot of the present value as the FX spot and volatility are subject to relative shifts. In the bottom right picture the contour plot of the relative error between the DBA and Taylor values is shown.](./Fig/56.png)

### 4.7.4 IRRBB Scenarios testing

In this subsection we perform the IRRBB test of the PRDCSwapCallable product. We study 10 IRRBB scenarios and the 'base' scenario, which corresponds to the current state of the market: 'base', 'parallel_up', 'parallel_down', 'steepener', 'flattener', 'short_up', 'short_down', 'long_up', 'long_down', 'steepener neg' and 'flattener_neg'.

#### 4.7.4.1 Scenario Curves

The scenario curves for the rates affecting this product are shown in Figure 260. The effects of each scenario are as expected by their names, for example the parallel up is a parallel shift of the base curve.

![Figure 260: JPY and USD zero rates under Base and IRRBB scenarios.](./Fig/57.png)

#### 4.7.4.2 JPY/USD FX Spot Shift

The stability of PV and FXDELTA under the IRRBB scenarios in comparison to the Base scenario is tested against FX spot shift as shown in Figure 261. All values are well behaved and as expected.

![Figure 261: PV and FXDELTA as a function of relative shift of JPY/USD FX spot for the Base and all IRRBB scenarios. The PV and FXDELTA are well behaved and as expected.](./Fig/58.png)

#### 4.7.4.3 JPY/USD FX Volatility Shift

The stability of PV and FXVEGA under the IRRBB scenarios in comparison to the Base scenario is tested against FX volatility shift as shown in Figure 262. All values are well behaved and as expected.

![Figure 262: PV and FXVEGA as a function of relative shift of JPY/USD FX volatility for the Base and all IRRBB scenarios. The PV and FXVEGA are well behaved and as expected.](./Fig/59.png)

#### 4.7.4.4 JPY IR Curve Shift

The stability of PV and FLATDELTA under the IRRBB scenarios in comparison to the Base scenario is tested against JPY curve shift as shown in Figure 263. All values are well behaved and as expected.

### 4.7.4.5 JPY IR Volatility Shift

The stability of PV and FLATVEGA under the IRRBB scenarios in comparison to the Base scenario is tested against JPY volatility shift as shown in Figure 264. All values are well behaved and as expected.

![Figure 264: PV and FLATVEGA as a function of relative shift of JPY volatility for the Base and all IRRBB scenarios. The PV and FLATVEGA are well behaved and as expected.](./Fig/264.png)

### 4.7.4.6 USD IR Curve Shift

The stability of PV and FLATDELTA under the IRRBB scenarios in comparison to the Base scenario is tested against USD curve shift as shown in Figure 265. All values are well behaved and as expected.

![Figure 265: PV and FLATDELTA as a function of parallel shift of USD curve for the Base and all IRRBB scenarios. The PV and FLATDELTA are well behaved and as expected.](./Fig/265.png)

### 4.7.4.7 USD IR Volatility Shift

The stability of PV and FLATVEGA under the IRRBB scenarios in comparison to the Base scenario is tested against USD volatility shift as shown in Figure 266. All values are well behaved and as expected.

![Figure 266: PV and FLATVEGA as a function of relative shift of USD volatility for the Base and all IRRBB scenarios. The PV and FLATVEGA are well behaved and as expected.](./Fig/266.png)

## 4.7.5 CCAR Scenarios testing

The 2023 CCAR shocks have bee applied to the EOD dictionary (Base scenario) for testing.

### 4.7.5.1 Monte Carlo convergence

We first carry out testing to ensure that the product's PV and main risk sensitivities are robust in the two CCAR scenarios as the Monte Carlo convergence testing that has been done for EOD testing. The trade under both CCAR scenarios displays good convergence.

![Figure 267: PV and main risk sensitivities as the number of simulations are varied, for different seeds under CCAR1 scenario. The results show stable convergence.](./Fig/267.png)

![Figure 268: PV and main risk sensitivities as the number of simulations are varied, for different seeds under CCAR2 scenario. The results show stable convergence.](./Fig/268.png)

### 4.7.5.2 JPY/USD FX Spot Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the JPY/USD FX Spot. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 269: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of relative shift of JPY/USD FX spot for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/269.png)

### 4.7.5.3 JPY/USD FX Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the JPY/USD FX volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 270: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of relative shift of JPY/USD FX volatility for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/270.png)

### 4.7.5.4 JPY IR Curve Shift

We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the JPY interest rate curve. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 271: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of parallel shift of JPY IR curve for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/271.png)

### 4.7.5.5 JPY IR Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the JPY volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 272: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of relative shift of JPY IR volatility for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/272.png)

### 4.7.5.6 USD IR Curve Shift

We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the USD interest rate curve. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 273: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of parallel shift of USD IR curve for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/273.png)

### 4.7.5.7 USD IR Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the USD volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 274: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of relative shift of USD IR volatility for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/274.png)

## 4.7.6 MultiVar Scenarios testing

For the given dictionary, DBAnalytics identifies the following risk factors:

| ObjectType | Currency | RiskFactor | Shocks Availability |
| --- | --- | --- | --- |
| IRCURVE | JPY | JPY | CCYSPREAD | Yes |
| IRCURVE | JPY | JPY | OISSPREAD | Yes |
| IRCURVE | JPY | JPY | SPOTLIBORSPREAD | Yes |
| IRCURVE | JPY | JPY | SWAP | Yes |
| IRCURVE | USD | USD | DISCOUNTSPREAD | Yes |
| IRCURVE | USD | USD | OISSPREAD | Yes |
| IRCURVE | USD | USD | SWAP | Yes |
| FXSPOT | JPY/USD | JPY/USD | SPOT | Yes |
| IRDBOPTVOL | JPY | JPY | CMSMAT | Yes |
| IRDBOPTVOL | USD | USD | CMSMAT | Yes |
| FXMARKETVOL | JPY/USD | JPY/USD | ATMVOL | Yes |
| FXMARKETVOL | JPY/USD | JPY/USD | CONVEXITY | No |
| FXMARKETVOL | JPY/USD | JPY/USD | DELTAVOL | No |
| FXMARKETVOL | JPY/USD | JPY/USD | SLOPE | No |
| FXSTOCHDBMVOL | JPY/USD | JPY/USD | LOCALVOL | No |
| FXSTOCHDBMVOL | JPY/USD | JPY/USD | MEANREV | No |

Table 94: Risk Factors identified by DBAnalytics in the dictionary of PRDCSwapCallable and shock availability in list provided by Market Risk.

The identified risk factors are correct: PRDCSwapCallable is an FX derivative whose payoff depends on the JPY/USD FX rate. There is two interest rates present in the dictionary: the USD rate and the JPY rate. As described in [21], every curve is constructed starting from a base curve (LIBOR 3M USD in this case) with the help of additional spreads. The curve construction model simultaneously constructs a LIBOR forecasting curve and an OIS discounting curve. This explains the presence of the OISSPREAD among the risk factors. The FundingName assigned in this security is "global-markets-usd" that corresponds to Funding name "usdsf+", which implies that DISCOUNTSPREADs are necessary and the product will show sensitivity to them.

The USD and JPY interest rates are modelled as Hul-White processes with time-dependent volatility that calibrate to the input DBOPT volatility objects. Therefore each volatility object will show sensitivity to the inputs CMSMAT. The JPY/USD FX rate is modelled as a lognormal local volatility (Dupire-type) process which is calibrated to an input volatility object of type DELTAVOL consisting of a volatility surface of type DNCVX/RR. Therefore the product will show sensitivity to these inputs. However, the provided shocks do not cover the given configuration, being given in a ATMVOL/SLOPE/CONVEXITY format. Therefore, in order to stress the FX volatility, we opt for a simplification and apply the ATMVOL shocks to the DN inputs stored in the DELTAVOL object.

The product shows sensitivity to those instruments relevant for the time period between valuation date and expiry date.

We apply the SVAR 10D shocks gradually to the EOD dictionary by stressing all the risk factors listed in Table 94 using the logic described above. We obtain the following profiles:

![Figure 275: PV of PRDCSwapCallable. The PV ladder shows that the pricing model is sufficiently robust to price in extremely stressed scenarios. As we evolve from the EOD scenario to the stressed VaR 10D scenario the profile of the PV remains stable and well-behaved. The test is passed.](./Fig/275.png)

You can see below examples of shocks applied only to the main risk factors (FX spot and FX vol):

![Figure 276: Upper Left: PV when only the term structure of FXSPOT is stressed. Upper Right: PV when only the term structure of FXMARKETVOL is stressed. Lower Left: PV when only the term structure of IRCURVE is stressed. Lower Right: PV when only the term structure of IRDBOPTVOL is stressed. The PV ladder shows that the pricing model is sufficiently robust to price in extremely stressed scenarios. As we evolve from the EOD scenario to the stressed VaR 10D scenario the profile of the PV remains stable and well-behaved. The test is passed.](./Fig/276.png)

## 4.7.7 Impact of parameters set by expert-judgement

The parameters of the SV component of the FX rate are set by expert judgement and are stored in a VOL object of DiffusionType=STOCHVOL. In the following figure, we examine the impact of the parameters stored in the TermVols table, see Section 2.3 for a complete description of the parameters. The original TermVols table is the following:

| Maturity | 1Y | 2Y | 3Y | 5Y | 7Y | 10Y | 15Y | 20Y | 30Y |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Vol | 0.415 | 0.33 | 0.263 | 0.241 | 0.232 | 0.219 | 0.2 | 0.2 | 0.2 |

Table 95: TermVol table stored in the VOL object of DiffusionType = STOCHVOL. These values are exogenously set.

Note that the SV component of the FX rate volatility is used in the last step of the calibration, and provides the final decomposition of the FX rate volatility into an N component and SV component, see Section 2.3.10. The method used in the calculation of the decomposition is calculated is controlled by the property DirectSLVCalculationMethod which has several modes allowed: FFT, FFT-2, BIN and DLV. The following figure figure shows the impact of the TermVols parameters on the product's price as we apply shifts ranging from -50% to +50% to the original term structure stored in the TermVols table in 3 scenarios for DirectSLVCalculationMethod: FFT, FFT-2 and BIN.

![Figure 277: PV of PRDCSwapCallable for different scenarios of vol-of-vol created by applying relative shifts ranging from -50% to +50% to the original TermVols table stored in the VOL object of DiffusionType=STOCHVOL. The test shows that the SV parameters, set by expert judgement, have an impact on the PRDCSwapCallable's price.](./Fig/277.png)

The following figures examine the impact of the mean-reversion parameters of the interest rate process on the price of PRDCSwapCallable. The mean-reversion parameters are exogenously set.

![Figure 278: PV of PRDCSwapCallable for different values of USD IR VOL MeanRev parameters (left) and JPY IR VOL MeanRev parameters (right). The test shows that these parameters, set by expert judgement, have an impact on the PRDCSwapCallable's price.](./Fig/278.png)

## 4.8 Product Testing: PRDCSwapCallableKORedemptionStrike

The testing in this section is done in Q2 2023 in model configuration

DBX-ShortRate[LVMRAUTO]-FXSkewStochVol[DLVAUTO]

using DBAnalytics version 1230.

### 4.8.1 Product Description

A PRDCSwapKORedemptionStrike is a PRDC swap which can be knocked-out and has a redemption strike: that is, if no early termination occurs, the buyer of the FX-linked coupons receives the principal at maturity in a different currency at the predefined FX rate.

The tested product consists of a PayLeg and a ReceiveLeg both having the same EffectiveDate 11/08/2008, RollDate 12/02/2009 and EndDate 12/08/2038. The ReceiveLeg pays coupons with semi-annual frequency a coupon depending on JPY LIBOR 6M along with a FinalNotional of 100 M JPY. The coupon and final notional payment are subject to a knockout barrier which is checked yearly from 12/08/2011 to 12/08/2037 on the JPY/AUD FX rate, and the barrier itself is time-dependent. The value of the receive leg is therefore,

$$\text{RecLeg(JPY)} = \mathbb{E}\left[N_r \sum_{t=0}^N (L_{6M}^{JPY}(t_i) + s_r)I(X_i^{JPY/AUD} < K_i)e^{-\int_0^{t_i}r_d ds} + N_r^{final}I(X_N^{JPY/AUD} < K_N)e^{-\int_0^{t_N}r_d ds}\right],$$

where $N_r$ is the notional on the receive leg ($N_r = 100$ M JPY), $L_{6M}^{JPY}(t_i)$ is the JPY LIBOR-6M at time $t_i$, $s_r$ is the spread ($s_r = -0.0001$), $X_i^{JPY/AUD}$ is the JPY/AUD FX forward rate at $t_i$, $K_i$ is the time-dependent upper KO barrier, $r_d$ is the domestic (JPY) interest rate, and $N_r^{final}$ is the final notional payment.

The PayLeg pays a fixed coupon annually which is difference between two spreads $s_1$ (AUD denominated) and $s_2$ (JPY denominated). The AUD spread is converted to JPY before the final coupon calculation. The pay leg is therefore given by,

$$\text{PayCoupon} = \sum_{i=0}^M CF(N_{p,1}X_i^{JPY/AUD}s_1 - N_{p,2}s_2)I(X_i^{JPY/AUD} < K_i)e^{-\int_0^{t_i}r_d ds},$$

$$\text{PayFinalNotional} = N_p^{final}X_N^{JPY/AUD}I(X_N^{JPY/AUD} < K_N)e^{-\int_0^{t_N}r_d ds},$$

$$\text{PayLeg(JPY)} = \mathbb{E}[\text{PayCoupon} + \text{PayFinalNotional}],$$

Here, $CF$ is the capfloor function, $CF(x) = max(min(0,x),C)$ and $C$ is the cap. The final notional, $N_p^{final}$, is denominated in AUD and must be converted to JPY.

| PV | AUD DELTA | JPY DELTA | AUD VEGA | JPY VEGA | FXDELTA | FXVEGA | FXGAMMA | Corr. Sens. |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 21,164,080.74 | -112,489.70 | 47,584.17 | -68,323.50 | 3,204.90 | 9,700,147.78 | -538,071.05 | -120,178.05 | -247,882.98 |

Table 96: PRDCSwapCallableKORedemptionStrike: PV and main risk sensitivities calculated in EOD scenario. We can see that the main risk factors are the FX spot rate and the volatility of the FX rate. The values are expressed in JPY which is the domestic market. Trade valuation date is 08/12/2021.

![Figure 279: PV of PRDCSwapCallableKORedemptionStrike as function of upper barrier set on the PayLeg (left) and upper barrier set on the ReceiveLeg (right).](./Fig/279.png)

The dictionary has been tested against the model rules submitted for approval,

| Property | Value |
| --- | --- |
| MVModelName | DBX-ShortRate_FXSkewStochVol |
| DB_RiskProduct | PRDCSwapCallableKORedemptionStrike |
| ModelRule Filter Name | PARAMCONTROL |
| ModelRule Filter Version | 20230602 |
| ModelRuleStatus | PASS |

### 4.8.2 Monte Carlo convergence: Price and Risk Sensitivities

We first carry out testing to ensure that the product's PV and main risk sensitivities are robust as the parameters relevant for the Monte Carlo simulation are varied.

The market trade has the following parameters for the DBX model,

| Parameter | Value |
| --- | --- |
| NumberSims | 15000 |
| NumberRuns | 1 |
| FrontLatticeFreq | 96 |
| FreqTimeVec | 12 |
| IntegrationFreq | 365 |

The convergence results are shown in Figures 280 and 281 for price and all risk sensitivities. We see that all estimates converge to stable values.

![Figure 280: a) Price, b) Flat Delta - JPY, c) FX Delta, d) Flat Delta - AUD, e) FX Gamma, and f) FX Vega estimates for the PRDCSwapCallableKORedemptionStrike trade as a function number of simulations in the Monte Carlo (DBX) model. The price and risk sensitivities all converge to stable values.](./Fig/280.png)

![Figure 281: a) Flat Vega - JPY, and b) Flat Vega - AUD for the PRDCSwapCallableKORedemptionStrike trade as a function number of simulations in the Monte Carlo (DBX) model. The Flat Vega values converge to a stable value.](./Fig/281.png)

### 4.8.3 Correlation Sensitivity

Figure 282 shows the PV impact of correlation between the FX volatility and domestic/foreign IR volatility for the PRDCSwapCallableKORedemptionStrike product, with and without the KnockOut feature (PRDCSwapCallableRedemptionStrike). When the KnockOut feature is removed from the product, the correlation has only a limited impact on the PV.

![Figure 282: Price as a function of the correlation between the JPY/AUD FX volatility and the domestic/foreign IR volatility for the PRDCSwapCallableKORedemptionStrike, with and without the KnockOut feature (PRDCSwapCallableRedemptionStrike). Correlation has a greater impact on price when the trade has the KnockOut than without.](./Fig/282.png)

This trade has a path-dependent KnockOut feature on the FX rate, and therefore it is highly sensitive to the FX volatility (see Figure 306). Increases in this risk factor leads to a decrease in the survivability of the FinalNotional payment on both the pay and receive legs. It also has a non-zero positive correlation between the FX volatility and the rate's volatility. Therefore shifts in the domestic or foreign IR volatility will have an impact on the forward FX and thus on the overall PV. When the KnockOut feature is removed, the impact of IR volatility is reduced, see Figure 283.

![Figure 283: Price as a function of a) domestic (JPY) and b) foreign (USD) IR volatility for the PRDCSwapCallableKORedemptionStrike, with and without the KnockOut feature (PRDCSwapCallableRedemptionStrike). IR volatility has a greater impact on price when the trade has the KnockOut than without. Only foreign IR volatility is shown, because the domestic IR volatility is an insignificant risk factor, see Figure 294.](./Fig/283.png)

### 4.8.4 Calibration Testing

#### 4.8.4.1 Repricing Calibration Targets

The results of the autocalibration step of the market trade are given in Tables 99, 100, and 101 for the domestic IR, foreign IR and FX volatility. The trade ends on 12/08/2038, and for IR volatility, this generates coterminal swaptions at pegs {1y, 18m, 2y, 3y, 4y, 5y, 7y, 10y, 15y}. After the fitting procedure, the difference between the target market implied volatility, and the implied volatility from the LVMR, is negligible. For FX volatility, PIVAutofit calibrates the market DN, 25RR, 10CVX to an SA4 parametric function. Again,t he difference in implied volatility between the market and model is insignificant.

| OptionType | Notional | OptionMat | Tenor | Strike | MarketVols | ModelVols | VolDiffs | MarketPrices | ModelPrices | PriceDiffs |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| STRADDLE | 100 | 1y | 20380812 | 0.002715 | 0.002083 | 0.002083 | -6.027245e-10 | 2.587626 | 2.587626 | 7.486212e-10 |
| STRADDLE | 100 | 18m | 20380812 | 0.002798 | 0.002132 | 0.002102 | -3.916356e-12 | 3.094257 | 3.094257 | 5.617221e-09 |
| STRADDLE | 100 | 2y | 20380812 | 0.002888 | 0.002134 | 0.002134 | 6.383330e-12 | 3.510418 | 3.510418 | 1.495810e-08 |
| STRADDLE | 100 | 3y | 20380812 | 0.003098 | 0.002159 | 0.002159 | 3.934895e-12 | 4.064876 | 4.064876 | 7.376304e-09 |
| STRADDLE | 100 | 4y | 20380812 | 0.003316 | 0.002203 | 0.002203 | 3.204656e-12 | 4.418064 | 4.418064 | 8.348239e-09 |
| STRADDLE | 100 | 5y | 20380812 | 0.003887 | 0.002258 | 0.002258 | 3.047407e-11 | 4.654999 | 4.654999 | 4.249883e-08 |
| STRADDLE | 100 | 7y | 20380812 | 0.004136 | 0.002356 | 0.002356 | 1.886135e-11 | 4.753716 | 4.753716 | 4.805852e-08 |
| STRADDLE | 100 | 10y | 20380812 | 0.004999 | 0.002433 | 0.002433 | -1.103114e-11 | 4.028695 | 4.028695 | 1.525636e-08 |
| STRADDLE | 100 | 15y | 20380812 | 0.006348 | 0.002476 | 0.002476 | 4.639770e-11 | 1.243062 | 1.243062 | 2.505414e-08 |

Table 99: Summary of autocalibration results for the domestic (JPY) IR volatility.

### Table 101: Summary of autocalibration results for the JPY/AUD FX volatility.

| Maturity | Delta | TargetVol | FittedVol | FitError |
| --- | --- | --- | --- | --- |
| 20311211 | DN | 0.132435 | 0.132435 | 8.213935e-11 |
| 20311211 | 25RR | -0.063098 | -0.063098 | 1.428499e-11 |
| 20311211 | 10CVX-DN | 0.018879 | 0.018879 | -1.344634e-09 |
| 20361211 | DN | 0.128091 | 0.128091 | 1.136790e-11 |
| 20361211 | 25RR | -0.076402 | -0.076402 | 8.268289e-12 |
| 20361211 | 10CVX-DN | 0.030323 | 0.030323 | -8.660335e-11 |
| 20411211 | DN | 0.130195 | 0.130195 | 1.328485e-11 |
| 20411211 | 25RR | -0.076458 | -0.076458 | -6.250361e-12 |
| 20411211 | 10CVX-DN | 0.029624 | 0.029624 | -1.781143e-10 |
| 20511211 | DN | 0.130197 | 0.130197 | 1.785080e-11 |
| 20511211 | 25RR | -0.077814 | -0.077814 | 3.627085e-12 |
| 20511211 | 10CVX-DN | 0.028623 | 0.028623 | -2.683321e-10 |

### 4.8.4.2 Sensitivity to Initial Guesses used for Parameters

The LocalVols are set to a flat value of 28.855 bps for the full term structure. In this section, we test the sensitivity of the calibration results for initial flat values in {1, 5, 10, 50, 100, 500} bps. The calibration should be robust to our choice in initial LVs, and this is evident by the difference in implied volatility and prices between the market and model, given in Tables 102 and 103 for the JPY IR vol, and 104 and 105 for the USD IR vol.

### Table 102: Difference in implied volatility between the market and model for different starting LocalVols in the domestic (JPY) IR vol object.

| OptionMat | Tenor | Strike | VolDiff (1 bps) | VolDiff (5 bps) | VolDiff (10 bps) | VolDiff (50 bps) | VolDiff (100 bps) | VolDiff (500 bps) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1y | 20380812 | 0.002715 | -4.168887e-13 | -4.168887e-13 | -4.168887e-13 | -4.451834e-13 | -2.161244e-10 | -2.053382e-10 |
| 18m | 20380812 | 0.002798 | 8.396372e-13 | -8.396372e-13 | -8.396372e-13 | -2.741876-12 | -1.241431e-09 | -1.020257e-09 |
| 2y | 20380812 | 0.002888 | 8.799684e-12 | 8.799684e-12 | 8.799684e-12 | -4.402100e-12 | -1.737821e-09 | -1.359696e-09 |
| 3y | 20380812 | 0.003098 | -4.459091e-12 | -4.459091e-12 | -4.459091e-12 | -3.854932e-12 | -1.333835e-09 | -1.596134e-09 |
| 4y | 20380812 | 0.003316 | -5.356226e-11 | -5.356226e-11 | -5.356226e-11 | 5.012501e-11 | -1.255952e-09 | -1.565546e-09 |
| 5y | 20380812 | 0.003567 | 2.204577e-11 | 2.204577e-11 | 2.204577e-11 | -2.782900e-11 | -1.168784e-09 | -1.815643e-09 |
| 7y | 20380812 | 0.004136 | -3.162703e-11 | -3.162703e-11 | -3.162703e-11 | -2.163824e-11 | -9.820877e-10 | -1.447732e-09 |
| 10y | 20380812 | 0.004999 | -3.304440e-11 | -3.304440e-11 | -3.304440e-11 | -1.746512e-11 | -8.233010e-10 | -1.273916e-09 |
| 15y | 20380812 | 0.006348 | -1.372353e-12 | -1.372353e-12 | -1.372353e-12 | -4.339315e-11 | -7.055050e-10 | -1.132757e-09 |

### Table 103: Difference in price between the market and model for different starting LocalVols in the domestic (JPY) IR vol object.

| OptionMat | Tenor | Strike | PriceDiff (1 bps) | PriceDiff (5 bps) | PriceDiff (10 bps) | PriceDiff (50 bps) | PriceDiff (100 bps) | PriceDiff (500 bps) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1y | 20380812 | 0.002715 | -5.178014e-10 | -5.178014e-10 | -5.178014e-10 | -5.529450e-10 | -2.684400e-07 | -3.557601e-07 |
| 18m | 20380812 | 0.002798 | 1.331382e-09 | 1.331382e-09 | 1.331382e-09 | -4.063486e-09 | -1.827137e-06 | -1.769525e-06 |
| 2y | 20380812 | 0.002888 | 1.447800e-08 | 1.447800e-08 | 1.447800e-08 | -7.243801e-09 | -2.367865e-06 | -2.295377e-06 |
| 3y | 20380812 | 0.003098 | -8.363431e-09 | -8.363431e-09 | -8.363431e-09 | 7.229861e-09 | -2.512523e-06 | -2.974390e-06 |
| 4y | 20380812 | 0.003316 | -1.074085e-07 | -1.074085e-07 | -1.074085e-07 | 1.805195e-09 | -2.578243e-06 | -3.196543e-06 |
| 5y | 20380812 | 0.003567 | 4.734047e-08 | 4.734047e-08 | 4.734047e-08 | -5.748529e-09 | -2.407213e-06 | -3.234450e-06 |
| 7y | 20380812 | 0.004136 | -6.381215e-08 | -6.381215e-08 | -6.381215e-08 | -4.965830e-08 | -1.979105e-06 | -2.920950e-06 |
| 10y | 20380812 | 0.004999 | -5.472044e-08 | -5.472044e-08 | -5.472044e-08 | -2.891984e-08 | -1.363274e-06 | -2.109430e-06 |
| 15y | 20380812 | 0.006348 | -6.890055e-10 | -6.890055e-10 | -6.890055e-10 | -3.200994e-08 | -1.542067e-07 | -6.654391e-07 |

### Table 104: Difference in implied volatility between the market and model for different starting LocalVols in the foreign (AUD) IR vol object.

| OptionMat | Tenor | Strike | VolDiff (1 bps) | VolDiff (5 bps) | VolDiff (10 bps) | VolDiff (50 bps) | VolDiff (100 bps) | VolDiff (500 bps) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1y | 20380812 | 0.022024 | -4.682383e-13 | -4.682383e-13 | -4.682383e-13 | 3.331189e-13 | -6.202070e-13 | -1.551852e-12 |
| 18m | 20380812 | 0.022345 | -2.380176e-12 | -2.380176e-12 | -2.380176e-12 | 2.907855e-12 | -5.618567e-12 | -1.031216e-11 |
| 2y | 20380812 | 0.022509 | 2.568566e-12 | 2.568566e-12 | 2.568566e-12 | 8.831216e-12 | -1.722747e-11 | -4.138711e-11 |
| 3y | 20380812 | 0.022675 | -1.135589e-11 | -1.135589e-11 | -1.135589e-11 | -3.159733e-12 | -6.899745e-12 | -1.538150e-11 |
| 4y | 20380812 | 0.022819 | -3.129043e-11 | -3.129043e-11 | -3.129043e-11 | -1.421491e-12 | 3.262029e-11 | -1.290058e-11 |
| 5y | 20380812 | 0.022978 | -1.812545e-11 | -1.812545e-11 | -1.812545e-11 | 1.191970e-11 | -1.444801e-10 | -4.817751e-11 |
| 7y | 20380812 | 0.023113 | -4.659773e-11 | -4.659773e-11 | -4.659773e-11 | 8.291588e-13 | -7.529060e-11 | -4.072550e-11 |
| 10y | 20380812 | 0.023079 | -3.765741e-11 | -3.765741e-11 | -3.765741e-11 | -5.510043e-12 | -7.180193e-11 | -3.387555e-11 |
| 15y | 20380812 | 0.022047 | -2.783110e-11 | -2.783110e-11 | -2.783110e-11 | -1.528850e-12 | -5.356544e-11 | -2.529695e-11 |

### Table 105: Difference in price between the market and model for different starting LocalVols in the foreign (AUD) IR vol object.

| OptionMat | Tenor | Strike | PriceDiff (1 bps) | PriceDiff (5 bps) | PriceDiff (10 bps) | PriceDiff (50 bps) | PriceDiff (100 bps) | PriceDiff (500 bps) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1y | 20380812 | 0.022024 | -5.070968e-10 | -5.070968e-10 | -5.070968e-10 | 3.607836e-10 | -6.715768e-10 | -1.880538e-09 |
| 18m | 20380812 | 0.022345 | -3.040677e-09 | -3.040677e-09 | -3.040677e-09 | 3.714534e-09 | -7.179159e-09 | -1.317383e-08 |
| 2y | 20380812 | 0.022509 | 3.651200e-09 | 3.651200e-09 | 3.651200e-09 | 1.187120e-08 | -2.455590e-08 | -1.897447e-08 |
| 3y | 20380812 | 0.022675 | -1.823195e-08 | -1.823195e-08 | -1.823195e-08 | -5.071353e-09 | -1.107756e-08 | -2.471371e-08 |
| 4y | 20380812 | 0.022819 | -5.323681e-08 | -5.323681e-08 | -5.323681e-08 | 2.415400e-09 | 5.545808e-08 | -3.177536e-08 |
| 5y | 20380812 | 0.022978 | -3.144395e-08 | -3.144395e-08 | -3.144395e-08 | 1.769122e-08 | -2.505427e-07 | -4.357793e-08 |
| 7y | 20380812 | 0.023113 | -7.766666e-08 | -7.766666e-08 | -7.766666e-08 | 1.383057e-09 | -1.255340e-07 | -4.783921e-08 |
| 10y | 20380812 | 0.023079 | -5.026118e-08 | -5.026118e-08 | -5.026118e-08 | -7.354701e-09 | -9.583354e-09 | -4.521830e-08 |
| 15y | 20380812 | 0.022047 | -1.088027e-08 | -1.088027e-08 | -1.088027e-08 | -5.976050e-10 | -2.003660e-08 | -9.929941e-09 |

### 4.8.4.3 DLV Calibration

We use the following DLV parameters in the MODEL object to improve the quality of calibration fit:

| Parameter | Value |
| --- | --- |
| NumberSims | 10000 |
| MaxIter | 0 |
| FrontLatticeFreq | 96 |
| IntegrationFreq | 365 |
| DLVCalibration | ALL |
| DLVCalibrationType | SIMPLE-SMOOTH |

FXSkewStochVol[DLVAuto] Figure 284 shows the comparison between the market implied volatility, fitted using a SA4 parametric function, and the DLV for options at different maturities. The SA4 parametric function is fitted using the DBSMC-RateDeterministic_FXMarket model. There is a good quality of fit between DLV and the parametric implied volatility.

![Figure 284: Comparison between the market implied volatility for the JPY/AUD FX rate computed using the DBSMC-RateDeterministic_FXMarket model and the Dupire local volatility (DLV) at option maturities of a) 3m, b) 6m, c) 1y, d) 5y, e) 10y and f) 30y.](./Fig/284.png)

### 4.8.5 EOD testing: Price and Risk Sensitivities

#### 4.8.5.1 Domestic IR Curve Shifts

We examine the behaviour of the product's PV under parallel shifts of the domestic (USD) interest rate curve in Figures 285, 286 and 287.

![Figure 285: a) Total PV, b) RecPV, and c) PayPV as a function of parallel shifts of the domestic (JPY) IR curve. For the receive leg, an upward shift of the JPY IR rate causes an increase in the JPY LIBOR-6m rate, but a decrease in the barrier survival probability at all cashflows. For the coupon, the increase in the LIBOR is greater than the decrease in the survival probability, and therefore the coupon value increases with the JPY rate. But the FinalNotional value decreases due to the barrier. The interplay between the final notional and preceding cash flows leads to a decrease in the RecPV. See Figure 286 for more information. Similarly, on the pay leg, the PayPV is dominated by the final notional value which also decreases due to KO barrier. See Figure 287 for more information.](./Fig/285.png)

![Figure 286: a) Discount factor, b) receive leg coupons, c) JPY/AUD FX forward rate, d) KO barrier survival probability, and e) receive cash flows at each pay leg date for JPY curve shifts in {−0.05, 0.0, 0.05}. The grey dashed line in (e) indicates the time-dependent KO barrier. When the JPY curve is shifted up, the discount factor decreases, but the JPY LIBOR-6m rate and the forward FX increases. Downward shifts of the JPY rate, leads to a negative receive PVLet. The PVLet can be manually computed as Rate0 × Notional × Daycount × Survival × DiscFact. This has been overlaid on (e) as grey dashed lines. f) The FinalNotional and CashFlow components of the RecPV. Rec CF is the sum of all the pay cashflows excluding the final notional payment. The FinalNotional payment is as significant as the value of all the preceding cash flows, and this decreases with the JPY rate since it is less likely to survive the KO barrier.](./Fig/286.png)

![Figure 287: a) Pay cash flows at each pay leg date for JPY curve shifts in {−0.05, 0.0, 0.05}. When the JPY curve is shifted up, the JPY/AUD FwdFX increases and therefore pay coupons also increase, since the are dependent on 30% of an AUD-denominated notional that must be converted to JPY. However, like the receive leg, both discount factor and the likelihood of surviving the KO barrier decreases. The increase in the pay coupons at the earlier dates is more significant than the decrease in survivability, and so the value of the pay coupons increase with the JPY rate. b) The FinalNotional and CashFlow components of the PayPV. Pay CF is the sum of all the pay cashflows excluding the final notional payment. It is clear that the PayPV is dominated by the behaviour of the FinalNotional, which decreases since it is more likely to KO at higher JPY rates.](./Fig/287.png)

Figures 288 and 289 show the PV and main risk sensitivities as a function of the domestic (JPY) interest rate curve. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 288: a) Price, b) JPY/AUD FX Delta, c) Flat Delta - JPY, d) Flat Delta - AUD, e) JPY/AUD FX Vega, and f) JPY/AUD FX Gamma as a function of parallel shifts of the domestic (JPY) IR curve. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/288.png)

![Figure 289: a) Flat Vega - JPY, and b) Flat Vega - AUD as a function of parallel shifts of the domestic (JPY) IR curve.](./Fig/289.png)

#### 4.8.5.2 Foreign IR Curve Shifts

We examine the behaviour of the product's PV under parallel shifts of the foreign (AUD) interest rate curve in Figures 290 and 291.

![Figure 290: a) Total PV, b) RecPV, and c) PayPV as a function of parallel shifts of the foreign (AUD) IR curve. For both legs, the behaviour of the PV is dominated by the value of the FinalNotional payment, and when the AUD rate increases, the JPY/AUD FX rate decreases. Thus the final notional payment on the receive leg is more likely to survive the KO barrier and its values increases. For the pay leg, the final notional is more likely to survive, but it is also multiplied by a falling JPY/AUD rate in the AUD-to-JPY currency conversion, hence the PayPV rises then falls. See Figure 291 for more information.](./Fig/290.png)

![Figure 291: a) JPY/AUD FX forward rate at each barrier date for AUD curve shifts in {−0.05, 0.0, 0.05}. The grey dashed line indicates the time-dependent KO barrier. When the AUD curve is shifted up, the JPY/AUD forward FX decreases and cashflows are more likely to survive the barrier. The FinalNotional and CashFlow components are given for the b) RecPV and c) PayPV as a function of AUD curve shifts. For both legs, especially the receive, the PV is dominated by the FinalNotional payment. On the receive leg, the final notional increases in value until the survival probability reaches 1. For the pay leg, final notional increases with survival probability, but eventually it decreases since the forward FX is falling.](./Fig/291.png)

Figures 292 and 293 show the PV and main risk sensitivities as a function of the foreign (AUD) interest rate curve. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 292: a) Price, b) JPY/AUD FX Delta, c) Flat Delta - JPY, d) Flat Delta - AUD, e) JPY/AUD FX Vega, and f) JPY/AUD FX Gamma as a function of parallel shifts of the foreign (AUD) IR curve. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/292.png)

![Figure 293: a) Flat Vega - JPY, and b) Flat Vega - AUD as a function of parallel shifts of the foreign (AUD) IR curve.](./Fig/293.png)

#### 4.8.5.3 Domestic IR Volatility Shifts

We examine the behaviour of the product's PV under relative shifts of the domestic (JPY) interest rate volatility in Figures 294 and 295.

![Figure 294: a) Total PV, b) RecPV, and c) PayPV as a function of relative shifts of the domestic (JPY) IR volatility. For both legs, the behaviour of the PV is dominated by the value of the FinalNotional payment, and when the JPY IR volatility increases, the JPY/AUD FX rate decreases slightly. Thus the final notional payment on the receive leg is more likely to survive the KO barrier and its values increases. This risk factor has only a minute impact on the PV. See Figure 295 for more information.](./Fig/294.png)

![Figure 295: a) JPY/AUD FX forward rate at each barrier date for JPY IR volatility shifts in {−0.95, 0.53, 2.0}. The grey dashed line indicates the time-dependent KO barrier, and the red dashed line is the difference in FwdFX between the 200% and -95% shifts. As the JPY IR volatility rises, the FwdFX rate decreases, especially at later dates. The FinalNotional and CashFlow components are given for the b) RecPV and c) PayPV as a function of JPY IR vol shifts. Again, the PV for both legs is dominated by the FinalNotional payment. This increases slightly with JPY IR vol, because the likelihood of surviving the KO barrier increases. This is only a minor risk factor, and has a relatively small impact on PV.](./Fig/295.png)

Figures 296 and 297 show the PV and main risk sensitivities as a function of the domestic (JPY) interest rate volatility. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 296: a) Price, b) JPY/AUD FX Delta, c) Flat Delta - JPY, d) Flat Delta - AUD, e) JPY/AUD FX Vega, and f) JPY/AUD FX Gamma as a function of relative shifts of the domestic (JPY) IR volatility. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/296.png)

![Figure 297: a) Flat Vega - JPY, and b) Flat Vega - AUD as a function of relative shifts of the domestic (JPY) IR volatility.](./Fig/297.png)

#### 4.8.5.4 Foreign IR Volatility Shifts

We examine the behaviour of the product's PV under relative shifts of the foreign (AUD) interest rate volatility in Figures 298 and 299.

![Figure 298: a) Total PV, b) RecPV, and c) PayPV as a function of relative shifts of the foreign (AUD) IR volatility. Again, both legs are dominated by the value of the FinalNotional payment, and when the AUD IR volatility increases, the JPY/AUD FX rate increases slightly. This decreases the likelihood of intermediate cashflows surviving, but paths that do survive have an increased likelihood of later cashflows also surviving. The RecPV and PayPV follow the survival probability which initially falls, then rises. See Figure 299 for more information.](./Fig/298.png)

![Figure 299: a) JPY/AUD FX forward rate and b) barrier survival probability at each barrier date for AUD IR volatility shifts in {−0.95, 0.53, 2.0}. The grey dashed line in (a) indicates the time-dependent KO barrier, and the red dashed line is the difference in FwdFX between the 200% and -95% shifts. As the AUD IR volatility rises, the FwdFX rate increases, especially at later dates. For intermediate cashflows, barrier survival decreases with AUD IR volatility, but for later cashflows, survival decreases then increases. The FinalNotional and CashFlow components are given for the c) RecPV and d) PayPV as a function of AUD IR vol shifts. Again, the PV for both legs is dominated by the FinalNotional payment. This follows the behaviour of the survival probability for the last date. AUD IR volatility is only a minor risk factor, and has a relatively small impact on PV.](./Fig/299.png)

Figures 300 and 301 show the PV and main risk sensitivities as a function of the foreign (AUD) interest rate volatility. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 300: a) Price, b) JPY/AUD FX Delta, c) Flat Delta - JPY, d) Flat Delta - AUD, e) JPY/AUD FX Vega, and f) JPY/AUD FX Gamma as a function of relative shifts of the foreign (AUD) IR volatility. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/300.png)

![Figure 301: a) Flat Vega - JPY, and b) Flat Vega - AUD as a function of relative shifts of the foreign (AUD) IR volatility.](./Fig/301.png)

### 4.8.5.5 FX Spot Shifts

We examine the behaviour of the product's PV under relative shifts of the JPY/AUD FX spot rate in Figures 302 and 303.

![Figure 302: a) Total PV, b) RecPV, and c) PayPV as a function of relative shifts of the JPY/AUD FX spot rate. Both legs are dominated by the value of the FinalNotional payment. The trade is currently ATM, so any increase in the JPY/AUD FX spot rate causes the receive and pay cashflows to knockout. On the receive leg, the PV tends to 0, but on the pay leg, the first cashflow is not affected by the knockout barrier. This cashflow is multiplied by a rising FwdFX rate, however the coupon is capped to 9.35. Therefore the PayPV tends to 9.35 M JPY. For downward shifts of the FX spot, all cashflows survive but they are multiplied by a decreasing FX rate, hence a decrease in the PayPV. See Figure 303 for more information.](./Fig/302.png)

![Figure 303: a) JPY/AUD FX forward rate at each barrier date for JPY/AUD FX spot shifts in {−0.95, 0.03, 2.0}. The grey dashed line indicates the time-dependent KO barrier, and the red dashed line is the difference in FwdFX between the 200% and -95% shifts. As the JPY/AUD FX spot rises, the FwdFX rate increases and the trade is deep out of the money. The FinalNotional and CashFlow components are given for the b) RecPV and c) PayPV as a function of FX spot shifts, and the last two figures show d) the barrier survival probability and e) individual pay cashflows at each pay date. The cashflows on the receive and pay leg tend to 0, along with the value of the final notional at higher FX spot rates. However, on the pay leg, the first cashflow was paid before the first barrier date, and is therefore unaffected by the barrier. As the FX spot increases, the value of this cashflow also rises due to the currency conversion, but it is capped to 9.35. This cap is shown by the red dashed line in figures (c) and (e). Therefore at higher FX spot rates, the PayPV tends to 9.35 M JPY.](./Fig/303.png)

Figures 304 and 305 show the PV and main risk sensitivities as a function of the JPY/AUD FX spot rate. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 304: a) Price, b) JPY/AUD FX Delta, c) Flat Delta - JPY, d) Flat Delta - AUD, e) JPY/AUD FX Vega, and f) JPY/AUD FX Gamma as a function of relative shifts of the JPY/AUD FX spot rate. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/304.png)

![Figure 305: a) Flat Vega - JPY, and b) Flat Vega - AUD as a function of relative shifts of the JPY/AUD FX spot rate.](./Fig/305.png)

### 4.8.5.6 FX Volatility Shifts

We examine the behaviour of the product's PV under relative shifts of the JPY/AUD FX volatility in Figures 306 and 307.

![Figure 306: a) Total PV, b) RecPV, and c) PayPV as a function of relative shifts of the JPY/AUD FX volatility. Both legs are dominated by the value of the FinalNotional payment. When the JPY/AUD FX volatility increases, the likelihood of surviving the KO barrier decreases, and so both the RecPV and PayPV decreases. See Figure 307 for more information.](./Fig/306.png)

![Figure 307: a) JPY/AUD FX forward rate at each barrier date for JPY/AUD FX volatility shifts in {−0.95, 0.03, 2.0}. The grey dashed line indicates the time-dependent KO barrier, and the red dashed line is the difference in FwdFX between the 200% and -95% shifts. The FinalNotional and CashFlow components are given for the c) RecPV and d) PayPV as a function of JPY/AUD FX vol shifts. The FinalNotional component is significantly greater than the previous cashflows. The final two figures show the d) survival probability and the e) individual pay cashflows at each pay date. As the JPY/AUD FX volatility rises, the FwdFX rate decreases slightly and the likelihood of surviving the barrier decreases. This leads to a drop in value of the FinalNotional payment on both legs.](./Fig/307.png)

Figures 308 and 309 show the PV and main risk sensitivities as a function of the JPY/AUD FX volatility. The test results show that the profiles of the PV and risk sensitivities are smooth.

![Figure 308: a) Price, b) JPY/AUD FX Delta, c) Flat Delta - JPY, d) Flat Delta - AUD, e) JPY/AUD FX Vega, and f) JPY/AUD FX Gamma as a function of relative shifts of the JPY/AUD FX volatility. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/308.png)

![Figure 309: a) Flat Vega - JPY, and b) Flat Vega - AUD as a function of relative shifts of the JPY/AUD FX volatility.](./Fig/309.png)

### 4.8.5.7 Taylor Test

In this section, we test how well the Delta-Gamma-Vega expansion of the present value approximates the present value in a neighborhood of the point

$$(FX Spot Shift, FX Vol Shift) = (0,0) \tag{59}$$

More precisely, we check that for spot and volatility shifts $(C,\sigma)$ in a neighborhood of $(0,0)$ (which we chose to be $(-10\%,10\%) \times (-60\%,60\%)$ we have

$$PV(C,\sigma) \approx PV(0,0) + \frac{1}{\delta_{\Delta}}\Delta(0,0)C + \frac{1}{\delta_{\nu}}\nu(0,0)\sigma + \frac{1}{2}\frac{1}{\delta^2_{\Gamma}}\Gamma(0,0)C^2, \tag{60}$$

where $\Delta$, $\nu$ and $\Gamma$ denote here the FXDELTA, FLATVEGA and FXGAMMAAVE and $\delta_{\Delta}$, $\delta_{\nu}$ and $\delta_{\Gamma}$ represent the shift sizes used in the computation of FXDELTA, FLATVEGA and FXGAMMAAVE, respectively.

![Figure 310: a) Price against JPY/USD FX spot shift calculated with DBAnalytics (red), and the first (green) and second (blue) order Taylor approximations. b) Price against JPY/USD FX vol shift calculated with DBAnalytics (red), and the first order (green) Taylor approximation.](./Fig/310.png)

![Figure 311: a) The price computed by DBAnalytics is shown as a coloured surface plot as a function of JPY/USD FX spot and vol shifts. The black wireframe shows the Taylor-approximated price, computed using the market PV, FX Delta, FX Gamma, Flat Vega. b) The absolute difference between the price calculated by DBAnalytics and the price approximated from the Taylor expansion.](./Fig/311.png)

### 4.8.6 IRRBB Scenarios testing

In this subsection we perform the IRRBB test of the PRDCSwapCallableKORedemptionStrike product. We study 10 IRRBB scenarios and the 'base' scenario, which corresponds to the current state of the market: 'base', 'parallel_up', 'parallel_down', 'steepener', 'flattener', 'short_up', 'short_down', 'long_up', 'long_down', 'steepener_neg' and 'flattener_neg'.

The effect of the IRRBB scenarios on the base case is illustrated in Figure 312 for the domestic yield curve (JPY) and in Figure 313 for the foreign yield curve (AUD).

![Figure 312: The IRRBB scenarios applied to the base case of the domestic (JPY) yield curves.](./Fig/312.png)

![Figure 313: The IRRBB scenarios applied to the base case of the foreign (AUD) yield curves.](./Fig/313.png)

Interest Rate curve shifts. We examine the behaviour of the product's PV and main risk sensitivity under parallel shifts of the JPY interest rate curve and AUD interest rate curve in the EOD scenario (added for comparison) and 10 IRRBB scenarios. The test results show that the profiles are smooth.

![Figure 314: a) Price and b) Flat Delta - JPY under parallel shifts of domestic (JPY) interest rate curve for the base and IRRBB scenarios.](./Fig/314.png)

![Figure 315: a) Price and b) Flat Delta - AUD under parallel shifts of foreign (AUD) interest rate curve for the base and IRRBB scenarios.](./Fig/315.png)

Interest Rate volatility shifts. We examine the behaviour of the product's PV and main risk sensitivity under relative shifts of the JPY interest rate volatility and AUD interest rate volatility. The test results show that the profiles are smooth.

![Figure 316: a) Price and b) Flat Vega - JPY under relative shifts of domestic (JPY) interest rate volatility for the base and IRRBB scenarios.](./Fig/316.png)

![Figure 317: a) Price and b) Flat Vega - AUD under relative shifts of foreign (AUD) interest rate volatility for the base and IRRBB scenarios.](./Fig/317.png)

FX spot shifts. We examine the behaviour of the product's PV and main risk sensitivity under relative shifts of the JPY/AUD FX spot rate. The test results show that the profiles are smooth.

![Figure 318: a) Price and b) FX Delta - JPY/AUD under relative shifts of JPY/AUD FX spot rate for the base and IRRBB scenarios.](./Fig/318.png)

FX VOL shifts. We examine the behaviour of the product's PV and main risk sensitivity under relative shifts of the FX rate volatility. The test results show that the profiles are smooth.

![Figure 319: a) Price and b) FX Vega - JPY/AUD under relative shifts of JPY/AUD FX volatility for the base and IRRBB scenarios.](./Fig/319.png)

### 4.8.7 CCAR Scenarios testing

The 2023 CCAR shocks have been applied to the EOD dictionary (Base scenario) for testing. There are no shocks for the JPY/AUD FX volatility so default shocks have been applied instead.

Interest Rate curve shifts. We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the AUD interest rate curve and JPY interest rate curve. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 320: a) Price and b) Flat Delta - JPY under parallel shifts of domestic (JPY) interest rate curve for the base and CCAR scenarios.](./Fig/320.png)

![Figure 321: a) Price and b) Flat Delta - AUD under parallel shifts of foreign (AUD) interest rate curve for the base and CCAR scenarios.](./Fig/321.png)

IR volatility shifts. We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the JPY and AUD IR volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 322: a) Price and b) Flat Vega - JPY under relative shifts of domestic (JPY) interest rate volatility for the base and CCAR scenarios.](./Fig/322.png)

![Figure 323: a) Price and b) Flat Vega - AUD under relative shifts of foreign (AUD) interest rate volatility for the base and CCAR scenarios.](./Fig/323.png)

FX spot rate shifts. We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the FX spot rate. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 324: a) Price and b) FX Delta - JPY/AUD under relative shifts of JPY/AUD FX spot rate for the base and CCAR scenarios.](./Fig/324.png)

FX rate volatility shifts. We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the volatility of FX rate. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 325: a) Price and b) FX Vega - JPY/AUD under relative shifts of JPY/AUD FX volatility for the base and CCAR scenarios.](./Fig/325.png)

### 4.8.8 MultiVar Scenarios testing

For the given dictionary, DBAnalytics identifies the following risk factors:

| ObjectType | Currency | RiskFactor | Shocks Availability |
| --- | --- | --- | --- |
| IRCURVE | JPY | JPY | CCYSPREAD | Yes |
| IRCURVE | JPY | JPY | SPOTLIBORSPREAD-6M | No |
| IRCURVE | JPY | JPY | SWAP | Yes |
| IRCURVE | AUD | USD | CCYSPREAD | Yes |
| IRCURVE | AUD | USD | OISSPREAD | Yes |
| IRCURVE | AUD | USD | SWAP | Yes |
| FXSPOT | JPY/AUD | JPY/USD | SPOT | Yes |
| IRDBOPTVOL | JPY | JPY | CMSMAT | Yes |
| IRDBOPTVOL | AUD | AUD | CMSMAT | Yes |
| FXMARKETVOL | JPY/AUD | JPY/USD | ATMVOL | Yes |
| FXMARKETVOL | JPY/AUD | JPY/USD | CONVEXITY | Yes |
| FXMARKETVOL | JPY/AUD | JPY/USD | DELTAVOL | Yes |
| FXMARKETVOL | JPY/AUD | JPY/USD | SLOPE | Yes |
| FXSTOCHDBMVOL | JPY/AUD | JPY/USD | LOCALVOL | No |
| FXSTOCHDBMVOL | JPY/AUD | JPY/USD | MEANREV | No |

Table 107: Risk Factors identified by DBAnalytics in the dictionary of PRDCSwapCallableKORedemptionStrike and shock availability in list provided by Market Risk.

The identified risk factors are correct: PRDCSwapCallableKORedemptionStrike is an FX derivative whose payoff depends on the JPY/AUD FX rate. There is two interest rates present in the dictionary: the AUD rate and the JPY rate. As described in [21], every curve is constructed starting from a base curve (LIBOR 3M AUD in this case) with the help of additional spreads. The curve construction model simultaneously constructs a LIBOR forecasting curve and an OIS discounting curve. This explains the presence of the OISSPREAD among the risk factors. The FundingName is not assigned in this security, which implies that the funding curve is the JPY OIS curve. Therefore DISCOUNTSPREADs are not necessary and the product will not show sensitivity to them.

The AUD and JPY interest rates are modelled as Hull-White processes with time-dependent volatility that calibrate to the input DBOPT volatility objects. Therefore each volatility object will show sensitivity to the inputs CMSMAT. The JPY/AUD FX rate is modelled as a lognormal local volatility (Dupire-type) process which is calibrated to an input volatility object of type DELTAVOL consisting of a volatility surface of type DN/CVX/RR. Therefore the product will show sensitivity to these inputs. However, the provided shocks do not cover the given configuration, being given in a ATMVOL/SLOPE/CONVEXITY format. Therefore, in order to stress the FX volatility, we opt for a simplification and apply the ATMVOL shocks to the DN inputs stored in the DELTAVOL object.

The product shows sensitivity to those instruments relevant for the time period between valuation date and expiry date.

We apply the SVAR 10D shocks gradually to the EOD dictionary by stressing all the risk factors listed in Table 107 using the logic described above. We obtain the following profiles:

![Figure 326: PV of PRDCSwapCallableKORedemptionStrike. The PV ladder shows that the pricing model is sufficiently robust to price in extremely stressed scenarios. As we evolve from the EOD scenario to the stressed VaR 10D scenario the profile of the PV remains stable and well-behaved. The test is passed.](./Fig/326.png)

![Figure 327: PV when only the term structure of a) FXSPOT, b) FXMARKETVOL, c) IRCURVE, and d) IRDBOPTVOL is stressed. The PV ladder shows that the pricing model is sufficiently robust to price in extremely stressed scenarios. As we evolve from the EOD scenario to the stressed VaR 10D scenario the profile of the PV remains stable and well-behaved. The test is passed.](./Fig/327.png)

## 4.8.9 Impact of parameters set by expert-judgement

The parameters of the SV component of the FX rate are set by expert judgement and are stored in a VOL object of DiffusionType=STOCHVOL. In the following figure, we examine the impact of the parameters stored in the TermVols table, see Section 2.3 for a complete description of the parameters. The original TermVols table is the following:

| Maturity | 1Y   | 2Y   | 3Y   | 5Y   | 7Y   | 10Y  | 15Y  | 20Y  | 30Y  |
|----------|------|------|------|------|------|------|------|------|------|
| Vol      | 0.38 | 0.321| 0.272| 0.196| 0.197| 0.198| 0.2  | 0.2  | 0.2  |

Table 108: TermVol table stored in the VOL object of DiffusionType = STOCHVOL. These values are exogenously set.

Note that the SV component of the FX rate volatility is used in the last step of the calibration, and provides the final decomposition of the FX rate volatility into an LV component and SV component, see Section 2.3.10. The method used in the calculation of the decomposition is calculated is controlled by the property DirectSLVCalculationMethod which has several modes allowed: FFT, FFT-2, BIN and DBL. The following figure figure shows the impact of the TermVols parameters on the product's price as we apply shifts ranging from -50% to +50% to the original term structure stored in the TermVols table in 3 scenarios for DirectSLVCalculationMethod: FFT, FFT-2 and BIN.

![PV: PRDCSwapCallableKORedemptionStrike](./Fig/1.png)

Figure 328: PV of PRDCSwapCallableKORedemptionStrike for different scenarios of vol-of-vol created by applying relative shifts ranging from -50% to +50% to the original TermVols table stored in the VOL object of DiffusionType=STOCHVOL. The test shows that the SV parameters, set by expert judgement, have an impact on the PRDCSwapCallableKORedemptionStrike's price.

The following figures examine the impact of the mean-reversion parameters of the interest rate process on the price of PRDCSwapCallableKORedemptionStrike. The mean-reversion parameters are exogenously set.

> The scenario DirectSLVCalculationMethod=DLV cannot be applied, the dictionary throwing the following error: "Invalid DSLV Computation type entered, must be STATEMAX or BIN".

## 4.9 Product Testing: PRDCSwapTarnRedemptionStrike

The testing done in this section is for Q2 2023 with model configuration

DBX-ShortRate+[LVMR]_FXSkewStochVol[DLVAUTO]

using DBAnalytics version 1240.

| Property              | Value                       |
|-----------------------|-----------------------------|
| MVModelName           | DBX-ShortRate_FXSkewStochVol|
| DB_RiskProduct        | PRDCSwapTarnRedemptionStrike|
| ModelRule Filter Name | PARAMCONTROL               |
| ModelRule Filter Version | 20230602                |
| ModelRule Status      | PASS                       |

The following parameters in the MODEL object have been used for FXSkewStochVol[DLVAUTO] calibration.

| Parameter         | Value           |
|-------------------|-----------------|
| NumberSims        | 10000           |
| MaxIter           | 0               |
| FrontLatticeFrq   | 96              |
| IntegrationFreq   | 365             |
| DLVCalibration    | ALL             |
| DLVCalibrationType| SIMPLE-SMOOTH   |

Figure 330 shows the comparison between the market (parametric implied volatility using DBSMC model) and model (Dupire local volatility using DBX model) implied volatility on the EOD dictionary. The fit quality is good.

### 4.9.1 Product Description

A PRDCSwapTARNRedemptionStrike is a power-reverse dual currency swap, subject to a TARN barrier, where, if no early termination occurs, the buyer of the FX-linked coupons receives the principal at maturity in a different currency at the predefined FX rate (the redemption strike).

The tested product consists of a PayLeg and a ReceiveLeg both having the same EffectiveDate 2007-05-21, RollDate 2007-05-21 and EndDate 2037-05-22. Both the RecLeg and PayLeg make semi-annual payments denominated in JPY. The ValuationDate is on 2021-12-09, so there are 29 cash flows before the ValuationDate and 31 after that. A TarnBarrier (15 JPY) on the PayLeg is applied to both legs.

If TarnBarrier is not breached, the FinalNotional will be exchanged at the end of the trade:

$$PV^{JPY} = PV_{rec}^{JPY} - PV_{pay}^{JPY}$$

$$PV_{rec}^{JPY} = N^{JPY} \cdot \mathbb{E} \left[ \sum_{t} (L_t^{JPY} + S_{rec}^{JPY}) \cdot \Delta_t \cdot DF(t_i) + FN_{rec}^{JPY} \cdot DF(t_n) \right]$$

$$PV_{pay}^{JPY} = \mathbb{E} \left[ \sum_{t} PayCoupon_t^{JPY} \cdot \Delta_t \cdot DF(t_i) + FN_{pay}^{EUR} \cdot X^{JPY/EUR}(t_n) \cdot DF(t_n) \right]$$

$$PayCoupon_t^{JPY} = N^{JPY} \cdot \max(Mult_{pay} \cdot X^{JPY/EUR}(t_i) + S_{pay}^{JPY}, 0)$$

where $N^{JPY} = 100M$ JPY, $\Delta_t$ is DaycountFraction, $DF(t_i)$ is discount factor at each PayDate, final notional on the PayLeg $FN_{pay}^{EUR} = 0.9090909$ EUR, $X^{JPY/EUR}$ is the FX rate, $Mult_{pay} = 0.01$, spreads $S_{pay}^{JPY} = -1.5435$ JPY, $S_{rec}^{JPY} = -0.0015$ JPY.

If $\sum_i \Delta_i \cdot PayCoupon_i > TarnBarrier$, FinalNotional will not be exchanged and the TARN knocks out all the future cash flows (not including the current one as TarnDelay is NEXT):

$$PV_{rec}^{JPY} = N^{JPY} \cdot \mathbb{E} \left[ \sum_{t} (L_t^{JPY} + S_{rec}^{JPY}) \cdot \Delta_t \cdot DF(t_i) \right]$$

$$PV_{pay}^{JPY} = \mathbb{E} \left[ \sum_{t} PayCoupon_t^{JPY} \cdot \Delta_t \cdot DF(t_i) \right]$$

Table 109 shows the main risk sensitivities for this trade.

| PV          | JPY DELTA      | EUR DELTA   | JPY VEGA    | EUR VEGA   | FXDELTA      | FXGAMMA    | FXVEGA      |
|-------------|----------------|-------------|-------------|------------|--------------|------------|-------------|
| 4,585,260.25| -49,362.10     | 65,373.63   | 8452.72     | 91,806.46  | -2,440,771.97| -53,038.15 | 698,298.93  |

Table 109: PRDCSwapTarnRedemptionStrike: PV and main risk sensitivities calculated in EOD scenario. We can see that the main risk factors are the FX spot rate and the volatility of the FX rate. Trade valuation date is 2021-12-09.

### JPY/EUR FX Spot Shift

To test the key features of the trade, CalcIntrinsic is set to 1 to ignore all the volatilities. Figure 331(a) shows the final notionals are knocked out when $\sum_i \Delta_i \cdot PayCoupon_i > TarnBarrier$ (15 JPY) and FX spot rate is increased beyond 30% REL. Note the tarn does not knock out the current cash flow immediately - it will knock out the next cash flow as TarnDelay = NEXT. When FX spot rate shift is smaller than 20%, the final notional on the rec leg is constant whereas that on the pay leg is a positive function of FX spot shift as $Mult_{pay} = 0.01$ being positive.

There are several features for the PayFlows table: the first two PayCoupons are fixed at 10 with DaycountFraction being 0.5 for each; the last 4 pay flows just before ValuationDate is dependent on FX spot rate. Figure 331(c) shows all the cash flows are knocked out when FX spot is increased to 30% as the number of effective cash flows (indicated by the black line) drops to zero. So the PV of the trade drops to 0 as shown in Figure 331(b) denoted by the black line. It is also shown in Figure 331(c) by the blue line that sum of PayCoupons before ValuationDate increases when FX spot is shifted up 20% and more whereas that after ValuationDate keeps constant. This is because the last 4 pay flows just before ValuationDate get more values ($PayCoupon_t^{JPY} = N^{JPY} \cdot \max(Mult_{pay} \cdot X^{JPY/EUR}(t_i) + S_{pay}^{JPY}, 0)$).

Shifting up the JPY curve, to some extent, is similar to increasing the FX rate. But there is also a difference. Figure 333(b) shows the trade PV after 2% shift of JPY curve is a bit volatile. The TarnDelay = NEXT is one contributing factor. As seen in Figure 333(d), the sum of PayCoupons can go up and down when $\sum_i \Delta_i \cdot PayCoupon_i > 15$ as the current cash flow is not immediately knocked out if TarnBarrier is breached.

Everything under JPY IR curve shift is well behaved and as expected.

![Figure 333: (a) Final notionals on both legs and sum of DaycountFraction multiplied by PayCoupon which is compared with TarnBarrier = 15 JPY (denoted by the red horizontal line); (b) PV consists of RecPV and PayPV; (c) Sum of RecCoupons before and after ValuationDate; (d) Sum of PayCoupons before and after ValuationDate and number of effective cash flows after ValuationDate. CalcIntrinsic = 1.](./Fig/2.png)

Figure 334 shows that the PV curves become smoother as JPY IR volatility is increased, which is as expected.

### 4.9.2 Monte Carlo convergence

We first carry out testing to ensure that the product's PV and main risk sensitivities are robust as the parameters relevant for the Monte Carlo simulation are varied.

![Figure 338: PV and main risk sensitivities as the number of simulations are varied, for different seeds. The results show stable convergence.](./Fig/3.png)

### 4.9.3 EOD testing

#### 4.9.3.1 JPY/EUR FX Spot Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the FX spot rate. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 339: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of relative shift of JPY/EUR FX spot rate. All values are well behaved and as expected.](./Fig/4.png)

#### 4.9.3.2 JPY/EUR FX Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the volatility of FX rate. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 340: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of relative shift of JPY/EUR FX volatility. All values are well behaved and as expected.](./Fig/5.png)

#### 4.9.3.3 JPY IR Curve Shift

We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the JPY interest rate curve. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 341: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of parallel shift of JPY IR curve. All values are well behaved and as expected.](./Fig/6.png)

#### 4.9.3.4 JPY IR Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the JPY interest rate volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 342: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of relative shift of JPY IR volatility. All values are well behaved and as expected.](./Fig/7.png)

#### 4.9.3.5 EUR IR Curve Shift

We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the EUR interest rate curve. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 343: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of parallel shift of EUR IR curve. All values are well behaved and as expected.](./Fig/8.png)

#### 4.9.3.6 EUR IR Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the EUR interest rate volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 344: PV, FLATDELTA, FLATVEGE, FXDELTA, FXGAMMA as a function of relative shift of EUR IR volatility. All values are well behaved and as expected.](./Fig/9.png)

#### 4.9.3.7 Taylor Test

In this section, we test how well the Delta-Gamma-Vega expansion of the present value approximates the present value in a neighborhood of the point

(FX Spot Shift, FX Vol Shift) = (0, 0)    (61)

More precisely, we check that for spot and volatility shifts $(C, \sigma)$ in a neighborhood of $(0,0)$ (which we chose to be $(-10\%, 10\%) \times (-50\%, 50\%)$) we have

$$PV(C,\sigma) \approx PV(0,0) + \frac{1}{\delta_\Delta}\Delta(0,0)C + \frac{1}{\delta_\nu}\nu(0,0)\sigma + \frac{1}{2\delta_\Gamma^2}\Gamma(0,0)C^2,    (62)$$

where $\Delta$, $\nu$ and $\Gamma$ denote here the FXDELTA, FLATVEGA and FXGAMMA respectively and $\delta_\Delta$, $\delta_\nu$ and $\delta_\Gamma$ represent the shift sizes used in the computation of FXDELTA, FLATVEGA and FXGAMMAAVE, respectively.

![Figure 345: The results of the Taylor expansion test for PRDCSwapTarnRedemptionStrike. On the top left and top right pictures we see the plot of the present value computed with DBAanalytics and with the Taylor expansion, together with the relative error as the FX Spot and FX Volatility are subject to relative shifts. In the bottom left picture the plot of the present value as the FX Spot and volatility are subject to relative shifts. In the bottom right picture the contour plot of the relative error between the DBA and Taylor values is shown.](./Fig/10.png)

### 4.9.4 IRRBB Scenarios testing

In this subsection we perform the IRRBB test of the PRDCSwapTarnRedemptionStrike product. We study 10 IRRBB scenarios and the 'base' scenario, which corresponds to the current state of the market: 'base', 'parallel_up', 'parallel_down', 'steepener', 'flattener', 'short_up', 'short_down', 'long_up', 'long_down','steepener_neg' and 'flattener_neg'.

#### 4.9.4.1 Scenario Curves

The scenario curves for the rates affecting this product are shown in Figure 346. The effects of each scenario are as expected by their names, for example the parallel up is a parallel shift of the base curve.

![Figure 346: JPY and EUR zero rates under Base and IRRBB scenarios.](./Fig/11.png)

#### 4.9.4.2 JPY/EUR FX Spot Shift

The stability of PV and FXDELTA under the IRRBB scenarios in comparison to the Base scenario is tested against FX spot shift as shown in Figure 347. All values are well behaved and as expected.

![Figure 347: PV and FXDELTA as a function of relative shift of JPY/EUR FX spot for the Base and all IRRBB scenarios. The PV and FXDELTA are well behaved and as expected.](./Fig/12.png)

#### 4.9.4.3 JPY/EUR FX Volatility Shift

The stability of PV and FXVEGA under the IRRBB scenarios in comparison to the Base scenario is tested against FX volatility shift as shown in Figure 348. All values are well behaved and as expected.

![Figure 348: PV and FXVEGA as a function of relative shift of JPY/EUR FX volatility for the Base and all IRRBB scenarios. The PV and FXVEGA are well behaved and as expected.](./Fig/13.png)

#### 4.9.4.4 JPY IR Curve Shift

The stability of PV and FLATDELTA under the IRRBB scenarios in comparison to the Base scenario is tested against JPY curve shift as shown in Figure 349. All values are well behaved and as expected.

![Figure 349: PV and FLATDELTA as a function of parallel shift of JPY curve for the Base and all IRRBB scenarios. The PV and FLATDELTA are well behaved and as expected.](./Fig/14.png)

#### 4.9.4.5 JPY IR Volatility Shift

The stability of PV and FLATVEGA under the IRRBB scenarios in comparison to the Base scenario is tested against JPY volatility shift as shown in Figure 350. All values are well behaved and as expected.

![Figure 350: PV and FLATVEGA as a function of relative shift of JPY volatility for the Base and all IRRBB scenarios. The PV and FLATVEGA are well behaved and as expected.](./Fig/15.png)

#### 4.9.4.6 EUR IR Curve Shift

The stability of PV and FLATDELTA under the IRRBB scenarios in comparison to the Base scenario is tested against EUR curve shift as shown in Figure 351. All values are well behaved and as expected.

![Figure 351: PV and FLATDELTA as a function of parallel shift of EUR curve for the Base and all IRRBB scenarios. The PV and FLATDELTA are well behaved and as expected.](./Fig/16.png)

#### 4.9.4.7 EUR IR Volatility Shift

The stability of PV and FLATVEGA under the IRRBB scenarios in comparison to the Base scenario is tested against EUR volatility shift as shown in Figure 352. All values are well behaved and as expected.

![Figure 352: PV and FLATVEGA as a function of relative shift of EUR IR Vol (%) for the Base and all IRRBB scenarios. The PV and FLATVEGA are well behaved and as expected.](./Fig/17.png)

### 4.9.5 CCAR Scenarios testing

The 2023 CCAR shocks have bee applied to the EOD dictionary (Base scenario) for testing. Note that there are no shocks available for JPY/EUR FX volatility and hence the default shocks for FXVOL are applied instead.

#### 4.9.5.1 Monte Carlo convergence

We first carry out testing to ensure that the product's PV and main risk sensitivities are robust in the two CCAR scenarios as the Monte Carlo convergence testing that has been done for EOD testing. The trade under both CCAR scenarios displays good convergence.

![Figure 353: PV and main risk sensitivities as the number of simulations are varied, for different seeds under CCAR1 scenario. The results show stable convergence.](./Fig/18.png)

![Figure 354: PV and main risk sensitivities as the number of simulations are varied, for different seeds under CCAR2 scenario. The results show stable convergence.](./Fig/19.png)

#### 4.9.5.2 JPY/EUR FX Spot Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the JPY/EUR FX Spot. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 355: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of relative shift of JPY/EUR FX spot for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/20.png)

#### 4.9.5.3 JPY/EUR FX Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the JPY/EUR FX volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 356: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of relative shift of JPY/EUR FX volatility for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/21.png)

#### 4.9.5.4 JPY IR Curve Shift

We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the JPY interest rate curve. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 357: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of parallel shift of JPY IR curve for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/22.png)

#### 4.9.5.5 JPY IR Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the JPY volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 358: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of relative shift of JPY IR volatility for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/23.png)

#### 4.9.5.6 EUR IR Curve Shift

We examine the behaviour of the product's PV and main risk sensitivities under parallel shifts of the EUR interest rate curve. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 359: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of parallel shift of EUR IR curve for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/24.png)

#### 4.9.5.7 EUR IR Volatility Shift

We examine the behaviour of the product's PV and main risk sensitivities under relative shifts of the EUR volatility. The test results show that the profiles of the PVs and risk sensitivities are smooth.

![Figure 360: PV, FLATDELTA, FLATVEGA, FXDELTA, FXGAMMA and FXVEGA as a function of relative shift of EUR IR volatility for the Base and CCAR scenarios. The PV and risk sensitivities are well behaved and as expected.](./Fig/25.png)

### 4.9.6 MultiVar Scenarios testing

For the given dictionary, DBAnalytics identifies the following risk factors:

| ObjectType    | Currency | RiskFactor   | Shocks Availability |
|---------------|----------|--------------|---------------------|
| IRCURVE       | JPY      | CCYSPREAD    | Yes                 |
| IRCURVE       | JPY      | OISSPREAD    | Yes                 |
| IRCURVE       | JPY      | SPOTLIBORSPREAD | Yes             |
| IRCURVE       | JPY      | SWAP         | Yes                 |
| IRCURVE       | EUR      | CCYSPREAD    | Yes                 |
| IRCURVE       | EUR      | SWAP         | Yes                 |
| FXSPOT        | JPY/EUR  | SPOT         | Yes                 |
| IRDBOPTVOL    | JPY      | CMSMAT       | Yes                 |
| IRDBOPTVOL    | EUR      | CMSMAT       | Yes                 |
| FXMARKETVOL   | JPY/EUR  | ATMVOL       | Yes                 |
| FXMARKETVOL   | JPY/EUR  | CONVEXITY    | No                  |
| FXMARKETVOL   | JPY/EUR  | DELTAVOL     | No                  |
| FXMARKETVOL   | JPY/EUR  | SLOPE        | No                  |
| FXSTOCHDBMVOL | JPY/EUR  | LOCALVOL     | No                  |
| FXSTOCHDBMVOL | JPY/EUR  | MEANREV      | No                  |

Table 110: Risk Factors identified by DBAnalytics in the dictionary of PRDCSwapTarnRedemptionStrike and shock availability in list provided by Market Risk.

The identified risk factors are correct: PRDCSwapTarnRedemptionStrike is an FX derivative whose payoff depends on the JPY/EUR FX rate. There is two interest rates present in the dictionary: the EUR rate and the JPY rate. As described in [21], every curve is constructed starting from a base curve (LIBOR 3M EUR in this case) with the help of additional spreads. The curve construction model simultaneously constructs a LIBOR forecasting curve and an OIS discounting curve. This explains the presence of the OISSPREAD among the risk factors. The FundingName assigned in this security is "global-markets-EUR" that corresponds to FundingID "EURsfr", which implies that DISCOUNTSPREADs are necessary and the product will show sensitivity to them.

The EUR and JPY interest rates are modelled as Hul-White processes with time-dependent volatility that calibrate to the input DBOPT volatility objects. Therefore each volatility object will show sensitivity to the inputs CMSMAT. The JPY/EUR FX rate is modelled as a lognormal local volatility (Dupire-type) process which is calibrated to an input volatility object of type DELTAVOL consisting of a volatility surface of type DN/CVX/RR. Therefore the product will show sensitivity to these inputs. However, the provided shocks do not cover the given configuration, being given in a ATMVOL/SLOPE/CONVEXITY format. Therefore, in order to stress the FX volatility, we opt for a simplification and apply the ATMVOL shocks to the DN inputs stored in the DELTAVOL object.

The product shows sensitivity to those instruments relevant for the time period between valuation date and expiry date.

We apply the SVAR 10D shocks gradually to the EOD dictionary by stressing all the risk factors listed in Table 110 using the logic described above. We obtain the following profiles:

![Figure 361: PV of PRDCSwapTarnRedemptionStrike. The PV ladder shows that the pricing model is sufficiently robust to price in extremely stressed scenarios. As we evolve from the EOD scenario to the stressed VaR 10D scenario the profile of the PV remains stable and well-behaved. The test is passed.](./Fig/26.png)

You can see below examples of shocks applied only to the main risk factors (FX spot and FX vol):

![Figure 362: Upper Left: PV when only the term structure of FXSPOT is stressed. Upper Right: PV when only the term structure of FXMARKETVOL is stressed. Lower Left: PV when only the term structure of IRCURVE is stressed. Lower Right: PV when only the term structure of IRDBOPTVOL is stressed. The PV ladder shows that the pricing model is sufficiently robust to price in extremely stressed scenarios. As we evolve from the EOD scenario to the stressed VaR 10D scenario the profile of the PV remains stable and well-behaved. The test is passed.](./Fig/27.png)

### 4.9.7 Impact of parameters set by expert-judgement

The parameters of the SV component of the FX rate are set by expert judgement and are stored in a VOL object of DiffusionType=STOCHVOL. In the following figure, we examine the impact of the parameters stored in the TermVols table, see Section 2.3 for a complete description of the parameters. The original TermVols table is the following:

| Maturity | 1Y   | 2Y   | 3Y   | 5Y   | 7Y   | 10Y  | 15Y  | 20Y  | 30Y  |
|----------|------|------|------|------|------|------|------|------|------|
| Vol      | 0.415| 0.33 | 0.263| 0.241| 0.232| 0.219| 0.2  | 0.2  | 0.2  |

Table 111: TermVol table stored in the VOL object of DiffusionType = STOCHVOL. These values are exogenously set.

Note that the SV component of the FX rate volatility is used in the last step of the calibration, and provides the final decomposition of the FX rate volatility into an LV component and SV component, see Section 2.3.10. The method used in the calculation of the decomposition is calculated is controlled by the property DirectSLVCalculationMethod which has several modes allowed: FFT, FFT-2, BIN and DBL. The following figure figure shows the impact of the TermVols parameters on the product's price as we apply shifts ranging from -50% to +50% to the original term structure stored in the TermVols table in 3 scenarios for DirectSLVCalculationMethod: FFT, FFT-2 and BIN.

![Figure 363: PV of PRDCSwapTarnRedemptionStrike for different scenarios of vol-of-vol created by applying relative shifts ranging from -50% to +50% to the original TermVols table stored in the VOL object of DiffusionType=STOCHVOL. The test shows that the SV parameters, set by expert judgement, have an impact on the PRDCSwapTarnRedemptionStrike's price.](./Fig/28.png)

The following figures examine the impact of the mean-reversion parameters of the interest rate process on the price of PRDCSwapTarnRedemptionStrike. The mean-reversion parameters are exogenously set.

> The scenario DirectSLVCalculationMethod=DLV cannot be applied, the dictionary throwing the following error: "Invalid DSLV Computation type entered, must be STATEMAX or BIN".

![Figure 364: PV of PRDCSwapTarnRedemptionStrike for different values of EUR IR VOL MeanRev parameters (left) and JPY IR VOL MeanRev parameters (right). The test shows that these parameters, set by expert judgement, have an impact on the PRDCSwapTarnRedemptionStrike's price.](./Fig/29.png)

## 4.10 Product Testing: IRSwapQuantoRangeAccrualCallable

### 4.10.1 Product Description

This product is tested for the following configuration:

DBX-ShortRateNormal[LVMRAUTO]_FXSkewStochVol[DLVUTO]

using DBAnalytics version 1320.

As of 26/01/2024, there are no live dictionaries for this product and therefore we have temporarily created a test dictionary with all the relevant features of this product for revalidation purposes. This trade starts on 08/01/2024 and ends on 08/01/2034 (10yr), with a valuation date of 08/01/2024. It is implemented using a RANGESWAP security with the quantoed receive leg paying the USD LIBOR-6m semi-annually on a 10000 JPY notional.

$$\text{Rec Leg} = N \sum_i \tau_i L_{6m}^{USD}(t_i) \cdot e^{-\int_0^{t_i} r\,ds}$$

where

* $N$ is the notional, $N = 10000$ JPY
* $L_{6m}^{USD}(t_i)$ is the USD LIBOR-6m at time $t_i$
* $r$ is the domestic (JPY) rate.

The pay leg pays the JPY LIBOR-6m with a spread of 0.0305, also on a 10000 JPY notional but this only accrues if the JPY LIBOR-6m rate remains between the UpperBarrier (U = 0.0625) and LowerBarrier (L = 0.0175).

$$\text{Pay Leg} = N \sum_i \tau_i(L_{6m}^{JPY}(t_i) + s_p) \cdot \frac{\sum_j I(L < L_{6m}^{JPY}(t_j) < U)}{\text{NumBarrierDates}} \cdot e^{-\int_0^{t_i} r\,ds}$$

where

* $L_{6m}^{JPY}(t_i)$ is the JPY LIBOR-6m at time $t_i$
* $t_j$ are the accrual dates in pay period $[t_i,t_{i+1}]$ and NumBarrierDates is the total number of dates in this period
* $I(x)$ is the indicator function
* $U$ and $L$ are the upper and lower barriers on the JPY LIBOR-6m

Additionally, there is a Bermuda LONG CANCEL option that can be exercised yearly between 08/01/2025 and 08/01/2034 with a strike of -3000, and this knocks out the trade if the remaining pay cashflows exceeds the sum of the remaining receive cashflows and the strike.

The dictionary has been tested against the model rules submitted for approval,

| Property              | Value                        |
|-----------------------|------------------------------|
| MVModelName           | DBX-ShortRate_FXSkewStochVol |
| DB_RiskProduct        | IRSwapQuantoRangeAccrualCallable |
| ModelRule Filter Name | PARAMCONTROL                |
| ModelRule Filter Version | 20240102                 |
| ModelRuleStatus       | PASS                        |

### 4.10.2 Product Specific Testing

In this section, we test specifically the features of the product and their behaviour under various risk factor shifts. Of all the risk factors, IR curve and IR volatility are the most significant risk factors for this product, and therefore we focus on these in this section.

#### 4.10.2.1 Domestic IR Curve Shifts

For domestic (JPY) curve shifts, Figure 365(a,b) shows that only the pay leg contributes significantly to the behaviour of the price profile. At the market JPY rate, the LIBOR-6m is close to but below the range accrual lower barrier (365d). Further downshifts to the JPY curve, reduces the likelihood that the LIBOR rate is within the range, therefore the coupons tend to 0 (365a) and subsequently so does the PayPV. For upshifts of the JPY curve, the JPY LIBOR-6m increases and is within the range accrual barriers for all pay dates, leading to a rise in the PayPV. Further upshifts, causes the LIBOR rate to breach the upper barrier and this reduces the interest rate accrued over the range dates. This causes the final drop in the PayPV.

A secondary effect in the pay profile is the value of the Bermuda option (365b). Because the PayPV increases for upward shifts of the JPY curve, the total pay cashflow are more likely to be higher than the sum of the receive cashflows and the strike, and therefore the option to knockout the trade becomes more valuable to the holder. The opposing effects of the rising option value and decreasing underlying swap value (RecPV - PayPV) creates the pay profile seen in 365a.

We investigate the effect of the range barriers on the PV and PayPV profiles in Figure 366. For narrower barriers, the increase in PayPV is reduced, as expected, since the likelihood of remaining within the barriers is lower. Equally, when the barriers are widened, the PayPV increase is greater and we no longer see the drop at ~3% curve shift. This is because the forward LIBOR-6m rate never breaches the upper barrier at any pay date. There is also an initial decrease in PayPV for wider barriers because the lower barrier (-0.025) allows for negative LIBOR rates.

![Figure 365: a) Price, b) the receive leg and pay leg PV components, and c) the UnderlyingSwap (RecPV - PayPV) and AmericanOption PV components as a function of parallel shifts of the domestic (JPY) IR curve. The most significant factors are the pay cashflows and the option value. d) JPY LIBOR-6m rate and e) the subsequent pay coupons at each pay dates for various JPY curve shifts in [-5%, 5%].](./Fig/30.png)

![Figure 366: a) PV and b) PayPV profiles as a function of parallel shifts of the domestic (JPY) curve for various [LowerBarrier, UpperBarrier]. As the barriers widen, there is an increased likelihood of the forward LIBOR rate to remain within the barriers and therefore the pay coupon's value increases.](./Fig/31.png)

![Figure 367: a) PV and b) AmericanOption profiles as a function of parallel shifts of the domestic (JPY) curve for various strikes.](./Fig/32.png)

#### 4.10.2.2 Foreign IR Curve Shifts

Inverse to domestic curve shifts, the two most significant factors for foreign curve shifts (Figure 368) are the receive leg cashflows and the value of option. Parallel shifts of the USD curve causes a linear increase in the RecPV which pays the USD LIBOR-6m rate. The option behaves as expected: when the sum of the RecPV and strike is greater than the PayPV, the option value decreases since it is less likely to be exercised and vice versa. The combination of the option value and the RecPV leads to the increasing PV profile in Figure 368a, with the plateau at negative USD shifts due to the option PV.

![Figure 368: a) Price, b) the receive leg and pay leg PV components, and c) the UnderlyingSwap (RecPV - PayPV) and AmericanOption PV components as a function of parallel shifts of the foreign (USD) IR curve. The most significant factors are the receive cashflows and the option value. d) USD LIBOR-6m rate at each pay dates for various USD curve shifts in [-5%, 5%].](./Fig/33.png)

#### 4.10.2.3 Domestic IR Volatility Shifts

Like domestic curve shifts, the most significant factors in play under domestic IR volatility shifts are the pay leg and the option value (Figure 369(a-c)). At the market JPY rate, all JPY LIBOR-6m forward rates are below the lower barrier and therefore downshifts of the IR volatility reduces the likelihood of any MC path where the forward LIBOR rate is within the range barriers and therefore the pay coupons' value are more likely to tend to 0 (369c). Conversely, upward shifts increases the likelihood of the rates being in range and therefore an increase in the PayPV. Extreme IR vol shifts, however, causes the pay coupon value of the later cashflows to decrease since they are more likely to breach the upper range barrier. Figure 370 compare the situation where the UpperBarrier is set to 0.0625 and when it is unset (9.99), and it shows that extreme IR volatility shifts do not cause a drop in value of the later cashflows and therefore the PayPV is higher (370b).

![Figure 369: a) Price, b) the receive leg and pay leg PV components, and c) the UnderlyingSwap (RecPV - PayPV) and AmericanOption PV components as a function of relative shifts of the domestic (JPY) IR volatility. The most significant factors are the pay cashflows and the option value. d) JPY LIBOR-6m rate and e) the subsequent pay coupons at each pay dates for various JPY IR volatility shifts in [-95%, 200%].](./Fig/34.png)

![Figure 370: a) PV and b) PayPV profiles as a function of relative shifts of the domestic (JPY) IR volatility for various [LowerBarrier, UpperBarrier]. The pay coupons at each pay date are shown in d) for UpperBarrier = 0.0625, e) and no UpperBarrier (9.99) at various JPY IR volatility shifts in [-95%, 200%].](./Fig/35.png)

### 4.10.3 Monte Carlo Convergence: Price and Risk Sensitivities

We first carry out testing to ensure that the product's PV and main risk sensitivities are robust as the parameters relevant for the Monte Carlo simulation are varied. We fix all the DBX model parameters and vary only the number of simulations for different Seed parameters. The product displays a good convergence, with PV and risk sensitivities reaching their asymptotic values after 5-10k paths. Similar Monte-Carlo convergence tests can be found in DBAnalytics testing document [1].

The market trade has the following parameters for the DBX model,

| Parameter       | Value |
|----------------|-------|
| NumberSims     | 10000 |
| NumberRuns     | 1     |
| FrontLatticeFreq | 96   |
| FreqTimeVec    | 12    |
| IntegrationFreq | 365  |

The convergence results are shown in Figures 371 and 372 for price and all risk sensitivities. We see that all estimates converge to stable values.

![Figure 371: a) Price, b) Flat Delta - JPY, c) Flat Delta - USD, d) Flat Gamma - JPY, e) Flat Gamma - USD, f) Flat Vega - JPY, and g) Flat Vega - USD estimates for the IRSwapQuantoRangeAccrualCallable trade as a function number of simulations in the Monte Carlo (DBX) model. The price and risk sensitivities all converge to stable values.](./Fig/36.png)

![Figure 372: a) FX Delta, b) FX Gamma, and c) FX Vega for the IRSwapQuantoRangeAccrualCallable trade as a function number of simulations in the Monte Carlo (DBX) model. The FX risk factor values converge to a stable value.](./Fig/37.png)

### 4.10.4 Calibration Testing

#### 4.10.4.1 DLV Calibration

We use the following DLV parameters in the MODEL object to improve the quality of calibration fit:

| Parameter          | Value           |
|--------------------|-----------------|
| NumberSims         | 10000           |
| MaxIter            | 0               |
| FrontLatticeFreq   | 96              |
| IntegrationFreq    | 365             |
| DLVCalibration     | ALL             |
| DLVCalibrationType | SIMPLE-SMOOTH   |

FXSkewStochVol[DLVAuto] Figure 373 shows the comparison between the market implied volatility, fitted using a SA4 parametric function, and the DLV for options at different maturities. The SA4 parametric function is fitted using the DBSMC-RateDeterministic_FXMarket model. There is a good quality of fit between DLV and the parametric implied volatility.

![Figure 373: Comparison between the market implied volatility for the JPY/USD FX rate computed using the DBSMC-RateDeterministic_FXMarket model and the Dupire local volatility (DLV) at option maturities of a) 3m, b) 6m, c) 1y, d) 5y, e) 10y and f) 20y.](./Fig/38.png)

### 4.10.5 Taylor Test

In this section, we test how well the Delta-Gamma expansion of the present value approximates the present value in a neighborhood of the point

(Dom. Curve Shift, For Curve Shift) = (0, 0)    (63)

More precisely, we check that for domestic and foreign curve shifts (α, β) in a neighborhood of (0, 0) (which we chose to be (-1%, 1%) × (-1%, 1%) we have

$$PV(α, β) ≈ PV(0, 0) + \frac{1}{δ_Δ_d}Δ_d(0, 0)α + \frac{1}{δ_f}Δ_f(0, 0)β + \frac{1}{2δ^2_{Γ_d}}Γ_d(0, 0)α^2 + \frac{1}{2δ^2_{Γ_f}}Γ_f(0, 0)β^2,    (64)$$

where Δ_{d/f} and Γ_{d/f} denote here the FLATDELTA and FLATGAMMA with respect to the domestic and foreign curves respectively, and δ_{Δ_{d/f}} and δ_{Γ_{d/f}} represent the shift sizes used in the computation of FLATDELTA and FLATGAMMA.

![Figure 374: a) Price against domestic (JPY) curve shift calculated with DBAnalytics (red), and the first (green) and second (blue) order Taylor approximations. b) Price against foreign (USD) curve shift calculated with DBAnalytics (red), and the first order (green) and second (blue) Taylor approximation.](./Fig/39.png)

![Figure 375: a) The price computed by DBAnalytics is shown as a coloured surface plot as a function of domestic (JPY) and foreign (USD) curve shifts. The black wireframe shows the Taylor-approximated price, computed using the market PV, Flat Delta - JPY, Flat Delta - USD, Flat Gamma - JPY, Flat Gamma - USD. b) The absolute difference between the price calculated by DBAnalytics and the price approximated from the Taylor expansion.](./Fig/40.png)

### 4.10.6 EOD Testing: Price and Risk Sensitivities

#### 4.10.6.1 Domestic IR Curve Shifts

Figures 376 and 377 show the PV and the risk sensitivities as a function of the domestic (JPY) interest rate curve. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 376: a) Price, b) Flat Delta - JPY, c) Flat Delta - USD, d) Flat Gamma - JPY, e) Flat Gamma - USD, f) Flat Vega - JPY, and g) Flat Vega - USD as a function of parallel shifts of the domestic (JPY) IR curve. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/41.png)

![Figure 377: a) FX Delta, b) FX Gamma, and c) FX Vega as a function of parallel shifts of the domestic (JPY) IR curve.](./Fig/42.png)

#### 4.10.6.2 Foreign IR Curve Shifts

Figures 378 and 379 show the PV and the risk sensitivities as a function of the foreign (USD) interest rate curve. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 378: a) Price, b) Flat Delta - JPY, c) Flat Delta - USD, d) Flat Gamma - JPY, e) Flat Gamma - USD, f) Flat Vega - JPY, and g) Flat Vega - USD as a function of parallel shifts of the foreign (USD) IR curve. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/43.png)

![Figure 379: a) FX Delta, b) FX Gamma, and c) FX Vega as a function of parallel shifts of the foreign (USD) IR curve.](./Fig/44.png)

#### 4.10.6.3 Domestic IR Vol Shifts

Figures 380 and 381 show the PV and the risk sensitivities as a function of the domestic (JPY) interest rate volatility. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 380: a) Price, b) Flat Delta - JPY, c) Flat Delta - USD, d) Flat Gamma - JPY, e) Flat Gamma - USD, f) Flat Vega - JPY, and g) Flat Vega - USD as a function of relative shifts of the domestic (JPY) IR volatility. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/45.png)

![Figure 381: a) FX Delta, b) FX Gamma, and c) FX Vega as a function of relative shifts of the domestic (JPY) IR volatility.](./Fig/46.png)

#### 4.10.6.4 Foreign IR Vol Shifts

Figures 382 and 383 show the PV and the risk sensitivities as a function of the foreign (USD) interest rate volatility. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 382: a) Price, b) Flat Delta - JPY, c) Flat Delta - USD, d) Flat Gamma - JPY, e) Flat Gamma - USD, f) Flat Vega - JPY, and g) Flat Vega - USD as a function of relative shifts of the foreign (USD) IR volatility. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/47.png)

![Figure 383: a) FX Delta, b) FX Gamma, and c) FX Vega as a function of relative shifts of the foreign (USD) IR volatility.](./Fig/48.png)

#### 4.10.6.5 FX Spot Shifts

Figures 384 and 385 show the PV and the risk sensitivities as a function of the JPY/USD FX spot. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected. This is a quanto product with no FX currency conversion, therefore we do not expect any dependence to the FX spot rate.

![Figure 384: a) Price, b) Flat Delta - JPY, c) Flat Delta - USD, d) Flat Gamma - JPY, e) Flat Gamma - USD, f) Flat Vega - JPY, and g) Flat Vega - USD as a function of relative shifts of the JPY/USD FX spot. The profiles of the PV and risk sensitivities are smooth and as expected. There is no dependence to the FX spot rate because this is a quanto product with no FX currency conversion.](./Fig/49.png)

#### 4.10.6.7 FX VolOfVol Shifts

Figures 386 and 389 show the PV and the risk sensitivities as a function of the JPY/USD FX vol-of-vol. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 386: a) Price, b) Flat Delta - JPY, c) Flat Delta - USD, d) Flat Gamma - JPY, e) Flat Gamma - USD, f) Flat Vega - JPY, and g) Flat Vega - USD as a function of relative shifts of the JPY/USD FX volatility. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/1.png)

![Figure 387: a) FX Delta, b) FX Gamma, and c) FX Vega as a function of relative shifts of the JPY/USD FX volatility.](./Fig/2.png)

![Figure 388: a) Price, b) Flat Delta - JPY, c) Flat Delta - USD, d) Flat Gamma - JPY, e) Flat Gamma - USD, f) Flat Vega - JPY, and g) Flat Vega - USD as a function of relative shifts of the JPY/USD FX vol-of-vol. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/3.png)

![Figure 389: a) FX Delta, b) FX Gamma, and c) FX Vega as a function of relative shifts of the JPY/USD FX vol-of-vol.](./Fig/4.png)

### 4.10.7 IRRBB Testing

#### 4.10.7.1 Domestic IR Curve Shifts

Figure 390 shows the PV as a function of the domestic (JPY) interest rate curve for the IRRBB scenarios. The test results show that the profiles of the PV are smooth and behave as expected.

![Figure 390: Price as a function of parallel shifts of the domestic (JPY) IR curve for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/5.png)

#### 4.10.7.2 Foreign IR Curve Shifts

Figure 391 shows the PV as a function of the foreign (USD) interest rate curve for the IRRBB scenarios. The test results show that the profiles of the PV are smooth and behave as expected.

![Figure 391: Price as a function of parallel shifts of the foreign (USD) IR curve for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/6.png)

#### 4.10.7.3 Domestic IR Volatility Shifts

Figure 392 shows the PV as a function of the domestic (JPY) interest rate volatility for the IRRBB scenarios. The test results show that the profiles of the PV are smooth and behave as expected.

![Figure 392: Price as a function of relative shifts of the domestic (JPY) IR volatility for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/7.png)

#### 4.10.7.4 Foreign IR Volatility Shifts

Figure 393 shows the PV as a function of the foreign (USD) interest rate volatility for the IRRBB scenarios. The test results show that the profiles of the PV are smooth and as expected.

![Figure 393: Price as a function of relative shifts of the foreign (USD) IR volatility for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/8.png)

#### 4.10.7.5 FX Spot Shifts

Figure 394 shows the PV as a function of the JPY/USD FX spot for the IRRBB scenarios. The test results show that the profiles of the PV are smooth and behave as expected.

![Figure 394: Price as a function of relative shifts of the JPY/USD FX spot for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/9.png)

#### 4.10.7.6 FX Volatility Shifts

Figure 395 shows the PV as a function of the JPY/USD FX volatility for the IRRBB scenarios. The test results show that the profiles of the PV are smooth and behave as expected.

![Figure 395: Price as a function of relative shifts of the JPY/USD FX volatility for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/10.png)

#### 4.10.7.7 FX VolOfVol Shifts

Figure 396 shows the PV as a function of the JPY/USD FX vol-of-vol for the IRRBB scenarios. The test results show that the profiles of the PV are smooth and behave as expected.

![Figure 396: Price as a function of relative shifts of the JPY/USD FX vol-of-vol for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/11.png)

### 4.10.8 CCAR Testing: Price and Risk Sensitivities

#### 4.10.8.1 Domestic IR Curve Shifts

Figure 397 shows the PV and main risk sensitivity as a function of the domestic (JPY) interest rate curve for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 397: a) Price and b) Flat Delta - JPY as a function of parallel shifts of the domestic (JPY) IR curve for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/12.png)

#### 4.10.8.2 Foreign IR Curve Shifts

Figure 398 shows the PV and main risk sensitivity as a function of the foreign (USD) interest rate curve for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 398: a) Price and b) Flat Delta - USD as a function of parallel shifts of the foreign (USD) IR curve for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/12.png)

#### 4.10.8.3 Domestic IR Volatility Shifts

Figure 399 shows the PV and main risk sensitivity as a function of the domestic (JPY) interest rate volatility for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 399: a) Price and b) Flat Vega - JPY as a function of relative shifts of the domestic (JPY) IR volatility for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/13.png)

#### 4.10.8.4 Foreign IR Volatility Shifts

Figure 400 shows the PV and main risk sensitivity as a function of the foreign (USD) interest rate volatility for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 400: a) Price and b) Flat Vega - USD as a function of relative shifts of the foreign (USD) IR volatility for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/13.png)

#### 4.10.8.5 FX Spot Shifts

Figure 401 shows the PV and main risk sensitivity as a function of the JPY/USD FX spot for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 401: a) Price and b) FX Delta as a function of relative shifts of the JPY/USD FX spot for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/14.png)

#### 4.10.8.6 FX Volatility Shifts

Figure 402 shows the PV and main risk sensitivity as a function of the JPY/USD FX volatility for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 402: a) Price and b) FX Vega as a function of relative shifts of the JPY/USD FX volatility for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/14.png)

#### 4.10.8.7 FX VolOfVol Shifts

Figure 403 shows the PV and main risk sensitivity as a function of the JPY/USD FX vol-of-vol for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 403: a) Price and b) FX Vega as a function of relative shifts of the JPY/USD FX vol-of-vol for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/15.png)

### 4.10.9 Multivar Testing

For the given dictionary, DBAnalytics identifies the following risk factors:

| Type | Currency | AssetName | RiskFactor | Sensitivity to RiskFactor |
| --- | --- | --- | --- | --- |
| IRCURVE | JPY | JPY | CCYSPREAD | YES |
| IRCURVE | JPY | JPY | SPOTLIBORSPREAD-6M | YES |
| IRCURVE | JPY | JPY | SWAP | YES |
| IRCURVE | USD | USD | DISCOUNTSPREAD | YES |
| IRCURVE | USD | USD | SPOTLIBORSPREAD-6M | YES |
| IRCURVE | USD | USD | SWAP | YES |
| FXSPOT | JPY/USD | JPY/USD | SPOT | YES |
| IRDBOPTVOL | JPY | JPY | CMSMAT | YES |
| IRDBOPTVOL | USD | USD | CMSMAT | YES |
| FXMARKETVOL | JPY/USD | JPY/USD | ATMVOL | YES |
| FXMARKETVOL | JPY/USD | JPY/USD | CONVEXITY* | - |
| FXMARKETVOL | JPY/USD | JPY/USD | DELTAVOL | YES |
| FXMARKETVOL | JPY/USD | JPY/USD | SLOPE* | - |
| FXSTOCHDBMVOL | JPY/USD | JPY/USD | LOCALVOL* | - |
| FXSTOCHDBMVOL | JPY/USD | JPY/USD | MEANREV* | - |

Table 115: Risk Factors identified by DBAnalytics in the dictionary of IRSwapQuantoRangeAccrualCallable and shock availability in list provided by Market Risk. No shocks are provided for RiskFactors marked with "*".

The identified risk factors are correct. There is two interest rates present in the dictionary: the JPY rate and the USD rate. As described in [21], every curve is constructed starting from a base curve (LIBOR 3M USD in this case) with the help of additional spreads. The FundingName is assigned "usdsfr" in this security which corresponds to DiscountSpread "usdsfr", therefore DISCOUNTSPREADs are necessary and the product will show sensitivity to them.

The JPY and USD interest rates are modelled as Hull-White processes with time-dependent volatility that calibrate to the input DBOPT volatility objects. Therefore each volatility object will show sensitivity to the inputs CMSMAT. The JPY/USD FX rate is modelled as a lognormal local volatility (Dupire-type) process which is calibrated to an input volatility object of type DELTAVOL consisting of a volatility surface of type DNCVX/RR. Therefore the product will show sensitivity to these inputs. However, the provided shocks do not cover the given configuration, being given in a ATMVOL/SLOPE/CONVEXITY or ATMVOL/DELTAVOL format. Therefore, in order to stress the FX volatility, we opt for a simplification and apply the ATMVOL shocks to the DN inputs stored in the DELTAVOL object.

We apply the SVAR 10D shocks gradually to the EOD dictionary by stressing all the risk factors listed in Table 125 using the logic described above. We obtain the following profiles:

![Figure 404: PV of IRSwapQuantoRangeAccrualCallable. The PV ladder shows that the pricing model is sufficiently robust to price in extremely stressed scenarios. As we evolve from the EOD scenario to the stressed VaR 10D scenario the profile of the PV remains stable and well-behaved](./Fig/16.png)

## 4.11 Product Testing: LTFXResurrectingFaderOpt (2024Jan08-SCHAARN-21245)

### 4.11.1 Product Description

This product is tested for the following configuration:

DBX-ShortRateNormal[LVMRAUTO]_FXSkewStochVol[DLVUTO]

using DBAnalytics version 1330.

This is a CALLFORWARD ($F_T - K$) option on the JPY/EUR FX rate with a strike 116.3 and can be exercised once on 27/12/2028. There is a continuous RANGE barrier on the same FX rate, which scales the coupon by the number of days within which the forward FX rate remains below the Upper Barrier. This barrier is checked daily between 13/03/2023 and 27/12/2028. The valuation date is 05/01/2024, and the forward FX rate was within range at all dates between 13/03/2023 and the valuation date (209 of 1483 days). The payoff is summarized as:

$$PV = E \left[ N \cdot (X^{JPY/EUR}(t_{ex}) - K) \cdot e^{-r \cdot t_{ex}} \cdot \frac{\sum_i I(X^{JPY/EUR}(t_i) < U)}{NumBarrierDates} \right]$$

where,

- $N$ is the notional, $N = 10000$ JPY
- $X^{JPY/EUR}(t_i)$ is the forward JPY/EUR FX rate at time $t_i$
- $t_{ex}$ is the exercise date, 27/12/2028.
- $K$ is the strike, $K = 116.3$
- $r$ is the domestic (JPY) interest rate.
- $I(x)$ is the indicator function
- $U$ is the upper barrier on the JPY/EUR FX rate, $U = 167$
- NumBarrierDates is the number of barrier dates between the starting and ending BarDate.

This is implemented using the FXKORANGE security with the following parameters:

| Parameter | Leg | Range |
| --- | --- | --- |
| Notional | 10000 | |
| ExerciseDate | 27/12/2028 | |
| OptionType | FORWARD | |
| Strike | 116.3 | |
| PayCurrency | JPY | |
| RangeType | SINGLE | |
| NumRanges | 1 | |
| RangeLookFreq | 1b | |
| UpperBarrier | 167 | |
| LowerBarrier | -9.99 | |
| RateIndexType | FXRATE | FXRATE |
| RateTerm | 2b | 2b |
| RateCurrency | JPY/EUR | JPY/EUR |

Table 116: Summary of market parameters for the FXKORANGE security, with the option and range parameters.

The dictionary has been tested against the model rules submitted for approval,

| Property | Value |
| --- | --- |
| MVModelName | DBX-ShortRate_FXSkewStochVol |
| DB_RiskProduct | LTFXResurrectingFaderOpt |
| ModelRule Filter Name | PARAMCONTROL |
| ModelRule Filter Version | 20240102 |
| ModelRuleStatus | PASS |

### 4.11.2 Product Specific Testing

In this section, we test specifically the features of the product and their behaviour under various risk factor shifts. Of all the risk factors, IR curve, FX spot, and FX volatility are the most significant risk factors for this product, and therefore we focus on these in this section.

#### 4.11.2.1 IR Curve Shifts

Upward shifts of the JPY rate increases the likelihood that the JPY/EUR FwdFX breaches the upper barrier, thereby reducing the scaling factor to its minimum of 209/1483, leading to a decrease in the overall PV (Figure 405). This barrier limits the upside of the trade. Equally, downwards shifts of the JPY curve leads to a decrease in the FwdFX, and therefore the coupon payoff which is dependent on this rate, $(X^{JPY/EUR}(t_{ex}) - K)$, also decreases. Changes in the EUR rate leads to the opposite behaviour in the forward FX rate, and therefore results in the behaviour shown in Figure 406.

![Figure 405: a) Price as a function of parallel shifts of the domestic (JPY) IR curve, b) JPY/EUR forward FX rate and c) the probability that this forward is within the specified range at each pay dates for various JPY curve shifts in [-5%, 5%].](./Fig/19.png)

![Figure 406: a) Price as a function of parallel shifts of the foreign (EUR) IR curve, b) JPY/EUR forward FX rate and c) the probability that this forward is within the specified range at each pay dates for various EUR curve shifts in [-5%, 5%].](./Fig/20.png)

Because the option is of type FORWARD, the effect of increasing strike is only to reduce the coupon value, $(X^{JPY/EUR}(t_{ex}) - K)$, see Figure 407. If the trade contains a CALL option, then a higher strike increases the likelihood that the option is exercised for downward shifts of the JPY rate (decreasing FwdFX), and the PV tends to 0 (see Figure 408).

![Figure 407: Price as a function of parallel shifts of the a) domestic (JPY), and b) foreign (EUR) IR curve for various Strikes in $K \in \{70,116.3,170\}$. In all cases, PV decreases with rising strike.](./Fig/21.png)

![Figure 408: Price as a function of parallel shifts of the a) domestic (JPY), and b) foreign (EUR) IR curve for a FORWARD and CALL option of various Strikes in $K \in \{116.3,130,150\}$.](./Fig/22.png)

If the FwdFX rate breaches the UpperBarrier, the scaling factor on the coupon decrease and therefore so does the trade value. By increasing this UpperBarrier, we decrease the likelihood of breaching the barrier, thus leading to an increase in PV, especially at the more extreme upward JPY shifts, where the FwdFX is higher (Figure 409). A similar behaviour is seen in the case of extreme downward shifts of the EUR rate. Furthermore, adding a LowerBarrier to the FX rate limits the trade's downside. For a relatively high LowerBarrier (e.g. 150), extreme downward shifts of the JPY rate increases the likelihood of breaching the lower barrier due to lower FwdFX rate, and therefore the rate of decrease in PV drops, see Figure 410.

![Figure 409: Price as a function of parallel shifts of the a) domestic (JPY), and b) foreign (EUR) IR curve for various UpperBarrier in $U \in \{160,167,180\}$.](./Fig/23.png)

![Figure 410: Price as a function of parallel shifts of the a) domestic (JPY), and b) foreign (EUR) IR curve for various LowerBarrier in $L \in \{-9.99,150,120,100\}$.](./Fig/24.png)

#### 4.11.2.2 FX Spot Shifts

Upwards shifts of the JPY/EUR spot rate leads to an increase in the FwdFX such that it is above the UpperBarrier and thus out of the range. This results in the small decrease in PV at small positive spot shifts. As the FX spot is increased further, the coupon, which depends on the FwdFX ($(X^{JPY/EUR}(t_{ex}) - K)$), also rises. Here the scaling factor remains constant at its lowest value of 209/1483. For downward shifts of the FX spot, the FwdFX drops below the UpperBarrier at all pay dates, and therefore the scaling factor rises to 1, and the full coupon value is paid. However, the value of these coupons decrease because of the falling FwdFX rate. This leads to the steep decline in trade value, as shown in Figure 411.

![Figure 411: a) Price as a function of relative shifts of the JPY/EUR FX spot rate, b) JPY/EUR forward FX rate and c) the probability that this forward is within the specified range at each pay dates for various JPY/EUR FX spot shifts in [-95%, 200%].](./Fig/25.png)

#### 4.11.2.3 FX Vol Shifts

At the market FX spot, the FwdFX at all pay dates lie below the UpperBarrier, and further decreases in the FX volatility reduces the likelihood that the FwdFX will breach the barrier. This leads to an increase in the trade PV. Vice versa, an increase in the FX volatility increases the likelihood of breaching the UpperBarrier and therefore a decline in the trade PV (see Figure 412).

![Figure 412: a) Price as a function of relative shifts of the JPY/EUR FX volatility, b) JPY/EUR forward FX rate and c) the probability that this forward is within the specified range at each pay dates for various JPY/EUR FX vol shifts in [-95%, 200%].](./Fig/26.png)

#### 4.11.2.4 Volatility Dependence

Figures 413 and 414 shows the PV and Flat Vega with respect to the FX rate and domestic IR and different levels of FX/IR volatility respectively. It shows that the volatility factor with the greatest impact on PV is due to the FX rate, and this is confirmed by the Flat Vega calculations. At low FX volatilities, the FX rate can increase to a higher level before it breaches the upper barrier, and further increases of the rate causes the barrier to be breached on more dates, leading to a decrease in PV. When the FX volatility is increased, the likelihood of breaching the upper barrier can happen even at lower FX rates, and this is reflected in the Flat Vega which reaches its minimum at lower JPY curve shifts.

On the other hand, Figure 414 shows that IR volatility has very little impact of the PV of the trade, likely due to the short trade duration of 5 years.

### 4.11.3 Convergence Testing

| Parameter | Value |
| --- | --- |
| NumberSims | 10000 |
| NumberRuns | 1 |
| FrontLatticeFreq | 96 |
| FreqTimeVec | 12 |
| IntegrationFreq | 365 |

The convergence results are shown in Figures 415 and 416 for price and all risk sensitivities. We see that all estimates converge to stable values.

![Figure 415: a) Price, b) Flat Delta - JPY, c) Flat Delta - EUR, d) Flat Gamma - JPY, e) Flat Gamma - EUR, f) Flat Vega - JPY, and g) Flat Vega - EUR estimates for the LTFXResurrectingFaderOpt trade as a function number of simulations in the Monte Carlo (DBX) model. The price and risk sensitivities all converge to stable values.](./Fig/27.png)

![Figure 416: a) FX Delta, b) FX Gamma, and c) FX Vega for the LTFXResurrectingFaderOpt trade as a function number of simulations in the Monte Carlo (DBX) model. The FX risk factor values converge to a stable value.](./Fig/28.png)

### 4.11.4 Calibration Testing

#### 4.11.4.1 DLV Calibration

We use the following DLV parameters in the MODEL object to improve the quality of calibration fit:

| Parameter | Value |
| --- | --- |
| NumberSims | 10000 |
| MaxIter | 0 |
| FrontLatticeFreq | 96 |
| IntegrationFreq | 365 |
| DLVCalibration | ALL |
| DLVCalibrationType | SIMPLE-SMOOTH |

FXSkewStochVol[DLVAuto] Figure 417 shows the comparison between the market implied volatility, fitted using a SAM parametric function, and the DLV for options contingent on the JPY/EUR FX rate, at different maturities. The SAM parametric function is fitted using the DBSMC-RateDeterministic_FXMarket model. There is a good quality of fit between DLV and the parametric implied volatility.

![Figure 417: Comparison between the market implied volatility for the JPY/EUR FX rate computed using the DBSMC-RateDeterministic_FXMarket model and the Dupire local volatility (DLV) at option maturities of a) 3m, b) 6m, c) 1y, d) 5y, e) 10y and f) 20y.](./Fig/29.png)

### 4.11.5 Taylor Test

In this section, we test how well the Delta-Gamma expansion of the present value approximates the present value in a neighbourhood of the point

$$(Dom. Curve Shift, For Curve Shift) = (0,0)$$

expansion in these Greeks, around a small neighbourhood about (0,0)

$$PV(\alpha, \beta) \approx PV(0,0) + \frac{1}{\delta_{f_r}} \Delta_{f_r}(0,0)a + \frac{1}{2}\frac{1}{\delta_{f_r}^2}\Gamma_{f_r}(0,0)a^2 + \frac{1}{\delta_{f_r}} \Lambda_{f_r}(0,0)\beta,$$

where $\Delta_{f_r}$ and $\Gamma_{f_r}$ denote here the FXDELTA and FXGAMMAVAVE with respect to the FX spot rate respectively, and $\Lambda_{f_r}$ is the FLATVEGA with respect to the FX vol. $\delta_{\alpha_{f_r}}$, $\delta_{\gamma_{f_r}}$, $\delta_{\lambda_{f_r}}$ represent the shift sizes used in the computation of these greeks. $(\alpha, \beta)$ are small shifts in FX spot and vol about the market neighbourhood.

![Figure 420: a) Price against JPY/EUR FX spot shift calculated with DBAnalytics (red), and the first (green) and second (blue) order Taylor approximations, b) Price against JPY/EUR FX vol shift calculated with DBAnalytics (red), and the first order (green) Taylor approximation.](./Fig/30.png)

![Figure 421: a) The price computed by DBAnalytics is shown as a coloured surface plot as a function of JPY/EUR FX spot and vol shifts. The black wireframe shows the Taylor-approximated price, computed using the market PV, FX Delta, FX Gamma, FX Vega. b) The absolute difference between the price calculated by DBAnalytics and the price approximated from the Taylor expansion.](./Fig/31.png)

### 4.11.6 EOD Testing: Price and Risk Sensitivities

#### 4.11.6.1 Domestic IR Curve Shifts

Figures 422 and 423 show the PV and the risk sensitivities as a function of the domestic (JPY) interest rate curve. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 422: a) Price, b) Flat Delta - JPY, c) Flat Delta - EUR, d) Flat Gamma - JPY, e) Flat Gamma - EUR, f) Flat Vega - JPY, and g) Flat Vega - EUR as a function of parallel shifts of the domestic (JPY) IR curve. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/32.png)

![Figure 423: a) FX Delta, b) FX Gamma, and c) FX Vega as a function of parallel shifts of the domestic (JPY) IR curve.](./Fig/33.png)

#### 4.11.6.2 Foreign IR Curve Shifts

Figures 424 and 425 show the PV and the risk sensitivities as a function of the foreign (EUR) interest rate curve. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 424: a) Price, b) Flat Delta - JPY, c) Flat Delta - EUR, d) Flat Gamma - JPY, e) Flat Gamma - EUR, f) Flat Vega - JPY, and g) Flat Vega - EUR as a function of parallel shifts of the foreign (EUR) IR curve. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/34.png)

![Figure 425: a) FX Delta, b) FX Gamma, and c) FX Vega as a function of parallel shifts of the foreign (EUR) IR curve.](./Fig/35.png)

#### 4.11.6.3 Domestic IR Vol Shifts

Figures 426 and 427 show the PV and the risk sensitivities as a function of the domestic (JPY) interest rate volatility. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 426: a) Price, b) Flat Delta - JPY, c) Flat Delta - EUR, d) Flat Gamma - JPY, e) Flat Gamma - EUR, f) Flat Vega - JPY, and g) Flat Vega - EUR as a function of relative shifts of the domestic (JPY) IR volatility. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/36.png)

![Figure 427: a) FX Delta, b) FX Gamma, and c) FX Vega as a function of relative shifts of the domestic (JPY) IR volatility.](./Fig/37.png)

#### 4.11.6.4 Foreign IR Vol Shifts

Figures 428 and 429 show the PV and the risk sensitivities as a function of the foreign (EUR) interest rate volatility. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 428: a) Price, b) Flat Delta - JPY, c) Flat Delta - EUR, d) Flat Gamma - JPY, e) Flat Gamma - EUR, f) Flat Vega - JPY, and g) Flat Vega - EUR as a function of relative shifts of the foreign (EUR) IR volatility. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/38.png)

![Figure 429: a) FX Delta, b) FX Gamma, and c) FX Vega as a function of relative shifts of the foreign (EUR) IR volatility.](./Fig/39.png)

#### 4.11.6.5 FX Spot Shifts

Figures 430 and 431 show the PV and the risk sensitivities as a function of the JPY/EUR FX spot. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected. This is a quanto product with no FX currency conversion, therefore we do not expect any dependence to the FX spot rate.

![Figure 430: a) Price, b) Flat Delta - JPY, c) Flat Delta - EUR, d) Flat Gamma - JPY, e) Flat Gamma - EUR, f) Flat Vega - JPY, and g) Flat Vega - EUR as a function of relative shifts of the JPY/EUR FX spot. The profiles of the PV and risk sensitivities are smooth and as expected. There is no dependence to the FX spot rate because this is a quanto product with no FX currency conversion.](./Fig/40.png)

![Figure 431: a) FX Delta, b) FX Gamma, and c) FX Vega as a function of relative shifts of the JPY/EUR FX spot. There is no dependence to the FX spot rate because this is a quanto product with no FX currency conversion.](./Fig/41.png)

#### 4.11.6.6 FX Volatility Shifts

Figures 432 and 433 show the PV and the risk sensitivities as a function of the JPY/EUR FX volatility. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 432: a) Price, b) Flat Delta - JPY, c) Flat Delta - EUR, d) Flat Gamma - JPY, e) Flat Gamma - EUR, f) Flat Vega - JPY, and g) Flat Vega - EUR as a function of relative shifts of the JPY/EUR FX volatility. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/42.png)

![Figure 433: a) FX Delta, b) FX Gamma, and c) FX Vega as a function of relative shifts of the JPY/EUR FX volatility.](./Fig/43.png)

#### 4.11.6.7 FX VolOfVol Shifts

Figures 434 and 435 show the PV and the risk sensitivities as a function of the JPY/EUR FX vol-of-vol. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 434: a) Price, b) Flat Delta - JPY, c) Flat Delta - EUR, d) Flat Gamma - JPY, e) Flat Gamma - EUR, f) Flat Vega - JPY, and g) Flat Vega - EUR as a function of relative shifts of the JPY/EUR FX vol-of-vol. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/44.png)

![Figure 435: a) FX Delta, b) FX Gamma, and c) FX Vega as a function of relative shifts of the JPY/EUR FX vol-of-vol.](./Fig/45.png)

### 4.11.7 IRRBB Testing

#### 4.11.7.1 Domestic IR Curve Shifts

Figure 436 shows the PV as a function of the domestic (JPY) interest rate curve for the IRRBB scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 436: Price as a function of parallel shifts of the domestic (JPY) IR curve for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/46.png)

#### 4.11.7.2 Foreign IR Curve Shifts

Figure 437 shows the PV as a function of the foreign (EUR) interest rate curve for the IRRBB scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 437: Price as a function of parallel shifts of the foreign (EUR) IR curve for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/47.png)

#### 4.11.7.3 Domestic IR Volatility Shifts

Figure 438 shows the PV as a function of the domestic (JPY) interest rate volatility for the IRRBB scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 438: Price as a function of relative shifts of the domestic (JPY) IR volatility for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/48.png)

#### 4.11.7.4 Foreign IR Volatility Shifts

Figure 439 shows the PV as a function of the foreign (EUR) interest rate volatility for the IRRBB scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and as expected.

![Figure 439: Price as a function of relative shifts of the foreign (EUR) IR volatility for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/49.png)

#### 4.11.7.5 FX Spot Shifts

Figure 440 shows the PV as a function of the JPY/EUR FX spot for the IRRBB scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 440: Price as a function of relative shifts of the JPY/EUR FX spot for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/50.png)

#### 4.11.7.6 FX Volatility Shifts

Figure 441 shows the PV as a function of the JPY/EUR FX volatility for the IRRBB scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.
![Figure 441: Price as a function of relative shifts of the JPY/EUR FX volatility for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/51.png)

#### 4.11.7.7 FX VolOfVol Shifts

Figure 442 shows the PV as a function of the JPY/EUR FX vol-of-vol for the IRRBB scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 442: Price as a function of relative shifts of the JPY/EUR FX vol-of-vol for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/52.png)

### 4.11.8 CCAR Testing: Price and Risk Sensitivities

#### 4.11.8.1 Domestic IR Curve Shifts

Figure 443 shows the PV and main risk sensitivity as a function of the domestic (JPY) interest rate curve for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 443: a) Price and b) Flat Delta - JPY as a function of parallel shifts of the domestic (JPY) IR curve for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/53.png)

#### 4.11.8.2 Foreign IR Curve Shifts

Figure 444 shows the PV and main risk sensitivity as a function of the foreign (EUR) interest rate curve for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 444: a) Price and b) Flat Delta - EUR as a function of parallel shifts of the foreign (EUR) IR curve for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/54.png)

#### 4.11.8.3 Domestic IR Volatility Shifts

Figure 445 shows the PV and main risk sensitivity as a function of the domestic (JPY) interest rate volatility for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 445: a) Price and b) Flat Vega - JPY as a function of relative shifts of the domestic (JPY) IR volatility for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/55.png)

#### 4.11.8.4 Foreign IR Volatility Shifts

Figure 446 shows the PV and main risk sensitivity as a function of the foreign (EUR) interest rate volatility for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 446: a) Price and b) Flat Vega - EUR as a function of relative shifts of the foreign (EUR) IR volatility for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/56.png)

#### 4.11.8.5 FX Spot Shifts

Figure 447 shows the PV and main risk sensitivity as a function of the JPY/EUR FX spot for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 447: a) Price and b) FX Delta as a function of relative shifts of the JPY/EUR FX spot for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/57.png)

#### 4.11.8.6 FX Volatility Shifts

Figure 448 shows the PV and main risk sensitivity as a function of the JPY/EUR FX volatility for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 448: a) Price and b) FX Vega as a function of relative shifts of the JPY/EUR FX volatility for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/58.png)

#### 4.11.8.7 FX VolOfVol Shifts

Figure 449 shows the PV and main risk sensitivity as a function of the JPY/EUR FX vol-of-vol for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 449: a) Price and b) FX Vega as a function of relative shifts of the JPY/EUR FX vol-of-vol for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.](./Fig/59.png)

### 4.11.9 Multivar Testing

For the given dictionary, DBAnalytics identifies the following risk factors:

| Type | Currency | AssetName | RiskFactor | Sensitivity to RiskFactor |
| --- | --- | --- | --- | --- |
| IRCURVE | JPY | JPY | CCYSPREAD | YES |
| IRCURVE | JPY | JPY | SWAP | YES |
| IRCURVE | EUR | EUR | CCYSPREAD | YES |
| IRCURVE | EUR | EUR | DISCOUNTSPREAD | YES |
| IRCURVE | EUR | EUR | SPOTLIBORSPREAD-1M | YES |
| IRCURVE | EUR | EUR | SPOTLIBORSPREAD-3M | YES |
| IRCURVE | EUR | EUR | SWAP | YES |
| FXSPOT | JPY/EUR | JPY/EUR | SPOT | YES |
| IRDBOPTVOL | EUR | EUR | CMSMAT | YES |
| IRDBOPTVOL | JPY | JPY | CMSMAT | YES |
| FXMARKETVOL | JPY/EUR | JPY/EUR | ATMVOL | YES |
| FXMARKETVOL | JPY/EUR | JPY/EUR | CONVEXITY* | - |
| FXMARKETVOL | JPY/EUR | JPY/EUR | DELTAVOL | YES |
| FXMARKETVOL | JPY/EUR | JPY/EUR | SLOPE* | - |
| FXSTOCHDBMVOL | JPY/EUR | JPY/EUR | LOCALVOL* | - |
| FXSTOCHDBMVOL | JPY/EUR | JPY/EUR | MEANREV* | - |

Table 120: Risk Factors identified by DBAnalytics in the dictionary of LTFXResurrectingFaderOpt and shock availability in list provided by Market Risk. No shocks are provided for RiskFactors marked with "*".

The identified risk factors are correct: LTFXResurrectingFaderOpt is an FX derivative whose payoff depends on the JPY/EUR FX rate. There is two interest rates present in the dictionary: the JPY rate and the EUR rate. As described in [21], every curve is constructed starting from a base curve (LIBOR 6M JPY in this case) with the help of additional spreads. The FundingName is assigned "eur3ml" in this security which corresponds to DiscountSpread "eur3ml", therefore DISCOUNTSPREADS are necessary and the product will show sensitivity to them.

The JPY and EUR interest rates are modelled as Hull-White processes with time-dependent volatility that calibrate to the input IRCMSOPT volatility objects. Therefore each volatility object will show sensitivity to the inputs CMSMAT.

The JPY/EUR FX rate is modelled as a lognormal local volatility (Dupire-type) process which is calibrated to an input volatility object of type DELTAVOL consisting of a volatility surface of type DNCVX/RR. Therefore the product will show sensitivity to these inputs. However, the provided shocks do not cover the given configuration, being given in a ATMVOL/SLOPE/CONVEXITY or ATMVOL/DELTAVOL format. Therefore, in order to stress the FX volatility, we opt for a simplification and apply the ATMVOL shocks to the DN inputs stored in the DELTAVOL object.

We apply the SVAR 10D shocks gradually to the EOD dictionary by stressing all the risk factors listed in Table 125 using the logic described above. We obtain the following profiles:

![Figure 450: PV of LTFXResurrectingFaderOpt. The PV ladder shows that the pricing model is sufficiently robust to price in extremely stressed scenarios. As we evolve from the EOD scenario to the stressed VaR 10D scenario the profile of the PV remains stable and well-behaved](./Fig/60.png)

## 4.12 Product Testing: LTFXOneBarDigitalOpt (2024Jan08-SCHAARN-21246)

### 4.12.1 Product Description

This product is tested for the following configuration:

DBX-ShortRateNormal[LVMRAUTO]_FXSkewStochVol[DLVUTO]

using DBAnalytics version 1330.

This is a BINARYPUT (digital) option on the JPY/USD FX rate with a strike 88 and can be exercised once on 19/05/2031. The option is exercised when FX rate at the exercise date is greater than the strike, $K$, knocking out the trade. Conversely if the rate is within the strike then the notional is paid out. This notional is originally denominated in USD but it is converted to JPY when paid out. There is additionally a continuous knock-out barrier on the same FX rate, which knocks out the trade if the forward FX rate and any barrier date drops below the lower barrier, $L = 79.55$. This barrier is checked daily between 19/05/2021 and 31/10/2025 (early finishing) and the trade valuation date is 08/01/2024. The payoff is summarized as:

$$PV(JPY) = \mathbb{E}\left[N \cdot \mathbb{I}(X^{JPY/USD}(t_{ex}) < K) \cdot X^{JPY/USD}(t_{ex}) \cdot e^{-\int_{t_0}^{t_{ex}}r_s ds} \cdot \prod_i \mathbb{I}(X^{JPY/USD}(t_i) > L)\right]$$

where

- $N$ is the notional, $N = 10000$ USD,
- $\mathbb{I}(x)$ is the indicator function
- $X^{JPY/USD}(t_i)$ is the forward JPY/USD FX rate at time $t_i$ with a spot rate of $144.238 JPY/USD$,
- $K$ is the strike, $K = 88$
- $t_{ex}$ is the exercise date, 19/05/2031,
- $r$ is the domestic (JPY) interest rate,
- $L$ is the lower barrier on the FX rate, $L = 79.55$
- $t_i$ are the daily dates where the KO barrier is active

This is implemented using the BARFXOPT security with the following parameters:

| Parameter | Leg |
| --- | --- |
| Notional | 10000 |
| RateIndexType | FXRATE |
| RateTerm | 2b |
| RateCurrency | JPY/USD |
| ExerciseDate | 19/05/2031 |
| OptionType | FORMULA |
| Strike | 88 |
| PayCurrency | USD |
| BarrierRateIndexType | FXRATE |
| BarrierRateTerm | 2b |
| BarrierRateCurrency | JPY/USD |
| BarrierStartDate | 19/05/2021 |
| BarrierEndDate | 31/10/2025 |
| BarrierInterval | 1b |
| OriginalUpper | 9.99 |
| OriginalLower | 79.55 |
| UpperBarrierType | CONTINUOUSKNOCKOUT |
| LowerBarrierType | CONTINUOUSKNOCKOUT |

Table 121: Summary of critical parameters for the BARFXOPT security, with the option and barrier parameters.

The dictionary has been tested against the model rules submitted for approval,

| Property | Value |
| --- | --- |
| MVModelName | DBX-ShortRate_FXSkewStochVol |
| DB_RiskProduct | LTFXOneBarDigitalOpt |
| ModelRule Filter Name | PARAMCONTROL |
| ModelRule Filter Version | 20240102 |
| ModelRuleStatus | PASS |

### 4.12.2 Product Specific Testing

In this section, we test specifically the features of the product and their behaviour under various risk factor shifts. Of all the risk factors, FX spot and IR curve are the most significant risk factors for this product, and therefore we focus on these in this section.

#### 4.12.2.1 FX Spot Shifts

Figure 451 shows the impact of the pay currency on the value of the trade. This is a digital product with a notional of 10000 USD; if we set the notional currency to JPY, such that it is equal to the report currency, then there is no longer a currency conversion and we can reproduce the behaviour of a digital product. In this test, we switch off the lower barrier, $L = -9.99$ (pink - 451a).

$$PV(JPY) = \mathbb{E}\left[N^{JPY} \cdot \mathbb{I}(X^{JPY/USD}(t_{ex}) < K) \cdot e^{-\int_{t_0}^{t_{ex}}r_s ds}\right]$$

When the NotionalCurrency is set to USD, as in the original trade, then once the likelihood of exercising the option reaches 0%, further negative shifts of the FX rate causes a decrease in PV due to the currency conversion to JPY (pink - 451b).

$$PV(JPY) = \mathbb{E}\left[N^{USD} \cdot \mathbb{I}(X^{JPY/USD}(t_{ex}) < K) \cdot X^{JPY/USD}(t_{ex}) \cdot e^{-\int_{t_0}^{t_{ex}}r_s ds}\right]$$

The additional lower barrier causes the PV to drop to 0 because negative FX spot shifts has caused the FwdFX rate to breach the barrier, knocking out the trade.

![Figure 451: Price as a function of relative shifts of the JPY/USD FX spot, when the NotionalCurrency is a) JPY, and b) USD. When the notional currency equals the report currency (JPY), the product behaves as a digital, otherwise negative shifts of the FX spot causes a decrease in trade PV due to the currency conversion.](./Fig/61.png)

Figure 452 shows the impact of FX spot shifts on the trade value. At the market, the FX spot rate (144.32) is greater than the strike (grey dashed line in 452p) so it is highly likely that the option is exercised, causing the PV to drop to zero. Further positive shifts to the FX spot increases the likelihood of option exercise, and therefore the PV tends to zero. Conversely, downward shifts of the FX spot decreases the likelihood of exercise, causing the PV to increase until the FwdFX = K. Further downward shifts causes a decrease in PV as there is an increased likelihood that FwdFX breaches the lower barrier (red dashed line - 452p). Note that the FwdFX rate at the exercise date in 452p is not the same as the FwdFX at the barrier date in 452b because the barrier date is earlier than the exercise date.

![Figure 452: Price and JPY/USD relationships.](./Fig/1.png)

Figure 452: a) Price and the JPY/USD forward FX rate at the b) exercise date and c) last barrier date as a function of relative shifts of the JPY/USD FX spot. Negative shifts of the FX rate increases the probability that the rate is within the strike, and therefore the trade value increases. However, further negative shifts causes the FX rate to breach the lower barrier, causing the trade to knock out. Thus PV tends to zero here. The grey dashed line is at the strike of $K = 88$ while the red dashed line is the lower barrier, $L = 79.55$.

In Figure 453, we investigate the effects of the early finishing feature of the barrier. When the BarrierEndDate is equal to the end date of the trade (ExerciseDate), then the behaviour of the FwdFX at the final barrier date is equal to the FwdFX at the exercise date, as expected. Conversely, when the BarrierEndDate is earlier than the trade end, the FwdFX at the last barrier date is higher than the rate at the exercise date, and therefore a larger FX spot downshift is required to breach the lower barrier.

![Figure 453: Price and JPY/USD relationships.](./Fig/2.png)

Figure 453: a) Price and b) JPY/USD forward FX rate as a function of relative shifts of the JPY/USD FX spot.

In Figure 454, we test the effect of varying both the strike and the lower barrier. In this trade, the strike and the lower barrier act as a range within which the FwdFX rate must remain in order to obtain maximum trade value. If we widen this range by setting the strike to $K = 100$ and the lower barrier to $L = 60$, then the trade is non-zero for a wider range of FX spot shifts, and vice versa. PV can also attain a higher peak in a wider range.

![Figure 454: Price and FX Delta.](./Fig/3.png)

Figure 454: a) Price and b) FX Delta - JPY/USD as a function of relative shifts of the JPY/USD FX spot, at various strikes and lower barriers.

#### 4.12.2.2 IR Curve Shifts

![Figure 455: Price and JPY/USD FX rate.](./Fig/4.png)

Figures 455 and 456 show the trade PV and FwdFX rate as a function of parallel shifts of the domestic (JPY) and foreign (USD) rates. These have an equal and opposite impact on the FX rate, whereby positive shifts to the JPY rate result in an increase in the FwdFX rate, whereas a shift to the USD rate leads to a decrease in the FwdFX. If the FwdFX increases, it is less likely to be lower than the strike, $I(X^{JPY/USD}(t_{ex}) < K)$, therefore causing the PV to drop to zero.

![Figure 456: Price and JPY/USD FX rate.](./Fig/5.png)

Figure 456: a) Price and b) JPY/USD forward FX rate as a function of parallel shifts of the foreign (USD) IR curve. This has the inverse behaviour of the JPY rate, where increases in the USD rate result in a decrease in the FwdFX and thus increasing its likelihood of being under the strike, $I(X^{JPY/USD}(t_{ex}) < K)$. Therefore the PV increases. The grey dashed line indicates the strike, $K = 88$.

#### 4.12.2.3 Volatility Dependence

Figures 457 and 458 shows the PV and Flat Vega with respect to the FX rate and domestic IR and different levels of FX/IR volatility respectively. It shows that the volatility factor with the greatest impact on PV is due to the FX rate, and this is confirmed by the Flat Vega calculations. Decreasing the FX volatility at the market JPY rate, decreases the likelihood of the FwdFX to remain within the strike (88), and therefore the PV drops to zero. By decreasing the JPY rate as well, causes the FwdFX to remain within the strike causing a jump in the PV (expected digital behaviour). As the increase FX volatility, the jump is smoothed with an increased likelihood of remaining within the strike at higher JPY rates, and vice versa.

Conversely, Figure 458 shows that IR volatility has very little impact of the PV of the trade, likely due to the short trade duration (exercised in 7 years from the valuation date).

![Figure 457: Price and FX Vega.](./Fig/6.png)

Figure 457: a) Price, and b) FX Vega as a function of parallel shifts of the JPY IR curve for various JPY/EUR FX vol shifts in [-95%, 125%]. The behaviour of the FX Vega can be attributed to the upper barrier, where at certain curve shifts there is an increased likelihood that pay coupons are knocked out.

![Figure 458: Price and Flat Vega.](./Fig/7.png)

Figure 458: a) Price, and b) Flat Vega - JPY as a function of parallel shifts of the JPY IR curve for various JPY IR vol shifts in [-95%, 200%]. Compared to FX volatility sensitivity, the IR volatility has only a minimal impact on the PV and this is reflected by the relatively smaller IR Vega. The lower sensitivity to IR volatility can be attributed to the shortness of the trade (7 years from valuation).

### 4.12.3 Monte Carlo Convergence: Price and Risk Sensitivities

We first carry out testing to ensure that the product's PV and main risk sensitivities are robust as the parameters relevant for the Monte Carlo simulation are varied. We fix all the DBX model parameters and vary only the number of simulations for different Seed parameters. The product displays a good convergence, with PV and risk sensitivities reaching their asymptotic values after 10k paths. Similar Monte Carlo convergence tests can be found in DBAnalytics testing document.

The market trade has the following parameters for the DBX model.

| Parameter | Value |
| --- | --- |
| NumberSims | 10000 |
| NumberRuns | 1 |
| FrontLatticeFreq | 96 |
| FreqTimeVec | 12 |
| IntegrationFreq | 365 |

The convergence results are shown in Figures 459 and 460 for price and all risk sensitivities. We see that all estimates converge to stable values.

![Figure 459: PV and risk sensitivities.](./Fig/8.png)

Figure 459: a) Price, b) Flat Delta - JPY, c) Flat Delta - USD, d) Flat Gamma - JPY, e) Flat Gamma - USD, f) Flat Vega - JPY, and g) Flat Vega - USD estimates for the LTFXOneBarDigitalOpt trade as a function number of simulations in the Monte Carlo (DBX) model. The price and risk sensitivities all converge to stable values.

![Figure 460: FX risk factor values.](./Fig/9.png)

Figure 460: a) FX Delta, b) FX Gamma, and c) FX Vega for the LTFXOneBarDigitalOpt trade as a function number of simulations in the Monte Carlo (DBX) model. The FX risk factor values converge to a stable value.

### 4.12.4 Calibration Testing

#### 4.12.4.1 DLV Calibration

We use the following DLV parameters in the MODEL object to improve the quality of calibration fit:

| Parameter | Value |
| --- | --- |
| NumberSims | 10000 |
| MaxIter | 0 |
| FrontLatticeFreq | 96 |
| IntegrationFreq | 365 |
| DLVCalibration | ALL |
| DLVCalibrationType | SIMPLE-SMOOTH |

![Figure 461: Market implied volatility comparison.](./Fig/10.png)

Figure 461: Comparison between the market implied volatility for the JPY/USD FX rate computed using the DBSMC RateDeterministic_FXMarket model and the Dupire local volatility (DLV) at option maturities of a) 3m, b) 6m, c) 1y, d) 5y, e) 10y and f) 20y.

### 4.12.5 Taylor Test

In this section, we test how well the Delta-Gamma expansion of the present value approximates the present value in a neighborhood of the point

$$(Dom\; Curve\; Shift, For\; Curve\; Shift) = (0,0)$$

More precisely, we check that for domestic and foreign curve shifts $(\alpha, \beta)$ in a neighborhood of $(0,0)$ (which we chose to be $(-1\%,1\%) \times (-1\%,1\%)$) we have

$$PV(\alpha, \beta) \approx PV(0,0) + \frac{1}{\delta_{\Delta_d}} \Delta_d(0,0)\alpha + \frac{1}{\delta_{\Delta_f}} \Delta_f(0,0)\beta + \frac{1}{2\delta^2_{\Gamma_d}} \Gamma_d(0,0)\alpha^2 + \frac{1}{2\delta^2_{\Gamma_f}} \Gamma_f(0,0)\beta^2,$$

where $\Delta_{d/f}$ and $\Gamma_{d/f}$ denote here the FLATDELTA and FLATGAMMA with respect to the domestic and foreign curves respectively, and $\delta_{\Delta_{d/f}}$ and $\delta_{\Gamma_{d/f}}$ represent the shift sizes used in the computation of FLATDELTA and FLATGAMMA.

![Figure 462: Price comparisons.](./Fig/11.png)

Figure 462: a) Price against domestic (JPY) curve shift calculated with DBAnalytics (red), and the first (green) and second (blue) order Taylor approximations. b) Price against foreign (USD) curve shift calculated with DBAnalytics (red), and the first order (green) and second (blue) Taylor approximation.

![Figure 463: Price and difference analysis.](./Fig/12.png)

Figure 463: a) The price computed by DBAnalytics is shown as a coloured surface plot as a function of domestic (JPY) and foreign (USD) curve shifts. The black wireframe shows the Taylor-approximated price, computed using the market PV, Flat Delta - JPY, Flat Delta - USD, Flat Gamma - JPY, Flat Gamma - USD. b) The absolute difference between the price calculated by DBAnalytics and the price approximated from the Taylor expansion.

### 4.12.6 EOD Testing: Price and Risk Sensitivities

#### 4.12.6.1 Domestic IR Curve Shifts

Figures 464 and 465 show the PV and the risk sensitivities as a function of the domestic (JPY) interest rate curve. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 464: Price, Flat Delta, Flat Gamma, Flat Vega.](./Fig/13.png)

Figure 464: a) Price, b) Flat Delta - JPY, c) Flat Delta - USD, d) Flat Gamma - JPY, e) Flat Gamma - USD, f) Flat Vega - JPY, and g) Flat Vega - USD as a function of parallel shifts of the domestic (JPY) IR curve. The profiles of the PV and risk sensitivities are smooth and as expected.

![Figure 465: FX Delta, FX Gamma, FX Vega.](./Fig/14.png)

Figure 465: a) FX Delta, b) FX Gamma, and c) FX Vega as a function of parallel shifts of the domestic (JPY) IR curve.

#### 4.12.6.2 Foreign IR Curve Shifts

Figures 466 and 467 show the PV and the risk sensitivities as a function of the foreign (USD) interest rate curve. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 466: Price, Flat Delta, Flat Gamma, Flat Vega.](./Fig/15.png)

Figure 466: a) Price, b) Flat Delta - JPY, c) Flat Delta - USD, d) Flat Gamma - JPY, e) Flat Gamma - USD, f) Flat Vega - JPY, and g) Flat Vega - USD as a function of parallel shifts of the foreign (USD) IR curve. The profiles of the PV and risk sensitivities are smooth and as expected.

![Figure 467: FX Delta, FX Gamma, FX Vega.](./Fig/16.png)

Figure 467: a) FX Delta, b) FX Gamma, and c) FX Vega as a function of parallel shifts of the foreign (USD) IR curve.

#### 4.12.6.3 Domestic IR Vol Shifts

Figures 468 and 469 show the PV and the risk sensitivities as a function of the domestic (JPY) interest rate volatility. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 468: Price, Flat Delta, Flat Gamma, Flat Vega.](./Fig/17.png)

Figure 468: a) Price, b) Flat Delta - JPY, c) Flat Delta - USD, d) Flat Gamma - JPY, e) Flat Gamma - USD, f) Flat Vega - JPY, and g) Flat Vega - USD as a function of relative shifts of the domestic (JPY) IR volatility. The profiles of the PV and risk sensitivities are smooth and as expected.

![Figure 469: FX Delta, FX Gamma, FX Vega.](./Fig/18.png)

Figure 469: a) FX Delta, b) FX Gamma, and c) FX Vega as a function of relative shifts of the domestic (JPY) IR volatility.

#### 4.12.6.4 Foreign IR Vol Shifts

Figures 470 and 471 show the PV and the risk sensitivities as a function of the foreign (USD) interest rate volatility. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 470: Price, Flat Delta, Flat Gamma, Flat Vega.](./Fig/19.png)

Figure 470: a) Price, b) Flat Delta - JPY, c) Flat Delta - USD, d) Flat Gamma - JPY, e) Flat Gamma - USD, f) Flat Vega - JPY, and g) Flat Vega - USD as a function of relative shifts of the foreign (USD) IR volatility. The profiles of the PV and risk sensitivities are smooth and as expected.

![Figure 471: FX Delta, FX Gamma, FX Vega.](./Fig/20.png)

Figure 471: a) FX Delta, b) FX Gamma, and c) FX Vega as a function of relative shifts of the foreign (USD) IR volatility.

#### 4.12.6.5 FX Spot Shifts

Figures 472 and 473 show the PV and the risk sensitivities as a function of the JPY/USD FX spot. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected. This is a quanto product with no FX currency conversion, therefore we do not expect any dependence to the FX spot rate.

![Figure 472: Price, Flat Delta, Flat Gamma, Flat Vega.](./Fig/21.png)

Figure 472: a) Price, b) Flat Delta - JPY, c) Flat Delta - USD, d) Flat Gamma - JPY, e) Flat Gamma - USD, f) Flat Vega - JPY, and g) Flat Vega - USD as a function of relative shifts of the JPY/USD FX spot. The profiles of the PV and risk sensitivities are smooth and as expected. There is no dependence to the FX spot rate because this is a quanto product with no FX currency conversion.

![Figure 473: FX Delta, FX Gamma, FX Vega.](./Fig/22.png)

Figure 473: a) FX Delta, b) FX Gamma, and c) FX Vega as a function of relative shifts of the JPY/USD FX spot. There is no dependence to the FX spot rate because this is a quanto product with no FX currency conversion.

#### 4.12.6.6 FX Volatility Shifts

Figures 474 and 475 show the PV and the risk sensitivities as a function of the JPY/USD FX volatility. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 474: Price and risk sensitivities.](./Fig/23.png)

Figure 474: a) Price, b) Flat Delta - JPY, c) Flat Delta - USD, d) Flat Gamma - JPY, e) Flat Gamma - USD, f) Flat Vega - JPY, and g) Flat Vega - USD as a function of relative shifts of the JPY/USD FX volatility. The profiles of the PV and risk sensitivities are smooth and as expected.

![Figure 475: FX risk sensitivities.](./Fig/24.png)

Figure 475: a) FX Delta, b) FX Gamma, and c) FX Vega as a function of relative shifts of the JPY/USD FX volatility.

#### 4.12.6.7 FX VolOfVol Shifts

Figures 476 and 477 show the PV and the risk sensitivities as a function of the JPY/USD FX vol-of-vol. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 476: Price and risk sensitivities.](./Fig/25.png)

Figure 476: a) Price, b) Flat Delta - JPY, c) Flat Delta - USD, d) Flat Gamma - JPY, e) Flat Gamma - USD, f) Flat Vega - JPY, and g) Flat Vega - USD as a function of relative shifts of the JPY/USD FX vol-of-vol. The profiles of the PV and risk sensitivities are smooth and as expected.

![Figure 477: FX risk sensitivities.](./Fig/26.png)

Figure 477: a) FX Delta, b) FX Gamma, and c) FX Vega as a function of relative shifts of the JPY/USD FX vol-of-vol.

### 4.12.7 IRRBB Testing

#### 4.12.7.1 Domestic IR Curve Shifts

Figure 478 shows the PV as a function of the domestic (JPY) interest rate curve for the IRRBB scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 478: IRRBB price sensitivities.](./Fig/27.png)

Figure 478: Price as a function of parallel shifts of the domestic (JPY) IR curve for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.

#### 4.12.7.2 Foreign IR Curve Shifts

Figure 479 shows the PV as a function of the foreign (USD) interest rate curve for the IRRBB scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 479: IRRBB price sensitivities.](./Fig/28.png)

Figure 479: Price as a function of parallel shifts of the foreign (USD) IR curve for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.

#### 4.12.7.3 Domestic IR Volatility Shifts

Figure 480 shows the PV as a function of the domestic (JPY) interest rate volatility for the IRRBB scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 480: IRRBB price sensitivities.](./Fig/29.png)

Figure 480: Price as a function of relative shifts of the domestic (JPY) IR volatility for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.

#### 4.12.7.4 Foreign IR Volatility Shifts

Figure 481 shows the PV as a function of the foreign (USD) interest rate volatility for the IRRBB scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 481: IRRBB price sensitivities.](./Fig/30.png)

Figure 481: Price as a function of relative shifts of the foreign (USD) IR volatility for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.

#### 4.12.7.5 FX Spot Shifts

Figure 482 shows the PV as a function of the JPY/USD FX spot for the IRRBB scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 482: IRRBB price sensitivities.](./Fig/31.png)

Figure 482: Price as a function of relative shifts of the JPY/USD FX spot for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.

#### 4.12.7.6 FX Volatility Shifts

Figure 483 shows the PV as a function of the JPY/USD FX volatility for the IRRBB scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 483: IRRBB price sensitivities.](./Fig/32.png)

Figure 483: Price as a function of relative shifts of the JPY/USD FX volatility for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.

#### 4.12.7.7 FX VolOfVol Shifts

Figure 484 shows the PV as a function of the JPY/USD FX vol-of-vol for the IRRBB scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

Figure 484: Price as a function of relative shifts of the JPY/USD FX vol-of-vol for the base and IRRBB scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.

### 4.12.8 CCAR Testing: Price and Risk Sensitivities

#### 4.12.8.1 Domestic IR Curve Shifts

Figure 485 shows the PV and main risk sensitivity as a function of the domestic (JPY) interest rate curve for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 485: CCAR price sensitivities.](./Fig/33.png)

Figure 485: a) Price and b) Flat Delta - JPY as a function of parallel shifts of the domestic (JPY) IR curve for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.

#### 4.12.8.2 Foreign IR Curve Shifts

Figure 486 shows the PV and main risk sensitivity as a function of the foreign (USD) interest rate curve for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 486: CCAR price sensitivities.](./Fig/34.png)

Figure 486: a) Price and b) Flat Delta - USD as a function of parallel shifts of the foreign (USD) IR curve for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.

#### 4.12.8.3 Domestic IR Volatility Shifts

Figure 487 shows the PV and main risk sensitivity as a function of the domestic (JPY) interest rate volatility for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 487: CCAR price sensitivities.](./Fig/35.png)

Figure 487: a) Price and b) Flat Vega - JPY as a function of relative shifts of the domestic (JPY) IR volatility for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.

#### 4.12.8.4 Foreign IR Volatility Shifts

Figure 488 shows the PV and main risk sensitivity as a function of the foreign (USD) interest rate volatility for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 488: CCAR price sensitivities.](./Fig/36.png)

Figure 488: a) Price and b) Flat Vega - USD as a function of relative shifts of the foreign (USD) IR volatility for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.

#### 4.12.8.5 FX Spot Shifts

Figure 489 shows the PV and main risk sensitivity as a function of the JPY/USD FX spot for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 489: CCAR price sensitivities.](./Fig/37.png)

Figure 489: a) Price and b) FX Delta as a function of relative shifts of the JPY/USD FX spot for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.

#### 4.12.8.6 FX Volatility Shifts

Figure 490 shows the PV and main risk sensitivity as a function of the JPY/USD FX volatility for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 490: CCAR price sensitivities.](./Fig/38.png)

Figure 490: a) Price and b) FX Vega as a function of relative shifts of the JPY/USD FX volatility for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.

#### 4.12.8.7 FX VolOfVol Shifts

Figure 491 shows the PV and main risk sensitivity as a function of the JPY/USD FX vol-of-vol for the CCAR scenarios. The test results show that the profiles of the PV and risk sensitivities are smooth and behave as expected.

![Figure 491: CCAR price sensitivities.](./Fig/39.png)

Figure 491: a) Price and b) FX Vega as a function of relative shifts of the JPY/USD FX vol-of-vol for the base and all CCAR scenarios. The profiles of the PV and risk sensitivities are smooth and as expected.

### 4.12.9 Multivar Testing

For the given dictionary, DBAnalytics identifies the following risk factors:

| Type | Currency | AssetName | RiskFactor | Sensitivity to RiskFactor |
| --- | --- | --- | --- | --- |
| IRCURVE | JPY | JPY | CCYSPREAD | YES |
| IRCURVE | JPY | JPY | SWAP | YES |
| IRCURVE | USD | USD | DISCOUNTSPREAD | YES |
| IRCURVE | USD | USD | SWAP | YES |
| FXSPOT | JPY/USD | JPY/USD | SPOT | YES |
| IRDBOPTVOL | JPY | JPY | CMSMAT | YES |
| IRDBOPTVOL | USD | USD | CMSMAT | YES |
| FXMARKETVOL | JPY/USD | JPY/USD | ATMVOL | YES |
| FXMARKETVOL | JPY/USD | JPY/USD | CONVEXITY* | - |
| FXMARKETVOL | JPY/USD | JPY/USD | DELTAVOL | YES |
| FXMARKETVOL | JPY/USD | JPY/USD | SLOPE* | - |
| FXSTOCHDBMVOL | JPY/USD | JPY/USD | LOCALVOL* | - |
| FXSTOCHDBMVOL | JPY/USD | JPY/USD | MEANREV* | - |

Table 125: Risk Factors identified by DBAnalytics in the dictionary of LTFXOneBarDigitalOpt and shock availability in list provided by Market Risk. No shocks are provided for RiskFactors marked with "*".

The identified risk factors are correct: LTFXOneBarDigitalOpt is an FX derivative whose payoff depends on the JPY/USD FX rate. There is two interest rates present in the dictionary: the JPY rate and the USD rate. As described in [21], every curve is constructed starting from a base curve (LIBOR 3M and USD in this case) with the help of additional spreads. The FundingName is assigned "usdsffr" in this security which corresponds to DiscountSpread "usdsffr", therefore DISCOUNTSPREADs are necessary and the product will show sensitivity to them.

| Group | Classification | Product Name | MVR Testing Section | DBA Testing Section |
| --- | --- | --- | --- | --- |
| European-Style Options | LTFX | FXEuroOpt | Section 4.13.5 |  |
|  | LTFX | FXOneBarEuroOpt |  |  |
|  | LTFX | LTFXDigital |  |  |
|  | LTFX | LTFXDigitalKnockOut | Section 4.13.8 |  |
|  | LTFX | LTFXParForwardKnockOut | Section 4.13.7 |  |
|  | LTFX | LTFXRatioForward |  |  |
|  | LTFX | LTFXRatioForwardKnockOut |  |  |
| Forward-Style Contracts | LTFX | FXVolSwap | 4.13.6 | Section 3.3 |
|  | XCCY | IRSwapQuanto |  | Section 3.5 |
|  | LTFX | LTFXParForward |  |  |
| Range Accruals | LTFX | IRFXSwapFXRangeAccrual | Section 4.13.10 | Section 3.6 |
| IR Swap-Style Contracts | LTFX | IRFXSwapFXKnockOut | Section 4.13.9 |  |
|  | LTFX | IRFXSwapFXOpt |  |  |
| PRDCs | LTFX | PRDCSwap |  |  |
|  | LTFX | PRDCSwapCallable | Section 4.13.13 |  |
|  | LTFX | PRDCSwapCallableKO |  |  |
|  | LTFX | PRDCSwapCallableKORedemptionStrike | Section 4.13.14 |  |
|  | LTFX | PRDCSwapCallableRedemptionStrike |  |  |
|  | LTFX | PRDCSwapKO |  |  |
|  | LTFX | PRDCSwapKORedemptionStrike |  |  |
|  | LTFX | PRDCSwapRedemptionStrike |  |  |
|  | LTFX | PRDCSwapTarn |  |  |
|  | LTFX | PRDCSwapTarnRedemptionStrike | Section 4.13.15 |  |
| Bermudan/American-Style Derivatives | LTFX | LTFXPaymentOption |  |  |
|  | LTFX | LTFXRatioForwardCallableKnockOut |  | Section 3.9 |
|  | LTFX | FXAmerOpt | Section 4.13.12 | Section 3.4 |
|  | XCCY | IRSwaptionXCcyBerm |  |  |
|  | XCCY | IRXCcySwapAccretingCallableBerm | Section 4.13.11 | Section 3.1 |
|  | XCCY | IRXCcySwapCallable |  |  |
|  | XCCY | IRXCcySwapCallableBerm |  |  |

Table 126: Products contained in MARS request 16199. The highlighted products have been tested in [29] and the corresponding testing dictionaries have been provided.

In this section, we briefly describe calibration methodology of the interest rate volatility and FX rate volatility and present the tests performed by DBAnalytics and MoRM. DBAnalytics examined the correct implementation and robustness of the calibration process through a series of tests performed in Section 3.1, 3.3, 3.4, 3.5, 3.6 and 3.8 of [29]. Additional independent tests have been performed by MoRM, covering representative products of each Group, see Sections listed in above table.

15. FX volatility: FX vega projection of calibration targets.

16. Sensitivity of calibration to MaxIter values: The PV of the exotic that relies on autocalibration is stable w.r.t. the choice of MaxIter parameter.

17. Benchmark testing: autocalibration vs two-step calibration in stressed scenarios obtained by shifting the input IR vols. The PVs of the exotic computed using the parameters from the two calibration methods are relatively close in the majority of scenarios.

The test results show that the calibration quality remains high in both EOD and stressed market scenarios. Furthermore, the behaviour of the exotic's PV and risk sensitivities is in line with expectations in all considered scenarios.

DBAnalytics findings and recommendations. Based on the tests performed in the developer document [29], DBAnaylitics draws the following conclusions:

1. Since the ShortRate model does not capture smile, ATM co-terminal swaptions should be used in the calibration of the interest rate volatility.

2. The calibration of IR volatility is sensitive to the choice of mean-reversion parameter, which is set exogenously.

3. The initial guess values can have an impact on calibration. In the case of IR volatility calibration, the calibration process exhibits a good convergence under reasonable flat initial guess values. In the case of FX volatility calibration, different values should be set for each of the PV parameters, as a flat initial guess is unlikely to give good results in terms of calibration convergence and pricing behavior.

#### 4.13.2 Description of MoRM testing results

MoRM performed a series of independent tests in the calibration-related subsections of Section 4 intended to confirm the robustness of the calibration process and the correct behaviour of the calibrated parameters, see Table 126 for the relevant sections. The tests also confirm the correct behaviour of the PV and risk sensitivities of exotics relying on the autocalibration. The performed tests are the following:

1. IR volatility: re-pricing of calibration targets used in domestic and foreign interest rate volatility calibrations. The test results show that the calibration quality, expressed as the difference

2. IR volatility: sensitivity of domestic and foreign interest rate volatility calibration to initial guesses used for LocalVols parameters.

3. IR volatility: robustness of calibration under stressed market scenarios obtained by shifting the input IR curves. The test results show that the calibration quality remains high in all considered scenarios.

4. IR volatility: behaviour of bucketed (domestic and foreign) IR rate vega under shifts of IR volatility and FX volatility.

5. IR volatility: impact on price from the choice of calibration targets. The test results show that the IR vega impact is generally significant for long-dated trades when swaption targets are short-dated and this is taken into consideration by limitation 3489 (Section 5.1.1).

6. FX volatility: re-pricing of calibration targets used in FX volatility calibration.

7. FX volatility: impact of initial guesses for VOL, SKEW and SHIFT parameters on the calibration quality.

8. FX volatility: robustness of calibration under stressed market scenarios obtained by shifting the FX spot. The test results show that the calibration quality remains high in all considered scenarios.

9. FX volatility: robustness of calibration under stressed market scenarios obtained by shifting the FX vol;

10. FX volatility: behaviour of FX rate vega under shifts of IR volatility and FX volatility

The test results show that the calibration quality remains high in both EOD and stressed market scenarios. Furthermore, the behaviour of the exotic's PV and risk sensitivities is in line with expectations in all considered scenarios.

#### 4.13.3 Conclusion

The performed tests confirm the correct implementation of the auto-calibration for the products listed in scope of the model. More precisely:

- The calibration quality, expressed as the difference between the input implied volatilities of the targets and the model-generated volatilities of the targets, is high for both IR volatility calibration and FX volatility calibration. The calibration quality and robustness is confirmed in both EOD conditions and stressed market conditions (e.g. under shifts applied to IR curves, FX spot, calibration targets, etc.). See Section 4.13.1 and Section 4.13.2 for the complete list and description of tests.

- The behaviour of the exotic's PV and risk sensitivities (IR FLATDELTA, IR VEGA, FXDELTA, FXVEGA) is in line with expectations in all considered scenarios. See Section 4.13.1 and Section 4.13.2 for the complete list and description of tests.

- The tests performed in Sections 4.13.16.4, where the MC computed DLVIR correction is benchmarked against the analytically computed DLVIR correction show that the DLVIR correction is implemented correctly and its behaviour is in line with expectations. Alternative tests, see Section 4.13.16.5 confirm the correct implementation of the DLVIR correction.

- The tests performed in Section 4.13.17.1 show that the impact of the property DLVIRMethod is negligible.

- The tests performed in Section 4.13.17.2 show that the impact of the property DirectSLVCalculationMethod is negligible, and its impact remains very small even for extremely large values of the vol of vol parameter.

The calibration-related model limitations identified during the latest revalidation (Q2 2020) apply to the auto-calibration described in the present request. These can be found in Section 5.1.1.

#### 4.13.4 Calibration Testing: CMSFXRangeAccrual

Description of tested product: A Constant Maturity Swap FX Range Accrual is a constant maturity swap where the coupons are only accrued when a specified FX rate falls within a given range. We consider a live product, whose dictionary was obtained on 01/05/2019. This is a swap beginning on 11/08/2035 and terminating on 11/08/2035. Both legs receive payments semi-annually. The receiver leg receives a coupon of 6 month JPY LIBOR in arrears with a spread of -0.0005. The pay leg receives a coupon equal to 0.72 times the 20-year JPY CMS rate provided that the JPY/USD FX rate is above 89.635 JPY on the fixing date. If the JPY/USD rate is below 89.635 JPY, then the received coupon is, instead, 0.005. We set the notionals for both legs to be 10000 JPY.

In formulas, the receiver leg coupons are of the form

$$C_i^{(r)} = LIBOR^{(JPY)}(T_i, T_i, T_{i+1}) - 0.0005, \quad \Delta(T_i, T_{i+1}) = 6m,$$

while the payer leg coupons read as

$$C_i^{(p)} = \begin{cases}
CMS_{6m}^{(JPY)}(T_i, T_i, T_i + 20y) & \text{if } JPY/USD(T_i) \geq 89.635 JPY, \\
0.005 & \text{otherwise}.
\end{cases}$$

In this section, we perform several tests in order to ensure the goodness of the calibration procedure for CMS-FXRangeAccrual. The product is tested with model configuration

DBX-ShortRateNormal[LVMRAUTO]_FXSkewStochVol[DLVAUTO].

That is, both the short rate component and the FX component are autocalibrated, as we shall explained and test in the following sections. We recall that the correlation, short rate mean reversion and FX stochastic vols are exogeneously calibrated (the first by the trading desk and the last two by the strats team, at their discretion), thus the calibration process is out of the scope of this MVR.

##### 4.13.4.1 Re-Pricing of Calibration Targets (JPY and USD Vols)

This test verifies that the instruments used as calibration targets for CMSFXRangeAccrual volatilities are re-priced with a great level of accuracy. This requires that the calibration errors are within the specified tolerance levels. The calibration error on a given calibration target may be measured either as the difference between the market price and the model implied price or as the difference between the market implied vol and the model implied vol.

Table 127: Summary of the JPY auto-calibration results of CMSFXRangeAccrual. The results show that the targets are repriced with a great level of accuracy.

| OptionType | Notional | Expiry | Tenor | Strike | MarketVols | ModelVols | VolDiffs | MarketPrices | ModelPrices | PriceDiffs |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| STRADDLE | 100 | 1y | 15y3m | 0.36% | 0.176% | 0.176% | -9.64E-16 | 2.16E+00 | 2.16E+00 | -1.17E-12 |
| STRADDLE | 100 | 1y6m | 14y9m | 0.373% | 0.186% | 0.186% | -1.88E-13 | 2.68E+00 | 2.68E+00 | 2.70E-10 |
| STRADDLE | 100 | 2y | 14y3m | 0.386% | 0.194% | 0.194% | -1.07E-11 | 3.12E+00 | 3.12E+00 | -1.71E-08 |
| STRADDLE | 100 | 3y | 13y3m | 0.421% | 0.206% | 0.206% | -7.93E-12 | 3.77E+00 | 3.77E+00 | -1.45E-08 |
| STRADDLE | 100 | 4y | 12y3m | 0.457% | 0.216% | 0.216% | -3.46E-12 | 4.20E+00 | 4.20E+00 | -4.07E-09 |
| STRADDLE | 100 | 5y | 11y3m | 0.496% | 0.224% | 0.224% | -2.06E-11 | 4.47E+00 | 4.47E+00 | -4.11E-08 |
| STRADDLE | 100 | 7y | 9y3m | 0.573% | 0.238% | 0.238% | -1.38E-11 | 4.61E+00 | 4.61E+00 | -2.67E-08 |
| STRADDLE | 100 | 10y | 6y3m | 0.666% | 0.255% | 0.255% | 7.39E-12 | 3.98E+00 | 3.98E+00 | 1.15E-08 |
| STRADDLE | 100 | 15y | 1y3m | 0.812% | 0.271% | 0.271% | -1.86E-11 | 1.04E+00 | 1.04E+00 | -7.10E-09 |

Table 128: Summary of the USD auto-calibration results of CMSFXRangeAccrual. The results show that the targets are repriced with a great level of accuracy.

| OptionType | Notional | Expiry | Tenor | Strike | MarketVols | ModelVols | VolDiffs | MarketPrices | ModelPrices | PriceDiffs |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| STRADDLE | 100 | 1y | 15y3m | 2.61% | 0.535% | 0.535% | -2.66E-14 | 5.97E+00 | 5.97E+00 | -2.67E-11 |
| STRADDLE | 100 | 1y6m | 14y9m | 2.623% | 0.549% | 0.549% | -6.10E-12 | 6.51E+00 | 6.51E+00 | -7.24E-09 |
| STRADDLE | 100 | 2y | 14y3m | 2.643% | 0.558% | 0.558% | 9.15E-12 | 7.33E+00 | 7.33E+00 | 1.07E-08 |
| STRADDLE | 100 | 3y | 13y3m | 2.685% | 0.569% | 0.569% | -6.78E-12 | 8.40E+00 | 8.40E+00 | -1.00E-08 |
| STRADDLE | 100 | 4y | 12y3m | 2.726% | 0.578% | 0.578% | -2.58E-11 | 8.99E+00 | 8.99E+00 | -4.02E-08 |
| STRADDLE | 100 | 5y | 11y3m | 2.763% | 0.589% | 0.589% | 9.76E-13 | 9.30E+00 | 9.30E+00 | 1.54E-09 |
| STRADDLE | 100 | 7y | 9y3m | 2.824% | 0.583% | 0.583% | -2.44E-11 | 8.73E+00 | 8.73E+00 | -3.65E-08 |
| STRADDLE | 100 | 10y | 6y3m | 2.875% | 0.564% | 0.564% | -2.21E-11 | 6.56E+00 | 6.56E+00 | -2.57E-08 |
| STRADDLE | 100 | 15y | 1y3m | 2.868% | 0.535% | 0.535% | -1.36E-11 | 1.46E+00 | 1.46E+00 | -3.70E-09 |

##### 4.13.4.2 Re-Pricing of Calibration Targets (JPY/USD Vol)

This test verifies that the instruments used as calibration targets for CMSFXRangeAccrual volatilities are re-priced with a great level of accuracy. This requires that the calibration errors are within the specified tolerance levels. The calibration error on a given calibration target may be measured either as the difference between the market price and the model implied price or as the difference between the market implied vol and the model implied vol.

Table 129: Summary of the JPY/USD auto-calibration results of CMSFXRangeAccrual. The results show that the targets are repriced with a great level of accuracy.

| Maturity | Delta | Type | TargetVol | FittedVol | FitError |
|----------|-------|------|-----------|-----------|----------|
| 3m | DN | CALL | 5.869% | 5.869% | 1.20E-14 |
| 3m | 25RR | CALL | -1.546% | -1.546% | -1.94E-14 |
| 3m | 10CVX-DN | CALL | 0.998% | 0.998% | -3.98E-14 |
| 6m | DN | CALL | 6.252% | 6.252% | 1.63E-10 |
| 6m | 25RR | CALL | -1.586% | -1.586% | -2.35E-10 |
| 6m | 10CVX-DN | CALL | 1.062% | 1.062% | -1.29E-09 |
| 1y | DN | CALL | 6.789% | 6.789% | 1.81E-14 |
| 1y | 25RR | CALL | -1.713% | -1.713% | -1.41E-14 |
| 1y | 10CVX-DN | CALL | 1.263% | 1.263% | -3.74E-14 |
| 2y | DN | CALL | 7.361% | 7.361% | 2.00E-14 |
| 2y | 25RR | CALL | -2.104% | -2.104% | -8.70E-15 |
| 2y | 10CVX-DN | CALL | 1.465% | 1.465% | -3.15E-14 |
| 3y | DN | CALL | 7.651% | 7.651% | 3.23E-14 |
| 3y | 25RR | CALL | -2.372% | -2.372% | -8.29E-15 |
| 3y | 10CVX-DN | CALL | 1.636% | 1.636% | -5.05E-14 |
| 5y | DN | CALL | 8.127% | 8.127% | 4.86E-14 |
| 5y | 25RR | CALL | -3.023% | -3.023% | -6.48E-15 |
| 5y | 10CVX-DN | CALL | 1.816% | 1.816% | -8.14E-14 |
| 7y | DN | CALL | 8.83% | 8.83% | 4.63E-14 |
| 7y | 25RR | CALL | -4.173% | -4.173% | -7.83E-15 |
| 7y | 10CVX-DN | CALL | 2.006% | 2.006% | -9.34E-14 |
| 10y | DN | CALL | 10.677% | 10.677% | 4.81E-14 |
| 10y | 25RR | CALL | -5.048% | -5.048% | 4.44E-15 |
| 10y | 10CVX-DN | CALL | 1.98% | 1.98% | -7.75E-14 |
| 15y | DN | CALL | 12.08% | 12.08% | 1.04E-11 |
| 15y | 25RR | CALL | -5.127% | -5.127% | 5.37E-11 |
| 15y | 10CVX-DN | CALL | 1.26% | 1.26% | 1.36E-10 |
| 20y | DN | CALL | 12.206% | 12.206% | 1.01E-11 |
| 20y | 25RR | CALL | -5.194% | -5.194% | 5.17E-11 |
| 20y | 10CVX-DN | CALL | 1.263% | 1.263% | 1.36E-10 |
| 30y | DN | CALL | 12.382% | 12.382% | 9.10E-12 |
| 30y | 25RR | CALL | -5.243% | -5.243% | 4.75E-11 |
| 30y | 10CVX-DN | CALL | 1.261% | 1.261% | 1.30E-10 |

### 4.13.4.3 Stability w.r.t. the Initial Point (JPY and USD Vols)

In this section, we check that the calibration algorithm, when applied to our testing product CMSFXRangeAccrual, is robust to various initial guesses of the parameters. More precisely, we test the following claim. If we denote by LV_calib(p_v) the local volatility obtained by running the calibration algorithm starting from the initial point p_v, then LV_calib|_V is (approximately) constant, where V is the space of flat local volatilities (which are used as initial guesses):

V = { (p_1,...,p) | p ∈ ℝ₊⁺ } ⊂ ℝ₊⁺

Table 130: Volatility differences of the JPY IR auto-calibration of CMSFXRangeAccrual for different (flat) initial guesses. The results show that the targets are repriced with a great level of accuracy.

[Table 130 contains volatility differences data across multiple expiries and tenors with various initial guesses]

Table 131: Summary of the price differences in the JPY IR auto-calibration of CMSFXRangeAccrual for different (flat) initial guesses. The results show that the targets are repriced with a great level of accuracy.

[Table 131 contains price differences data]

Table 132: Volatility differences of the USD IR auto-calibration of CMSFXRangeAccrual for different (flat) initial guesses. The results show that the targets are repriced with a great level of accuracy.

[Table 132 contains volatility differences data]

Table 133: Summary of the price differences in the USD IR auto-calibration of CMSFXRangeAccrual for different (flat) initial guesses. The results show that the targets are repriced with a great level of accuracy.

[Table 133 contains price differences data]

### 4.13.4.4 Stability w.r.t. the Initial Point (JPY/USD Vol)

In this subsection, we check that the calibration process, when applied to our testing product CMSFXRangeAccrual, reproduces in a satisfactory way the market volatility for several choices of initial points. We have chosen 8 different initial points:

| | VOL | SKEW | SMILE |
|------------|-----|------|-------|
| Scenario #1 | 0.2 | 0 | 0 |
| Scenario #2 | 0.1 | 0.1 | 0.1 |
| Scenario #3 | 0.1 | 0 | 0 |
| Scenario #4 | 0 | 0.01 | 0 |
| Scenario #5 | 0 | 0 | 0.01 |
| Scenario #6 | 0.2 | 0.02 | 0.02 |
| Scenario #7 | 0.2 | -0.01 | 0.01 |
| Scenario #8 | 0.2 | -0.2 | 0.2 |

Table 134: The results of the calibration applied to the JPY/USD FX market vol of CMSFXRangeAccrual with several initial points. The calibration matches market volatility up to machine precision.

[Table 134 contains volatility differences data for 8 different scenarios across multiple maturities and deltas]

### 4.13.4.5 Fit quality with respect to the number of Calibration Targets (JPY/USD Vol)

In this section, we confirm that the quality of the fitted implied volatility surface for CMSFXRangeAccrual increases as the number of calibration targets increases. We check it for the JPY/USD Vol and we look at slices of the fitted implied volatility surface for different maturities.

[Figure 493: Implied volatility surface slices for different maturities, as the number of calibration targets increases.]

For the CMSFXRangeAccrual under examination, we are given 33 market data point in the MARKETVOL object, which consist of 3 strikes (given in the delta parameterization) for each maturity. We check the quality of the calibrated volatility when: we calibrate to only 3m and 30y (6 market data points), then 3m, 5y and 30y (9 market data points), 3m, 1y, 3y, 7y, 15y and 30y (18 market data points) and finally to the whole data set (3m, 6m, 1y, 2y, 3y, 5y, 7y, 10y, 15y, 20y, 30y). We see that that quality of the calibration of the CMSFXRangeAccrual JPY/USD volatility increases as the number of targets increases, as expected.

### 4.13.4.6 Convergence Under different Market Scenarios

In this section we verify that the calibration algorithm converges under a range of market conditions (reflected as shifts to the market prices/vols used as calibration targets).

#### Stress Testing: JPY CURVE

In this paragraph, we check the stability of the calibration procedure for CMSFXRangeAccrual when the JPY curve is subject to parallel shifts from -5.0% to 5.0% with steps of 1.00%.

Table 135: Difference between the calibrated and market volatilities for the JPY IR volatility for CMSFXRangeAccrual under several different scenarios, where the JPY IR curve is subject to parallel shifts from -5% to +5%. The results show that the calibration is of great quality under these stressed scenarios.

[Table 135 shows all values are 0, indicating no differences]

Table 136: Difference between the calibrated and market prices for the JPY IR volatility for CMSFXRangeAccrual under several different scenarios, where the JPY IR curve is subject to parallel shifts from -5% to +5%. The results show that the calibration is of great quality under these stressed scenarios.

[Table 136 shows all values are 0.00]

Table 137: Difference between the calibrated and market volatilities for the USD IR volatility for CMSFXRangeAccrual under several different scenarios, where the JPY IR curve is subject to parallel shifts from -5% to +5%. The results show that the calibration is of great quality under these stressed scenarios.

[Table 137 shows all values are 0]

Table 138: Difference between the calibrated and market prices for the USD IR volatility for CMSFXRangeAccrual under several different scenarios, where the JPY IR curve is subject to parallel shifts from -5% to +5%. The results show that the calibration is of great quality under these stressed scenarios.

[Table 138 shows all values are 0.00]

Table 139: Difference between the calibrated and market volatilities for the JPY/USD FX volatility for CMSFXRangeAccrual under several different scenarios, where the JPY IR curve is subject to parallel shifts from -5% to +5%. The results show that the calibration is of great quality under these stressed scenarios.

[Table 139 shows all values are 0.00]

#### Stress Testing: USD CURVE

In this paragraph, we check the stability of the calibration procedure for CMSFXRangeAccrual when the USD curve is subject to parallel shifts from -5.0% to 5.0% with steps of 1.00%.

Table 140: Difference between the calibrated and market volatilities for the JPY IR volatility for CMSFXRangeAccrual under several different scenarios, where the USD IR curve is subject to parallel shifts from -5% to +5%. The results show that the calibration is of great quality under these stressed scenarios.

[Table 140 shows all values are 0]

Table 141: Difference between the calibrated and market prices for the JPY IR volatility for CMSFXRangeAccrual under several different scenarios, where the USD IR curve is subject to parallel shifts from -5% to +5%. The results show that the calibration is of great quality under these stressed scenarios.

[Table 141 shows all values are 0.00]

Table 142: Difference between the calibrated and market volatilities for the USD IR volatility for CMSFXRangeAccrual under several different scenarios, where the USD IR curve is subject to parallel shifts from -5% to +5%. The results show that the calibration is of great quality under these stressed scenarios.

[Table 142 shows all values are 0]

Table 143: Difference between the calibrated and market prices for the USD IR volatility for CMSFXRangeAccrual under several different scenarios, where the USD IR curve is subject to parallel shifts from -5% to +5%. The results show that the calibration is of great quality under these stressed scenarios.

[Table 143 shows all values are 0.00]

Table 144: Difference between the calibrated and market volatilities for the JPY/USD FX volatility for CMSFXRangeAccrual under several different scenarios, where the USD IR curve is subject to parallel shifts from -5% to +5%. The results show that the calibration is of great quality under these stressed scenarios.

[Table 144 shows all values are 0.00]

#### Stress Testing: JPY/USD VOL

In this paragraph, we check the stability of the calibration procedure for CMSFXRangeAccrual when the JPY/USD vol is subject to relative shifts from -90.0% to 200.0% with steps of 32.00%.

Table 145: Difference between the calibrated and market volatilities for the JPY IR volatility for CMSFXRangeAccrual under several different scenarios, where the JPY/USD FX spot is subject to relative shifts from -90% to +200%. The results show that the calibration is of great quality under these stressed scenarios.

[Table 145 shows all values are 0]

Table 146: Difference between the calibrated and market prices for the JPY IR volatility for CMSFXRangeAccrual under several different scenarios, where the JPY/USD JPY/USD FX spot is subject to relative shifts from -90% to +200%. The results show that the calibration is of great quality under these stressed scenarios.

[Table 146 shows all values are 0.00]

Table 147: Difference between the calibrated and market volatilities for the USD IR volatility for CMSFXRangeAccrual under several different scenarios, where the JPY/USD FX spot is subject to relative shifts from -90% to +200%. The results show that the calibration is of great quality under these stressed scenarios.

[Table 147 shows all values are 0]

Table 148: Difference between the calibrated and market prices for the USD IR volatility for CMSFXRangeAccrual under several different scenarios, where the JPY/USD JPY/USD FX spot is subject to relative shifts from -90% to +200%. The results show that the calibration is of great quality under these stressed scenarios.

[Table 148 shows all values are 0.00]

Table 149: Difference between the calibrated and market volatilities for the JPY/USD FX volatility for CMSFXRangeAccrual under several different scenarios, where the JPY/USD FX spot is subject to relative shifts from -90% to +200%. The results show that the calibration is of great quality under these stressed scenarios.

[Table 149 shows all values are 0.00]

#### Stress Testing: JPY VOL

In this paragraph, we check the stability of the calibration procedure for CMSFXRangeAccrual when the JPY vol is subject to relative shifts from -90.0% to 200.0% with steps of 32.00%.

Table 150: Difference calibration of the JPY IR volatility for CMSFXRangeAccrual under several different scenarios, where the JPY volatility is subject to relative shifts from -90% to 200%. The results show that the calibration is of great quality under these stressed scenarios.

[Table 150 shows values of -0.00]

Table 151: Results of the calibration algorithm under several different scenarios, where the JPY IR volatility is subject to relative shifts from -90% to 200%. The results show that the calibration is of great quality under these stressed scenarios.

[Table 151 shows price differences across different scenarios]

#### Stress Testing: USD VOL

In this paragraph, we check the stability of the calibration procedure for CMSFXRangeAccrual when the USD vol is subject to relative shifts from -90.0% to 200.0% with steps of 32.00%.

Table 152: Difference calibration of the USD IR volatility for CMSFXRangeAccrual under several different scenarios, where the USD volatility is subject to relative shifts from -90% to 200%. The results show that the calibration is of great quality under these stressed scenarios.

[Table 152 shows values of -0.00 and 0.00]

Table 153: Results of the calibration algorithm under several different scenarios, where the USD IR volatility is subject to relative shifts from -90% to 200%. The results show that the calibration is of great quality under these stressed scenarios.

[Table 153 shows price differences across different scenarios]

#### Stress Testing: JPY/USD VOL

In this paragraph, we check the stability of the calibration procedure for CMSFXRangeAccrual when the JPY/USD vol is subject to relative shifts from -60.0% to 60.0% with steps of 13.00%.

Table 154: Results of the calibration of the JPY/USD FX volatility of CMSFXRangeAccrual under several different scenarios, where the JPY/USD volatility is subject to relative shifts from -60% to 60%. The results show that the calibration is of great quality under these stressed scenarios.

[Table 154 shows very small differences in scientific notation]

### 4.13.4.7 Risk Projection on Calibration Targets

In this section, we compute the bucketed vegas for CMSFXRangeAccrual under market stress.

#### Stress Testing: JPY CURVE

In this paragraph, we check the bucketed vegas for CMSFXRangeAccrual when the JPY curve is subject to parallel
&&